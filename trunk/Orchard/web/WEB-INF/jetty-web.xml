<?xml version="1.0"  encoding="ISO-8859-1"?>
<!DOCTYPE Configure PUBLIC "-//Mort Bay Consulting//DTD Configure//EN" "http://jetty.mortbay.org/configure.dtd">

<!-- jetty-web.xml - Jetty Web server Web application configuration
     Project Orchard

     $Id$

     Copyright (c) 2010 The University of Texas at Austin. All rights reserved.

     Use and redistribution of this file is governed by the license terms in
     the LICENSE file found in the project's top-level directory and also found at
     URL: http://orc.csres.utexas.edu/license.shtml .
  -->

<!-- See http://docs.codehaus.org/display/JETTY/jetty-web.xml -->
<!-- This config publishes the Orchard Web services endpoints at .../json/... and .../soap/... -->
<!-- Until we move to JSR 109 annotations, Web service configuration requires proprietary methods :-( -->

<Configure class="org.mortbay.jetty.webapp.WebAppContext">

	<!-- HttpServer httpServer = new JettyHttpServer(webappContext.getServer(), true); -->
	<New id="HttpServer" class="org.mortbay.jetty.j2se6.JettyHttpServer">
		<Arg>
			<Get name="server" />
		</Arg>
		<Arg type="boolean">true</Arg>
	</New>

	<!-- String webappPath = webappContext.getContextPath(); -->
	<Get id="WebappPath" name="contextPath" />

	<!-- HttpContext soapCompilerContext = httpServer.createContext(webappPath+"/soap/compiler"); -->
	<Ref id="HttpServer">
		<Call id="SoapCompilerContext" name="createContext">
			<Arg>
				<Ref id="WebappPath">
					<Call name="concat">
						<Arg>/soap/compiler</Arg>
					</Call>
				</Ref>
			</Arg>
		</Call>
	</Ref>

	<Call class="java.lang.Thread" name="dumpStack"/>

	<!-- Endpoint.create(new orc.orchard.soap.CompilerService()).publish(soapCompilerContext); -->
	<Call class="javax.xml.ws.Endpoint" name="create">
		<Arg>
			<New class="orc.orchard.soap.CompilerService" />
		</Arg>
		<Call name="publish">
			<Arg ref="SoapCompilerContext" />
		</Call>
	</Call>

	<!-- HttpContext soapExecutorContext = httpServer.createContext(webappPath+"/soap/executor"); -->
	<Ref id="HttpServer">
		<Call id="SoapExecutorContext" name="createContext">
			<Arg>
				<Ref id="WebappPath">
					<Call name="concat">
						<Arg>/soap/executor</Arg>
					</Call>
				</Ref>
			</Arg>
		</Call>
	</Ref>

	<!-- Endpoint.create(new orc.orchard.soap.ExecutorService()).publish(soapExecutorContext); -->
	<Call class="javax.xml.ws.Endpoint" name="create">
		<Arg>
			<New class="orc.orchard.soap.ExecutorService" />
		</Arg>
		<Call name="publish">
			<Arg ref="SoapExecutorContext" />
		</Call>
	</Call>

	<!-- HttpContext jsonCompilerContext = httpServer.createContext(webappPath+"/json/compiler"); -->
	<Ref id="HttpServer">
		<Call id="JsonCompilerContext" name="createContext">
			<Arg>
				<Ref id="WebappPath">
					<Call name="concat">
						<Arg>/json/compiler</Arg>
					</Call>
				</Ref>
			</Arg>
		</Call>
	</Ref>

	<!-- Endpoint.create("https://jax-ws-commons.dev.java.net/json/", new orc.orchard.soap.CompilerService()).publish(jsonCompilerContext); -->
	<Call class="javax.xml.ws.Endpoint" name="create">
		<Arg>https://jax-ws-commons.dev.java.net/json/</Arg>
		<Arg>
			<New class="orc.orchard.soap.CompilerService" />
		</Arg>
		<Call name="publish">
			<Arg ref="JsonCompilerContext" />
		</Call>
	</Call>
	
	<!-- HttpContext jsonExecutorContext = httpServer.createContext(webappPath+"/json/executor"); -->
	<Ref id="HttpServer">
		<Call id="JsonExecutorContext" name="createContext">
			<Arg>
				<Ref id="WebappPath">
					<Call name="concat">
						<Arg>/json/executor</Arg>
					</Call>
				</Ref>
			</Arg>
		</Call>
	</Ref>

	<!-- Endpoint.create("https://jax-ws-commons.dev.java.net/json/", new orc.orchard.soap.ExecutorService()).publish(jsonExecutorContext); -->
	<Call class="javax.xml.ws.Endpoint" name="create">
		<Arg>https://jax-ws-commons.dev.java.net/json/</Arg>
		<Arg>
			<New class="orc.orchard.soap.ExecutorService" />
		</Arg>
		<Call name="publish">
			<Arg ref="JsonExecutorContext" />
		</Call>
	</Call>

</Configure>
