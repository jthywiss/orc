/**
 * CodeMirror 0.58 http://marijn.haverbeke.nl/codemirror/
 *
 * This is a minified version created by Adrian Quark for the Orc project:
 * http://orc.csres.utexas.edu. It is otherwise unmodified.
 *
 * ------------ ORIGINAL LICENSE FOLLOWS -----------------
 *
 * Copyright (c) 2007 Marijn Haverbeke
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any
 * damages arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any
 * purpose, including commercial applications, and to alter it and
 * redistribute it freely, subject to the following restrictions:
 *
 * 1. The origin of this software must not be misrepresented; you must
 *    not claim that you wrote the original software. If you use this
 *    software in a product, an acknowledgment in the product
 *    documentation would be appreciated but is not required.
 *
 * 2. Altered source versions must be plainly marked as such, and must
 *    not be misrepresented as being the original software.
 *
 * 3. This notice may not be removed or altered from any source
 *    distribution.
 *
 * Marijn Haverbeke
 * marijnh at gmail
 */
var Editor=(function(){var I={P:true,DIV:true,LI:true};function D(Q){var P=[],O=true;for(;Q>0;Q--){P.push((O||Q==1)?nbsp:" ");O=!O}return P.join("")}function E(O){if(O==" "){return nbsp}else{return O.replace(/[\t \u00a0]{2,}/g,function(P){return D(P.length)})}}function C(O){return E(O.replace(/\u00a0/g," ")).replace(/\r\n?/g,"\n").split("\n")}var A=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent);function F(P){var R=P.ownerDocument;var O=[];var S=false;function Q(T){if(T.nodeType==3){var U=T.nodeValue=E(T.nodeValue.replace(/[\n\r]/g,""));if(U.length){S=false}O.push(T)}else{if(T.nodeName=="BR"&&T.childNodes.length==0){S=true;O.push(T)}else{forEach(T.childNodes,Q);if(!S&&I.hasOwnProperty(T.nodeName)){S=true;O.push(R.createElement("BR"))}}}}Q(P);return O}function G(O){function P(b,d){R=d;return b}function W(d,b,e){return function(){return d(b,e)}}function X(){R=X;throw StopIteration}var R=W(Y,O,X);var Q=O.ownerDocument;var S=[];function V(d){var c=d.parentNode;var b=d.nextSibling;return function(e){c.insertBefore(e,b)}}var Z=null;function T(b){var d="\n";if(b.nodeType==3){select.moveSelection();d=b.nodeValue;var c=Q.createElement("SPAN");c.className="part";c.appendChild(b);b=c;b.currentText=d}b.dirty=true;S.push(b);Z(b);return d}function U(d,e){var b=[];forEach(F(d),function(c){b.push(T(c))});return P(b.join(""),e)}function a(b){if(b.nodeName=="SPAN"&&b.childNodes.length==1&&b.firstChild.nodeType==3){b.currentText=b.firstChild.nodeValue;return true}return false}function Y(b,d){if(b.nextSibling){d=W(Y,b.nextSibling,d)}if(a(b)){S.push(b);return P(b.currentText,d)}else{if(b.nodeName=="BR"){S.push(b);return P("\n",d)}else{Z=V(b);removeElement(b);return U(b,d)}}}return{next:function(){return R()},nodes:S}}function K(O){if(O.nodeName=="BR"){return 1}else{return O.currentText.length}}function M(O){while(O&&O.nodeName!="BR"){O=O.previousSibling}return O}function J(O){return O.replace(/\u00a0/g," ")}function L(R,Q,P){this.editor=R;this.history=R.history;this.history.commit();this.atOccurrence=false;this.fallbackSize=15;var T;if(P&&(T=select.cursorPos(this.editor.container))){this.line=T.node;this.offset=T.offset}else{this.line=null;this.offset=0}this.valid=!!Q;var S=Q.split("\n"),O=this;this.matches=(S.length==1)?function(){var U=J(O.history.textAfter(O.line).slice(O.offset)).indexOf(Q);if(U>-1){return{from:{node:O.line,offset:O.offset+U},to:{node:O.line,offset:O.offset+U+Q.length}}}}:function(){var X=J(O.history.textAfter(O.line).slice(O.offset));var W=X.lastIndexOf(S[0]);if(W==-1||W!=X.length-S[0].length){return false}var U=O.offset+W;var V=O.history.nodeAfter(O.line);for(var Y=1;Y<S.length-1;Y++){if(J(O.history.textAfter(V))!=S[Y]){return false}V=O.history.nodeAfter(V)}if(J(O.history.textAfter(V)).indexOf(S[S.length-1])!=0){return false}return{from:{node:O.line,offset:U},to:{node:V,offset:S[S.length-1].length}}}}L.prototype={findNext:function(){if(!this.valid){return false}this.atOccurrence=false;var O=this;if(this.line&&!this.line.parentNode){this.line=null;this.offset=0}function Q(R){if(O.history.textAfter(R.node).length<R.offset){O.line=R.node;O.offset=R.offset+1}else{O.line=O.history.nodeAfter(R.node);O.offset=0}}while(true){var P=this.matches();if(P){this.atOccurrence=P;Q(P.from);return true}this.line=this.history.nodeAfter(this.line);this.offset=0;if(!this.line){this.valid=false;return false}}},select:function(){if(this.atOccurrence){select.setCursorPos(this.editor.container,this.atOccurrence.from,this.atOccurrence.to);select.scrollToCursor(this.editor.container)}},replace:function(P){if(this.atOccurrence){var O=this.editor.replaceRange(this.atOccurrence.from,this.atOccurrence.to,P);this.line=O.node;this.offset=O.offset;this.atOccurrence=false}}};function H(P){this.options=P;this.parent=parent;this.doc=document;this.container=this.doc.body;this.win=window;this.history=new History(this.container,this.options.undoDepth,this.options.undoDelay,this,P.onChange);if(!H.Parser){throw"No parser loaded."}if(P.parserConfig&&H.Parser.configure){H.Parser.configure(P.parserConfig)}if(!P.textWrapping){this.container.style.whiteSpace="pre"}if(!P.readOnly){select.setCursorPos(this.container,{node:null,offset:0})}this.dirty=[];if(P.content){this.importCode(P.content)}else{this.container.appendChild(this.doc.createElement("BR"))}if(!P.readOnly){if(P.continuousScanning!==false){this.scanner=this.documentScanner(P.linesPerPass);this.delayScanning()}function Q(){if(document.body.contentEditable!=undefined&&/MSIE/.test(navigator.userAgent)){document.body.contentEditable="true"}else{document.designMode="on"}}try{Q()}catch(R){var O=addEventHandler(document,"focus",function(){removeEventHandler(O);Q()})}addEventHandler(document,"keydown",method(this,"keyDown"));addEventHandler(document,"keypress",method(this,"keyPress"));addEventHandler(document,"keyup",method(this,"keyUp"));addEventHandler(document.body,"paste",method(this,"markCursorDirty"));addEventHandler(document.body,"cut",method(this,"markCursorDirty"));if(this.options.autoMatchParens){addEventHandler(document.body,"click",method(this,"scheduleParenBlink"))}}}function N(O){var P=0;while(O&&(!O.parserFromHere||O.dirty)){P+=(O.textContent||O.innerText||"-").length;if(P>800){return false}O=O.previousSibling}return true}function B(O){return(O>=16&&O<=18)||(O>=33&&O<=40)}H.prototype={importCode:function(O){this.history.push(null,null,C(O));this.history.reset()},getCode:function(){if(!this.container.firstChild){return""}var O=[],P=select.markSelection(this.win);forEach(G(this.container.firstChild),method(O,"push"));select.selectMarked(P);return J(O.join(""))},jumpToLine:function(O){if(O<=1||!this.container.firstChild){select.focusAfterNode(null,this.container)}else{var P=this.container.firstChild;while(true){if(P.nodeName=="BR"){O--}if(O<=1||!P.nextSibling){break}P=P.nextSibling}select.focusAfterNode(P,this.container)}select.scrollToCursor(this.container)},currentLine:function(){var P=select.cursorPos(this.container,true),O=1;if(!P){return 1}for(cursor=P.node;cursor;cursor=cursor.previousSibling){if(cursor.nodeName=="BR"){O++}}return O},selectedText:function(){var P=this.history;P.commit();var R=select.cursorPos(this.container,true),O=select.cursorPos(this.container,false);if(!R||!O){return""}if(R.node==O.node){return P.textAfter(R.node).slice(R.offset,O.offset)}var Q=[P.textAfter(R.node).slice(R.offset)];for(pos=P.nodeAfter(R.node);pos!=O.node;pos=P.nodeAfter(pos)){Q.push(P.textAfter(pos))}Q.push(P.textAfter(O.node).slice(0,O.offset));return J(Q.join("\n"))},replaceSelection:function(P){this.history.commit();var Q=select.cursorPos(this.container,true),O=select.cursorPos(this.container,false);if(!Q||!O){return false}O=this.replaceRange(Q,O,P);select.setCursorPos(this.container,Q,O);return true},replaceRange:function(T,S,R){var Q=C(R);Q[0]=this.history.textAfter(T.node).slice(0,T.offset)+Q[0];var P=Q[Q.length-1];Q[Q.length-1]=P+this.history.textAfter(S.node).slice(S.offset);var O=this.history.nodeAfter(S.node);this.history.push(T.node,O,Q);return{node:this.history.nodeBefore(O),offset:P.length}},getSearchCursor:function(P,O){return new L(this,P,O)},reindent:function(){if(this.container.firstChild){this.indentRegion(null,this.container.lastChild)}},keyDown:function(O){this.delayScanning();if(this.options.autoMatchParens){this.scheduleParenBlink()}if(O.keyCode==13){if(O.ctrlKey){this.reparseBuffer()}else{select.insertNewlineAtCursor(this.win);this.indentAtCursor();select.scrollToCursor(this.container)}O.stop()}else{if(O.keyCode==9){this.handleTab();O.stop()}else{if(O.ctrlKey){if(O.keyCode==90||O.keyCode==8){this.history.undo();O.stop()}else{if(O.keyCode==89){this.history.redo();O.stop()}else{if(O.keyCode==83&&this.options.saveFunction){this.options.saveFunction();O.stop()}}}}}}},keyPress:function(P){var O=H.Parser.electricChars;if(P.code==13||P.code==9){P.stop()}else{if((P.character=="["||P.character=="]")&&P.ctrlKey){P.stop(),this.blinkParens()}else{if(O&&O.indexOf(P.character)!=-1){this.parent.setTimeout(method(this,"indentAtCursor"),0)}}}},keyUp:function(O){if(A){this.container.createTextRange().execCommand("unlink")}if(!B(O.keyCode)){this.markCursorDirty()}},indentLineAfter:function(T){var S=T?T.nextSibling:this.container.firstChild;if(S&&!hasClass(S,"whitespace")){S=null}var P=S?S.nextSibling:(T?T.nextSibling:this.container.firstChild);var Q=(T&&P&&P.currentText)?P.currentText:"";var O=T?T.indentation(Q):0;var R=O-(S?S.currentText.length:0);if(R<0){if(O==0){removeElement(S);S=null}else{S.currentText=D(O);S.firstChild.nodeValue=S.currentText}}else{if(R>0){if(S){S.currentText=D(O);S.firstChild.nodeValue=S.currentText}else{S=this.doc.createElement("SPAN");S.className="part whitespace";S.appendChild(this.doc.createTextNode(D(O)));if(T){insertAfter(S,T)}else{this.container.insertBefore(S,this.container.firstChild)}}}}return S},highlightAtCursor:function(){var S=select.selectionTopNode(this.container,true);var R=select.selectionTopNode(this.container,false);if(S===false||!R){return }if(R.nextSibling){R=R.nextSibling}var Q=select.markSelection(this.win);var P=R.nodeType==3;if(!P){R.dirty=true}while(R.parentNode==this.container&&(P||R.dirty)){var O=this.highlight(S,1,true);if(O){S=O.node}if(!O||O.left){break}}select.selectMarked(Q)},handleTab:function(){if(this.options.dumbTabs){select.insertTabAtCursor(this.win)}else{var P=select.selectionTopNode(this.container,true),O=select.selectionTopNode(this.container,false);if(P===false||O===false){return }if(P==O){this.indentAtCursor()}else{this.indentRegion(P,O)}}},scheduleParenBlink:function(){if(this.parenEvent){this.parent.clearTimeout(this.parenEvent)}this.parenEvent=this.parent.setTimeout(method(this,"blinkParens"),300)},blinkParens:function(){if(this.parenEvent){this.parent.clearTimeout(this.parenEvent)}this.parenEvent=null;function V(a){if(a.currentText){var Z=a.currentText.match(/^[\s\u00a0]*([\(\)\[\]{}])[\s\u00a0]*$/);return Z&&Z[1]}}function R(Z){return/[\(\[\{]/.test(Z)}var O,X=this,W=select.selectionTopNode(this.container,true);if(!W||!N(W)){return }this.highlightAtCursor();W=select.selectionTopNode(this.container,true);if(!W||!(O=V(W))){return }var U=W.className,Q=R(O),S=matching[O];function T(){var Z=[],b,a=true;for(var c=W;c;c=Q?c.nextSibling:c.previousSibling){if(c.className==U&&c.nodeName=="SPAN"&&(b=V(c))){if(R(b)==Q){Z.push(b)}else{if(!Z.length){a=false}else{if(Z.pop()!=matching[b]){a=false}}}if(!Z.length){break}}else{if(c.dirty||c.nodeName!="SPAN"&&c.nodeName!="BR"){return{node:c,status:"dirty"}}}}return{node:c,status:c&&a}}function P(a,Z){a.style.fontWeight="bold";a.style.color=Z?"#8F8":"#F88";X.parent.setTimeout(function(){a.style.fontWeight="";a.style.color=""},500)}while(true){var Y=T();if(Y.status=="dirty"){this.highlight(Y.node,1);Y.node.dirty=false;continue}else{P(W,Y.status);if(Y.node){P(Y.node,Y.status)}break}}},indentAtCursor:function(){if(!this.container.firstChild){return }this.highlightAtCursor();var Q=select.selectionTopNode(this.container,false);if(Q===false){return }var O=M(Q);var P=this.indentLineAfter(O);if(Q==O&&P){Q=P}if(Q==P){select.focusAfterNode(Q,this.container)}},indentRegion:function(S,P){var R=select.markSelection(this.win);if(!S){this.indentLineAfter(S)}else{S=M(S.previousSibling)}P=M(P);while(true){var O=this.highlight(S,1);var Q=O?O.node:null;while(S!=Q){S=S?S.nextSibling:this.container.firstChild}if(Q){this.indentLineAfter(Q)}if(S==P){break}}select.selectMarked(R)},markCursorDirty:function(){var O=select.selectionTopNode(this.container,false);if(O!==false&&this.container.firstChild){this.scheduleHighlight();this.addDirtyNode(O||this.container.firstChild)}},reparseBuffer:function(){forEach(this.container.childNodes,function(O){O.dirty=true});if(this.container.firstChild){this.addDirtyNode(this.container.firstChild)}},addDirtyNode:function(P){P=P||this.container.firstChild;if(!P){return }for(var O=0;O<this.dirty.length;O++){if(this.dirty[O]==P){return }}if(P.nodeType!=3){P.dirty=true}this.dirty.push(P)},scheduleHighlight:function(){var O=this;this.parent.clearTimeout(this.highlightTimeout);this.highlightTimeout=this.parent.setTimeout(function(){O.highlightDirty()},this.options.passDelay)},getDirtyNode:function(){while(this.dirty.length>0){var O=this.dirty.pop();try{while(O&&O.parentNode!=this.container){O=O.parentNode}if(O&&(O.dirty||O.nodeType==3)){return O}}catch(P){}}return null},highlightDirty:function(R){var P=R?Infinity:this.options.linesPerPass;var Q=this.options.readOnly?null:select.markSelection(this.win);var S;while(P>0&&(S=this.getDirtyNode())){var O=this.highlight(S,P);if(O){P=O.left;if(O.node&&O.dirty){this.addDirtyNode(O.node)}}}if(!this.options.readOnly){select.selectMarked(Q)}if(S){this.scheduleHighlight()}return this.dirty.length==0},documentScanner:function(O){var P=this,Q=null;return function(){if(Q&&Q.parentNode!=P.container){Q=null}var T=select.markSelection(P.win);var R=P.highlight(Q,O,true);select.selectMarked(T);var S=R?(R.node&&R.node.nextSibling):null;Q=(Q==S)?null:S;P.delayScanning()}},delayScanning:function(){if(this.scanner){this.parent.clearTimeout(this.documentScan);this.documentScan=this.parent.setTimeout(this.scanner,this.options.continuousScanning)}},highlight:function(Y,c,T){var P=this.container,a=this;if(!P.firstChild){return }while(Y&&(!Y.parserFromHere||Y.dirty)){Y=Y.previousSibling}if(Y&&!Y.nextSibling){return }function O(e,d){return !d.reduced&&d.currentText==e.value&&d.className=="part "+e.style}function b(d,e){d.currentText=d.currentText.substring(e);d.reduced=true}function R(e){var d=a.doc.createElement("SPAN");d.className="part "+e.style;d.appendChild(a.doc.createTextNode(e.value));d.currentText=e.value;return d}var W=G(Y?Y.nextSibling:P.firstChild),Z=stringStream(W),X=Y?Y.parserFromHere(Z):H.Parser.make(Z);var S={current:null,get:function(){if(!this.current){this.current=W.nodes.shift()}return this.current},next:function(){this.current=null},remove:function(){P.removeChild(this.get());this.current=null},getNonEmpty:function(){var e=this.get();while(e&&e.nodeName=="SPAN"&&e.currentText==""){var d=e;this.remove();e=this.get();select.moveSelection(d.firstChild,e.firstChild||e,0,0)}return e}};var V=false,Q=true,U=0;forEach(X,function(f){var e=S.getNonEmpty();if(f.value=="\n"){if(e.nodeName!="BR"){throw"Parser out of sync. Expected BR."}if(e.dirty||!e.indentation){V=true}if(V){a.history.touch(Y)}Y=e;e.parserFromHere=X.copy();e.indentation=f.indentation;e.dirty=false;if((c!==undefined&&--c<=0)||(!V&&!Q&&U>1&&!T)){throw StopIteration}Q=V;V=false;U=0;S.next()}else{if(e.nodeName!="SPAN"){throw"Parser out of sync. Expected SPAN."}if(e.dirty){V=true}U++;if(O(f,e)){e.dirty=false;S.next()}else{V=true;var d=R(f);P.insertBefore(d,e);var i=f.value.length;var h=0;while(i>0){e=S.get();var g=e.currentText.length;select.moveSelection(e.firstChild,d.firstChild,i,h);if(g>i){b(e,i);i=0}else{i-=g;h+=g;S.remove()}}}}});if(V){this.history.touch(Y)}return{left:c,node:S.get(),dirty:V}}};return H})();addEventHandler(window,"load",function(){var A=window.frameElement.CodeMirror;A.editor=new Editor(A.options);if(A.options.initCallback){this.parent.setTimeout(function(){A.options.initCallback(A)},0)}});var select={};(function(){var C=document.selection&&document.selection.createRangeCollection;function D(J,K){while(J&&J.parentNode!=K){J=J.parentNode}return J}function I(J,K){while(!J.previousSibling&&J.parentNode!=K){J=J.parentNode}return D(J.previousSibling,K)}var H=false;var E="\u00a0\u00a0\u00a0\u00a0";if(C){select.markSelection=function(N){var M=N.document.selection;var O=M.createRange(),K=O.duplicate();var L=O.getBookmark();O.collapse(true);K.collapse(false);H=false;var J=N.document.body;return{start:{x:O.boundingLeft+J.scrollLeft-1,y:O.boundingTop+J.scrollTop},end:{x:K.boundingLeft+J.scrollLeft-1,y:K.boundingTop+J.scrollTop},window:N,bookmark:L}};select.selectMarked=function(M){if(!M||!H){return }H=false;var L=M.window.document.body.createTextRange(),J=L.duplicate();var K=false;if(M.start.y>=0&&M.end.y<M.window.document.body.clientHeight){try{L.moveToPoint(M.start.x,M.start.y);J.moveToPoint(M.end.x,M.end.y);L.setEndPoint("EndToStart",J);K=true}catch(N){}}if(!K){K=L.moveToBookmark(M.bookmark)}if(K){L.select()}};select.moveSelection=function(){H=true};select.selectionTopNode=function(L,Q){var O=L.ownerDocument.selection;if(!O){return false}var N=O.createRange();N.collapse(Q);var P=N.parentElement();if(P&&isAncestor(L,P)){var K=N.duplicate();K.moveToElementText(P);if(N.compareEndPoints("StartToStart",K)==-1){return D(P,L)}}N.pasteHTML("<span id='xxx-temp-xxx'></span>");var M=L.ownerDocument.getElementById("xxx-temp-xxx");if(M){var J=I(M,L);removeElement(M);return J}return false};select.focusAfterNode=function(L,J){var K=J.ownerDocument.body.createTextRange();K.moveToElementText(L||J);K.collapse(!L);K.select()};function B(M,K){var L=M.document.selection;if(L){var J=L.createRange();J.pasteHTML(K);J.collapse(false);J.select()}}select.insertNewlineAtCursor=function(J){B(J,"<br/>")};select.insertTabAtCursor=function(J){B(J,E)};select.cursorPos=function(K,P){var N=K.ownerDocument.selection;if(!N){return null}var M=select.selectionTopNode(K,P);while(M&&M.nodeName!="BR"){M=M.previousSibling}var L=N.createRange(),J=L.duplicate();L.collapse(P);if(M){J.moveToElementText(M);J.collapse(false)}else{try{J.moveToElementText(K)}catch(O){return null}J.collapse(true)}L.setEndPoint("StartToStart",J);return{node:M,offset:L.text.length}};select.setCursorPos=function(K,N,M){function J(P){var O=K.ownerDocument.body.createTextRange();if(!P.node){O.moveToElementText(K);O.collapse(true)}else{O.moveToElementText(P.node);O.collapse(false)}O.move("character",P.offset);return O}var L=J(N);if(M&&M!=N){L.setEndPoint("EndToEnd",J(M))}L.select()};select.scrollToCursor=function(J){var K=J.ownerDocument.selection;if(!K){return null}K.createRange().scrollIntoView()}}else{var G=!window.scrollX&&!window.scrollY;select.markSelection=function(N){H=false;var M=N.getSelection();if(!M||M.rangeCount==0){return null}var L=M.getRangeAt(0);var J={start:{node:L.startContainer,offset:L.startOffset},end:{node:L.endContainer,offset:L.endOffset},window:N,scrollX:G&&N.document.body.scrollLeft,scrollY:G&&N.document.body.scrollTop};function K(O){while(O.node.nodeType!=3&&O.node.nodeName!="BR"){var P=O.node.childNodes[O.offset]||O.node.nextSibling;O.offset=0;while(!P&&O.node.parentNode){O.node=O.node.parentNode;P=O.node.nextSibling}O.node=P;if(!P){break}}}K(J.start);K(J.end);if(J.start.node){J.start.node.selectStart=J.start}if(J.end.node){J.end.node.selectEnd=J.end}return J};select.selectMarked=function(L){if(!L||!H){return }var M=L.window;var K=M.document.createRange();function J(N,O){if(N.node){delete N.node["select"+O];if(N.offset==0){K["set"+O+"Before"](N.node)}else{K["set"+O](N.node,N.offset)}}else{K.setStartAfter(M.document.body.lastChild||M.document.body)}}if(G){L.window.document.body.scrollLeft=L.scrollX;L.window.document.body.scrollTop=L.scrollY}J(L.end,"End");J(L.start,"Start");F(K,M)};select.moveSelection=function(M,K,L,N){H=true;if(M==undefined){return }function J(P){var O=M["select"+P];if(O){if(O.offset>L){O.offset-=L}else{K["select"+P]=O;delete M["select"+P];O.node=K;O.offset+=(N||0)}}}J("Start");J("End")};function F(J,L){var K=L.getSelection();K.removeAllRanges();K.addRange(J)}function A(K){var J=K.getSelection();if(!J||J.rangeCount==0){return false}else{return J.getRangeAt(0)}}select.selectionTopNode=function(J,N){var K=A(J.ownerDocument.defaultView);if(!K){return false}var L=N?K.startContainer:K.endContainer;var M=N?K.startOffset:K.endOffset;if(window.opera&&!N&&K.endContainer==J&&K.endOffset==K.startOffset+1&&J.childNodes[K.startOffset]&&J.childNodes[K.startOffset].nodeName=="BR"){M--}if(L.nodeType==3){if(M>0){return D(L,J)}else{return I(L,J)}}else{if(L.nodeName=="HTML"){return(M==1?null:J.lastChild)}else{if(L==J){return(M==0)?null:L.childNodes[M-1]}else{if(M==L.childNodes.length){return D(L,J)}else{if(M==0){return I(L,J)}else{return D(L.childNodes[M-1],J)}}}}}};select.focusAfterNode=function(L,J){var M=J.ownerDocument.defaultView,K=M.document.createRange();K.setStartBefore(J.firstChild||J);if(L&&!L.firstChild){K.setEndAfter(L)}else{if(L){K.setEnd(L,L.childNodes.length)}else{K.setEndBefore(J.firstChild||J)}}K.collapse(false);F(K,M)};insertNodeAtCursor=function(L,K){var J=A(L);if(!J){return }J.deleteContents();J.insertNode(K);J.setEndAfter(K);J.collapse(false);F(J,L);return K};select.insertNewlineAtCursor=function(J){insertNodeAtCursor(J,J.document.createElement("BR"))};select.insertTabAtCursor=function(J){insertNodeAtCursor(J,J.document.createTextNode(E))};select.cursorPos=function(J,M){var K=A(window);if(!K){return }var L=select.selectionTopNode(J,M);while(L&&L.nodeName!="BR"){L=L.previousSibling}K=K.cloneRange();K.collapse(M);if(L){K.setStartAfter(L)}else{K.setStartBefore(J)}return{node:L,offset:K.toString().length}};select.setCursorPos=function(J,O,N){var M=J.ownerDocument.defaultView,L=M.document.createRange();function K(S,V,Q){if(!S){S=J.firstChild}else{S=S.nextSibling}if(!S){return }if(V==0){L["set"+Q+"Before"](S);return true}var T=[];function P(W){if(W.nodeType==3){T.push(W)}else{forEach(W.childNodes,P)}}while(true){while(S&&!T.length){P(S);S=S.nextSibling}var U=T.shift();if(!U){return false}var R=U.nodeValue.length;if(R>=V){L["set"+Q](U,V);return true}V-=R}}N=N||O;if(K(N.node,N.offset,"End")&&K(O.node,O.offset,"Start")){F(L,M)}};select.scrollToCursor=function(L){var K=L.ownerDocument.body,N=L.ownerDocument.defaultView;var M=select.selectionTopNode(L,true)||L.firstChild;while(M&&!M.offsetTop){M=M.previousSibling}var P=0,O=M;while(O&&O.offsetParent){P+=O.offsetTop;O=O.offsetParent}var J=P-K.scrollTop;if(J<0||J>N.innerHeight-10){N.scrollTo(0,P)}}}}());(function(){var A={more:function(){return this.peek()!==null},applies:function(C){var B=this.peek();return(B!==null&&C(B))},nextWhile:function(B){while(this.applies(B)){this.next()}},equals:function(B){return B===this.peek()},endOfLine:function(){var B=this.peek();return B==null||B=="\n"},matches:function(C,B){for(var D=0;D<C.length;D++){var E=this.peek();if(!E||C.charAt(D)!=(B?E:E.toLowerCase())){return false}this.next()}return true}};window.stringStream=function(C){C=iter(C);var D="",F=0;var E=null,B="";return update({peek:function(){if(!E){try{E=this.step()}catch(G){if(G!=StopIteration){throw G}else{E=null}}}return E},step:function(){if(E){var G=E;E=null;return G}while(F==D.length){B+=D;D="";F=0;D=C.next()}return D.charAt(F++)},next:function(){try{return this.step()}catch(G){if(G==StopIteration&&B.length>0){throw"End of stringstream reached without emptying buffer ('"+B+"')."}else{throw G}}},get:function(){var G=B;var H=E?F-1:F;B="";if(H>0){G+=D.slice(0,H);D=D.slice(H);F=E?1:0}return G},reset:function(){D=B+D;B="";F=0;E=null},push:function(G){D=D.slice(0,F)+G+D.slice(F)}},A)}})();function tokenizer(D,C){function B(E){return E!="\n"&&/^[\s\u00a0]*$/.test(E)}var A={state:C,take:function(E){if(typeof (E)=="string"){E={style:E,type:E}}E.content=(E.content||"")+D.get();if(!/\n$/.test(E.content)){D.nextWhile(B)}E.value=E.content+D.get();return E},next:function(){if(!D.more()){throw StopIteration}var E;if(D.equals("\n")){D.next();return this.take("whitespace")}if(D.applies(B)){E="whitespace"}else{while(!E){E=this.state(D,function(F){A.state=F})}}return this.take(E)}};return A}function History(B,F,A,E,C){this.container=B;this.maxDepth=F;this.commitDelay=A;this.editor=E;this.parent=E.parent;this.onChange=C;var D={text:"",from:null,to:null};this.first=D;this.last=D;this.firstTouched=false;this.history=[];this.redoHistory=[];this.touched=[]}History.prototype={scheduleCommit:function(){this.parent.clearTimeout(this.commitTimeout);this.commitTimeout=this.parent.setTimeout(method(this,"tryCommit"),this.commitDelay)},touch:function(A){this.setTouched(A);this.scheduleCommit()},undo:function(){this.commit();if(this.history.length){this.redoHistory.push(this.updateTo(this.history.pop(),"applyChain"));if(this.onChange){this.onChange()}}},redo:function(){this.commit();if(this.redoHistory.length){this.addUndoLevel(this.updateTo(this.redoHistory.pop(),"applyChain"));if(this.onChange){this.onChange()}}},push:function(F,E,B){var D=[];for(var C=0;C<B.length;C++){var A=(C==B.length-1)?E:this.container.ownerDocument.createElement("BR");D.push({from:F,to:A,text:B[C]});F=A}this.pushChains([D],F==null&&E==null)},pushChains:function(B,A){this.commit(A);this.addUndoLevel(this.updateTo(B,"applyChain"));this.redoHistory=[]},reset:function(){this.history=[];this.redoHistory=[]},textAfter:function(A){return this.after(A).text},nodeAfter:function(A){return this.after(A).to},nodeBefore:function(A){return this.before(A).from},tryCommit:function(){if(this.editor.highlightDirty()){this.commit()}else{this.scheduleCommit()}},commit:function(B){this.parent.clearTimeout(this.commitTimeout);if(!B){this.editor.highlightDirty(true)}var C=this.touchedChains(),A=this;if(C.length){this.addUndoLevel(this.updateTo(C,"linkChain"));this.redoHistory=[];if(this.onChange){this.onChange()}}},updateTo:function(E,A){var D=[],C=[];for(var B=0;B<E.length;B++){D.push(this.shadowChain(E[B]));C.push(this[A](E[B]))}if(A=="applyChain"){this.notifyDirty(C)}return D},notifyDirty:function(A){forEach(A,method(this.editor,"addDirtyNode"));this.editor.scheduleHighlight()},linkChain:function(C){for(var B=0;B<C.length;B++){var A=C[B];if(A.from){A.from.historyAfter=A}else{this.first=A}if(A.to){A.to.historyBefore=A}else{this.last=A}}},after:function(A){return A?A.historyAfter:this.first},before:function(A){return A?A.historyBefore:this.last},setTouched:function(A){if(A){if(!A.historyTouched){this.touched.push(A);A.historyTouched=true}}else{this.firstTouched=true}},addUndoLevel:function(A){this.history.push(A);if(this.history.length>this.maxDepth){this.history.shift()}},touchedChains:function(){var H=this;function E(K,J){return K.replace(/\u00a0/g," ")==J.replace(/\u00a0/g," ")}var F=null;function G(J){return J?J.historyTemp:F}function C(K,J){if(K){K.historyTemp=J}else{F=J}}function A(J){var L=[];for(var K=J?J.nextSibling:H.container.firstChild;K&&K.nodeName!="BR";K=K.nextSibling){if(K.currentText){L.push(K.currentText)}}return{from:J,to:K,text:L.join("")}}var I=[];if(H.firstTouched){H.touched.push(null)}forEach(H.touched,function(K){if(K&&K.parentNode!=H.container){return }if(K){K.historyTouched=false}else{H.firstTouched=false}var J=A(K),L=H.after(K);if(!L||!E(L.text,J.text)||L.to!=J.to){I.push(J);C(K,J)}});function B(M,J){var L=J+"Sibling",K=M[L];while(K&&K.nodeName!="BR"){K=K[L]}return K}var D=[];H.touched=[];forEach(I,function(K){if(!G(K.from)){return }var L=[],M=K.from,N=true;while(true){var J=G(M);if(!J){if(N){break}else{J=A(M)}}L.unshift(J);C(M,null);if(!M){break}N=H.after(M);M=B(M,"previous")}M=K.to;N=H.before(K.from);while(true){if(!M){break}var J=G(M);if(!J){if(N){break}else{J=A(M)}}L.push(J);C(M,null);N=H.before(M);M=B(M,"next")}D.push(L)});return D},shadowChain:function(C){var E=[],D=this.after(C[0].from),B=C[C.length-1].to;while(true){E.push(D);var A=D.to;if(!A||A==B){break}else{D=A.historyAfter}}return E},applyChain:function(A){var J=select.cursorPos(this.container,false),L=this;function B(Q,P){var O=Q?Q.nextSibling:L.container.firstChild;while(O!=P){var N=O.nextSibling;removeElement(O);O=N}}var C=A[0].from,G=A[A.length-1].to;B(C,G);var K=G?function(N){L.container.insertBefore(N,G)}:function(N){L.container.appendChild(N)};for(var H=0;H<A.length;H++){var M=A[H];if(H>0){K(M.from)}var F=this.container.ownerDocument.createTextNode(M.text);K(F);if(J&&J.node==M.from){var E=0;var D=this.after(M.from);if(D&&H==A.length-1){for(var I=0;I<J.offset&&M.text.charAt(I)==D.text.charAt(I);I++){}if(J.offset>I){E=M.text.length-D.text.length}}select.setCursorPos(this.container,{node:M.from,offset:Math.max(0,J.offset+E)})}else{if(J&&(H==A.length-1)&&J.node&&J.node.parentNode!=this.container){select.setCursorPos(this.container,{node:M.from,offset:M.text.length})}}}this.linkChain(A);return C}};function method(B,A){return function(){B[A].apply(B,arguments)}}function update(B,C){for(var A in C){B[A]=C[A]}return B}var StopIteration={toString:function(){return"StopIteration"}};function iter(A){var B=0;if(A.next){return A}else{return{next:function(){if(B>=A.length){throw StopIteration}else{return A[++B]}}}}}function forEach(A,C){if(A.next){try{while(true){C(A.next())}}catch(D){if(D!=StopIteration){throw D}}}else{for(var B=0;B<A.length;B++){C(A[B])}}}function map(A,C){var B=[];forEach(A,function(D){B.push(C(D))});return B}function matcher(A){return function(B){return A.test(B)}}function hasClass(B,C){var A=B.className;return A&&new RegExp("(^| )"+C+"($| )").test(A)}function insertAfter(A,C){var B=C.parentNode;B.insertBefore(A,C.nextSibling);return A}function removeElement(A){if(A.parentNode){A.parentNode.removeChild(A)}}function clearElement(A){while(A.firstChild){A.removeChild(A.firstChild)}}function isAncestor(A,B){while(B=B.parentNode){if(A==B){return true}}return false}var nbsp="\u00a0";var matching={"{":"}","[":"]","(":")","}":"{","]":"[",")":"("};function normalizeEvent(A){if(!A.stopPropagation){A.stopPropagation=function(){this.cancelBubble=true};A.preventDefault=function(){this.returnValue=false}}if(!A.stop){A.stop=function(){this.stopPropagation();this.preventDefault()}}if(A.type=="keypress"){if(A.charCode===0||A.charCode==undefined){A.code=A.keyCode}else{A.code=A.charCode}A.character=String.fromCharCode(A.code)}return A}function addEventHandler(C,B,A){function D(E){A(normalizeEvent(E||window.event))}if(typeof C.addEventListener=="function"){C.addEventListener(B,D,false);return function(){C.removeEventListener(B,D,false)}}else{C.attachEvent("on"+B,D);return function(){C.detachEvent("on"+B,D)}}}function removeEventHandler(A){A()};