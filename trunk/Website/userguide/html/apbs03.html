<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>B.3.&nbsp;Reference</title><meta content="DocBook XSL Stylesheets V1.74.0" name="generator"><link rel="home" href="index.html" title="Orc User Guide v0.9.9"><link rel="up" href="apb.html" title="Appendix&nbsp;B.&nbsp;Standard Library"><link rel="prev" href="apbs02.html" title="B.2.&nbsp;Types and Notation"><link href="/orchard/orc.css" type="text/css" rel="stylesheet"><link href="style.css" type="text/css" rel="stylesheet"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">B.3.&nbsp;Reference</th></tr><tr><td align="left" width="20%"><a accesskey="p" href="apbs02.html">Prev</a>&nbsp;</td><th align="center" width="60%">Appendix&nbsp;B.&nbsp;Standard Library</th><td align="right" width="20%">&nbsp;</td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N11EA7"></a>B.3.&nbsp;Reference</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11EAB"></a>B.3.1.&nbsp;core.inc: Fundamental sites and operators.</h3></div></div></div><p>Fundamental sites and operators.</p><p>These declarations include both prefix and infix sites (operators).  For
consistency, all declarations are written in prefix form, with the site name
followed by the operands.  When the site name is surrounded in parentheses, as
in <code class="code">(+)</code>, it denotes an infix operator.</p><p>For a more complete description of the built-in operators and their syntax, see
the <a class="link" href="ch01s02.html#language.base.operators" title="1.2.2.&nbsp;Operators">Operators</a> section of the
User Guide.</p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">let</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">let</span>() :: <span class="hl-variable">Top</span></code>
                            </p><p>When applied to no arguments, return a signal.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">let</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">let</span>[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>When applied to a single argument, return that argument (behaving as the identity function).</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">let</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">let</span>[<span class="hl-variable">A</span>, ...](<span class="hl-variable">A</span>, ...) :: (<span class="hl-variable">A</span>, ...)</code>
                            </p><p>When applied to two or more arguments, return the arguments in a tuple.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-keyword">if</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-keyword">if</span>(<span class="hl-variable">Boolean</span>) :: <span class="hl-variable">Top</span></code>

                            </p><p>Fail silently if the argument is false. Otherwise return a signal.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: "Always publishes"</span>
  <span class="hl-keyword">if</span>(<span class="hl-literal">false</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Never publishes"</span>
<span class="hl-combinator">|</span> <span class="hl-keyword">if</span>(<span class="hl-literal">true</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Always publishes"</span></pre>
                            </p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">error</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">error</span>(<span class="hl-variable">String</span>) :: <span class="hl-variable">Bot</span></code>

                            </p><p>Halt with the given error message.</p><p>Example, using <code class="code"><span class="hl-variable">error</span></code> to implement assertions:
<pre class="orc">
<span class="hl-keyword">def</span> <span class="hl-site">assert</span>(<span class="hl-variable">b</span>) =
  <span class="hl-keyword">if</span> <span class="hl-variable">b</span> <span class="hl-keyword">then</span> <span class="hl-keyword">signal</span> <span class="hl-keyword">else</span> <span class="hl-site">error</span>(<span class="hl-literal">"assertion failed"</span>)

<span class="hl-comment">-- Fail with the error message: "assertion failed"</span>
<span class="hl-site">assert</span>(<span class="hl-literal">false</span>)</pre>
                            </p></td></tr><tr><td><p><span class="term">
                            <code class="code">(+)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (+)(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span>+<span class="hl-variable">b</span></code> returns the sum of <code class="code"><span class="hl-variable">a</span></code> and <code class="code"><span class="hl-variable">b</span></code>.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(-)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (-)(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span>-<span class="hl-variable">b</span></code> returns the value of <code class="code"><span class="hl-variable">a</span></code> minus the value of <code class="code"><span class="hl-variable">b</span></code>.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(<span class="hl-literal">0</span>-)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (<span class="hl-literal">0</span>-)(<span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>Return the additive inverse of the argument.
When this site appears as an operator, it is written in prefix form without the
zero, i.e. <code class="code">(-<span class="hl-variable">a</span>)</code>
                            </p></td></tr><tr><td><p><span class="term">
                            <code class="code">(*)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (*)(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span>*<span class="hl-variable">b</span></code> returns the product of <code class="code"><span class="hl-variable">a</span></code> and <code class="code"><span class="hl-variable">b</span></code>.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(**)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (**)(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span> ** <span class="hl-variable">b</span></code> returns
<span class="mathphrase">a<sup>b</sup>
                                    </span>,
i.e. <code class="code"><span class="hl-variable">a</span></code> raised to the <code class="code"><span class="hl-variable">b</span></code>th power.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(/)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (/)(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>

                                <code class="code"><span class="hl-variable">a</span>/<span class="hl-variable">b</span></code> returns <code class="code"><span class="hl-variable">a</span></code> divided by <code class="code"><span class="hl-variable">b</span></code>.
If both arguments have integral types, <code class="code">(/)</code> performs integral
division, rounding towards zero. Otherwise, it performs floating-point
division. If <code class="code"><span class="hl-variable">b</span>=<span class="hl-literal">0</span></code>, <code class="code"><span class="hl-variable">a</span>/<span class="hl-variable">b</span></code> halts with an error.</p><p>Example:
<pre class="orc">
  <span class="hl-literal">7</span>/<span class="hl-literal">3</span>   <span class="hl-comment">-- publishes 2</span>
<span class="hl-combinator">|</span> <span class="hl-literal">7</span>/<span class="hl-literal">3.0</span> <span class="hl-comment">-- publishes 2.333...</span></pre>
                            </p></td></tr><tr><td><p><span class="term">
                            <code class="code">(%)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (%)(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>

                                <code class="code"><span class="hl-variable">a</span>%<span class="hl-variable">b</span></code> computes the remainder of <code class="code"><span class="hl-variable">a</span>/<span class="hl-variable">b</span></code>. If <code class="code"><span class="hl-variable">a</span></code>
and <code class="code"><span class="hl-variable">b</span></code> have integral types, then the remainder is given by
the expression <code class="code"><span class="hl-variable">a</span> - (<span class="hl-variable">a</span>/<span class="hl-variable">b</span>)*<span class="hl-variable">b</span></code>. For a full description, see the
<a class="link" href="http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#15.17.3" target="_top">Java Language Specification, 3rd edition</a>.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(&lt;)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (&lt;)(<span class="hl-variable">Top</span>, <span class="hl-variable">Top</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span> &lt; <span class="hl-variable">b</span></code> returns true if <code class="code"><span class="hl-variable">a</span></code> is less than <code class="code"><span class="hl-variable">b</span></code>, and false otherwise.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(<span class="hl-site">&lt;=</span>)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (<span class="hl-site">&lt;=</span>)(<span class="hl-variable">Top</span>, <span class="hl-variable">Top</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span> <span class="hl-site">&lt;=</span> <span class="hl-variable">b</span></code> returns true if <code class="code"><span class="hl-variable">a</span></code> is less than or equal to <code class="code"><span class="hl-variable">b</span></code>, and false otherwise.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(&gt;)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (&gt;)(<span class="hl-variable">Top</span>, <span class="hl-variable">Top</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span> &gt; <span class="hl-variable">b</span></code> returns true if <code class="code"><span class="hl-variable">a</span></code> is greater than <code class="code"><span class="hl-variable">b</span></code>, and false otherwise.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(<span class="hl-site">&gt;=</span>)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (<span class="hl-site">&gt;=</span>)(<span class="hl-variable">Top</span>, <span class="hl-variable">Top</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span> <span class="hl-site">&gt;=</span> <span class="hl-variable">b</span></code> returns true if <code class="code"><span class="hl-variable">a</span></code> is greater than or equal to <code class="code"><span class="hl-variable">b</span></code>, and false otherwise.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(=)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (=)(<span class="hl-variable">Top</span>, <span class="hl-variable">Top</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>

                                <code class="code"><span class="hl-variable">a</span> = <span class="hl-variable">b</span></code> returns true if <code class="code"><span class="hl-variable">a</span></code> is equal to <code class="code"><span class="hl-variable">b</span></code>,
and false otherwise.  The precise definition of "equal" depends on the values
being compared, but always obeys the rule that if two values are considered
equal, then one may be substituted locally for the other without affecting the
behavior of the program.</p><p>Two values with the same object identity are always considered equal.
In addition, Cor <a class="link" href="ch01s02.html#cor.constants" title="1.2.1.&nbsp;Constants">constant values</a> and <a class="link" href="ch01s02.html#cor.data" title="1.2.5.&nbsp;Data Structures">data structures</a> are considered equal if their
contents are equal. Other types are free to implement their own equality
relationship provided it conforms to the rules given here.</p><p>Note that although values of different types may be compared with
<code class="code">=</code>, the substitutability principle requires that such values are
always considered inequal, i.e. the comparison will return <code class="code"><span class="hl-literal">false</span></code>.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(/=)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (/=)(<span class="hl-variable">Top</span>, <span class="hl-variable">Top</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span>/=<span class="hl-variable">b</span></code> returns false if <code class="code"><span class="hl-variable">a</span>=<span class="hl-variable">b</span></code>, and true otherwise.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(~)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (~)(<span class="hl-variable">Boolean</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return the logical negation of the argument.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(&amp;&amp;)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (&amp;&amp;)(<span class="hl-variable">Boolean</span>, <span class="hl-variable">Boolean</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return the logical conjunction of the arguments. This is not a short-circuiting
operator; both arguments must be evaluated and available before the result is
computed.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(<span class="hl-site">||</span>)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (<span class="hl-site">||</span>)(<span class="hl-variable">Boolean</span>, <span class="hl-variable">Boolean</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return the logical disjunction of the arguments. This is not a short-circuiting
operator; both arguments must be evaluated and available before the result is
computed.</p></td></tr><tr><td><p><span class="term">
                            <code class="code">(:)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> (:)[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>

                            </p><p>The list <code class="code"><span class="hl-variable">a</span>:<span class="hl-variable">b</span></code> is formed by prepending the element <code class="code"><span class="hl-variable">a</span></code> to
the list <code class="code"><span class="hl-variable">b</span></code>.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: (3, [4, 5])</span>
<span class="hl-literal">3</span>:<span class="hl-literal">4</span>:<span class="hl-literal">5</span>:[] <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span>:<span class="hl-variable">xs</span><span class="hl-combinator">&gt;</span> (<span class="hl-variable">x</span>,<span class="hl-variable">xs</span>)</pre>
                            </p><p>In patterns, the <code class="code">(:)</code> deconstructor can be applied to a variety of
list-like values such as <code class="code"><span class="hl-variable">Array</span></code>s and Java <code class="code"><span class="hl-variable">Iterable</span></code>s,
in which case it returns the first element of the list-like value, and a new
list-like value (not necessarily of the same type as the original list-like
value) representing the tail.  Modifying the structure of the original
value (e.g. adding an element to an <code class="code"><span class="hl-variable">Iterable</span></code>) may render
old "tail"s unusable, so you should refrain from modifying a value
while you are deconstructing it.  This feature is highly experimental
and will probably change in future versions of the implementation.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">abs</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">abs</span>(<span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>Return the absolute value of the argument.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">abs</span>(<span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span>
<span class="hl-keyword">def</span> <span class="hl-site">abs</span>(<span class="hl-variable">x</span>) = <span class="hl-keyword">if</span> <span class="hl-variable">x</span> &lt; <span class="hl-literal">0</span> <span class="hl-keyword">then</span> -<span class="hl-variable">x</span> <span class="hl-keyword">else</span> <span class="hl-variable">x</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">signum</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">signum</span>(<span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>
                                <code class="code"><span class="hl-site">signum</span>(<span class="hl-variable">a</span>)</code> returns <code class="code">-<span class="hl-literal">1</span></code> if <code class="code"><span class="hl-variable">a</span>&lt;<span class="hl-literal">0</span></code>,
<code class="code"><span class="hl-literal">1</span></code> if <code class="code"><span class="hl-variable">a</span>&gt;<span class="hl-literal">0</span></code>, and <code class="code"><span class="hl-literal">0</span></code> if <code class="code"><span class="hl-variable">a</span>=<span class="hl-literal">0</span></code>.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">signum</span>(<span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span>
<span class="hl-keyword">def</span> <span class="hl-site">signum</span>(<span class="hl-variable">x</span>) =
  <span class="hl-keyword">if</span> <span class="hl-variable">x</span> &lt; <span class="hl-literal">0</span> <span class="hl-keyword">then</span> -<span class="hl-literal">1</span>
  <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> <span class="hl-variable">x</span> &gt; <span class="hl-literal">0</span> <span class="hl-keyword">then</span> <span class="hl-literal">1</span>
  <span class="hl-keyword">else</span> <span class="hl-literal">0</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">min</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">min</span>[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>Return the lesser of the arguments. If the arguments
are equal, return the first argument.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">min</span>[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">min</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) = <span class="hl-keyword">if</span> <span class="hl-variable">y</span> &lt; <span class="hl-variable">x</span> <span class="hl-keyword">then</span> <span class="hl-variable">y</span> <span class="hl-keyword">else</span> <span class="hl-variable">x</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">max</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">max</span>[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>Return the greater of the arguments. If the arguments
are equal, return the second argument.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">max</span>[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">max</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) = <span class="hl-keyword">if</span> <span class="hl-variable">x</span> &gt; <span class="hl-variable">y</span> <span class="hl-keyword">then</span> <span class="hl-variable">x</span> <span class="hl-keyword">else</span> <span class="hl-variable">y</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">floor</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">floor</span>(<span class="hl-variable">Number</span>) :: <span class="hl-variable">Integer</span></code>
                            </p><p>Return the greatest integer less than
or equal to this number.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">ceil</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">ceil</span>(<span class="hl-variable">Number</span>) :: <span class="hl-variable">Integer</span></code>
                            </p><p>Return the least integer greater than
or equal to this number.</p></td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1213A"></a>B.3.2.&nbsp;state.inc: General-purpose supplemental data structures.</h3></div></div></div><p>General-purpose supplemental data structures.</p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Some</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Some</span>[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>) :: <span class="hl-site">Option</span>[<span class="hl-variable">A</span>]</code>

                            </p><p>An optional value which is available.
This site may also be used in a pattern.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: (3,4)</span>
<span class="hl-site">Some</span>((<span class="hl-literal">3</span>,<span class="hl-literal">4</span>)) <span class="hl-combinator">&gt;</span><span class="hl-variable">s</span><span class="hl-combinator">&gt;</span> (
    <span class="hl-variable">s</span> <span class="hl-combinator">&gt;</span><span class="hl-site">Some</span>((<span class="hl-variable">x</span>,<span class="hl-variable">y</span>))<span class="hl-combinator">&gt;</span> (<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)
  <span class="hl-combinator">|</span> <span class="hl-variable">s</span> <span class="hl-combinator">&gt;</span><span class="hl-site">None</span>()<span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span>
)</pre>
                            </p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">None</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">None</span>[<span class="hl-variable">A</span>]() :: <span class="hl-site">Option</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>An optional value which is not available.
This site may also be used in a pattern.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Semaphore</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Semaphore</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Semaphore</span></code>

                            </p><p>Return a semaphore with the given value. The semaphore maintains the invariant
that its value is always non-negative.</p><p>An example using a semaphore as a lock for a critical section:
<pre class="orc">
<span class="hl-comment">-- Prints:</span>
<span class="hl-comment">-- Entering critical section</span>
<span class="hl-comment">-- Leaving critical section</span>
<span class="hl-keyword">val</span> <span class="hl-variable">lock</span> = <span class="hl-site">Semaphore</span>(<span class="hl-literal">1</span>)
<span class="hl-variable">lock</span>.<span class="hl-site">acquire</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
<span class="hl-site">println</span>(<span class="hl-literal">"Entering critical section"</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
<span class="hl-site">println</span>(<span class="hl-literal">"Leaving critical section"</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
<span class="hl-variable">lock</span>.<span class="hl-site">release</span>()</pre>
                            </p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">acquire</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Semaphore</span>.<span class="hl-site">acquire</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>If the semaphore's value is greater than <code class="code"><span class="hl-literal">0</span></code>, decrement the semaphore and return a signal.
If the semaphore's value is <code class="code"><span class="hl-literal">0</span></code>, block until it becomes greater than <code class="code"><span class="hl-literal">0</span></code>.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">acquirenb</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Semaphore</span>.<span class="hl-site">acquirenb</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>If the semaphore's value is greater than <code class="code"><span class="hl-literal">0</span></code>, decrement the semaphore and return a signal.
If the semaphore's value is <code class="code"><span class="hl-literal">0</span></code>, halt.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">release</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Semaphore</span>.<span class="hl-site">release</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>If any calls to <code class="code"><span class="hl-variable">acquire</span></code> are blocked, allow the oldest such call
to return.  Otherwise, increment the value of the semaphore.  This may
increment the value beyond that with which the semaphore was constructed.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">snoop</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Semaphore</span>.<span class="hl-site">snoop</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>If any calls to <code class="code"><span class="hl-variable">acquire</span></code> are blocked, return a signal.
Otherwise, block until some call to <code class="code"><span class="hl-variable">acquire</span></code> blocks.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">snoopnb</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Semaphore</span>.<span class="hl-site">snoopnb</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>If any calls to <code class="code"><span class="hl-variable">acquire</span></code> are blocked, return a signal.
Otherwise, halt.</p></td></tr></tbody></table></div></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Buffer</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>]() :: <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>
<p><a name="orc.lib.Buffer.close"></a>
Create a new buffer (FIFO channel) of unlimited size. A buffer supports
get, put and close operations.
</p>

                            </p><p>A buffer may be either empty or non-empty, and either open or closed.  When
empty and open, calls to <code class="code"><span class="hl-variable">get</span></code> block.  When empty and closed, calls
to <code class="code"><span class="hl-variable">get</span></code> halt.  When closed, calls to <code class="code"><span class="hl-variable">put</span></code> halt.  In all
other cases, calls return normally.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 10</span>
<span class="hl-keyword">val</span> <span class="hl-variable">b</span> = <span class="hl-site">Buffer</span>()
  <span class="hl-site">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">b</span>.<span class="hl-site">put</span>(<span class="hl-literal">10</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span>
<span class="hl-combinator">|</span> <span class="hl-variable">b</span>.<span class="hl-site">get</span>()</pre>
                            </p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">get</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">get</span>() :: <span class="hl-variable">A</span></code>

                                    </p><p>Get an item from the buffer. If the buffer is open and no items are available,
block until one becomes available. If the buffer is <a class="link" href="apbs03.html#orc.lib.Buffer.close">closed</a> and no items are available, halt.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">getnb</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">getnb</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Get an item from the buffer. If no items are available, halt.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">put</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">put</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Top</span></code>

                                    </p><p>Put an item in the buffer. If the buffer is <a class="link" href="apbs03.html#orc.lib.Buffer.close">closed</a>, halt.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">close</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">close</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>Close the buffer and block until it is empty.
This has the effect of immediately causing any blocked calls to
<code class="code"><span class="hl-variable">get</span></code> to halt. In addition, any subsequent calls to <code class="code"><span class="hl-variable">put</span></code>
will halt, and once the buffer becomes empty, any subsequent calls to
<code class="code"><span class="hl-variable">get</span></code> will halt.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">closenb</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">closenb</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>Close the buffer and return a signal immediately.
This has the effect of immediately causing any blocked calls to
<code class="code"><span class="hl-variable">get</span></code> to halt. In addition, any subsequent calls to <code class="code"><span class="hl-variable">put</span></code>
will halt, and once the buffer becomes empty, any subsequent calls to
<code class="code"><span class="hl-variable">get</span></code> will halt.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">isClosed</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">isClosed</span>() :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>If the buffer is currently closed, return true, otherwise return false.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">getAll</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">getAll</span>() :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                                    </p><p>Get all of the items currently in the buffer, emptying the buffer and returning
a list of the items in the order they were added. If there are no items in the
buffer, return an empty list.</p></td></tr></tbody></table></div></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">BoundedBuffer</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">BoundedBuffer</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Integer</span>) :: <span class="hl-site">BoundedBuffer</span>[<span class="hl-variable">A</span>]</code>

                            </p><p>Create a new buffer (FIFO channel) with the given number of slots.
Putting an item into the buffer fills a slot, and getting an item opens a slot.
A buffer with zero slots is equivalent to a
<a class="link" href="apbs03.html#orc.lib.state.SyncChannel">synchronous channel</a>.</p><p>A bounded buffer may be empty, partly filled, or full, and either open or
closed.  When empty and open, calls to <code class="code"><span class="hl-variable">get</span></code> block.  When empty and
closed, calls to <code class="code"><span class="hl-variable">get</span></code> halt. When full and open, calls to
<code class="code"><span class="hl-variable">put</span></code> block. When closed, calls to <code class="code"><span class="hl-variable">put</span></code> halt.  In all
other cases, calls return normally.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: "Put 1" "Got 1" "Put 2" "Got 2"</span>
<span class="hl-keyword">val</span> <span class="hl-variable">c</span> = <span class="hl-site">BoundedBuffer</span>(<span class="hl-literal">1</span>)
  <span class="hl-variable">c</span>.<span class="hl-site">put</span>(<span class="hl-literal">1</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Put "</span> + <span class="hl-literal">1</span>
<span class="hl-combinator">|</span> <span class="hl-variable">c</span>.<span class="hl-site">put</span>(<span class="hl-literal">2</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Put "</span> + <span class="hl-literal">2</span>
<span class="hl-combinator">|</span> <span class="hl-site">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> (
    <span class="hl-variable">c</span>.<span class="hl-site">get</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">n</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Got "</span> + <span class="hl-variable">n</span>
  <span class="hl-combinator">|</span> <span class="hl-variable">c</span>.<span class="hl-site">get</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">n</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Got "</span> + <span class="hl-variable">n</span>
  )</pre>
                            </p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">get</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">BoundedBuffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">get</span>() :: <span class="hl-variable">A</span></code>

                                    </p><p>Get an item from the buffer. If the buffer is open and no items are available,
block until one becomes available. If the buffer is <a class="link" href="apbs03.html#orc.lib.BoundedBuffer.close">closed</a> and no items are available, halt.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">getnb</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">BoundedBuffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">getnb</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Get an item from the buffer. If no items are available, halt.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">put</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">BoundedBuffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">put</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Top</span></code>

                                    </p><p>Put an item in the buffer. If no slots are open, block until one becomes open.
If the buffer is <a class="link" href="apbs03.html#orc.lib.BoundedBuffer.close">closed</a>, halt.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">putnb</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">BoundedBuffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">putnb</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Top</span></code>

                                    </p><p>Put an item in the buffer. If no slots are open, halt.
If the buffer is <a class="link" href="apbs03.html#orc.lib.BoundedBuffer.close">closed</a>, halt.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">close</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">BoundedBuffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">close</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>
<p><a name="orc.lib.BoundedBuffer.close"></a>
Close the buffer and block until it is empty.
This has the effect of immediately causing any blocked calls to
<code class="code"><span class="hl-variable">get</span></code> to halt. In addition, any subsequent calls to <code class="code"><span class="hl-variable">put</span></code>
will halt, and once the buffer becomes empty, any subsequent calls to
<code class="code"><span class="hl-variable">get</span></code> will halt. Note that any blocked calls to <code class="code"><span class="hl-variable">put</span></code>
initiated prior to closing the buffer may still be allowed to return as usual.
</p>
                                    </p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">closenb</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">BoundedBuffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">closenb</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>Close the buffer and return a signal immediately.
This has the effect of immediately causing any blocked calls to
<code class="code"><span class="hl-variable">get</span></code> to halt. In addition, any subsequent calls to <code class="code"><span class="hl-variable">put</span></code>
will halt, and once the buffer becomes empty, any subsequent calls to
<code class="code"><span class="hl-variable">get</span></code> will halt. Note that any blocked calls to <code class="code"><span class="hl-variable">put</span></code>
initiated prior to closing the buffer may still be allowed to return as usual.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">isClosed</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">BoundedBuffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">isClosed</span>() :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>If the buffer is currently closed, return true, otherwise return false.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">getOpen</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">BoundedBuffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">getOpen</span>() :: <span class="hl-variable">Integer</span></code>
                                    </p><p>Return the number of open slots in the buffer. Because of concurrency
this value may become out-of-date so it should only be used for debugging
or statistical measurements.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">getBound</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">BoundedBuffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">getBound</span>() :: <span class="hl-variable">Integer</span></code>
                                    </p><p>Return the total number of slots (open or filled) in the buffer.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">getAll</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">BoundedBuffer</span>[<span class="hl-variable">A</span>].<span class="hl-site">getAll</span>() :: [<span class="hl-variable">A</span>]</code>
                                    </p><p>Get all of the items currently in the buffer or waiting to be added, emptying
the buffer and returning a list of the items in the order they were added. If
there are no items in the buffer or waiting to be added, return an empty list.</p></td></tr></tbody></table></div></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">SyncChannel</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">SyncChannel</span>[<span class="hl-variable">A</span>]() :: <span class="hl-site">SyncChannel</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>
<p><a name="orc.lib.state.SyncChannel"></a>
Create a synchronous channel, or rendezvous.
</p>
                            </p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publish: 10</span>
<span class="hl-keyword">val</span> <span class="hl-variable">c</span> = <span class="hl-site">SyncChannel</span>()
  <span class="hl-variable">c</span>.<span class="hl-site">put</span>(<span class="hl-literal">10</span>)
<span class="hl-combinator">|</span> <span class="hl-site">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">c</span>.<span class="hl-site">get</span>()</pre>
                            </p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">get</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">SyncChannel</span>[<span class="hl-variable">A</span>].<span class="hl-site">get</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Receive an item over the channel. If no sender is available, block until one becomes available.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">put</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">SyncChannel</span>[<span class="hl-variable">A</span>].<span class="hl-site">put</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Top</span></code>
                                    </p><p>Send an item over the channel. If no receiver is available, block until one becomes available.</p></td></tr></tbody></table></div></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Cell</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Cell</span>[<span class="hl-variable">A</span>]() :: <span class="hl-site">Cell</span>[<span class="hl-variable">A</span>]</code>

                            </p><p>Create a write-once storage location.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 5 5</span>
<span class="hl-keyword">val</span> <span class="hl-variable">c</span> = <span class="hl-site">Cell</span>()
  <span class="hl-variable">c</span>.<span class="hl-site">write</span>(<span class="hl-literal">5</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">c</span>.<span class="hl-site">read</span>()
<span class="hl-combinator">|</span> <span class="hl-site">Rtimer</span>(<span class="hl-literal">1</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> ( <span class="hl-variable">c</span>.<span class="hl-site">write</span>(<span class="hl-literal">10</span>) <span class="hl-combinator">;</span> <span class="hl-variable">c</span>.<span class="hl-site">read</span>() )</pre>
                            </p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">read</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Cell</span>[<span class="hl-variable">A</span>].<span class="hl-site">read</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Read a value from the cell. If the cell does not yet have a value, block until it receives one.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">readnb</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Cell</span>[<span class="hl-variable">A</span>].<span class="hl-site">readnb</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Read a value from the cell. If the cell does not yet have a value, halt.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">write</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Cell</span>[<span class="hl-variable">A</span>].<span class="hl-site">write</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>Write a value to the cell. If the cell already has a value, halt.</p></td></tr></tbody></table></div></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Ref</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Ref</span>[<span class="hl-variable">A</span>]() :: <span class="hl-site">Ref</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>
                                <p><a name="orc.lib.state.Ref"></a>
Create a rewritable storage location without an initial value.
</p>
                            </p><p>Example:
<pre class="orc">
<span class="hl-keyword">val</span> <span class="hl-variable">r</span> = <span class="hl-site">Ref</span>()
<span class="hl-site">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">r</span> <span class="hl-site">:=</span> <span class="hl-literal">5</span> <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span>
<span class="hl-combinator">|</span> <span class="hl-site">println</span>(<span class="hl-variable">r</span><span class="hl-site">?</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-variable">r</span> <span class="hl-site">:=</span> <span class="hl-literal">10</span> <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-site">println</span>(<span class="hl-variable">r</span><span class="hl-site">?</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-keyword">stop</span></pre>
                            </p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">Ref</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Ref</span>[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>) :: <span class="hl-site">Ref</span>[<span class="hl-variable">A</span>]</code>
                                    </p><p>Create a rewritable storage location initialized to the provided value.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">read</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Ref</span>[<span class="hl-variable">A</span>].<span class="hl-site">read</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Read the value of the ref. If the ref does not yet have a value, block until it receives one.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">readnb</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Ref</span>[<span class="hl-variable">A</span>].<span class="hl-site">readnb</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Read the value of the ref. If the ref does not yet have a value, halt.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">write</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Ref</span>[<span class="hl-variable">A</span>].<span class="hl-site">write</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Top</span></code>
                                    </p><p>Write a value to the ref.</p></td></tr></tbody></table></div></td></tr><tr><td><p><span class="term">
                            <code class="code">(<span class="hl-site">?</span>)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> (<span class="hl-site">?</span>)[<span class="hl-variable">A</span>](<span class="hl-site">Ref</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Get the value held by a reference.
<code class="code"><span class="hl-variable">x</span><span class="hl-site">?</span></code> is equivalent to <code class="code"><span class="hl-variable">x</span>.<span class="hl-site">read</span>()</code>.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> (<span class="hl-site">?</span>)[<span class="hl-variable">A</span>](<span class="hl-site">Ref</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> (<span class="hl-site">?</span>)(<span class="hl-variable">r</span>) = <span class="hl-variable">r</span>.<span class="hl-site">read</span>()</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code">(<span class="hl-site">:=</span>)</code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> (<span class="hl-site">:=</span>)[<span class="hl-variable">A</span>](<span class="hl-site">Ref</span>[<span class="hl-variable">A</span>], <span class="hl-variable">A</span>) :: <span class="hl-variable">Top</span></code>
                            </p><p>Set the value held by a reference.
<code class="code"><span class="hl-variable">x</span> <span class="hl-site">:=</span> <span class="hl-variable">y</span></code> is equivalent to <code class="code"><span class="hl-variable">x</span>.<span class="hl-site">write</span>(<span class="hl-variable">y</span>)</code>.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> (<span class="hl-site">:=</span>)[<span class="hl-variable">A</span>](<span class="hl-site">Ref</span>[<span class="hl-variable">A</span>], <span class="hl-variable">A</span>) :: <span class="hl-variable">Top</span>
<span class="hl-keyword">def</span> (<span class="hl-site">:=</span>)(<span class="hl-variable">r</span>,<span class="hl-variable">v</span>) = <span class="hl-variable">r</span>.<span class="hl-site">write</span>(<span class="hl-variable">v</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Array</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Array</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Integer</span>) :: <span class="hl-site">Array</span>[<span class="hl-variable">A</span>]</code>

                            </p><p>Create a new native array of the given size. The array is initialized
to contain <code class="code"><span class="hl-literal">null</span></code>s.</p><p>The resulting array can be called directly with an index, as if
its type were <code class="code"><span class="hl-keyword">lambda</span> (<span class="hl-variable">Integer</span>) :: <span class="hl-site">Ref</span>[<span class="hl-variable">A</span>]</code>.
In this case, it returns a <a class="link" href="apbs03.html#orc.lib.state.Ref">Ref</a>
pointing to the element of the array specified by an index,
counting from 0. Changes to the array are reflected immediately
in the ref and visa versa.</p><p>Simple example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 3</span>
<span class="hl-keyword">val</span> <span class="hl-variable">a</span> = <span class="hl-site">Array</span>(<span class="hl-literal">1</span>)
<span class="hl-site">a</span>(<span class="hl-literal">0</span>) <span class="hl-site">:=</span> <span class="hl-literal">3</span> <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
<span class="hl-site">a</span>(<span class="hl-literal">0</span>)<span class="hl-site">?</span></pre>

                            </p><p>More complex example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 0 1 2</span>
<span class="hl-keyword">val</span> <span class="hl-variable">a</span> = <span class="hl-site">Array</span>(<span class="hl-literal">3</span>)
<span class="hl-site">for</span>(<span class="hl-literal">0</span>, <span class="hl-variable">a</span>.<span class="hl-site">length</span>()) <span class="hl-combinator">&gt;</span><span class="hl-variable">i</span><span class="hl-combinator">&gt;</span>
<span class="hl-site">a</span>(<span class="hl-variable">i</span>) <span class="hl-site">:=</span> <span class="hl-site">f</span>(<span class="hl-variable">i</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
<span class="hl-keyword">stop</span>
<span class="hl-combinator">;</span> <span class="hl-site">a</span>(<span class="hl-literal">0</span>)<span class="hl-site">?</span> <span class="hl-combinator">|</span> <span class="hl-site">a</span>(<span class="hl-literal">1</span>)<span class="hl-site">?</span> <span class="hl-combinator">|</span> <span class="hl-site">a</span>(<span class="hl-literal">2</span>)<span class="hl-site">?</span></pre>
                            </p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">Array</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Array</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Integer</span>, <span class="hl-variable">String</span>) :: <span class="hl-site">Array</span>[<span class="hl-variable">A</span>]</code>
                                    </p><p>Create a new primitive array of the given size with the given primitive type.
The initial values in the array depend on the primitive type: for numeric types,
it is <code class="code"><span class="hl-literal">0</span></code>; for booleans, <code class="code"><span class="hl-literal">false</span></code>; for chars, the character
with codepoint <code class="code"><span class="hl-literal">0</span></code>.</p><p>The element type of the array should be the appropriate wrapper type for the given
primitive type, although a typechecker may not be able to verify this. This
constructor is only necessary when interfacing with certain Java libraries; most
programs will just use the  <code class="code"><span class="hl-site">Array</span>(<span class="hl-variable">Integer</span>)</code> constructor.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">get</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Array</span>[<span class="hl-variable">A</span>].<span class="hl-site">get</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span></code>
                                    </p><p>Get the element of the array given by the index, counting from 0.
<code class="code"><span class="hl-variable">a</span>.<span class="hl-site">get</span>(<span class="hl-variable">i</span>)</code> is equivalent to <code class="code"><span class="hl-site">a</span>(<span class="hl-variable">i</span>)<span class="hl-site">?</span></code>.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">set</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Array</span>[<span class="hl-variable">A</span>].<span class="hl-site">set</span>(<span class="hl-variable">Integer</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">Top</span></code>
                                    </p><p>Set the element of the array given by the index, counting from 0.
<code class="code"><span class="hl-variable">a</span>.<span class="hl-site">set</span>(<span class="hl-variable">i</span>,<span class="hl-variable">v</span>)</code> is equivalent to <code class="code"><span class="hl-site">a</span>(<span class="hl-variable">i</span>) <span class="hl-site">:=</span> <span class="hl-variable">v</span></code>.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">slice</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Array</span>[<span class="hl-variable">A</span>].<span class="hl-site">slice</span>(<span class="hl-variable">Integer</span>, <span class="hl-variable">Integer</span>) :: <span class="hl-site">Array</span>[<span class="hl-variable">A</span>]</code>
                                    </p><p>Return a copy of the portion of the array with indices covered by the given
half-open range. The result array is still indexed counting from 0.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">length</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Array</span>[<span class="hl-variable">A</span>].<span class="hl-site">length</span>() :: <span class="hl-variable">Integer</span></code>
                                    </p><p>Return the size of the array.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">fill</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Array</span>[<span class="hl-variable">A</span>].<span class="hl-site">fill</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Top</span></code>

                                    </p><p>Set every element of the array to the given value. The given value is not
copied, but is shared by every element of the array, so for example
<code class="code"><span class="hl-variable">a</span>.<span class="hl-site">fill</span>(<span class="hl-site">Semaphore</span>(<span class="hl-literal">1</span>))</code> would allow you to access the same semaphore
from every element <code class="code"><span class="hl-variable">a</span></code>.</p><p>This method is primarily useful to initialize or reset an array to a constant
value,
for example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 0 0 0</span>
<span class="hl-keyword">val</span> <span class="hl-variable">a</span> = <span class="hl-site">Array</span>(<span class="hl-literal">3</span>)
<span class="hl-variable">a</span>.<span class="hl-site">fill</span>(<span class="hl-literal">0</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-site">each</span>(<span class="hl-variable">a</span>)</pre>
                                    </p></td></tr></tbody></table></div></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">IArray</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">IArray</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Integer</span>, <span class="hl-keyword">lambda</span> (<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span>)(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>The call <code class="code"><span class="hl-site">IArray</span>(<span class="hl-variable">n</span>,<span class="hl-variable">f</span>)</code>, where <code class="code"><span class="hl-variable">n</span></code> is a
natural number and <code class="code"><span class="hl-variable">f</span></code> a total function over natural numbers,
creates and returns a partial, pre-computed version of <code class="code"><span class="hl-variable">f</span></code>
restricted to the range (0, <code class="code"><span class="hl-variable">n</span></code>-1). If <code class="code"><span class="hl-variable">f</span></code> halts
on any number in this range, the call to <code class="code"><span class="hl-variable">IArray</span></code> will halt.</p><p>The user may also think of the call as returning an array whose
<code class="code"><span class="hl-variable">i</span></code>th element is <code class="code"><span class="hl-site">f</span>(<span class="hl-variable">i</span>)</code>.</p><p>This function provides a simple form of memoisation; we avoid recomputing
the value of <code class="code"><span class="hl-site">f</span>(<span class="hl-variable">i</span>)</code> by storing the result in an array.</p><p>Example:
<pre class="programlisting">
<span class="hl-keyword">val</span> <span class="hl-variable">a</span> = <span class="hl-site">IArray</span>(<span class="hl-literal">5</span>, <span class="hl-variable">fib</span>)
<span class="hl-comment">-- Publishes the 4th number of the fibonnaci sequence: 5</span>
<span class="hl-site">a</span>(<span class="hl-literal">3</span>)</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">IArray</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Integer</span>, <span class="hl-keyword">lambda</span> (<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span>)(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">IArray</span>(<span class="hl-variable">n</span>, <span class="hl-variable">f</span>) =
  <span class="hl-keyword">val</span> <span class="hl-variable">a</span> = <span class="hl-site">Array</span>[<span class="hl-variable">A</span>](<span class="hl-variable">n</span>)
  <span class="hl-keyword">def</span> <span class="hl-site">fill</span>(<span class="hl-variable">Integer</span>, <span class="hl-keyword">lambda</span> (<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span>) :: <span class="hl-variable">Top</span>
  <span class="hl-keyword">def</span> <span class="hl-site">fill</span>(<span class="hl-variable">i</span>, <span class="hl-variable">f</span>) =
    <span class="hl-keyword">if</span> <span class="hl-variable">i</span> &lt; <span class="hl-literal">0</span> <span class="hl-keyword">then</span> <span class="hl-keyword">signal</span>
    <span class="hl-keyword">else</span> (<span class="hl-variable">a</span>.<span class="hl-site">set</span>(<span class="hl-variable">i</span>, <span class="hl-site">f</span>(<span class="hl-variable">i</span>)), <span class="hl-site">fill</span>(<span class="hl-variable">i</span>-<span class="hl-literal">1</span>, <span class="hl-variable">f</span>)) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span>
  <span class="hl-site">fill</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>, <span class="hl-variable">f</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">a</span>.<span class="hl-variable">get</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Set</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Set</span>[<span class="hl-variable">A</span>]() :: <span class="hl-site">Set</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Construct an empty mutable set. The set considers two
values <code class="code"><span class="hl-variable">a</span></code> and <code class="code"><span class="hl-variable">b</span></code> to be the same if
and only if <code class="code"><span class="hl-variable">a</span>=<span class="hl-variable">b</span></code>. This site conforms to the Java interface
<code class="code"><span class="hl-variable">java</span>.<span class="hl-variable">util</span>.<span class="hl-variable">Set</span></code>, except that it obeys Orc rules for equality of
elements rather than Java rules.</p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">add</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Set</span>[<span class="hl-variable">A</span>].<span class="hl-site">add</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>Add a value to the set, returning true if the set did not already contain the value,
and false otherwise.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">remove</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Set</span>[<span class="hl-variable">A</span>].<span class="hl-site">remove</span>(<span class="hl-variable">Top</span>) :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>Remove a value from the set, returning true if the set contained the value,
and false otherwise.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">contains</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Set</span>[<span class="hl-variable">A</span>].<span class="hl-site">contains</span>(<span class="hl-variable">Top</span>) :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>Return true if the set contains the given value, and false otherwise.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">isEmpty</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Set</span>[<span class="hl-variable">A</span>].<span class="hl-site">isEmpty</span>() :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>Return true if the set contains no values.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">clear</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Set</span>[<span class="hl-variable">A</span>].<span class="hl-site">clear</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>Remove all values from the set.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">size</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Set</span>[<span class="hl-variable">A</span>].<span class="hl-site">size</span>() :: <span class="hl-variable">Integer</span></code>
                                    </p><p>Return the number of unique values currently contained in the set.</p></td></tr></tbody></table></div></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Map</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Map</span>[<span class="hl-variable">K</span>,<span class="hl-variable">V</span>]() :: <span class="hl-site">Map</span>[<span class="hl-variable">K</span>,<span class="hl-variable">V</span>]</code>
                            </p><p>Construct an empty mutable map from keys to values.  Each key contained in the
map is associated with exactly one value.  The mapping considers two keys
<code class="code"><span class="hl-variable">a</span></code> and <code class="code"><span class="hl-variable">b</span></code> to be the same if and only if
<code class="code"><span class="hl-variable">a</span>=<span class="hl-variable">b</span></code>. This site conforms to the Java interface
<code class="code"><span class="hl-variable">java</span>.<span class="hl-variable">util</span>.<span class="hl-variable">Map</span></code>, except that it obeys Orc rules for equality of keys
rather than Java rules.</p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">put</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Map</span>[<span class="hl-variable">K</span>,<span class="hl-variable">V</span>].<span class="hl-site">put</span>(<span class="hl-variable">K</span>, <span class="hl-variable">V</span>) :: <span class="hl-variable">V</span></code>
                                    </p><p>
                                    <code class="code"><span class="hl-variable">map</span>.<span class="hl-site">put</span>(<span class="hl-variable">k</span>,<span class="hl-variable">v</span>)</code> associates the value <code class="code"><span class="hl-variable">v</span></code> with the key
<code class="code"><span class="hl-variable">k</span></code> in <code class="code"><span class="hl-variable">map</span></code>, such that <code class="code"><span class="hl-variable">map</span>.<span class="hl-site">get</span>(<span class="hl-variable">k</span>)</code> returns
<code class="code"><span class="hl-variable">v</span></code>. Return the value previously associated with the key,
if any, otherwise return <code class="code"><span class="hl-site">Null</span>()</code>.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">get</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Map</span>[<span class="hl-variable">K</span>,<span class="hl-variable">V</span>].<span class="hl-site">get</span>(<span class="hl-variable">K</span>) :: <span class="hl-variable">V</span></code>
                                    </p><p>Return the value currently associated with the given key, if any, otherwise
return <code class="code"><span class="hl-site">Null</span>()</code>.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">remove</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Map</span>[<span class="hl-variable">K</span>,<span class="hl-variable">V</span>].<span class="hl-site">remove</span>(<span class="hl-variable">Top</span>) :: <span class="hl-variable">V</span></code>
                                    </p><p>Remove the given key from the map. Return the value previously associated with the key,
if any, otherwise return <code class="code"><span class="hl-site">Null</span>()</code>.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">containsKey</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Map</span>[<span class="hl-variable">K</span>,<span class="hl-variable">V</span>].<span class="hl-site">containsKey</span>(<span class="hl-variable">Top</span>) :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>Return true if the map contains the given key, and false otherwise.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">isEmpty</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Map</span>[<span class="hl-variable">K</span>,<span class="hl-variable">V</span>].<span class="hl-site">isEmpty</span>() :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>Return true if the map contains no keys.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">clear</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Map</span>[<span class="hl-variable">K</span>,<span class="hl-variable">V</span>].<span class="hl-site">clear</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>Remove all keys from the map.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">size</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Map</span>[<span class="hl-variable">K</span>,<span class="hl-variable">V</span>].<span class="hl-site">size</span>() :: <span class="hl-variable">Integer</span></code>
                                    </p><p>Return the number of unique keys currently contained in the map.</p></td></tr></tbody></table></div></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Counter</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Counter</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Counter</span></code>
                            </p><p>Create a new counter initialized to the given value.</p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">Counter</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Counter</span>() :: <span class="hl-variable">Counter</span></code>
                                    </p><p>Create a new counter initialized to zero.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">inc</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Counter</span>.<span class="hl-site">inc</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>Increment the counter.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">dec</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Counter</span>.<span class="hl-site">dec</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>If the counter is already at zero, halt. Otherwise, decrement
the counter and return a signal.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">onZero</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Counter</span>.<span class="hl-site">onZero</span>() :: <span class="hl-variable">Top</span></code>
                                    </p><p>If the counter is at zero, return a signal. Otherwise
block until the counter reaches zero.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">value</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Counter</span>.<span class="hl-site">value</span>() :: <span class="hl-variable">Integer</span></code>

                                    </p><p>Return the current value of the counter.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes five signals</span>
<span class="hl-keyword">val</span> <span class="hl-variable">c</span> = <span class="hl-site">Counter</span>(<span class="hl-literal">5</span>)
<span class="hl-site">repeat</span>(<span class="hl-variable">c</span>.<span class="hl-variable">dec</span>)</pre>
                                    </p></td></tr></tbody></table></div></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Dictionary</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Dictionary</span>() :: <span class="hl-variable">Dictionary</span></code>

                            </p><p>Create a new dictionary (a mutable map from field names to values), initially
empty.  The first time each field of the dictionary is accessed (using dot
notation), the dictionary creates and returns a new empty <a class="link" href="apbs03.html#orc.lib.state.Ref">Ref</a> which will also be returned on
subsequent accesses of the same field.  Dictionaries allow you to easily create
object-like data structures.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Prints: 1 2</span>
<span class="hl-keyword">val</span> <span class="hl-variable">d</span> = <span class="hl-site">Dictionary</span>()
  <span class="hl-site">println</span>(<span class="hl-variable">d</span>.<span class="hl-variable">one</span>.<span class="hl-site">read</span>()) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-site">println</span>(<span class="hl-variable">d</span>.<span class="hl-variable">two</span>.<span class="hl-site">read</span>()) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-keyword">stop</span>
<span class="hl-combinator">|</span> <span class="hl-variable">d</span>.<span class="hl-variable">one</span>.<span class="hl-site">write</span>(<span class="hl-literal">1</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-variable">d</span>.<span class="hl-variable">two</span>.<span class="hl-site">write</span>(<span class="hl-literal">2</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-keyword">stop</span></pre>

                            </p><p>Here is the same example rewritten using Orc's reference syntax to improve
clarity:
<pre class="orc">
<span class="hl-comment">-- Prints: 1 2</span>
<span class="hl-keyword">val</span> <span class="hl-variable">d</span> = <span class="hl-site">Dictionary</span>()
  <span class="hl-site">println</span>(<span class="hl-variable">d</span>.<span class="hl-variable">one</span><span class="hl-site">?</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-site">println</span>(<span class="hl-variable">d</span>.<span class="hl-variable">two</span><span class="hl-site">?</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-keyword">stop</span>
<span class="hl-combinator">|</span> <span class="hl-variable">d</span>.<span class="hl-variable">one</span> <span class="hl-site">:=</span> <span class="hl-literal">1</span> <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-variable">d</span>.<span class="hl-variable">two</span> <span class="hl-site">:=</span> <span class="hl-literal">2</span> <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-keyword">stop</span></pre>

                            </p><p>To create a multi-level dictionary, you must explicitly create sub-dictionaries
for each field. For example:
<pre class="orc">
<span class="hl-comment">-- Prints: 2</span>
<span class="hl-keyword">val</span> <span class="hl-variable">d</span> = <span class="hl-site">Dictionary</span>()
<span class="hl-variable">d</span>.<span class="hl-variable">one</span> <span class="hl-site">:=</span> <span class="hl-site">Dictionary</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
<span class="hl-variable">d</span>.<span class="hl-variable">one</span><span class="hl-site">?</span>.<span class="hl-variable">two</span> <span class="hl-site">:=</span> <span class="hl-literal">2</span> <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
<span class="hl-site">println</span>(<span class="hl-variable">d</span>.<span class="hl-variable">one</span><span class="hl-site">?</span>.<span class="hl-variable">two</span><span class="hl-site">?</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
<span class="hl-keyword">stop</span></pre>

                            </p><p>Note that you cannot write <code class="code"><span class="hl-variable">d</span>.<span class="hl-variable">one</span>.<span class="hl-variable">two</span></code>: because <code class="code"><span class="hl-variable">d</span>.<span class="hl-variable">one</span></code>
is a reference to a dictionary, and not simply a dictionary, you must
dereference before accessing its fields, as in <code class="code"><span class="hl-variable">d</span>.<span class="hl-variable">one</span><span class="hl-site">?</span> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">x</span>.<span class="hl-variable">two</span></code>.
For readers familiar with the C language, this is the same reason you must
write <code class="code">s-&gt;field</code> instead of <code class="code"><span class="hl-variable">s</span>.<span class="hl-variable">field</span></code> when
<code class="code"><span class="hl-variable">s</span></code> is a pointer to a struct.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Record</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Record</span>(<span class="hl-variable">String</span>, <span class="hl-variable">A</span>, <span class="hl-variable">String</span>, <span class="hl-variable">B</span>, ...) :: <span class="hl-site">Record</span>[<span class="hl-variable">A</span>, <span class="hl-variable">B</span>, ...]</code>

                            </p><p>Create a new record (an immutable map from field names to values).
Arguments are consumed in pairs; the first argument of each pair
is the key, and the second is the value for that key.</p><p>To access the value in record <code class="code"><span class="hl-variable">r</span></code> for key <code class="code"><span class="hl-literal">"x"</span></code>,
use the syntax <code class="code"><span class="hl-variable">r</span>.<span class="hl-variable">x</span></code>. For example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 1</span>
<span class="hl-keyword">val</span> <span class="hl-variable">r</span> = <span class="hl-site">Record</span>(
  <span class="hl-literal">"one"</span>, <span class="hl-literal">1</span>,
  <span class="hl-literal">"two"</span>, <span class="hl-literal">2</span>)
<span class="hl-variable">r</span>.<span class="hl-variable">one</span></pre>
                            </p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">fst</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">fst</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>]((<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)) :: <span class="hl-variable">A</span></code>
                            </p><p>Return the first element of a pair.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">fst</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>]((<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">fst</span>((<span class="hl-variable">x</span>,<span class="hl-variable">_</span>)) = <span class="hl-variable">x</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">snd</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">snd</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>]((<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)) :: <span class="hl-variable">B</span></code>
                            </p><p>Return the second element of a pair.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">snd</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>]((<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)) :: <span class="hl-variable">B</span>
<span class="hl-keyword">def</span> <span class="hl-site">snd</span>((<span class="hl-variable">_</span>,<span class="hl-variable">y</span>)) = <span class="hl-variable">y</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Interval</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Interval</span>[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>, <span class="hl-variable">A</span>) :: <span class="hl-site">Interval</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>
                                <code class="code"><span class="hl-site">Interval</span>(<span class="hl-variable">a</span>,<span class="hl-variable">b</span>)</code> returns an object representing the half-open
interval [<code class="code"><span class="hl-variable">a</span></code>,<code class="code"><span class="hl-variable">b</span></code>).</p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">isEmpty</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Interval</span>[<span class="hl-variable">A</span>].<span class="hl-site">isEmpty</span>() :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>Return true if this interval is empty.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">spans</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Interval</span>[<span class="hl-variable">A</span>].<span class="hl-site">spans</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>Return true if the interval spans the given point, false otherwise.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">intersects</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Interval</span>[<span class="hl-variable">A</span>].<span class="hl-site">intersects</span>(<span class="hl-site">Interval</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>Return true if the given interval has a non-empty intersection with this one,
and false otherwise.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">intersect</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Interval</span>[<span class="hl-variable">A</span>].<span class="hl-site">intersect</span>(<span class="hl-site">Interval</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">Interval</span>[<span class="hl-variable">A</span>]</code>
                                    </p><p>Return the intersection of this interval with another. If
the two intervals do not intersect, returns an empty interval.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">contiguous</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Interval</span>[<span class="hl-variable">A</span>].<span class="hl-site">contiguous</span>(<span class="hl-site">Interval</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>Return true if the given interval is contiguous with this one
(overlaps or abuts), and false otherwise.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">union</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Interval</span>[<span class="hl-variable">A</span>].<span class="hl-site">union</span>(<span class="hl-site">Interval</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">Interval</span>[<span class="hl-variable">A</span>]</code>
                                    </p><p>Return the union of this interval with another. Halts with an error if
the two intervals are not contiguous.</p></td></tr></tbody></table></div></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Intervals</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Intervals</span>[<span class="hl-variable">A</span>]() :: <span class="hl-site">Intervals</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Return an empty set of intervals. An Intervals object is iterable;
iterating over the set returns disjoint intervals in increasing order.</p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">isEmpty</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Intervals</span>[<span class="hl-variable">A</span>].<span class="hl-site">isEmpty</span>() :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>Return true if this set of intervals is empty.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">spans</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Intervals</span>[<span class="hl-variable">A</span>].<span class="hl-site">spans</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>Return true if this set of intervals spans the given point, and false otherwise.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">intersect</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Intervals</span>[<span class="hl-variable">A</span>].<span class="hl-site">intersect</span>(<span class="hl-site">Intervals</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">Intervals</span>[<span class="hl-variable">A</span>]</code>
                                    </p><p>Return the intersection of this set of intervals with another.</p></td></tr><tr><td><p><span class="term">
                                    <code class="code"><span class="hl-variable">union</span></code>
                                    </span></p></td><td><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Intervals</span>[<span class="hl-variable">A</span>].<span class="hl-site">union</span>(<span class="hl-site">Interval</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">Intervals</span>[<span class="hl-variable">A</span>]</code>
                                    </p><p>Return the union of this set of intervals with the given interval.
This method is most efficient when the given interval is before
most of the intervals in the set.</p></td></tr></tbody></table></div></td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N127D0"></a>B.3.3.&nbsp;idioms.inc: Higher-order Orc programming idioms.</h3></div></div></div><p>Higher-order Orc programming idioms.
Many of these are standard functional-programming
combinators borrowed from Haskell or Scheme.</p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">apply</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">apply</span>[<span class="hl-variable">A</span>, ..., <span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, ...) :: <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">B</span></code>
                            </p><p>Apply a function to a list of arguments.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">curry</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">curry</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>)(<span class="hl-variable">A</span>)(<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span></code>
                            </p><p>Curry a function of two arguments.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">curry</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>)(<span class="hl-variable">A</span>)(<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>
<span class="hl-keyword">def</span> <span class="hl-site">curry</span>(<span class="hl-variable">f</span>)(<span class="hl-variable">x</span>)(<span class="hl-variable">y</span>) = <span class="hl-site">f</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">curry3</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">curry3</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>,<span class="hl-variable">D</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>) :: <span class="hl-variable">D</span>)(<span class="hl-variable">A</span>)(<span class="hl-variable">B</span>)(<span class="hl-variable">C</span>) :: <span class="hl-variable">D</span></code>
                            </p><p>Curry a function of three arguments.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">curry3</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>,<span class="hl-variable">D</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>) :: <span class="hl-variable">D</span>)(<span class="hl-variable">A</span>)(<span class="hl-variable">B</span>)(<span class="hl-variable">C</span>) :: <span class="hl-variable">D</span>
<span class="hl-keyword">def</span> <span class="hl-site">curry3</span>(<span class="hl-variable">f</span>)(<span class="hl-variable">x</span>)(<span class="hl-variable">y</span>)(<span class="hl-variable">z</span>) = <span class="hl-site">f</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>,<span class="hl-variable">z</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">uncurry</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">uncurry</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>)(<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>)(<span class="hl-variable">A</span>, <span class="hl-variable">B</span>) :: <span class="hl-variable">C</span></code>
                            </p><p>Uncurry a function of two arguments.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">uncurry</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>)(<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>)(<span class="hl-variable">A</span>, <span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>
<span class="hl-keyword">def</span> <span class="hl-site">uncurry</span>(<span class="hl-variable">f</span>)(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) = <span class="hl-site">f</span>(<span class="hl-variable">x</span>)(<span class="hl-variable">y</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">uncurry3</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">uncurry3</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>,<span class="hl-variable">D</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>)(<span class="hl-variable">B</span>)(<span class="hl-variable">C</span>) :: <span class="hl-variable">D</span>)(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>) :: <span class="hl-variable">D</span></code>
                            </p><p>Uncurry a function of three arguments.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">uncurry3</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>,<span class="hl-variable">D</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>)(<span class="hl-variable">B</span>)(<span class="hl-variable">C</span>) :: <span class="hl-variable">D</span>)(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>) :: <span class="hl-variable">D</span>
<span class="hl-keyword">def</span> <span class="hl-site">uncurry3</span>(<span class="hl-variable">f</span>)(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>,<span class="hl-variable">z</span>) = <span class="hl-site">f</span>(<span class="hl-variable">x</span>)(<span class="hl-variable">y</span>)(<span class="hl-variable">z</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">flip</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">flip</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>)(<span class="hl-variable">B</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">C</span></code>
                            </p><p>Flip the order of parameters of a two-argument function.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">flip</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>)(<span class="hl-variable">B</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">C</span>
<span class="hl-keyword">def</span> <span class="hl-site">flip</span>(<span class="hl-variable">f</span>)(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) = <span class="hl-site">f</span>(<span class="hl-variable">y</span>,<span class="hl-variable">x</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">constant</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">constant</span>[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>)() :: <span class="hl-variable">A</span></code>
                            </p><p>Create a function which returns a constant value.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">constant</span>[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>)() :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">constant</span>(<span class="hl-variable">x</span>)() = <span class="hl-variable">x</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">defer</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">defer</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-variable">A</span>)() :: <span class="hl-variable">B</span></code>
                            </p><p>Given a function and its argument, return a thunk which applies the function.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">defer</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-variable">A</span>)() :: <span class="hl-variable">B</span>
<span class="hl-keyword">def</span> <span class="hl-site">defer</span>(<span class="hl-variable">f</span>, <span class="hl-variable">x</span>)() = <span class="hl-site">f</span>(<span class="hl-variable">x</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">defer2</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">defer2</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>, <span class="hl-variable">A</span>, <span class="hl-variable">B</span>)() :: <span class="hl-variable">C</span></code>
                            </p><p>Given a function and its arguments, return a thunk which applies the function.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">defer2</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>, <span class="hl-variable">A</span>, <span class="hl-variable">B</span>)() :: <span class="hl-variable">C</span>
<span class="hl-keyword">def</span> <span class="hl-site">defer2</span>(<span class="hl-variable">f</span>, <span class="hl-variable">x</span>, <span class="hl-variable">y</span>)() = <span class="hl-site">f</span>(<span class="hl-variable">x</span>, <span class="hl-variable">y</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">ignore</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">ignore</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">B</span>)(<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span></code>
                            </p><p>From a function of no arguments, create a function
of one argument, which is ignored.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">ignore</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">B</span>)(<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>
<span class="hl-keyword">def</span> <span class="hl-site">ignore</span>(<span class="hl-variable">f</span>)(<span class="hl-variable">_</span>) = <span class="hl-site">f</span>()</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">ignore2</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">ignore2</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>](<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">C</span>)(<span class="hl-variable">A</span>, <span class="hl-variable">B</span>) :: <span class="hl-variable">C</span></code>
                            </p><p>From a function of no arguments, create a function
of two arguments, which are ignored.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">ignore2</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>](<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">C</span>)(<span class="hl-variable">A</span>, <span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>
<span class="hl-keyword">def</span> <span class="hl-site">ignore2</span>(<span class="hl-variable">f</span>)(<span class="hl-variable">_</span>, <span class="hl-variable">_</span>) = <span class="hl-site">f</span>()</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">compose</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">compose</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>, <span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>)(<span class="hl-variable">A</span>) :: <span class="hl-variable">C</span></code>
                            </p><p>Compose two single-argument functions.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">compose</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>,
                   <span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>)(<span class="hl-variable">A</span>) :: <span class="hl-variable">C</span>
<span class="hl-keyword">def</span> <span class="hl-site">compose</span>(<span class="hl-variable">f</span>,<span class="hl-variable">g</span>)(<span class="hl-variable">x</span>) = <span class="hl-site">f</span>(<span class="hl-site">g</span>(<span class="hl-variable">x</span>))</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">while</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">while</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>)(<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>Iterate a function while a predicate is satisfied, publishing
each value passed to the function. The exact behavior is specified
by the following implementation:</p><p>
                                <pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-site">while</span>(<span class="hl-variable">p</span>,<span class="hl-variable">f</span>) = 
  <span class="hl-keyword">def</span> <span class="hl-site">loop</span>(<span class="hl-variable">x</span>) = <span class="hl-keyword">if</span>(<span class="hl-site">p</span>(<span class="hl-variable">x</span>)) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> ( <span class="hl-variable">x</span> <span class="hl-combinator">|</span> <span class="hl-site">loop</span>(<span class="hl-site">f</span>(<span class="hl-variable">x</span>)) )
  <span class="hl-variable">loop</span></pre>
                            </p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 0 1 2 3 4 5</span>
<span class="hl-site">while</span>(
  <span class="hl-keyword">lambda</span> (<span class="hl-variable">n</span>) = (<span class="hl-variable">n</span> <span class="hl-site">&lt;=</span> <span class="hl-literal">5</span>),
  <span class="hl-keyword">lambda</span> (<span class="hl-variable">n</span>) = <span class="hl-variable">n</span>+<span class="hl-literal">1</span>
)(<span class="hl-literal">0</span>)</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">while</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>,
             <span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>)(<span class="hl-variable">A</span>)
  :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">while</span>(<span class="hl-variable">p</span>,<span class="hl-variable">f</span>) = 
  <span class="hl-keyword">def</span> <span class="hl-site">loop</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>
  <span class="hl-keyword">def</span> <span class="hl-site">loop</span>(<span class="hl-variable">x</span>) = <span class="hl-keyword">if</span>(<span class="hl-site">p</span>(<span class="hl-variable">x</span>)) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> ( <span class="hl-variable">x</span> <span class="hl-combinator">|</span> <span class="hl-site">loop</span>(<span class="hl-site">f</span>(<span class="hl-variable">x</span>)) )
  <span class="hl-variable">loop</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">repeat</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">repeat</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>Call a function sequentially, publishing each value returned by the function.
The expression <code class="code"><span class="hl-site">repeat</span>(<span class="hl-variable">f</span>)</code> is equivalent to
the infinite expression <code class="code"><span class="hl-site">f</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> ( <span class="hl-variable">x</span> <span class="hl-combinator">|</span> <span class="hl-site">f</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> ( <span class="hl-variable">x</span> <span class="hl-combinator">|</span> <span class="hl-site">f</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> ... ) )</code>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">repeat</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">repeat</span>(<span class="hl-variable">f</span>) = <span class="hl-site">f</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> (<span class="hl-variable">x</span> <span class="hl-combinator">|</span> <span class="hl-site">repeat</span>(<span class="hl-variable">f</span>))</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">fork</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">fork</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Call a list of functions in parallel, publishing
all values published by the functions.</p><p>The expression <code class="code"><span class="hl-site">fork</span>([<span class="hl-variable">f</span>,<span class="hl-variable">g</span>,<span class="hl-variable">h</span>])</code> is equivalent to
the expression <code class="code"><span class="hl-site">f</span>() <span class="hl-combinator">|</span> <span class="hl-site">g</span>() <span class="hl-combinator">|</span> <span class="hl-site">h</span>()</code>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">fork</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">fork</span>([]) = <span class="hl-keyword">stop</span>
<span class="hl-keyword">def</span> <span class="hl-site">fork</span>(<span class="hl-variable">p</span>:<span class="hl-variable">ps</span>) = <span class="hl-site">p</span>() <span class="hl-combinator">|</span> <span class="hl-site">fork</span>(<span class="hl-variable">ps</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">forkMap</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">forkMap</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">B</span></code>
                            </p><p>Apply a function to a list in parallel, publishing all values published
by the applications.</p><p>The expression <code class="code"><span class="hl-site">forkMap</span>(<span class="hl-variable">f</span>, [<span class="hl-variable">a</span>,<span class="hl-variable">b</span>,<span class="hl-variable">c</span>])</code> is equivalent to
the expression <code class="code"><span class="hl-site">f</span>(<span class="hl-variable">a</span>) <span class="hl-combinator">|</span> <span class="hl-site">f</span>(<span class="hl-variable">b</span>) <span class="hl-combinator">|</span> <span class="hl-site">f</span>(<span class="hl-variable">c</span>)</code>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">forkMap</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">B</span>
<span class="hl-keyword">def</span> <span class="hl-site">forkMap</span>(<span class="hl-variable">f</span>, []) = <span class="hl-keyword">stop</span>
<span class="hl-keyword">def</span> <span class="hl-site">forkMap</span>(<span class="hl-variable">f</span>, <span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) = <span class="hl-site">f</span>(<span class="hl-variable">x</span>) <span class="hl-combinator">|</span> <span class="hl-site">forkMap</span>(<span class="hl-variable">f</span>, <span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">seq</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">seq</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>]) :: <span class="hl-variable">Top</span></code>
                            </p><p>Call a list of functions in sequence, publishing
a signal whenever the last function publishes. The
actual publications of the given functions are not
published.</p><p>The expression <code class="code"><span class="hl-site">seq</span>([<span class="hl-variable">f</span>,<span class="hl-variable">g</span>,<span class="hl-variable">h</span>])</code> is equivalent to
the expression <code class="code"><span class="hl-site">f</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-site">g</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-site">h</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span></code>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">seq</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>]) :: <span class="hl-variable">Top</span>
<span class="hl-keyword">def</span> <span class="hl-site">seq</span>([]) = <span class="hl-keyword">signal</span>
<span class="hl-keyword">def</span> <span class="hl-site">seq</span>(<span class="hl-variable">p</span>:<span class="hl-variable">ps</span>) = <span class="hl-site">p</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-site">seq</span>(<span class="hl-variable">ps</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">seqMap</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">seqMap</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Top</span></code>
                            </p><p>Apply a function to a list in in sequence, publishing
a signal whenever the last application publishes. The
actual publications of the given functions are not
published.</p><p>The expression <code class="code"><span class="hl-site">seqMap</span>(<span class="hl-variable">f</span>, [<span class="hl-variable">a</span>,<span class="hl-variable">b</span>,<span class="hl-variable">c</span>])</code> is equivalent to
the expression <code class="code"><span class="hl-site">f</span>(<span class="hl-variable">a</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-site">f</span>(<span class="hl-variable">b</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-site">f</span>(<span class="hl-variable">c</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span></code>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">seqMap</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Top</span>
<span class="hl-keyword">def</span> <span class="hl-site">seqMap</span>(<span class="hl-variable">f</span>, []) = <span class="hl-keyword">signal</span>
<span class="hl-keyword">def</span> <span class="hl-site">seqMap</span>(<span class="hl-variable">f</span>, <span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) = <span class="hl-site">f</span>(<span class="hl-variable">x</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-site">seqMap</span>(<span class="hl-variable">f</span>, <span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">join</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">join</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>]) :: <span class="hl-variable">Top</span></code>
                            </p><p>Call a list of functions in parallel and publish
a signal once all functions have completed.</p><p>The expression <code class="code"><span class="hl-site">join</span>([<span class="hl-variable">f</span>,<span class="hl-variable">g</span>,<span class="hl-variable">h</span>])</code> is equivalent to
the expression <code class="code">(<span class="hl-site">f</span>(), <span class="hl-site">g</span>(), <span class="hl-site">h</span>()) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span></code>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">join</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>]) :: <span class="hl-variable">Top</span>
<span class="hl-keyword">def</span> <span class="hl-site">join</span>([]) = <span class="hl-keyword">signal</span>
<span class="hl-keyword">def</span> <span class="hl-site">join</span>(<span class="hl-variable">p</span>:<span class="hl-variable">ps</span>) = (<span class="hl-site">p</span>(), <span class="hl-site">join</span>(<span class="hl-variable">ps</span>)) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">joinMap</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">joinMap</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Top</span></code>
                            </p><p>Apply a function to a list in parallel and publish
a signal once all applications have completed.</p><p>The expression <code class="code"><span class="hl-site">joinMap</span>(<span class="hl-variable">f</span>, [<span class="hl-variable">a</span>,<span class="hl-variable">b</span>,<span class="hl-variable">c</span>])</code> is equivalent to
the expression <code class="code">(<span class="hl-site">f</span>(<span class="hl-variable">a</span>), <span class="hl-site">f</span>(<span class="hl-variable">b</span>), <span class="hl-site">f</span>(<span class="hl-variable">c</span>)) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span></code>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">joinMap</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Top</span>
<span class="hl-keyword">def</span> <span class="hl-site">joinMap</span>(<span class="hl-variable">f</span>, []) = <span class="hl-keyword">signal</span>
<span class="hl-keyword">def</span> <span class="hl-site">joinMap</span>(<span class="hl-variable">f</span>, <span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) = (<span class="hl-site">f</span>(<span class="hl-variable">x</span>), <span class="hl-site">joinMap</span>(<span class="hl-variable">f</span>, <span class="hl-variable">xs</span>)) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">alt</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">alt</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Call each function in the list until one publishes.</p><p>The expression <code class="code"><span class="hl-site">alt</span>([<span class="hl-variable">f</span>,<span class="hl-variable">g</span>,<span class="hl-variable">h</span>])</code> is equivalent to
the expression <code class="code"><span class="hl-site">f</span>() <span class="hl-combinator">;</span> <span class="hl-site">g</span>() <span class="hl-combinator">;</span> <span class="hl-site">h</span>()</code>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">alt</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">alt</span>([]) = <span class="hl-keyword">stop</span>
<span class="hl-keyword">def</span> <span class="hl-site">alt</span>(<span class="hl-variable">p</span>:<span class="hl-variable">ps</span>) = <span class="hl-site">p</span>() <span class="hl-combinator">;</span> <span class="hl-site">alt</span>(<span class="hl-variable">ps</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">altMap</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">altMap</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">B</span></code>
                            </p><p>Apply the function to each element in the list until one publishes.</p><p>The expression <code class="code"><span class="hl-site">altMap</span>(<span class="hl-variable">f</span>, [<span class="hl-variable">a</span>,<span class="hl-variable">b</span>,<span class="hl-variable">c</span>])</code> is equivalent to
the expression <code class="code"><span class="hl-site">f</span>(<span class="hl-variable">a</span>) <span class="hl-combinator">;</span> <span class="hl-site">f</span>(<span class="hl-variable">b</span>) <span class="hl-combinator">;</span> <span class="hl-site">f</span>(<span class="hl-variable">c</span>)</code>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">altMap</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">B</span>
<span class="hl-keyword">def</span> <span class="hl-site">altMap</span>(<span class="hl-variable">f</span>, []) = <span class="hl-keyword">stop</span>
<span class="hl-keyword">def</span> <span class="hl-site">altMap</span>(<span class="hl-variable">f</span>, <span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) = <span class="hl-site">f</span>(<span class="hl-variable">x</span>) <span class="hl-combinator">;</span> <span class="hl-site">altMap</span>(<span class="hl-variable">f</span>, <span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">por</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">por</span>(<span class="hl-site">List</span>[<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">Boolean</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Parallel or. Evaluate a list of boolean functions in parallel, publishing
a value as soon as possible, and terminating any unnecessary ongoing
computation.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">por</span>(<span class="hl-site">List</span>[<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">Boolean</span>]) :: <span class="hl-variable">Boolean</span>
<span class="hl-keyword">def</span> <span class="hl-site">por</span>([]) = <span class="hl-literal">false</span>
<span class="hl-keyword">def</span> <span class="hl-site">por</span>(<span class="hl-variable">p</span>:<span class="hl-variable">ps</span>) =
  <span class="hl-site">let</span>(
    <span class="hl-keyword">val</span> <span class="hl-variable">b1</span> = <span class="hl-site">p</span>()
    <span class="hl-keyword">val</span> <span class="hl-variable">b2</span> = <span class="hl-site">por</span>(<span class="hl-variable">ps</span>)
    <span class="hl-keyword">if</span>(<span class="hl-variable">b1</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">true</span> <span class="hl-combinator">|</span> <span class="hl-keyword">if</span>(<span class="hl-variable">b2</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">true</span> <span class="hl-combinator">|</span> (<span class="hl-variable">b1</span> <span class="hl-site">||</span> <span class="hl-variable">b2</span>)
  )</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">pand</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">pand</span>(<span class="hl-site">List</span>[<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">Boolean</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Parallel and. Evaluate a list of boolean functions in parallel, publishing
a value as soon as possible, and terminating any unnecessary ongoing
computation.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">pand</span>(<span class="hl-site">List</span>[<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">Boolean</span>]) :: <span class="hl-variable">Boolean</span>
<span class="hl-keyword">def</span> <span class="hl-site">pand</span>([]) = <span class="hl-literal">true</span>
<span class="hl-keyword">def</span> <span class="hl-site">pand</span>(<span class="hl-variable">p</span>:<span class="hl-variable">ps</span>) =
  <span class="hl-site">let</span>(
    <span class="hl-keyword">val</span> <span class="hl-variable">b1</span> = <span class="hl-site">p</span>()
    <span class="hl-keyword">val</span> <span class="hl-variable">b2</span> = <span class="hl-site">pand</span>(<span class="hl-variable">ps</span>)
    <span class="hl-keyword">if</span>(~<span class="hl-variable">b1</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">false</span> <span class="hl-combinator">|</span> <span class="hl-keyword">if</span>(~<span class="hl-variable">b2</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">false</span> <span class="hl-combinator">|</span> (<span class="hl-variable">b1</span> &amp;&amp; <span class="hl-variable">b2</span>)
  )</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">collect</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">collect</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>

                            </p><p>Run a function, collecting all publications in a list.
Return the list when the function terminates.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: [signal, signal, signal, signal, signal]</span>
<span class="hl-site">collect</span>(<span class="hl-site">defer</span>(<span class="hl-variable">signals</span>, <span class="hl-literal">5</span>))</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">collect</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">collect</span>(<span class="hl-variable">p</span>) =
  <span class="hl-keyword">val</span> <span class="hl-variable">b</span> = <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>]()
  <span class="hl-site">p</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">b</span>.<span class="hl-site">put</span>(<span class="hl-variable">x</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span>
  <span class="hl-combinator">;</span> <span class="hl-variable">b</span>.<span class="hl-site">getAll</span>()</pre></p></td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N12A05"></a>B.3.4.&nbsp;list.inc: Operations on lists.</h3></div></div></div><p>Operations on lists.
Many of these functions are similar to those in the Haskell prelude, but
operate on the elements of a list in parallel.</p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">each</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">each</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Publish every value in a list, simultaneously.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">each</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">each</span>([]) = <span class="hl-keyword">stop</span>
<span class="hl-keyword">def</span> <span class="hl-site">each</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>) = <span class="hl-variable">h</span> <span class="hl-combinator">|</span> <span class="hl-site">each</span>(<span class="hl-variable">t</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">map</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">map</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">B</span>]</code>
                            </p><p>Apply a function to every element of a list (in parallel),
returning a list of the results.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">map</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">B</span>]
<span class="hl-keyword">def</span> <span class="hl-site">map</span>(<span class="hl-variable">f</span>,[]) = []
<span class="hl-keyword">def</span> <span class="hl-site">map</span>(<span class="hl-variable">f</span>,<span class="hl-variable">h</span>:<span class="hl-variable">t</span>) = <span class="hl-site">f</span>(<span class="hl-variable">h</span>):<span class="hl-site">map</span>(<span class="hl-variable">f</span>,<span class="hl-variable">t</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">reverse</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">reverse</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Return the reverse of the given list.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">reverse</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">reverse</span>(<span class="hl-variable">l</span>) = 
  <span class="hl-keyword">def</span> <span class="hl-site">tailrev</span>(<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>] 
  <span class="hl-keyword">def</span> <span class="hl-site">tailrev</span>([],<span class="hl-variable">x</span>) = <span class="hl-variable">x</span>
  <span class="hl-keyword">def</span> <span class="hl-site">tailrev</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>,<span class="hl-variable">x</span>) = <span class="hl-site">tailrev</span>(<span class="hl-variable">t</span>,<span class="hl-variable">h</span>:<span class="hl-variable">x</span>)
  <span class="hl-site">tailrev</span>(<span class="hl-variable">l</span>,[])</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">filter</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">filter</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Return a list containing only those elements which satisfy the predicate.
The filter is applied to all list elements in parallel.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">filter</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">filter</span>(<span class="hl-variable">p</span>,[]) = []
<span class="hl-keyword">def</span> <span class="hl-site">filter</span>(<span class="hl-variable">p</span>,<span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) =
  <span class="hl-keyword">val</span> <span class="hl-variable">fxs</span> = <span class="hl-site">filter</span>(<span class="hl-variable">p</span>, <span class="hl-variable">xs</span>)
  <span class="hl-keyword">if</span> <span class="hl-site">p</span>(<span class="hl-variable">x</span>) <span class="hl-keyword">then</span> <span class="hl-variable">x</span>:<span class="hl-variable">fxs</span> <span class="hl-keyword">else</span> <span class="hl-variable">fxs</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">head</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">head</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Return the first element of a list.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">head</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">head</span>(<span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) = <span class="hl-variable">x</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">tail</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">tail</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Return all but the first element of a list.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">tail</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">tail</span>(<span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) = <span class="hl-variable">xs</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">init</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">init</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Return all but the last element of a list.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">init</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">init</span>([<span class="hl-variable">x</span>]) = []
<span class="hl-keyword">def</span> <span class="hl-site">init</span>(<span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) = <span class="hl-variable">x</span>:<span class="hl-site">init</span>(<span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">last</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">last</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Return the last element of a list.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">last</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">last</span>([<span class="hl-variable">x</span>]) = <span class="hl-variable">x</span>
<span class="hl-keyword">def</span> <span class="hl-site">last</span>(<span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) = <span class="hl-site">last</span>(<span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">empty</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">empty</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Is the list empty?</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">empty</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span>
<span class="hl-keyword">def</span> <span class="hl-site">empty</span>([]) = <span class="hl-literal">true</span>
<span class="hl-keyword">def</span> <span class="hl-site">empty</span>(<span class="hl-variable">_</span>) = <span class="hl-literal">false</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">index</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">index</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>Return the nth element of a list, counting from 0.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">index</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">index</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>, <span class="hl-literal">0</span>) = <span class="hl-variable">h</span>
<span class="hl-keyword">def</span> <span class="hl-site">index</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>, <span class="hl-variable">n</span>) = <span class="hl-site">index</span>(<span class="hl-variable">t</span>, <span class="hl-variable">n</span>-<span class="hl-literal">1</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">append</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">append</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Return the first list concatenated with the second.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">append</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">append</span>([],<span class="hl-variable">l</span>) = <span class="hl-variable">l</span>
<span class="hl-keyword">def</span> <span class="hl-site">append</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>,<span class="hl-variable">l</span>) = <span class="hl-variable">h</span>:<span class="hl-site">append</span>(<span class="hl-variable">t</span>,<span class="hl-variable">l</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">foldl</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">foldl</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">B</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">B</span></code>
                            </p><p>Reduce a list using the given left-associative binary operation and initial value.
Given the list <code class="code">[<span class="hl-variable">x1</span>, <span class="hl-variable">x2</span>, <span class="hl-variable">x3</span>, ...]</code> and initial value <code class="code"><span class="hl-variable">x0</span></code>,
returns <code class="code"><span class="hl-site">f</span>(... <span class="hl-site">f</span>(<span class="hl-site">f</span>(<span class="hl-site">f</span>(<span class="hl-variable">x0</span>, <span class="hl-variable">x1</span>), <span class="hl-variable">x2</span>), <span class="hl-variable">x3</span>) ...)</code>

                            </p><p>Example using <code class="code"><span class="hl-variable">foldl</span></code> to reverse a list:
<pre class="orc">
<span class="hl-comment">-- Publishes: [3, 2, 1]</span>
<span class="hl-site">foldl</span>(<span class="hl-site">flip</span>((:)), [], [<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>])</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">foldl</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">B</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">B</span>
<span class="hl-keyword">def</span> <span class="hl-site">foldl</span>(<span class="hl-variable">f</span>,<span class="hl-variable">z</span>,[]) = <span class="hl-variable">z</span>
<span class="hl-keyword">def</span> <span class="hl-site">foldl</span>(<span class="hl-variable">f</span>,<span class="hl-variable">z</span>,<span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) = <span class="hl-site">foldl</span>(<span class="hl-variable">f</span>,<span class="hl-site">f</span>(<span class="hl-variable">z</span>,<span class="hl-variable">x</span>),<span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">foldl1</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">foldl1</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>A special case of <code class="code"><span class="hl-variable">foldl</span></code> which uses the last element of the list as the
initial value. It is an error to call this on an empty list.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">foldl1</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">foldl1</span>(<span class="hl-variable">f</span>,<span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) = <span class="hl-site">foldl</span>(<span class="hl-variable">f</span>,<span class="hl-variable">x</span>,<span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">foldr</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">foldr</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">B</span>) :: <span class="hl-variable">B</span>, <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">B</span></code>
                            </p><p>Reduce a list using the given right-associative binary operation and initial value.
Given the list <code class="code">[..., <span class="hl-variable">x3</span>, <span class="hl-variable">x2</span>, <span class="hl-variable">x1</span>]</code> and initial value <code class="code"><span class="hl-variable">x0</span></code>,
returns <code class="code"><span class="hl-site">f</span>(... <span class="hl-site">f</span>(<span class="hl-variable">x3</span>, <span class="hl-site">f</span>(<span class="hl-variable">x2</span>, <span class="hl-site">f</span>(<span class="hl-variable">x1</span>, <span class="hl-variable">x0</span>))) ...)</code>

                            </p><p>Example summing the numbers in a list:
<pre class="orc">
<span class="hl-comment">-- Publishes: 6</span>
<span class="hl-site">foldr</span>((+), <span class="hl-literal">0</span>, [<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>])</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">foldr</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">B</span>) :: <span class="hl-variable">B</span>, <span class="hl-variable">B</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">B</span>
<span class="hl-keyword">def</span> <span class="hl-site">foldr</span>(<span class="hl-variable">f</span>,<span class="hl-variable">z</span>,<span class="hl-variable">xs</span>) = <span class="hl-site">foldl</span>(<span class="hl-site">flip</span>(<span class="hl-variable">f</span>),<span class="hl-variable">z</span>,<span class="hl-site">reverse</span>(<span class="hl-variable">xs</span>))</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">foldr1</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">foldr1</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>A special case of <code class="code"><span class="hl-variable">foldr</span></code> which uses the last element of the list as the
initial value. It is an error to call this on an empty list.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">foldr1</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">foldr1</span>(<span class="hl-variable">f</span>,<span class="hl-variable">xs</span>) = <span class="hl-site">foldl1</span>(<span class="hl-site">flip</span>(<span class="hl-variable">f</span>),<span class="hl-site">reverse</span>(<span class="hl-variable">xs</span>))</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">afold</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">afold</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Reduce a non-empty list using the given associative binary operation.
This function reduces independent subexpressions in parallel; the
calls exhibit a balanced tree structure, so the number of sequential 
reductions performed is O(log n).  For expensive reductions, this
is much more efficient than <code class="code"><span class="hl-variable">foldl</span></code> or <code class="code"><span class="hl-variable">foldr</span></code>.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">afold</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">afold</span>(<span class="hl-variable">f</span>, [<span class="hl-variable">x</span>]) = <span class="hl-variable">x</span>
<span class="hl-comment">{- Here's the interesting part -}</span>
<span class="hl-keyword">def</span> <span class="hl-site">afold</span>(<span class="hl-variable">f</span>, <span class="hl-variable">xs</span>) =
  <span class="hl-keyword">def</span> <span class="hl-variable">afold</span>'(<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
  <span class="hl-keyword">def</span> <span class="hl-variable">afold</span>'([]) = []
  <span class="hl-keyword">def</span> <span class="hl-variable">afold</span>'([<span class="hl-variable">x</span>]) = [<span class="hl-variable">x</span>]
  <span class="hl-keyword">def</span> <span class="hl-variable">afold</span>'(<span class="hl-variable">x</span>:<span class="hl-variable">y</span>:<span class="hl-variable">xs</span>) = <span class="hl-site">f</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>):<span class="hl-variable">afold</span>'(<span class="hl-variable">xs</span>)
  <span class="hl-site">afold</span>(<span class="hl-variable">f</span>, <span class="hl-variable">afold</span>'(<span class="hl-variable">xs</span>))</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">cfold</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">cfold</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Reduce a non-empty list using the given associative and commutative binary operation.
This function opportunistically reduces independent subexpressions in parallel, so the number of
sequential reductions performed is as small as possible.  For expensive reductions, this
is much more efficient than <code class="code"><span class="hl-variable">foldl</span></code> or <code class="code"><span class="hl-variable">foldr</span></code>. In cases
where the reduction does not always take the same amount of time to complete, it 
is also more efficient than <code class="code"><span class="hl-variable">afold</span></code>.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">cfold</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">cfold</span>(<span class="hl-variable">f</span>, []) = <span class="hl-keyword">stop</span>
<span class="hl-keyword">def</span> <span class="hl-site">cfold</span>(<span class="hl-variable">f</span>, [<span class="hl-variable">x</span>]) = <span class="hl-variable">x</span>
<span class="hl-keyword">def</span> <span class="hl-site">cfold</span>(<span class="hl-variable">f</span>, [<span class="hl-variable">x</span>,<span class="hl-variable">y</span>]) = <span class="hl-site">f</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)
<span class="hl-keyword">def</span> <span class="hl-site">cfold</span>(<span class="hl-variable">f</span>, <span class="hl-variable">L</span>) =
  <span class="hl-keyword">val</span> <span class="hl-variable">c</span> = <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>]()
  <span class="hl-keyword">def</span> <span class="hl-site">work</span>(<span class="hl-variable">Number</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
  <span class="hl-keyword">def</span> <span class="hl-site">work</span>(<span class="hl-variable">i</span>, <span class="hl-variable">x</span>:<span class="hl-variable">y</span>:<span class="hl-variable">rest</span>) =
    <span class="hl-variable">c</span>.<span class="hl-site">put</span>(<span class="hl-site">f</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span> <span class="hl-combinator">|</span> <span class="hl-site">work</span>(<span class="hl-variable">i</span>+<span class="hl-literal">1</span>, <span class="hl-variable">rest</span>)
  <span class="hl-keyword">def</span> <span class="hl-site">work</span>(<span class="hl-variable">i</span>, [<span class="hl-variable">x</span>]) = <span class="hl-variable">c</span>.<span class="hl-site">put</span>(<span class="hl-variable">x</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span> <span class="hl-combinator">|</span> <span class="hl-site">work</span>(<span class="hl-variable">i</span>+<span class="hl-literal">1</span>, [])
  <span class="hl-keyword">def</span> <span class="hl-site">work</span>(<span class="hl-variable">i</span>, []) =
    <span class="hl-keyword">if</span> (<span class="hl-variable">i</span> &lt; <span class="hl-literal">2</span>) <span class="hl-keyword">then</span> <span class="hl-variable">c</span>.<span class="hl-site">get</span>() 
    <span class="hl-keyword">else</span> <span class="hl-variable">c</span>.<span class="hl-site">get</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">c</span>.<span class="hl-site">get</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">y</span><span class="hl-combinator">&gt;</span>
         ( <span class="hl-variable">c</span>.<span class="hl-site">put</span>(<span class="hl-site">f</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span> <span class="hl-combinator">|</span> <span class="hl-site">work</span>(<span class="hl-variable">i</span>-<span class="hl-literal">1</span>,[]) ) 
  <span class="hl-site">work</span>(<span class="hl-literal">0</span>, <span class="hl-variable">L</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">zip</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">zip</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">B</span>]) :: <span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)]</code>
                            </p><p>Combine two lists into a list of pairs.
The length of the shortest list determines the length of the result.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">zip</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">B</span>]) :: <span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)]
<span class="hl-keyword">def</span> <span class="hl-site">zip</span>([],<span class="hl-variable">_</span>) = []
<span class="hl-keyword">def</span> <span class="hl-site">zip</span>(<span class="hl-variable">_</span>,[]) = []
<span class="hl-keyword">def</span> <span class="hl-site">zip</span>(<span class="hl-variable">x</span>:<span class="hl-variable">xs</span>,<span class="hl-variable">y</span>:<span class="hl-variable">ys</span>) = (<span class="hl-variable">x</span>,<span class="hl-variable">y</span>):<span class="hl-site">zip</span>(<span class="hl-variable">xs</span>,<span class="hl-variable">ys</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">unzip</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">unzip</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)]) :: (<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">B</span>])</code>
                            </p><p>Split a list of pairs into a pair of lists.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">unzip</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)]) :: (<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">B</span>])
<span class="hl-keyword">def</span> <span class="hl-site">unzip</span>([]) = ([],[])
<span class="hl-keyword">def</span> <span class="hl-site">unzip</span>((<span class="hl-variable">x</span>,<span class="hl-variable">y</span>):<span class="hl-variable">z</span>) = (<span class="hl-variable">x</span>:<span class="hl-variable">xs</span>,<span class="hl-variable">y</span>:<span class="hl-variable">ys</span>) <span class="hl-combinator">&lt;</span>(<span class="hl-variable">xs</span>,<span class="hl-variable">ys</span>)<span class="hl-combinator">&lt;</span> <span class="hl-site">unzip</span>(<span class="hl-variable">z</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">concat</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">concat</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-site">List</span>[<span class="hl-variable">A</span>]]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Concatenate a list of lists into a single list.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">concat</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-site">List</span>[<span class="hl-variable">A</span>]]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">concat</span>([]) = []
<span class="hl-keyword">def</span> <span class="hl-site">concat</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>) = <span class="hl-site">append</span>(<span class="hl-variable">h</span>,<span class="hl-site">concat</span>(<span class="hl-variable">t</span>))</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">length</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">length</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Integer</span></code>
                            </p><p>Return the number of elements in a list.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">length</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Integer</span>
<span class="hl-keyword">def</span> <span class="hl-site">length</span>([]) = <span class="hl-literal">0</span>
<span class="hl-keyword">def</span> <span class="hl-site">length</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>) = <span class="hl-literal">1</span> + <span class="hl-site">length</span>(<span class="hl-variable">t</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">take</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">take</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Integer</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Given a number <code class="code"><span class="hl-variable">n</span></code> and a list <code class="code"><span class="hl-variable">l</span></code>,
return the first <code class="code"><span class="hl-variable">n</span></code> elements of <code class="code"><span class="hl-variable">l</span></code>.
If <code class="code"><span class="hl-variable">n</span></code> exceeds the length of <code class="code"><span class="hl-variable">l</span></code>,
or <code class="code"><span class="hl-variable">n</span> &lt; <span class="hl-literal">0</span></code>, take halts with an error.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">take</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Integer</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">take</span>(<span class="hl-literal">0</span>, <span class="hl-variable">_</span>) = []
<span class="hl-keyword">def</span> <span class="hl-site">take</span>(<span class="hl-variable">n</span>, <span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) =
  <span class="hl-keyword">if</span> <span class="hl-variable">n</span> &gt; <span class="hl-literal">0</span> <span class="hl-keyword">then</span> <span class="hl-variable">x</span>:<span class="hl-site">take</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>, <span class="hl-variable">xs</span>)
  <span class="hl-keyword">else</span> <span class="hl-site">error</span>(<span class="hl-literal">"Cannot take("</span> + <span class="hl-variable">n</span> + <span class="hl-literal">", _)"</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">drop</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">drop</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Integer</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Given a number <code class="code"><span class="hl-variable">n</span></code> and a list <code class="code"><span class="hl-variable">l</span></code>,
return the elements of <code class="code"><span class="hl-variable">l</span></code> after the first <code class="code"><span class="hl-variable">n</span></code>.
If <code class="code"><span class="hl-variable">n</span></code> exceeds the length of <code class="code"><span class="hl-variable">l</span></code>,
or <code class="code"><span class="hl-variable">n</span> &lt; <span class="hl-literal">0</span></code>, drop halts with an error.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">drop</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Integer</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">drop</span>(<span class="hl-literal">0</span>, <span class="hl-variable">xs</span>) = <span class="hl-variable">xs</span>
<span class="hl-keyword">def</span> <span class="hl-site">drop</span>(<span class="hl-variable">n</span>, <span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) =
  <span class="hl-keyword">if</span> <span class="hl-variable">n</span> &gt; <span class="hl-literal">0</span> <span class="hl-keyword">then</span> <span class="hl-site">drop</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>, <span class="hl-variable">xs</span>)
  <span class="hl-keyword">else</span> <span class="hl-site">error</span>(<span class="hl-literal">"Cannot drop("</span> + <span class="hl-variable">n</span> + <span class="hl-literal">", _)"</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">member</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">member</span>[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return true if the given item is a member of the given list, and false
otherwise.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">member</span>[<span class="hl-variable">A</span>](<span class="hl-variable">A</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span>
<span class="hl-keyword">def</span> <span class="hl-site">member</span>(<span class="hl-variable">item</span>, []) = <span class="hl-literal">false</span>
<span class="hl-keyword">def</span> <span class="hl-site">member</span>(<span class="hl-variable">item</span>, <span class="hl-variable">h</span>:<span class="hl-variable">t</span>) =
  <span class="hl-keyword">if</span> <span class="hl-variable">item</span> = <span class="hl-variable">h</span> <span class="hl-keyword">then</span> <span class="hl-literal">true</span>
  <span class="hl-keyword">else</span> <span class="hl-site">member</span>(<span class="hl-variable">item</span>, <span class="hl-variable">t</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">merge</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">merge</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>

                            </p><p>Merge two sorted lists.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: [1, 2, 2, 3, 4, 5]</span>
<span class="hl-site">merge</span>([<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>], [<span class="hl-literal">2</span>,<span class="hl-literal">4</span>,<span class="hl-literal">5</span>])</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">merge</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">merge</span>(<span class="hl-variable">xs</span>,<span class="hl-variable">ys</span>) = <span class="hl-site">mergeBy</span>((&lt;), <span class="hl-variable">xs</span>, <span class="hl-variable">ys</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">mergeBy</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">mergeBy</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Merge two lists using the given less-than relation.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">mergeBy</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>,
               <span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">mergeBy</span>(<span class="hl-variable">lt</span>, <span class="hl-variable">xs</span>, []) = <span class="hl-variable">xs</span>
<span class="hl-keyword">def</span> <span class="hl-site">mergeBy</span>(<span class="hl-variable">lt</span>, [], <span class="hl-variable">ys</span>) = <span class="hl-variable">ys</span>
<span class="hl-keyword">def</span> <span class="hl-site">mergeBy</span>(<span class="hl-variable">lt</span>, <span class="hl-variable">x</span>:<span class="hl-variable">xs</span>, <span class="hl-variable">y</span>:<span class="hl-variable">ys</span>) =
  <span class="hl-keyword">if</span> <span class="hl-site">lt</span>(<span class="hl-variable">y</span>,<span class="hl-variable">x</span>) <span class="hl-keyword">then</span> <span class="hl-variable">y</span>:<span class="hl-site">mergeBy</span>(<span class="hl-variable">lt</span>,<span class="hl-variable">x</span>:<span class="hl-variable">xs</span>,<span class="hl-variable">ys</span>)
  <span class="hl-keyword">else</span> <span class="hl-variable">x</span>:<span class="hl-site">mergeBy</span>(<span class="hl-variable">lt</span>,<span class="hl-variable">xs</span>,<span class="hl-variable">y</span>:<span class="hl-variable">ys</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">sort</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">sort</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>

                            </p><p>Sort a list.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: [1, 2, 3]</span>
<span class="hl-site">sort</span>([<span class="hl-literal">1</span>,<span class="hl-literal">3</span>,<span class="hl-literal">2</span>])</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">sort</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">sort</span>(<span class="hl-variable">xs</span>) = <span class="hl-site">sortBy</span>((&lt;), <span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">sortBy</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">sortBy</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Sort a list using the given less-than relation.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">sortBy</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">sortBy</span>(<span class="hl-variable">lt</span>, []) = []
<span class="hl-keyword">def</span> <span class="hl-site">sortBy</span>(<span class="hl-variable">lt</span>, [<span class="hl-variable">x</span>]) = [<span class="hl-variable">x</span>]
<span class="hl-keyword">def</span> <span class="hl-site">sortBy</span>(<span class="hl-variable">lt</span>, <span class="hl-variable">xs</span>) =
  <span class="hl-keyword">val</span> <span class="hl-variable">half</span> = <span class="hl-site">length</span>(<span class="hl-variable">xs</span>)/<span class="hl-literal">2</span>
  <span class="hl-keyword">val</span> <span class="hl-variable">front</span> = <span class="hl-site">take</span>(<span class="hl-site">floor</span>(<span class="hl-variable">half</span>),<span class="hl-variable">xs</span>)
  <span class="hl-keyword">val</span> <span class="hl-variable">back</span> = <span class="hl-site">drop</span>(<span class="hl-site">ceil</span>(<span class="hl-variable">half</span>),<span class="hl-variable">xs</span>)
  <span class="hl-site">mergeBy</span>(<span class="hl-variable">lt</span>, <span class="hl-site">sortBy</span>(<span class="hl-variable">lt</span>, <span class="hl-variable">front</span>), <span class="hl-site">sortBy</span>(<span class="hl-variable">lt</span>, <span class="hl-variable">back</span>))</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">mergeUnique</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">mergeUnique</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>

                            </p><p>Merge two sorted lists, discarding duplicates.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: [1, 2, 3, 4, 5]</span>
<span class="hl-site">mergeUnique</span>([<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>], [<span class="hl-literal">2</span>,<span class="hl-literal">4</span>,<span class="hl-literal">5</span>])</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">mergeUnique</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">mergeUnique</span>(<span class="hl-variable">xs</span>,<span class="hl-variable">ys</span>) = <span class="hl-site">mergeUniqueBy</span>((=), (&lt;), <span class="hl-variable">xs</span>, <span class="hl-variable">ys</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">mergeUniqueBy</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">mergeUniqueBy</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Merge two lists, discarding duplicates, using the given equality and less-than relations.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">mergeUniqueBy</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>,
                     <span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>,
                      <span class="hl-site">List</span>[<span class="hl-variable">A</span>], <span class="hl-site">List</span>[<span class="hl-variable">A</span>])
  :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">mergeUniqueBy</span>(<span class="hl-variable">eq</span>, <span class="hl-variable">lt</span>, <span class="hl-variable">xs</span>, []) = <span class="hl-variable">xs</span>
<span class="hl-keyword">def</span> <span class="hl-site">mergeUniqueBy</span>(<span class="hl-variable">eq</span>, <span class="hl-variable">lt</span>, [], <span class="hl-variable">ys</span>) = <span class="hl-variable">ys</span>
<span class="hl-keyword">def</span> <span class="hl-site">mergeUniqueBy</span>(<span class="hl-variable">eq</span>, <span class="hl-variable">lt</span>, <span class="hl-variable">x</span>:<span class="hl-variable">xs</span>, <span class="hl-variable">y</span>:<span class="hl-variable">ys</span>) =
  <span class="hl-keyword">if</span> <span class="hl-site">eq</span>(<span class="hl-variable">y</span>,<span class="hl-variable">x</span>) <span class="hl-keyword">then</span> <span class="hl-site">mergeUniqueBy</span>(<span class="hl-variable">eq</span>, <span class="hl-variable">lt</span>, <span class="hl-variable">xs</span>, <span class="hl-variable">y</span>:<span class="hl-variable">ys</span>)
  <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> <span class="hl-site">lt</span>(<span class="hl-variable">y</span>,<span class="hl-variable">x</span>) <span class="hl-keyword">then</span> <span class="hl-variable">y</span>:<span class="hl-site">mergeUniqueBy</span>(<span class="hl-variable">eq</span>,<span class="hl-variable">lt</span>,<span class="hl-variable">x</span>:<span class="hl-variable">xs</span>,<span class="hl-variable">ys</span>)
  <span class="hl-keyword">else</span> <span class="hl-variable">x</span>:<span class="hl-site">mergeUniqueBy</span>(<span class="hl-variable">eq</span>,<span class="hl-variable">lt</span>,<span class="hl-variable">xs</span>,<span class="hl-variable">y</span>:<span class="hl-variable">ys</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">sortUnique</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">sortUnique</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>

                            </p><p>Sort a list, discarding duplicates.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: [1, 2, 3]</span>
<span class="hl-site">sortUnique</span>([<span class="hl-literal">1</span>,<span class="hl-literal">3</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>])</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">sortUnique</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">sortUnique</span>(<span class="hl-variable">xs</span>) = <span class="hl-site">sortUniqueBy</span>((=), (&lt;), <span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">sortUniqueBy</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">sortUniqueBy</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]</code>
                            </p><p>Sort a list, discarding duplicates, using the given equality and less-than relations.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">sortUniqueBy</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>,
                    <span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>,
                    <span class="hl-site">List</span>[<span class="hl-variable">A</span>])
  :: <span class="hl-site">List</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">sortUniqueBy</span>(<span class="hl-variable">eq</span>, <span class="hl-variable">lt</span>, []) = []
<span class="hl-keyword">def</span> <span class="hl-site">sortUniqueBy</span>(<span class="hl-variable">eq</span>, <span class="hl-variable">lt</span>, [<span class="hl-variable">x</span>]) = [<span class="hl-variable">x</span>]
<span class="hl-keyword">def</span> <span class="hl-site">sortUniqueBy</span>(<span class="hl-variable">eq</span>, <span class="hl-variable">lt</span>, <span class="hl-variable">xs</span>) =
  <span class="hl-site">length</span>(<span class="hl-variable">xs</span>)/<span class="hl-literal">2</span> <span class="hl-combinator">&gt;</span><span class="hl-variable">half</span><span class="hl-combinator">&gt;</span>
  (<span class="hl-site">take</span>(<span class="hl-site">floor</span>(<span class="hl-variable">half</span>),<span class="hl-variable">xs</span>), <span class="hl-site">drop</span>(<span class="hl-site">ceil</span>(<span class="hl-variable">half</span>),<span class="hl-variable">xs</span>)) <span class="hl-combinator">&gt;</span>(<span class="hl-variable">front</span>, <span class="hl-variable">back</span>)<span class="hl-combinator">&gt;</span>
  <span class="hl-site">mergeUniqueBy</span>(<span class="hl-variable">eq</span>, <span class="hl-variable">lt</span>,
    <span class="hl-site">sortUniqueBy</span>(<span class="hl-variable">eq</span>, <span class="hl-variable">lt</span>, <span class="hl-variable">front</span>),
    <span class="hl-site">sortUniqueBy</span>(<span class="hl-variable">eq</span>, <span class="hl-variable">lt</span>, <span class="hl-variable">back</span>))</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">group</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">group</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)]) :: <span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-site">List</span>[<span class="hl-variable">B</span>])]</code>

                            </p><p>Given a list of pairs, group together the second
elements of consecutive pairs with equal first elements.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: [(1, [1, 2]), (2, [3]), (3, [4]), (1, [3])]</span>
<span class="hl-site">group</span>([(<span class="hl-literal">1</span>,<span class="hl-literal">1</span>), (<span class="hl-literal">1</span>,<span class="hl-literal">2</span>), (<span class="hl-literal">2</span>,<span class="hl-literal">3</span>), (<span class="hl-literal">3</span>,<span class="hl-literal">4</span>), (<span class="hl-literal">1</span>,<span class="hl-literal">3</span>)])</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">group</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)]) :: <span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-site">List</span>[<span class="hl-variable">B</span>])]
<span class="hl-keyword">def</span> <span class="hl-site">group</span>(<span class="hl-variable">xs</span>) = <span class="hl-site">groupBy</span>((=), <span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">groupBy</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">groupBy</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)]) :: <span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-site">List</span>[<span class="hl-variable">B</span>])]</code>
                            </p><p>Given a list of pairs, group together the second
elements of consecutive pairs with equal first elements,
using the given equality relation.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">groupBy</span>[<span class="hl-variable">A</span>,<span class="hl-variable">B</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>,
                 <span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)])
  :: <span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-site">List</span>[<span class="hl-variable">B</span>])]
<span class="hl-keyword">def</span> <span class="hl-site">groupBy</span>(<span class="hl-variable">eq</span>, []) = []
<span class="hl-keyword">def</span> <span class="hl-site">groupBy</span>(<span class="hl-variable">eq</span>, (<span class="hl-variable">k</span>,<span class="hl-variable">v</span>):<span class="hl-variable">kvs</span>) =
  <span class="hl-keyword">def</span> <span class="hl-site">helper</span>(<span class="hl-variable">A</span>, <span class="hl-site">List</span>[<span class="hl-variable">B</span>], <span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)]) :: <span class="hl-site">List</span>[(<span class="hl-variable">A</span>,<span class="hl-site">List</span>[<span class="hl-variable">B</span>])]
  <span class="hl-keyword">def</span> <span class="hl-site">helper</span>(<span class="hl-variable">k</span>,<span class="hl-variable">vs</span>, []) = [(<span class="hl-variable">k</span>,<span class="hl-variable">vs</span>)]
  <span class="hl-keyword">def</span> <span class="hl-site">helper</span>(<span class="hl-variable">k</span>,<span class="hl-variable">vs</span>, (<span class="hl-variable">k2</span>,<span class="hl-variable">v</span>):<span class="hl-variable">kvs</span>) =
    <span class="hl-keyword">if</span> <span class="hl-site">eq</span>(<span class="hl-variable">k2</span>,<span class="hl-variable">k</span>) <span class="hl-keyword">then</span> <span class="hl-site">helper</span>(<span class="hl-variable">k</span>, <span class="hl-variable">v</span>:<span class="hl-variable">vs</span>, <span class="hl-variable">kvs</span>)
    <span class="hl-keyword">else</span> (<span class="hl-variable">k</span>,<span class="hl-variable">vs</span>):<span class="hl-site">helper</span>(<span class="hl-variable">k2</span>, [<span class="hl-variable">v</span>], <span class="hl-variable">kvs</span>)
  <span class="hl-site">helper</span>(<span class="hl-variable">k</span>,[<span class="hl-variable">v</span>], <span class="hl-variable">kvs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">rangeBy</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">rangeBy</span>(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-site">List</span>[<span class="hl-variable">Number</span>]</code>
                            </p><p>
                                <code class="code"><span class="hl-site">rangeBy</span>(<span class="hl-variable">low</span>, <span class="hl-variable">high</span>, <span class="hl-variable">skip</span>)</code> returns a sorted list of
numbers <code class="code"><span class="hl-variable">n</span></code> which satisfy <code class="code"><span class="hl-variable">n</span> = <span class="hl-variable">low</span> + <span class="hl-variable">skip</span>*<span class="hl-variable">i</span></code> (for some
integer <code class="code"><span class="hl-variable">i</span></code>), <code class="code"><span class="hl-variable">n</span> <span class="hl-site">&gt;=</span> <span class="hl-variable">low</span></code>, and <code class="code"><span class="hl-variable">n</span> &lt; <span class="hl-variable">high</span></code>.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">rangeBy</span>(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-site">List</span>[<span class="hl-variable">Number</span>]
<span class="hl-keyword">def</span> <span class="hl-site">rangeBy</span>(<span class="hl-variable">low</span>, <span class="hl-variable">high</span>, <span class="hl-variable">skip</span>) =
  <span class="hl-keyword">if</span> <span class="hl-variable">low</span> &lt; <span class="hl-variable">high</span>
  <span class="hl-keyword">then</span> <span class="hl-variable">low</span>:<span class="hl-site">rangeBy</span>(<span class="hl-variable">low</span>+<span class="hl-variable">skip</span>, <span class="hl-variable">high</span>, <span class="hl-variable">skip</span>)
  <span class="hl-keyword">else</span> []</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">range</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">range</span>(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-site">List</span>[<span class="hl-variable">Number</span>]</code>
                            </p><p>Generate a list of numbers in the given half-open range.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">range</span>(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-site">List</span>[<span class="hl-variable">Number</span>]
<span class="hl-keyword">def</span> <span class="hl-site">range</span>(<span class="hl-variable">low</span>, <span class="hl-variable">high</span>) = <span class="hl-site">rangeBy</span>(<span class="hl-variable">low</span>, <span class="hl-variable">high</span>, <span class="hl-literal">1</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">any</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">any</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return true if any of the elements of the list match the predicate, and false otherwise.
The predicate is applied to all elements of the list in parellel; the result
is returned as soon as it is known and any unnecessary evaluation of the predicate
terminated.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">any</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span>
<span class="hl-keyword">def</span> <span class="hl-site">any</span>(<span class="hl-variable">p</span>, []) = <span class="hl-literal">false</span>
<span class="hl-keyword">def</span> <span class="hl-site">any</span>(<span class="hl-variable">p</span>, <span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) =
  <span class="hl-site">let</span>(
    <span class="hl-keyword">val</span> <span class="hl-variable">b1</span> = <span class="hl-site">p</span>(<span class="hl-variable">x</span>)
    <span class="hl-keyword">val</span> <span class="hl-variable">b2</span> = <span class="hl-site">any</span>(<span class="hl-variable">p</span>, <span class="hl-variable">xs</span>)
    <span class="hl-keyword">if</span>(<span class="hl-variable">b1</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">true</span> <span class="hl-combinator">|</span> <span class="hl-keyword">if</span>(<span class="hl-variable">b2</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">true</span> <span class="hl-combinator">|</span> (<span class="hl-variable">b1</span> <span class="hl-site">||</span> <span class="hl-variable">b2</span>)
  )</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">all</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">all</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return true if all of the elements of the list match the predicate, and false otherwise.
The predicate is applied to all elements of the list in parellel; the result
is returned as soon as it is known and any unnecessary evaluation of the predicate
terminated.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">all</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span>
<span class="hl-keyword">def</span> <span class="hl-site">all</span>(<span class="hl-variable">p</span>, []) = <span class="hl-literal">true</span>
<span class="hl-keyword">def</span> <span class="hl-site">all</span>(<span class="hl-variable">p</span>, <span class="hl-variable">x</span>:<span class="hl-variable">xs</span>) =
  <span class="hl-site">let</span>(
    <span class="hl-keyword">val</span> <span class="hl-variable">b1</span> = <span class="hl-site">p</span>(<span class="hl-variable">x</span>)
    <span class="hl-keyword">val</span> <span class="hl-variable">b2</span> = <span class="hl-site">all</span>(<span class="hl-variable">p</span>, <span class="hl-variable">xs</span>)
    <span class="hl-keyword">if</span>(~<span class="hl-variable">b1</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">false</span> <span class="hl-combinator">|</span> <span class="hl-keyword">if</span>(~<span class="hl-variable">b2</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">false</span> <span class="hl-combinator">|</span> (<span class="hl-variable">b1</span> &amp;&amp; <span class="hl-variable">b2</span>)
  )</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">sum</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">sum</span>(<span class="hl-site">List</span>[<span class="hl-variable">Number</span>]) :: <span class="hl-variable">Number</span></code>
                            </p><p>Return the sum of all numbers in a list.
The sum of an empty list is 0.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">sum</span>(<span class="hl-site">List</span>[<span class="hl-variable">Number</span>]) :: <span class="hl-variable">Number</span>
<span class="hl-keyword">def</span> <span class="hl-site">sum</span>(<span class="hl-variable">xs</span>) = <span class="hl-site">foldl</span>(
  (+) :: <span class="hl-keyword">lambda</span> (<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span>,
  <span class="hl-literal">0</span>, <span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">product</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">product</span>(<span class="hl-site">List</span>[<span class="hl-variable">Number</span>]) :: <span class="hl-variable">Number</span></code>
                            </p><p>Return the product of all numbers in a list.
The product of an empty list is 1.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">product</span>(<span class="hl-site">List</span>[<span class="hl-variable">Number</span>]) :: <span class="hl-variable">Number</span>
<span class="hl-keyword">def</span> <span class="hl-site">product</span>(<span class="hl-variable">xs</span>) = <span class="hl-site">foldl</span>(
  (*) :: <span class="hl-keyword">lambda</span> (<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span>,
  <span class="hl-literal">1</span>, <span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">and</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">and</span>(<span class="hl-site">List</span>[<span class="hl-variable">Boolean</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return the boolean conjunction of all boolean values in the list.
The conjunction of an empty list is <code class="code"><span class="hl-literal">true</span></code>.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">and</span>(<span class="hl-site">List</span>[<span class="hl-variable">Boolean</span>]) :: <span class="hl-variable">Boolean</span>
<span class="hl-keyword">def</span> <span class="hl-site">and</span>([]) = <span class="hl-literal">true</span>
<span class="hl-keyword">def</span> <span class="hl-site">and</span>(<span class="hl-literal">false</span>:<span class="hl-variable">xs</span>) = <span class="hl-literal">false</span>
<span class="hl-keyword">def</span> <span class="hl-site">and</span>(<span class="hl-literal">true</span>:<span class="hl-variable">xs</span>) = <span class="hl-site">and</span>(<span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">or</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">or</span>(<span class="hl-site">List</span>[<span class="hl-variable">Boolean</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return the boolean disjunction of all boolean values in the list.
The disjunction of an empty list is <code class="code"><span class="hl-literal">false</span></code>.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">or</span>(<span class="hl-site">List</span>[<span class="hl-variable">Boolean</span>]) :: <span class="hl-variable">Boolean</span>
<span class="hl-keyword">def</span> <span class="hl-site">or</span>([]) = <span class="hl-literal">false</span>
<span class="hl-keyword">def</span> <span class="hl-site">or</span>(<span class="hl-literal">true</span>:<span class="hl-variable">xs</span>) = <span class="hl-literal">true</span>
<span class="hl-keyword">def</span> <span class="hl-site">or</span>(<span class="hl-literal">false</span>:<span class="hl-variable">xs</span>) = <span class="hl-site">or</span>(<span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">minimum</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">minimum</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Return the minimum element of a non-empty list.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">minimum</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">minimum</span>(<span class="hl-variable">xs</span>) =
  <span class="hl-comment">-- this def appeases the typechecker</span>
  <span class="hl-keyword">def</span> <span class="hl-site">minA</span>(<span class="hl-variable">x</span>::<span class="hl-variable">A</span>,<span class="hl-variable">y</span>::<span class="hl-variable">A</span>) = <span class="hl-site">min</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)
  <span class="hl-site">foldl1</span>(<span class="hl-variable">minA</span>, <span class="hl-variable">xs</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">maximum</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">maximum</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Return the maximum element of a non-empty list.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">maximum</span>[<span class="hl-variable">A</span>](<span class="hl-site">List</span>[<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">maximum</span>(<span class="hl-variable">xs</span>) =
  <span class="hl-comment">-- this def appeases the typechecker</span>
  <span class="hl-keyword">def</span> <span class="hl-site">maxA</span>(<span class="hl-variable">x</span>::<span class="hl-variable">A</span>,<span class="hl-variable">y</span>::<span class="hl-variable">A</span>) = <span class="hl-site">max</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)
  <span class="hl-site">foldl1</span>(<span class="hl-variable">maxA</span>, <span class="hl-variable">xs</span>)</pre></p></td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N12DE7"></a>B.3.5.&nbsp;text.inc: Operations on strings.</h3></div></div></div><p>Operations on strings.</p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">cat</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">cat</span>(<span class="hl-variable">Top</span>, ...) :: <span class="hl-variable">String</span></code>
                            </p><p>Return the string representation of one or more values, concatenated.
For Java objects, this will call <code class="code"><span class="hl-site">toString</span>()</code> to convert
the object to a String.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">print</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">print</span>(<span class="hl-variable">Top</span>, ...) :: <span class="hl-variable">Top</span></code>
                            </p><p>Print one or more values as strings, concatenated, to standard output.
For Java objects, this will call <code class="code"><span class="hl-site">toString</span>()</code> to convert
the object to a String.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">println</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">println</span>(<span class="hl-variable">Top</span>, ...) :: <span class="hl-variable">Top</span></code>
                            </p><p>Print one or more values as strings, concatenated,
to standard output, with each value followed by a newline.
For Java objects, this will call <code class="code"><span class="hl-site">toString</span>()</code> to convert
the object to a String.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">read</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">read</span>[<span class="hl-variable">A</span>](<span class="hl-variable">String</span>) :: <span class="hl-variable">A</span></code>

                            </p><p>Given a string representing an Orc value (using standard
Orc literal syntax), return the corresponding value. If
the argument does not conform to Orc literal syntax,
halt with an error.</p><p>Example:
<pre class="orc">
  <span class="hl-site">read</span>(<span class="hl-literal">"true"</span>) <span class="hl-comment">-- publishes the boolean true</span>
<span class="hl-combinator">|</span> <span class="hl-site">read</span>(<span class="hl-literal">"1"</span>) <span class="hl-comment">-- publishes the integer 1</span>
<span class="hl-combinator">|</span> <span class="hl-site">read</span>(<span class="hl-literal">"(3.0, [])"</span>) <span class="hl-comment">-- publishes the tuple (3.0, [])</span>
<span class="hl-combinator">|</span> <span class="hl-site">read</span>(<span class="hl-literal">"\"hi\""</span>) <span class="hl-comment">-- publishes the string "hi"</span></pre>
                            </p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">lines</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">lines</span>(<span class="hl-variable">String</span>) :: <span class="hl-site">List</span>[<span class="hl-variable">String</span>]</code>
                            </p><p>Split a string into lines, which are substrings
terminated by an endline or the end of the string.
DOS, Mac, and Unix endline conventions are all accepted.
Endline characters are not included in the result.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">lines</span>(<span class="hl-variable">String</span>) :: <span class="hl-site">List</span>[<span class="hl-variable">String</span>]
<span class="hl-keyword">def</span> <span class="hl-site">lines</span>(<span class="hl-variable">text</span>) =
  <span class="hl-keyword">val</span> <span class="hl-variable">out</span> = <span class="hl-variable">text</span>.<span class="hl-site">split</span>(<span class="hl-literal">"\n|\r\n|\r"</span>)
  <span class="hl-keyword">if</span> <span class="hl-variable">out</span>.<span class="hl-site">get</span>(<span class="hl-variable">out</span>.<span class="hl-site">length</span>()-<span class="hl-literal">1</span>) = <span class="hl-literal">""</span> <span class="hl-keyword">then</span>
    <span class="hl-variable">out</span>.<span class="hl-site">split</span>(<span class="hl-literal">0</span>, <span class="hl-variable">out</span>.<span class="hl-site">length</span>()-<span class="hl-literal">1</span>)
  <span class="hl-keyword">else</span> <span class="hl-variable">out</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">unlines</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">unlines</span>(<span class="hl-site">List</span>[<span class="hl-variable">String</span>]) :: <span class="hl-variable">String</span></code>
                            </p><p>Append a linefeed, "\n", to each string in the sequence
and concatenate the results.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">unlines</span>(<span class="hl-site">List</span>[<span class="hl-variable">String</span>]) :: <span class="hl-variable">String</span>
<span class="hl-keyword">def</span> <span class="hl-site">unlines</span>(<span class="hl-variable">line</span>:<span class="hl-variable">lines</span>) = <span class="hl-site">cat</span>(<span class="hl-variable">line</span>, <span class="hl-literal">"\n"</span>, <span class="hl-site">unlines</span>(<span class="hl-variable">lines</span>))
<span class="hl-keyword">def</span> <span class="hl-site">unlines</span>([]) = <span class="hl-literal">""</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">words</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">words</span>(<span class="hl-variable">String</span>) :: <span class="hl-site">List</span>[<span class="hl-variable">String</span>]</code>
                            </p><p>Split a string into words, which are sequences of non-whitespace characters separated by whitespace.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">words</span>(<span class="hl-variable">String</span>) :: <span class="hl-site">List</span>[<span class="hl-variable">String</span>]
<span class="hl-keyword">def</span> <span class="hl-site">words</span>(<span class="hl-variable">text</span>) = <span class="hl-variable">text</span>.<span class="hl-site">trim</span>().<span class="hl-site">split</span>(<span class="hl-literal">"\\s+"</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">unwords</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">unwords</span>(<span class="hl-site">List</span>[<span class="hl-variable">String</span>]) :: <span class="hl-variable">String</span></code>
                            </p><p>Concatenate a sequence of strings with a single space between
each string.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">unwords</span>(<span class="hl-site">List</span>[<span class="hl-variable">String</span>]) :: <span class="hl-variable">String</span>
<span class="hl-keyword">def</span> <span class="hl-site">unwords</span>([]) = <span class="hl-literal">""</span>
<span class="hl-keyword">def</span> <span class="hl-site">unwords</span>([<span class="hl-variable">word</span>]) = <span class="hl-variable">word</span>
<span class="hl-keyword">def</span> <span class="hl-site">unwords</span>(<span class="hl-variable">word</span>:<span class="hl-variable">words</span>) = <span class="hl-site">cat</span>(<span class="hl-variable">word</span>, <span class="hl-literal">" "</span>, <span class="hl-site">unwords</span>(<span class="hl-variable">words</span>))</pre></p></td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N12E82"></a>B.3.6.&nbsp;time.inc: Real and logical time.</h3></div></div></div><p>Real and logical time.</p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Rtimer</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Rtimer</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Top</span></code>
                            </p><p>Publish a signal after the given number of milliseconds.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Clock</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Clock</span>()() :: <span class="hl-variable">Integer</span></code>

                            </p><p>A call to <code class="code"><span class="hl-variable">Clock</span></code> creates a new relative clock.
Calling a relative clock returns the number
of milliseconds which have elapsed since the
clock was created.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes a value near 1000</span>
<span class="hl-keyword">val</span> <span class="hl-variable">c</span> = <span class="hl-site">Clock</span>()
<span class="hl-site">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-site">c</span>()</pre>
                            </p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Ltimer</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Ltimer</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Top</span></code>
                            </p><p>Publish a signal after the given number of logical timesteps.
A logical timestep is complete as soon as all outstanding site
calls (other than calls to <code class="code"><span class="hl-variable">Ltimer</span></code>) have published.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">withLtimer</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">withLtimer</span>[<span class="hl-variable">A</span>](<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>Run a thunk in the context of a new logical clock.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">metronome</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">metronome</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Top</span></code>
                            </p><p>Publish a signal at regular intervals, indefinitely. The period is given by the
argument, in milliseconds.</p></td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N12EDC"></a>B.3.7.&nbsp;util.inc: Miscellaneous utility functions.</h3></div></div></div><p>Miscellaneous utility functions.</p><div class="variablelist"><table border="0"><col valign="top" align="left"><tbody><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">random</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">random</span>() :: <span class="hl-variable">Integer</span></code>
                            </p><p>Return a random Integer value
chosen from the range of all possible 32-bit Integer values.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">random</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">random</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Integer</span></code>
                            </p><p>Return a pseudorandom, uniformly distributed Integer value
between 0 (inclusive) and the specified value (exclusive).
If the argument is 0, halt.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">urandom</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">urandom</span>() :: <span class="hl-variable">Number</span></code>
                            </p><p>Returns a pseudorandom, uniformly distributed Double value
between 0 and 1, inclusive.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">UUID</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">UUID</span>() :: <span class="hl-variable">String</span></code>
                            </p><p>Return a random (type 4) UUID represented as a string.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Thread</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Thread</span>(<span class="hl-variable">Top</span>) :: <span class="hl-variable">Bot</span></code>
                            </p><p>Given a site, return a new site which calls the original site
in a separate thread.  This is necessary when calling
a Java site which does not cooperate with Orc's scheduler
and may block for an unpredictable amount of time.</p><p>A limited number of threads are reserved in a pool for use
by this site, so there is a limit to the number of blocking,
uncooperative sites that can be called simultaneously.</p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">Prompt</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-site">Prompt</span>(<span class="hl-variable">String</span>) :: <span class="hl-variable">String</span></code>

                            </p><p>Prompt the user for some input. The user may cancel the prompt,
in which case the site fails silently. Otherwise their response
is returned as soon as it is received.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes the user's name</span>
<span class="hl-site">Prompt</span>(<span class="hl-literal">"What is your name?"</span>)</pre>
                            </p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">signals</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">signals</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Top</span></code>

                            </p><p>Publish the given number of signals, simultaneously.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes five signals</span>
<span class="hl-site">signals</span>(<span class="hl-literal">5</span>)</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">signals</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Top</span>
<span class="hl-keyword">def</span> <span class="hl-site">signals</span>(<span class="hl-variable">n</span>) = <span class="hl-keyword">if</span> <span class="hl-variable">n</span> &gt; <span class="hl-literal">0</span> <span class="hl-keyword">then</span> (<span class="hl-keyword">signal</span> <span class="hl-combinator">|</span> <span class="hl-site">signals</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>))</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">for</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">for</span>(<span class="hl-variable">Integer</span>, <span class="hl-variable">Integer</span>) :: <span class="hl-variable">Integer</span></code>

                            </p><p>Publish all values in the given half-open range, simultaneously.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 1 2 3 4 5</span>
<span class="hl-site">for</span>(<span class="hl-literal">1</span>,<span class="hl-literal">6</span>)</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">for</span>(<span class="hl-variable">Integer</span>, <span class="hl-variable">Integer</span>) :: <span class="hl-variable">Integer</span>
<span class="hl-keyword">def</span> <span class="hl-site">for</span>(<span class="hl-variable">low</span>, <span class="hl-variable">high</span>) =
  <span class="hl-keyword">if</span> <span class="hl-variable">low</span> <span class="hl-site">&gt;=</span> <span class="hl-variable">high</span> <span class="hl-keyword">then</span> <span class="hl-keyword">stop</span>
  <span class="hl-keyword">else</span> ( <span class="hl-variable">low</span> <span class="hl-combinator">|</span> <span class="hl-site">for</span>(<span class="hl-variable">low</span>+<span class="hl-literal">1</span>, <span class="hl-variable">high</span>) )</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">upto</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">upto</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Integer</span></code>
                            </p><p>

                                <code class="code"><span class="hl-site">upto</span>(<span class="hl-variable">n</span>)</code> publishes all values in the range <code class="code">(<span class="hl-literal">0.</span>.<span class="hl-variable">n</span>-<span class="hl-literal">1</span>)</code>
simultaneously.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 0 1 2 3 4</span>
<span class="hl-site">upto</span>(<span class="hl-literal">5</span>)</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">upto</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Integer</span>
<span class="hl-keyword">def</span> <span class="hl-site">upto</span>(<span class="hl-variable">high</span>) = <span class="hl-site">for</span>(<span class="hl-literal">0</span>, <span class="hl-variable">high</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">fillArray</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">fillArray</span>[<span class="hl-variable">A</span>](<span class="hl-site">Array</span>[<span class="hl-variable">A</span>], <span class="hl-keyword">lambda</span> (<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span>) :: <span class="hl-site">Array</span>[<span class="hl-variable">A</span>]</code>

                            </p><p>Given an array and a function from indices to values, populate the array
by calling the function for each index in the array.</p><p>For example, to set all elements of an array to zero:
<pre class="orc">
<span class="hl-comment">-- Publishes: 0 0 0</span>
<span class="hl-keyword">val</span> <span class="hl-variable">a</span> = <span class="hl-site">fillArray</span>(<span class="hl-site">Array</span>(<span class="hl-literal">3</span>), <span class="hl-keyword">lambda</span> (<span class="hl-variable">_</span>) = <span class="hl-literal">0</span>)
<span class="hl-variable">a</span>.<span class="hl-site">get</span>(<span class="hl-literal">0</span>) <span class="hl-combinator">|</span> <span class="hl-variable">a</span>.<span class="hl-site">get</span>(<span class="hl-literal">1</span>) <span class="hl-combinator">|</span> <span class="hl-variable">a</span>.<span class="hl-site">get</span>(<span class="hl-literal">2</span>)</pre>
                            </p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">fillArray</span>[<span class="hl-variable">A</span>](<span class="hl-site">Array</span>[<span class="hl-variable">A</span>], <span class="hl-keyword">lambda</span> (<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span>)
  :: <span class="hl-site">Array</span>[<span class="hl-variable">A</span>]
<span class="hl-keyword">def</span> <span class="hl-site">fillArray</span>(<span class="hl-variable">a</span>, <span class="hl-variable">f</span>) =
  <span class="hl-keyword">val</span> <span class="hl-variable">n</span> = <span class="hl-variable">a</span>.<span class="hl-site">length</span>()
  <span class="hl-keyword">def</span> <span class="hl-site">fill</span>(<span class="hl-variable">Integer</span>, <span class="hl-keyword">lambda</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span>) :: <span class="hl-variable">Bot</span>
  <span class="hl-keyword">def</span> <span class="hl-site">fill</span>(<span class="hl-variable">i</span>, <span class="hl-variable">f</span>) =
    <span class="hl-keyword">if</span> <span class="hl-variable">i</span> = <span class="hl-variable">n</span> <span class="hl-keyword">then</span> <span class="hl-keyword">stop</span>
    <span class="hl-keyword">else</span> ( <span class="hl-variable">a</span>.<span class="hl-site">set</span>(<span class="hl-variable">i</span>, <span class="hl-site">f</span>(<span class="hl-variable">i</span>)) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span>
         <span class="hl-combinator">|</span> <span class="hl-site">fill</span>(<span class="hl-variable">i</span>+<span class="hl-literal">1</span>, <span class="hl-variable">f</span>) )
  <span class="hl-site">fill</span>(<span class="hl-literal">0</span>, <span class="hl-variable">f</span>) <span class="hl-combinator">;</span> <span class="hl-variable">a</span></pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">takePubs</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">takePubs</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Integer</span>, <span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>
                                <code class="code"><span class="hl-site">takePubs</span>(<span class="hl-variable">n</span>, <span class="hl-variable">f</span>)</code> calls <code class="code"><span class="hl-site">f</span>()</code>,
publishes the first <code class="code"><span class="hl-variable">n</span></code> values published
by <code class="code"><span class="hl-site">f</span>()</code> (as they are published), and then
halts.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">takePubs</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Integer</span>, <span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">takePubs</span>(<span class="hl-variable">n</span>, <span class="hl-variable">f</span>) =
  <span class="hl-keyword">val</span> <span class="hl-variable">out</span> = <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>]()
  <span class="hl-keyword">val</span> <span class="hl-variable">c</span> = <span class="hl-site">Counter</span>(<span class="hl-variable">n</span>)
  <span class="hl-site">let</span>(
    <span class="hl-site">f</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span>
    <span class="hl-keyword">if</span>(<span class="hl-variable">c</span>.<span class="hl-site">dec</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">out</span>.<span class="hl-site">put</span>(<span class="hl-variable">x</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">false</span>
       <span class="hl-combinator">;</span> <span class="hl-variable">out</span>.<span class="hl-site">closenb</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">true</span>)
  ) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span> <span class="hl-combinator">|</span> <span class="hl-site">repeat</span>(<span class="hl-variable">out</span>.<span class="hl-variable">get</span>)</pre></p></td></tr><tr><td><p><span class="term">
                            <code class="code"><span class="hl-variable">withLock</span></code>
                        </span></p></td><td><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-site">withLock</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Semaphore</span>, <span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>Acquire the semaphore and run the thunk, publishing all values published by the
thunk. Once the thunk halts, release the semaphore.</p><p><b>Implementation.&nbsp;</b><pre class="programlisting"><span class="hl-keyword">def</span> <span class="hl-site">withLock</span>[<span class="hl-variable">A</span>](<span class="hl-variable">Semaphore</span>, <span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>
<span class="hl-keyword">def</span> <span class="hl-site">withLock</span>(<span class="hl-variable">s</span>, <span class="hl-variable">f</span>) =
  <span class="hl-keyword">val</span> <span class="hl-variable">out</span> = <span class="hl-site">Buffer</span>[<span class="hl-variable">A</span>]()
  ( <span class="hl-variable">s</span>.<span class="hl-site">acquire</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
    <span class="hl-site">f</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span>
    <span class="hl-variable">out</span>.<span class="hl-site">put</span>(<span class="hl-variable">x</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
    <span class="hl-keyword">stop</span>
  <span class="hl-combinator">;</span> <span class="hl-variable">s</span>.<span class="hl-site">release</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
    <span class="hl-variable">out</span>.<span class="hl-site">closenb</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
    <span class="hl-keyword">stop</span>
  ) <span class="hl-combinator">|</span> <span class="hl-site">repeat</span>(<span class="hl-variable">out</span>.<span class="hl-variable">get</span>)</pre></p></td></tr></tbody></table></div></div></div><script type="text/javascript" src="/orchard/orc.js"></script><div class="navfooter"><hr><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="apbs02.html">Prev</a>&nbsp;</td><td align="center" width="20%"><a accesskey="u" href="apb.html">Up</a></td><td align="right" width="40%">&nbsp;</td></tr><tr><td valign="top" align="left" width="40%">B.2.&nbsp;Types and Notation&nbsp;</td><td align="center" width="20%"><a accesskey="h" href="index.html">Home</a></td><td valign="top" align="right" width="40%">&nbsp;</td></tr></table></div></body></html>