<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Orc User Guide</title><link href="style.css" rel="stylesheet" type="text/css"><meta content="DocBook XSL Stylesheets V1.74.0" name="generator"><link href="/orchard/orc.css" type="text/css" rel="stylesheet"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="N10001"></a>Orc User Guide</h1></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#N10007">Introduction</a></span></dt><dt><span class="chapter"><a href="#chapter.language">1. The Orc Programming Language</a></span></dt><dd><dl><dt><span class="section"><a href="#N10017">1.1. Introduction</a></span></dt><dt><span class="section"><a href="#N10020">1.2. Cor: A Functional Subset</a></span></dt><dd><dl><dt><span class="section"><a href="#cor.constants">1.2.1. Constants</a></span></dt><dt><span class="section"><a href="#language.base.operators">1.2.2. Operators</a></span></dt><dt><span class="section"><a href="#N10313">1.2.3. Conditionals</a></span></dt><dt><span class="section"><a href="#cor.variables">1.2.4. Variables</a></span></dt><dt><span class="section"><a href="#cor.data">1.2.5. Data Structures</a></span></dt><dt><span class="section"><a href="#N10483">1.2.6. Patterns</a></span></dt><dt><span class="section"><a href="#cor.functions">1.2.7. Functions</a></span></dt><dt><span class="section"><a href="#N105C6">1.2.8. Comments</a></span></dt></dl></dd><dt><span class="section"><a href="#N105DB">1.3. Orc: Orchestrating services</a></span></dt><dd><dl><dt><span class="section"><a href="#N106BA">1.3.1. Communicating with external services</a></span></dt><dt><span class="section"><a href="#N10714">1.3.2. The concurrency combinators of Orc</a></span></dt><dt><span class="section"><a href="#N10890">1.3.3. Revisiting Cor expressions</a></span></dt><dt><span class="section"><a href="#N10997">1.3.4. Time</a></span></dt></dl></dd><dt><span class="section"><a href="#N109C3">1.4. Advanced Features of Orc</a></span></dt><dd><dl><dt><span class="section"><a href="#N10AA6">1.4.1. Special call forms</a></span></dt><dt><span class="section"><a href="#N10B40">1.4.2. Extensions to pattern matching</a></span></dt><dt><span class="section"><a href="#N10B86">1.4.3. New forms of declarations</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chapter.methodology">2. Programming Methodology</a></span></dt><dd><dl><dt><span class="section"><a href="#N10BC7">2.1. Syntactic and Stylistic Conventions</a></span></dt><dd><dl><dt><span class="section"><a href="#N10BCC">2.1.1. Parallel combinator</a></span></dt><dt><span class="section"><a href="#N10C08">2.1.2. Sequential combinator</a></span></dt><dt><span class="section"><a href="#N10C45">2.1.3. Pruning combinator</a></span></dt><dt><span class="section"><a href="#N10CBA">2.1.4. Declarations</a></span></dt></dl></dd><dt><span class="section"><a href="#N10CF3">2.2. Programming Idioms</a></span></dt><dd><dl><dt><span class="section"><a href="#N10CF7">2.2.1. Fork-join</a></span></dt><dt><span class="section"><a href="#N10D70">2.2.2. Parallel Or</a></span></dt><dt><span class="section"><a href="#N10DAA">2.2.3. Finite Sequential Composition</a></span></dt><dt><span class="section"><a href="#N10DD0">2.2.4. Timeout</a></span></dt><dt><span class="section"><a href="#N10E0A">2.2.5. Priority</a></span></dt><dt><span class="section"><a href="#N10E1A">2.2.6. Repeat</a></span></dt><dt><span class="section"><a href="#N10E2F">2.2.7. Priority Poll</a></span></dt><dt><span class="section"><a href="#N10E3B">2.2.8. Parallel Matching</a></span></dt><dt><span class="section"><a href="#N10E51">2.2.9. Arrays</a></span></dt></dl></dd><dt><span class="section"><a href="#N10E75">2.3. Larger Examples</a></span></dt><dd><dl><dt><span class="section"><a href="#N10E78">2.3.1. Dining Philosophers</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="#N10EC8">A. Complete Syntax of Orc</a></span></dt><dt><span class="appendix"><a href="#appendix.library">B. Standard Library</a></span></dt><dd><dl><dt><span class="section"><a href="#N11131">B.1. Overview</a></span></dt><dt><span class="section"><a href="#N1113B">B.2. Notation</a></span></dt><dt><span class="section"><a href="#N11204">B.3. Reference</a></span></dt><dd><dl><dt><span class="section"><a href="#N11208">B.3.1. core.inc: Fundamental sites and operators.</a></span></dt><dt><span class="section"><a href="#N11466">B.3.2. data.inc: General-purpose supplemental data structures.</a></span></dt><dt><span class="section"><a href="#N11821">B.3.3. idioms.inc: Higher-order Orc programming idioms.</a></span></dt><dt><span class="section"><a href="#N1196E">B.3.4. list.inc: Operations on lists.</a></span></dt><dt><span class="section"><a href="#N11C07">B.3.5. text.inc: Operations on strings.</a></span></dt><dt><span class="section"><a href="#N11C94">B.3.6. time.inc: Real and logical time.</a></span></dt><dt><span class="section"><a href="#N11CDE">B.3.7. util.inc: Miscellaneous utility functions.</a></span></dt></dl></dd></dl></dd></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>1.1. <a href="#cor-ebnf-table">Syntax of the Functional Subset of Orc (Cor)</a></dt><dt>1.2. <a href="#ops-table">Operators of Cor</a></dt><dt>1.3. <a href="#orc-ebnf-table">Basic Syntax of Orc</a></dt><dt>1.4. <a href="#advanced-ebnf-table">Advanced Syntax of Orc</a></dt><dt>A.1. <a href="#full-ebnf-grammar">Complete Syntax of Orc</a></dt></dl></div><div class="preface" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="N10007"></a>Introduction</h2></div></div></div><p>
Orc is a programming language designed to make distributed and
concurrent programs simple and intuitive to write. Orc expresses
orchestration, a type of structured concurrency. It emphasizes the
flow of control and gives a global view of a concurrent system. Orc
is well-suited for task orchestration, a form of
concurrent programming with applications in workflow, business process
management, and web service orchestration. Orc provides constructs to
orchestrate the concurrent invocation of services while managing
time-outs, priorities, and failures of services or communication.  To
learn more about Orc and run your own Orc programs, visit the website:
<a class="ulink" href="http://orc.csres.utexas.edu/" target="_top">
                <code class="code"><span class="hl-variable">http</span>://<span class="hl-variable">orc</span>.<span class="hl-variable">csres</span>.<span class="hl-variable">utexas</span>.<span class="hl-variable">edu</span>/</code>
            </a>.
</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="chapter.language"></a>Chapter&nbsp;1.&nbsp;The Orc Programming Language</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#N10017">1.1. Introduction</a></span></dt><dt><span class="section"><a href="#N10020">1.2. Cor: A Functional Subset</a></span></dt><dd><dl><dt><span class="section"><a href="#cor.constants">1.2.1. Constants</a></span></dt><dt><span class="section"><a href="#language.base.operators">1.2.2. Operators</a></span></dt><dt><span class="section"><a href="#N10313">1.2.3. Conditionals</a></span></dt><dt><span class="section"><a href="#cor.variables">1.2.4. Variables</a></span></dt><dt><span class="section"><a href="#cor.data">1.2.5. Data Structures</a></span></dt><dt><span class="section"><a href="#N10483">1.2.6. Patterns</a></span></dt><dt><span class="section"><a href="#cor.functions">1.2.7. Functions</a></span></dt><dt><span class="section"><a href="#N105C6">1.2.8. Comments</a></span></dt></dl></dd><dt><span class="section"><a href="#N105DB">1.3. Orc: Orchestrating services</a></span></dt><dd><dl><dt><span class="section"><a href="#N106BA">1.3.1. Communicating with external services</a></span></dt><dt><span class="section"><a href="#N10714">1.3.2. The concurrency combinators of Orc</a></span></dt><dt><span class="section"><a href="#N10890">1.3.3. Revisiting Cor expressions</a></span></dt><dt><span class="section"><a href="#N10997">1.3.4. Time</a></span></dt></dl></dd><dt><span class="section"><a href="#N109C3">1.4. Advanced Features of Orc</a></span></dt><dd><dl><dt><span class="section"><a href="#N10AA6">1.4.1. Special call forms</a></span></dt><dt><span class="section"><a href="#N10B40">1.4.2. Extensions to pattern matching</a></span></dt><dt><span class="section"><a href="#N10B86">1.4.3. New forms of declarations</a></span></dt></dl></dd></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N10017"></a>1.1.&nbsp;Introduction</h2></div></div></div><p>
This chapter describes the Orc programming language in three steps. In Section 1.2, we
discuss a small subset of Orc called Cor. Cor is a pure functional language,
which has no features for concurrency, has no state, and does not communicate 
with external services. Cor introduces us to the parts of Orc that are most familiar 
from existing programming languages, such as arithmetic operations, variables,
conditionals, and functions.
</p><p>
In Section 1.3, we consider Orc itself, which in addition to Cor, comprises 
external services and combinators for concurrent orchestration of those services. 
We show how Orc interacts with these external services, how the combinators can be
used to build up complex orchestrations from simple base expressions, and how the 
functional constructs of Cor take on new, subtler behaviors in the concurrent 
context of Orc.
</p><p>
In Section 1.4, we discuss some additional features of Orc that extend 
the basic syntax. These are useful for creating large-scale Orc programs, but 
they are not essential to the understanding of the language.
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N10020"></a>1.2.&nbsp;Cor: A Functional Subset</h2></div></div></div><p>
In this section we introduce Cor, a pure functional subset of the Orc language.
Users of functional programming languages such as Haskell and ML will already be 
familiar with many of the key concepts of Cor.  
</p><p>
A Cor program is an <em class="firstterm">expression</em>. Cor expressions are built
up recursively from smaller expressions. Cor <em class="firstterm">evaluates</em> an expression
to reduce it to some simple <em class="firstterm">value</em> which cannot be evaluated further, 
for example a list of numbers or a Boolean truth value. This value is called the <em class="firstterm">
result</em> of the expression.
</p><p>
In the following subsections we introduce the concepts of Cor. First, we talk about
simple constants, such as numbers and truth values, and the operations that we can perform
on those values. Then we introduce conditionals (<code class="code"><span class="hl-keyword">if</span> <span class="hl-keyword">then</span> <span class="hl-keyword">else</span></code>). Then we 
introduce variables and binding, as a way to give a name to the value of an expression. 
After that, we talk about constructing data structures, and examining those structures
using patterns. Lastly, we introduce functions.
</p><p>
Table 1.1 describes the syntax of Cor. Each part of the syntax is explained 
in a subsequent section.
</p><p>
<div class="table"><a name="cor-ebnf-table"></a><p class="title"><b>Table&nbsp;1.1.&nbsp;Syntax of the Functional Subset of Orc (Cor)</b></p><div class="table-contents"><table summary="Syntax of the Functional Subset of Orc (Cor)" border="0" width="80%"><colgroup><col align="right"><col align="center"><col align="left"><col align="left"><col align="left"></colgroup><tbody><tr><td align="right">E</td><td align="center">::=</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>Expression</em></span>
                                </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">&nbsp;</td><td align="left">C</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>constant value</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E <span class="emphasis"><em>op</em></span> E</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>operator</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">X</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>variable</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code"><span class="hl-keyword">if</span></code> E <code class="code"><span class="hl-keyword">then</span></code> E <code class="code"><span class="hl-keyword">else</span></code> E </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>conditional</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">X<code class="code">(</code> E <code class="code">,</code> ... <code class="code">,</code> E <code class="code">)</code>
                                </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>function call</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code">(</code> E <code class="code">,</code> ... <code class="code">,</code> E <code class="code">)</code>
                                </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>tuple</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code">[</code> E <code class="code">,</code> ... <code class="code">,</code> E <code class="code">]</code>
                                </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>list</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">D E</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>scoped declaration</em></span>
                                </td></tr><tr><td align="right">C</td><td align="center">::=</td><td align="left">
                                    <span class="emphasis"><em>Boolean</em></span> | <span class="emphasis"><em>Number</em></span> | <span class="emphasis"><em>String</em></span>
                                </td><td align="left">
                                    <span class="emphasis"><em>Constant</em></span>
                                </td><td align="left">&nbsp;</td></tr><tr><td align="right">X</td><td align="center">::=</td><td align="left">
                                    <span class="emphasis"><em>Identifier</em></span>
                                </td><td align="left">
                                    <span class="emphasis"><em>Identifier</em></span>
                                </td><td align="left">&nbsp;</td></tr><tr><td align="right">D</td><td align="center">::=</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>Declaration</em></span>
                                </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">&nbsp;</td><td align="left">
                                    <code class="code"><span class="hl-keyword">val</span></code> P <code class="code">=</code> E</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>value declaration</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code"><span class="hl-keyword">def</span></code> X<code class="code">(</code> P <code class="code">,</code> ... <code class="code">,</code> P <code class="code">)</code> <code class="code">=</code> E</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>function declaration</em></span>
                                </td></tr><tr><td align="right">P</td><td align="center">::=</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>Pattern</em></span>
                                </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">&nbsp;</td><td align="left">X</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>variable</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">C</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>constant</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code"><span class="hl-variable">_</span></code>
                                </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>wildcard</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code">(</code> P <code class="code">,</code> ... <code class="code">,</code> P <code class="code">)</code>
                                </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>tuple</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code">[</code> P <code class="code">,</code> ... <code class="code">,</code> P <code class="code">]</code>
                                </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>list</em></span>

                                </td></tr></tbody></table></div></div><br class="table-break">
</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cor.constants"></a>1.2.1.&nbsp;Constants</h3></div></div></div><p>
The simplest expression one can write is a constant. It evaluates trivially
to that constant value. 
</p><p>

Cor has three types of constants, and thus for the moment three types of values:

<div class="itemizedlist"><ul type="disc"><li>
Boolean: <code class="code"><span class="hl-literal">true</span></code> and <code class="code"><span class="hl-literal">false</span></code></li><li>
Number: <code class="code"> <span class="hl-literal">5</span>, -<span class="hl-literal">1</span>, <span class="hl-literal">2.71828</span>, ... </code></li><li>
String: <code class="code"><span class="hl-literal">"orc"</span></code>, <code class="code"><span class="hl-literal">"ceci n'est pas une |"</span></code></li></ul></div>
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="language.base.operators"></a>1.2.2.&nbsp;Operators</h3></div></div></div><p>
Cor has a standard set of arithmetic, logical, and comparison operators.
As in most other programming languages, they are written in the usual 
infix style. They have Java-like operator precedence, which can be
overridden by adding parentheses.  
</p><p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code"><span class="hl-literal">1</span>+<span class="hl-literal">2</span></code> evaluates to <code class="code"><span class="hl-literal">3</span></code>.</li><li><code class="code">(<span class="hl-literal">98</span>+<span class="hl-literal">2</span>)*<span class="hl-literal">17</span></code> evaluates to <code class="code"><span class="hl-literal">1700</span></code>.</li><li><code class="code"><span class="hl-literal">4</span> = <span class="hl-literal">20</span> / <span class="hl-literal">5</span></code> evaluates to <code class="code"><span class="hl-literal">true</span></code>.</li><li><code class="code"><span class="hl-literal">3</span>-<span class="hl-literal">5</span> <span class="hl-site">&gt;=</span> <span class="hl-literal">5</span>-<span class="hl-literal">3</span> </code> evaluates to <code class="code"><span class="hl-literal">false</span></code>.</li><li><code class="code"><span class="hl-literal">true</span> &amp;&amp; (<span class="hl-literal">false</span> <span class="hl-site">||</span> <span class="hl-literal">true</span>)</code> evaluates to <code class="code"><span class="hl-literal">true</span></code>.</li><li><code class="code"><span class="hl-literal">"leap"</span> + <span class="hl-literal">"frog"</span></code> evaluates to <code class="code"><span class="hl-literal">"leapfrog"</span></code>.</li></ul></div>
</p><p>
Here is the full set of operators that Cor supports:

<div class="table"><a name="ops-table"></a><p class="title"><b>Table&nbsp;1.2.&nbsp;Operators of Cor</b></p><div class="table-contents"><table summary="Operators of Cor" border="0" width="80%"><colgroup><col align="left"><col align="left"><col align="left"><col align="left"><col align="left"><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th colspan="2" align="left">Arithmetic</th><th colspan="2" align="left">Comparison</th><th colspan="2" align="left">Logical</th><th colspan="2" align="left">String</th></tr></thead><tbody><tr><td align="left">
                                    <code class="code">+</code>
                                    </td><td align="left">addition</td><td align="left">
                                    <code class="code">=</code>
                                    </td><td align="left">equality</td><td align="left">
                                    <code class="code">&amp;&amp;</code>
                                    </td><td align="left">logical and</td><td align="left">
                                    <code class="code">+</code>
                                    </td><td align="left">concatenation</td></tr><tr><td align="left">
                                    <code class="code">-</code>
                                    </td><td align="left">subtraction</td><td align="left">
                                    <code class="code">/=</code>
                                    </td><td align="left">inequality</td><td align="left">
                                    <code class="code"><span class="hl-site">||</span></code>

                                    </td><td align="left">logical or</td><td colspan="2" align="left">&nbsp;</td></tr><tr><td align="left">
                                    <code class="code">*</code>
                                    </td><td align="left">multiplication</td><td align="left">
                                    <code class="code">&lt;</code>
                                    </td><td align="left">less than</td><td align="left">
                                    <code class="code">~</code>

                                    </td><td align="left">logical not</td><td colspan="2" align="left">&nbsp;</td></tr><tr><td align="left">
                                    <code class="code">/</code>
                                    </td><td align="left">division</td><td align="left">
                                    <code class="code">&gt;</code>

                                    </td><td align="left">greater than</td><td colspan="2" align="left">&nbsp;</td><td colspan="2" align="left">&nbsp;</td></tr><tr><td align="left">
                                    <code class="code">%</code>
                                    </td><td align="left">modulus</td><td align="left">
                                    <code class="code"><span class="hl-site">&lt;=</span></code>

                                    </td><td align="left">less than or equal</td><td colspan="2" align="left">&nbsp;</td><td colspan="2" align="left">&nbsp;</td></tr><tr><td align="left">
                                    <code class="code">**</code>
                                    </td><td align="left">exponent</td><td align="left">
                                    <code class="code"><span class="hl-site">&gt;=</span></code>

                                    </td><td align="left">greater than or equal</td><td colspan="2" align="left">&nbsp;</td><td colspan="2" align="left">&nbsp;</td></tr></tbody></table></div></div><br class="table-break">

</p><p>
There is also a unary negation operator, written <code class="code">-</code>, for example <code class="code">-(<span class="hl-literal">2</span> ** <span class="hl-literal">5</span>)</code>.
</p><p>
The <code class="code">=</code> operator can compare values of any type. Values of different type are always inequal; for example,
<code class="code"><span class="hl-literal">10</span> = <span class="hl-literal">true</span></code> evaluates to <code class="code"><span class="hl-literal">false</span></code>.
</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N102FD"></a>1.2.2.1.&nbsp;Silent Expression</h4></div></div></div><p>
There are situations where an expression evaluation is stuck, because it is attempting to perform 
some impossible operation and cannot compute a value. In that case, the expression is <em class="firstterm">silent</em>. 
An expression is also silent if it depends on the result of a silent subexpression. For example, the following
expressions are silent: <code class="code"><span class="hl-literal">10</span>/<span class="hl-literal">0</span></code>, <code class="code"><span class="hl-literal">6</span> + <span class="hl-literal">false</span></code>, <code class="code"><span class="hl-literal">3</span> + <span class="hl-literal">1</span>/<span class="hl-literal">0</span></code>, <code class="code"><span class="hl-literal">4</span> + <span class="hl-literal">true</span> = <span class="hl-literal">5</span></code>.
</p><p>
Cor is a dynamically typed language. A Cor implementation does not statically check the type correctness
of an expression; instead, an expression with a type error is simply silent when it is evaluated.
</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10313"></a>1.2.3.&nbsp;Conditionals</h3></div></div></div><p>
A conditional expression in Cor is of the form 
<code class="code"><span class="hl-keyword">if</span></code> E <code class="code"><span class="hl-keyword">then</span></code> F <code class="code"><span class="hl-keyword">else</span></code> G. 
Its meaning is similar to that in other languages: the value
of the expression is the value of F if and only if E evaluates to true, 
or the value of G if and only if E evaluates to false. Note that G is not
evaluated at all if E evaluates to true, and similarly F is not evaluated
at all if E evaluates to false. Thus, for example, evaluation of 
<code class="code"><span class="hl-keyword">if</span> <span class="hl-literal">true</span> <span class="hl-keyword">then</span> <span class="hl-literal">2</span>+<span class="hl-literal">3</span> <span class="hl-keyword">else</span> <span class="hl-literal">1</span>/<span class="hl-literal">0</span></code> does not evaluate <code class="code"><span class="hl-literal">1</span>/<span class="hl-literal">0</span></code>;
it only evaluates <code class="code"><span class="hl-literal">2</span>+<span class="hl-literal">3</span></code>.
</p><p>
Unlike other languages, expressions in Cor may be silent. If E is
silent, then the entire expression is silent. And if E evaluates to true 
but F is silent (or if E evaluates to false and G is silent) then the 
expression is silent.
</p><p>
The behavior of conditionals is summarized by the following table
(<span class="emphasis"><em>v</em></span> denotes a value).

<div class="informaltable"><a name="cond-table"></a><table border="0" width="60%"><colgroup><col align="center"><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">E</th><th align="center">F</th><th align="center">G</th><th align="center">
                                    <code class="code"><span class="hl-keyword">if</span></code> E <code class="code"><span class="hl-keyword">then</span></code> F <code class="code"><span class="hl-keyword">else</span></code> G</th></tr></thead><tbody><tr><td align="center">
                                    <code class="code"><span class="hl-literal">true</span></code>
                                    </td><td align="center">
                                    <span class="emphasis"><em>v</em></span>
                                    </td><td align="center">-</td><td align="center">
                                    <span class="emphasis"><em>v</em></span>
                                    </td></tr><tr><td align="center">
                                    <code class="code"><span class="hl-literal">true</span></code>
                                    </td><td align="center">silent</td><td align="center">-</td><td align="center">silent</td></tr><tr><td align="center">
                                    <code class="code"><span class="hl-literal">false</span></code>
                                    </td><td align="center">-</td><td align="center">
                                    <span class="emphasis"><em>v</em></span>
                                    </td><td align="center">
                                    <span class="emphasis"><em>v</em></span>
                                    </td></tr><tr><td align="center">
                                    <code class="code"><span class="hl-literal">false</span></code>
                                    </td><td align="center">-</td><td align="center">silent</td><td align="center">silent</td></tr><tr><td align="center">silent</td><td align="center">-</td><td align="center">-</td><td align="center">silent</td></tr></tbody></table></div>

</p><p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code"><span class="hl-keyword">if</span> <span class="hl-literal">true</span> <span class="hl-keyword">then</span> <span class="hl-literal">4</span> <span class="hl-keyword">else</span> <span class="hl-literal">5</span></code> evaluates to <code class="code"><span class="hl-literal">4</span></code>.</li><li><code class="code"><span class="hl-keyword">if</span>  <span class="hl-literal">2</span> &lt; <span class="hl-literal">3</span> &amp;&amp; <span class="hl-literal">5</span> &lt; <span class="hl-literal">4</span>  <span class="hl-keyword">then</span> <span class="hl-literal">"blue"</span> <span class="hl-keyword">else</span> <span class="hl-literal">"green"</span></code> evaluates to "green".</li><li><code class="code"><span class="hl-keyword">if</span>  <span class="hl-literal">true</span> <span class="hl-site">||</span> <span class="hl-literal">"fish"</span>  <span class="hl-keyword">then</span> <span class="hl-literal">"yes"</span> <span class="hl-keyword">else</span> <span class="hl-literal">"no"</span></code> is silent.</li><li><code class="code"><span class="hl-keyword">if</span>  <span class="hl-literal">false</span> <span class="hl-site">||</span> <span class="hl-literal">false</span>  <span class="hl-keyword">then</span> <span class="hl-literal">4</span>+<span class="hl-literal">5</span> <span class="hl-keyword">else</span> <span class="hl-literal">4</span>+<span class="hl-literal">true</span></code> is silent.</li><li><code class="code"><span class="hl-keyword">if</span> <span class="hl-literal">0</span> &lt; <span class="hl-literal">5</span> <span class="hl-keyword">then</span> <span class="hl-literal">0</span>/<span class="hl-literal">5</span> <span class="hl-keyword">else</span> <span class="hl-literal">5</span>/<span class="hl-literal">0</span></code> evaluates to 0.</li></ul></div>
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cor.variables"></a>1.2.4.&nbsp;Variables</h3></div></div></div><p>
A <em class="firstterm">variable</em> can be bound to a value. A <em class="firstterm">declaration</em> binds one or
more variables to values. The simplest form of declaration is <code class="code"><span class="hl-keyword">val</span></code>, which 
evaluates an expression and binds its result to a variable. Declarations follow the rules of 
<a class="ulink" href="http://en.wikipedia.org/wiki/Lexical_scope" target="_top">lexical scoping</a>.
</p><p>
<pre class="programlisting">
<span class="hl-keyword">val</span> <span class="hl-variable">x</span> = <span class="hl-literal">1</span> + <span class="hl-literal">2</span>
<span class="hl-keyword">val</span> <span class="hl-variable">y</span> = <span class="hl-variable">x</span> + <span class="hl-variable">x</span>
</pre>

These declarations bind variable <code class="code"><span class="hl-variable">x</span></code> to 3 and variable <code class="code"><span class="hl-variable">y</span></code> to 6.
</p><p>
If the expression on the right side of a <code class="code"><span class="hl-keyword">val</span></code> is silent, then the variable is not bound, but 
evaluation of other declarations and expressions continues. If an evaluated expression depends on that
variable, that expression is silent.

<pre class="orc">
<span class="hl-keyword">val</span> <span class="hl-variable">x</span> = <span class="hl-literal">1</span>/<span class="hl-literal">0</span>
<span class="hl-keyword">val</span> <span class="hl-variable">y</span> = <span class="hl-literal">4</span>+<span class="hl-literal">5</span>
<span class="hl-keyword">if</span> <span class="hl-literal">false</span> <span class="hl-keyword">then</span> <span class="hl-variable">x</span> <span class="hl-keyword">else</span> <span class="hl-variable">y</span></pre>

Evaluation of the declaration <code class="code"><span class="hl-keyword">val</span> <span class="hl-variable">y</span> = <span class="hl-literal">4</span>+<span class="hl-literal">5</span></code> and the expression <code class="code"><span class="hl-keyword">if</span> <span class="hl-literal">false</span> <span class="hl-keyword">then</span> <span class="hl-variable">x</span> <span class="hl-keyword">else</span> <span class="hl-variable">y</span></code>
may continue even though <code class="code"><span class="hl-variable">x</span></code> is not bound. The expression evaluates to 9.

</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cor.data"></a>1.2.5.&nbsp;Data Structures</h3></div></div></div><p>
Cor supports two basic data structures, <em class="firstterm">tuples</em> and <em class="firstterm">lists</em>.
</p><p>
A <em class="firstterm">tuple expression</em> is a comma-separated sequence of at least two 
expressions, enclosed by parentheses. Each expression is evaluated; the value of the whole 
tuple expression is a tuple containing each of these values in order. 
If any of the expressions is silent, then the whole tuple expression is silent.
</p><p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code">(<span class="hl-literal">1</span>+<span class="hl-literal">2</span>, <span class="hl-literal">7</span>)</code> evaluates to <code class="code">(<span class="hl-literal">3</span>,<span class="hl-literal">7</span>)</code>.</li><li><code class="code"> (<span class="hl-literal">"true"</span> + <span class="hl-literal">"false"</span>, <span class="hl-literal">true</span> <span class="hl-site">||</span> <span class="hl-literal">false</span>, <span class="hl-literal">true</span> &amp;&amp; <span class="hl-literal">false</span>) </code> evaluates to <code class="code">(<span class="hl-literal">"truefalse"</span>, <span class="hl-literal">true</span>, <span class="hl-literal">false</span>)</code>.</li><li><code class="code">(<span class="hl-literal">2</span>/<span class="hl-literal">2</span>, <span class="hl-literal">2</span>/<span class="hl-literal">1</span>, <span class="hl-literal">2</span>/<span class="hl-literal">0</span>)</code> is silent.</li></ul></div>
</p><p>
A <em class="firstterm">list expression</em> is a comma-separated sequence of expressions enclosed by
square brackets. It may be of any length, including zero. Each expression is evaluated; the value 
of the whole list expression is a list containing each of these values in order.   
If any of the expressions is silent, then the whole list expression is silent.
</p><p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code">[<span class="hl-literal">1</span>,<span class="hl-literal">2</span>+<span class="hl-literal">3</span>] </code> evaluates to <code class="code">[<span class="hl-literal">1</span>,<span class="hl-literal">5</span>]</code>.</li><li><code class="code"> [<span class="hl-literal">true</span> &amp;&amp; <span class="hl-literal">true</span>]  </code> evaluates to <code class="code">[<span class="hl-literal">true</span>]</code>.</li><li><code class="code">[]</code> evaluates vacuously to <code class="code">[]</code>, the empty list.</li><li><code class="code">[<span class="hl-literal">5</span>, <span class="hl-literal">5</span> + <span class="hl-literal">true</span>, <span class="hl-literal">5</span>]</code> is silent.</li></ul></div>
</p><p>
There is also a concatenation (<em class="firstterm">cons</em>) operation on lists,
written F<code class="code">:</code>G, where F and G are expressions. Its result is a new list whose first element is the 
value of F and whose remaining elements are the list value of G. The <code class="code">:</code> operator is right associative,
so F<code class="code">:</code>G<code class="code">:</code>H is F<code class="code">(</code>G<code class="code">:</code>H<code class="code">)</code>.
</p><p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code">(<span class="hl-literal">1</span>+<span class="hl-literal">3</span>):[<span class="hl-literal">2</span>+<span class="hl-literal">5</span>,<span class="hl-literal">6</span>]</code> evaluates to <code class="code">[<span class="hl-literal">4</span>,<span class="hl-literal">7</span>,<span class="hl-literal">6</span>]</code>.</li><li><code class="code"><span class="hl-literal">2</span>:<span class="hl-literal">2</span>:<span class="hl-literal">5</span>:[] </code> evaluates to <code class="code">[<span class="hl-literal">2</span>,<span class="hl-literal">2</span>,<span class="hl-literal">5</span>]</code>.</li><li>Suppose <code class="code"><span class="hl-variable">t</span></code> is bound to [3,5]. Then <code class="code"><span class="hl-literal">1</span>:<span class="hl-variable">t</span></code> evaluates to <code class="code">[<span class="hl-literal">1</span>,<span class="hl-literal">3</span>,<span class="hl-literal">5</span>]</code>.</li><li><code class="code"><span class="hl-literal">2</span>:<span class="hl-literal">3</span></code> is silent, because <code class="code"><span class="hl-literal">3</span></code> is not a list.</li></ul></div>
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10483"></a>1.2.6.&nbsp;Patterns</h3></div></div></div><p>
We have seen how to construct data structures. But how do we examine them, and use them? We use <em class="firstterm">patterns</em>.
</p><p>
A pattern is a powerful way to bind variables. When writing <code class="code"><span class="hl-keyword">val</span></code> declarations, instead of just
binding one variable, we can replace the variable name with a more complex pattern that follows the structure of the
value, and matches its components. A pattern's structure is called its <em class="firstterm">shape</em>; a
pattern may take the shape of any structured value. A pattern can hierarchically match a value, going deep into its 
structure. It can also bind an entire structure to a variable.

</p><p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code"><span class="hl-keyword">val</span> (<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) = (<span class="hl-literal">2</span>+<span class="hl-literal">3</span>,<span class="hl-literal">2</span>*<span class="hl-literal">3</span>)</code> binds <code class="code"><span class="hl-variable">x</span></code> to 5 and <code class="code"><span class="hl-variable">y</span></code> to 6.</li><li><code class="code"><span class="hl-keyword">val</span> [<span class="hl-variable">a</span>,<span class="hl-variable">b</span>,<span class="hl-variable">c</span>] = [<span class="hl-literal">"one"</span>, <span class="hl-literal">"two"</span>, <span class="hl-literal">"three"</span>]</code> binds <code class="code"><span class="hl-variable">a</span></code> to "one", 
<code class="code"><span class="hl-variable">b</span></code> to "two", and <code class="code"><span class="hl-variable">c</span></code> to "three".
</li><li><code class="code"><span class="hl-keyword">val</span> ((<span class="hl-variable">a</span>,<span class="hl-variable">b</span>),<span class="hl-variable">c</span>) = ((<span class="hl-literal">1</span>, <span class="hl-literal">true</span>), (<span class="hl-literal">2</span>, <span class="hl-literal">false</span>))</code> binds <code class="code"><span class="hl-variable">a</span></code> to 1, <code class="code"><span class="hl-variable">b</span></code> to <code class="code"><span class="hl-literal">true</span></code>,
and <code class="code"><span class="hl-variable">c</span></code> to <code class="code">(<span class="hl-literal">2</span>,<span class="hl-literal">false</span>)</code>.
</li></ul></div>
</p><p>
Patterns are <em class="firstterm">linear</em>; that is, a pattern may mention a variable name at most once. 
For example, <code class="code">(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>,<span class="hl-variable">x</span>)</code> is not a valid pattern.
</p><p>
Note that a pattern may fail to match a value, if it does not have the same shape as that value. In a <code class="code"><span class="hl-keyword">val</span></code>
declaration, this has the same effect as evaluating a silent expression. No variable in the pattern is bound, and
if any one of those variables is later evaluated, it is silent.
</p><p>
It is often useful to ignore parts of the value that are not relevant. We can use the
wildcard pattern, written <code class="code"><span class="hl-variable">_</span></code>, to do this; it matches any shape and binds no
variables.
</p><p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code"><span class="hl-keyword">val</span> (<span class="hl-variable">x</span>,<span class="hl-variable">_</span>,<span class="hl-variable">_</span>) = (<span class="hl-literal">1</span>,(<span class="hl-literal">2</span>,<span class="hl-literal">2</span>),[<span class="hl-literal">3</span>,<span class="hl-literal">3</span>,<span class="hl-literal">3</span>])</code> binds <code class="code"><span class="hl-variable">x</span></code> to 1.</li><li><code class="code"><span class="hl-keyword">val</span> [[<span class="hl-variable">_</span>,<span class="hl-variable">x</span>],[<span class="hl-variable">_</span>,<span class="hl-variable">y</span>]] = [[<span class="hl-literal">1</span>,<span class="hl-literal">3</span>],[<span class="hl-literal">2</span>,<span class="hl-literal">4</span>]]</code> binds <code class="code"><span class="hl-variable">x</span></code> to 3 and <code class="code"><span class="hl-variable">y</span></code> to 4.</li></ul></div>
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="cor.functions"></a>1.2.7.&nbsp;Functions</h3></div></div></div><p>
Like most other programming languages, Cor provides the capability to define <em class="firstterm">functions</em>,
which are expressions that have a defined name, and have some number of parameters. Functions are declared 
using the keyword <code class="code"><span class="hl-keyword">def</span></code>, in the following way.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">Add</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) = <span class="hl-variable">x</span>+<span class="hl-variable">y</span>
</pre>

The expression on the right of the <code class="code">=</code> is called the <em class="firstterm">body</em> of the function.
</p><p>
After defining the function, we can <em class="firstterm">call</em> it. A call looks just like the left side of
the declaration except that the variable names (the <em class="firstterm">formal parameters</em>) have been 
replaced by expressions (the <em class="firstterm">actual parameters</em>). 
</p><p>
To evaluate a call, we treat it as a sequence of <code class="code"><span class="hl-keyword">val</span></code> declarations associating the formal
parameters with the actual parameters, followed by the body of the function. 

<pre class="programlisting">
<span class="hl-comment">{- Evaluation of Add(1+2,3+4) -}</span>
<span class="hl-keyword">val</span> <span class="hl-variable">x</span> = <span class="hl-literal">1</span>+<span class="hl-literal">2</span>
<span class="hl-keyword">val</span> <span class="hl-variable">y</span> = <span class="hl-literal">3</span>+<span class="hl-literal">4</span>
<span class="hl-variable">x</span>+<span class="hl-variable">y</span>
</pre>
</p><p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code"><span class="hl-variable">Add</span>(<span class="hl-literal">10</span>,<span class="hl-literal">10</span>*<span class="hl-literal">10</span>)</code> evaluates to <code class="code"><span class="hl-literal">110</span></code>.</li><li><code class="code"><span class="hl-variable">Add</span>(<span class="hl-variable">Add</span>(<span class="hl-literal">5</span>,<span class="hl-literal">3</span>),<span class="hl-literal">5</span>)</code> evaluates to <code class="code"><span class="hl-literal">13</span></code>.</li></ul></div>
</p><p>
Notice that the evaluation strategy of functions allows a call to proceed even if some of the actual
parameters are silent, so long as the values of those actual parameters are not used in the evaluation
of the body.

<pre class="orc">
<span class="hl-keyword">def</span> <span class="hl-variable">cond</span>(<span class="hl-variable">b</span>,<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) = <span class="hl-keyword">if</span> <span class="hl-variable">b</span> <span class="hl-keyword">then</span> <span class="hl-variable">x</span> <span class="hl-keyword">else</span> <span class="hl-variable">y</span>
<span class="hl-variable">cond</span>(<span class="hl-literal">true</span>, <span class="hl-literal">3</span>, <span class="hl-literal">5</span>/<span class="hl-literal">0</span>)
</pre>

This evaluates to <code class="code"><span class="hl-literal">3</span></code> even though <code class="code"><span class="hl-literal">5</span>/<span class="hl-literal">0</span></code> is silent, because <code class="code"><span class="hl-variable">y</span></code> is not
needed.

</p><p>
A function definition or call may have zero arguments, in which case we write <code class="code">()</code> for the arguments.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">Zero</span>() = <span class="hl-literal">0</span>
</pre>
</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N1053F"></a>1.2.7.1.&nbsp;Recursion</h4></div></div></div><p>
Functions can be recursive; that is, the name of a function may be used in its own body.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">Sumto</span>(<span class="hl-variable">n</span>) = <span class="hl-keyword">if</span> <span class="hl-variable">n</span> &lt; <span class="hl-literal">1</span> <span class="hl-keyword">then</span> <span class="hl-literal">0</span> <span class="hl-keyword">else</span> <span class="hl-variable">n</span> + <span class="hl-variable">Sumto</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>)
</pre>

Then, <code class="code"><span class="hl-variable">Sumto</span>(<span class="hl-literal">5</span>)</code> evaluates to 15.
</p><p>
Mutual recursion is also supported.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">Even</span>(<span class="hl-variable">n</span>) = 
  <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &gt; <span class="hl-literal">0</span>) <span class="hl-keyword">then</span> <span class="hl-variable">Odd</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>)
  <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &lt; <span class="hl-literal">0</span>) <span class="hl-keyword">then</span> <span class="hl-variable">Odd</span>(<span class="hl-variable">n</span>+<span class="hl-literal">1</span>)
  <span class="hl-keyword">else</span> <span class="hl-literal">true</span>
<span class="hl-keyword">def</span> <span class="hl-variable">Odd</span>(<span class="hl-variable">n</span>) = 
  <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &gt; <span class="hl-literal">0</span>) <span class="hl-keyword">then</span> <span class="hl-variable">Even</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>)
  <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &lt; <span class="hl-literal">0</span>) <span class="hl-keyword">then</span> <span class="hl-variable">Even</span>(<span class="hl-variable">n</span>+<span class="hl-literal">1</span>)
  <span class="hl-keyword">else</span> <span class="hl-literal">false</span>
</pre>

There is no special keyword for mutual recursion; any contiguous sequence of function declarations is assumed to be 
mutually recursive.
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="cor.closures"></a>1.2.7.2.&nbsp;Closures</h4></div></div></div><p>
Functions are actually values, just like any other value. Defining a function creates a special value called a 
<em class="firstterm">closure</em>; the name of the function is a variable and its bound value is the closure. Thus, 
a closure can be put into a data structure, or bound to some other variable, just like any other value.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">a</span>(<span class="hl-variable">x</span>) = <span class="hl-variable">x</span>-<span class="hl-literal">3</span>
<span class="hl-keyword">def</span> <span class="hl-variable">b</span>(<span class="hl-variable">y</span>) = <span class="hl-variable">y</span>*<span class="hl-literal">4</span>
<span class="hl-keyword">val</span> <span class="hl-variable">funs</span> = (<span class="hl-variable">a</span>,<span class="hl-variable">b</span>)
</pre>
</p><p>
Like any other value, a closure can be passed as an argument to another function. This means that Cor
supports <span class="emphasis"><em>higher-order</em></span> functions.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">Onetwosum</span>(<span class="hl-variable">f</span>) = <span class="hl-variable">f</span>(<span class="hl-literal">1</span>) + <span class="hl-variable">f</span>(<span class="hl-literal">2</span>)
<span class="hl-keyword">def</span> <span class="hl-variable">Triple</span>(<span class="hl-variable">x</span>) = <span class="hl-variable">x</span> * <span class="hl-literal">3</span>
</pre>

Then, <code class="code"><span class="hl-variable">Onetwosum</span>(<span class="hl-variable">Triple</span>)</code> is <code class="code"><span class="hl-variable">Triple</span>(<span class="hl-literal">1</span>) + <span class="hl-variable">Triple</span>(<span class="hl-literal">2</span>)</code>, which is <code class="code"><span class="hl-literal">1</span> * <span class="hl-literal">3</span> + <span class="hl-literal">2</span> * <span class="hl-literal">3</span></code> which evaluates to <code class="code"><span class="hl-literal">9</span></code>.

</p><p>
Since all declarations (including function declarations) in Cor are lexically scoped, these closures are
<span class="emphasis"><em>lexical closures</em></span>. This means that when a closure is created, if the body of the
function contains any variables other than the formal parameters, the bindings for those variables are
stored in the closure. Then, when the closure is called, the evaluation of the function body uses those 
stored variable bindings.  
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10574"></a>1.2.7.3.&nbsp;Lambda</h4></div></div></div><p>
Sometimes one would like to create a closure directly, without bothering to give it a name. 
There is a special keyword <code class="code"><span class="hl-keyword">lambda</span></code> for this purpose. By writing a function
definition without the keyword <code class="code"><span class="hl-keyword">def</span></code> and replacing the function name with
the keyword <code class="code"><span class="hl-keyword">lambda</span></code>, that definition becomes an expression which evaluates to a closure. 

<pre class="orc">
<span class="hl-keyword">def</span> <span class="hl-variable">Onetwosum</span>(<span class="hl-variable">f</span>) = <span class="hl-variable">f</span>(<span class="hl-literal">1</span>) + <span class="hl-variable">f</span>(<span class="hl-literal">2</span>)

<span class="hl-variable">Onetwosum</span>( <span class="hl-keyword">lambda</span>(<span class="hl-variable">x</span>) = <span class="hl-variable">x</span> * <span class="hl-literal">3</span> )
<span class="hl-comment">{- 
  identical to:
  def triple(x) = x * 3
  onetwosum(triple)
-}</span></pre>

Then, <code class="code"><span class="hl-variable">Onetwosum</span>( <span class="hl-keyword">lambda</span>(<span class="hl-variable">x</span>) = <span class="hl-variable">x</span> * <span class="hl-literal">3</span> )</code> evaluates to 9. 

</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10589"></a>1.2.7.4.&nbsp;Clauses</h4></div></div></div><p>
The combination of functions and pattern matching offers a powerful capability: 
<em class="firstterm">clausal</em> definition of functions. We can define expressions which execute 
different code depending on the structure of their arguments. 
</p><p>
Here's an example.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">Sum</span>([]) = <span class="hl-literal">0</span>
<span class="hl-keyword">def</span> <span class="hl-variable">Sum</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>) = <span class="hl-variable">h</span> + <span class="hl-variable">Sum</span>(<span class="hl-variable">t</span>)
</pre>

<code class="code"><span class="hl-variable">Sum</span>(<span class="hl-variable">L</span>)</code> publishes the sum of the numbers in the list <code class="code"><span class="hl-variable">L</span></code>. It has two clauses: 
one which matches the empty list, and one which matches any nonempty list. If its argument is an empty 
list, it returns 0, the appropriate sum for an empty list. If the argument is a nonempty list, it adds 
the first element of that list to the sum of all of the other elements. In this way, it recursively finds 
the sum of the list.
</p><p>
A function may have multiple clauses, each of which has a sequence of patterns to match each argument, 
and a body expression. Naturally, all clauses of a function must have the same number of arguments. Any 
contiguous sequence of definitions with the same name and different arguments is interpreted as a clausal 
definition, where each individual declaration is a clause of the larger function. 
</p><p>
When the function is called, the clauses are tried in the order in which they appear until a match is found. 
If no clause matches, the call remains silent.
</p><p>
We allow a new form of pattern which is very useful in clausal definition of functions: a constant pattern.
A constant pattern is a match only for the same constant value. We can use this to define the "base case"
of a recursive function in a straightforward way.

<pre class="programlisting">
<span class="hl-comment">{- Fibonacci numbers -}</span>
<span class="hl-keyword">def</span> <span class="hl-variable">Fib</span>(<span class="hl-literal">0</span>) = <span class="hl-literal">1</span>
<span class="hl-keyword">def</span> <span class="hl-variable">Fib</span>(<span class="hl-literal">1</span>) = <span class="hl-literal">1</span>
<span class="hl-keyword">def</span> <span class="hl-variable">Fib</span>(<span class="hl-variable">n</span>) = <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &lt; <span class="hl-literal">0</span>) <span class="hl-keyword">then</span> <span class="hl-literal">0</span> <span class="hl-keyword">else</span> <span class="hl-variable">Fib</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>) + <span class="hl-variable">Fib</span>(<span class="hl-variable">n</span>-<span class="hl-literal">2</span>)
</pre>

This definition of the Fibonacci function is straightforward, but slow, due to the repeated work in recursive
calls to <code class="code"><span class="hl-variable">Fib</span></code>. We can define a linear-time version, again with the help of pattern matching:

<pre class="programlisting">
<span class="hl-comment">{- Alternate definition of the Fibonacci function -}</span>

<span class="hl-comment">{- A helper function: find the pair (Fibonacci(n-1), Fibonacci(n)) -}</span>
<span class="hl-keyword">def</span> <span class="hl-variable">H</span>(<span class="hl-literal">0</span>) = (<span class="hl-literal">1</span>,<span class="hl-literal">1</span>)
<span class="hl-keyword">def</span> <span class="hl-variable">H</span>(<span class="hl-variable">n</span>) = <span class="hl-variable">H</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>) <span class="hl-combinator">&gt;</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)<span class="hl-combinator">&gt;</span> (<span class="hl-variable">y</span>,<span class="hl-variable">x</span>+<span class="hl-variable">y</span>)

<span class="hl-keyword">def</span> <span class="hl-variable">Fib</span>(<span class="hl-variable">n</span>) = <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &lt; <span class="hl-literal">0</span>) <span class="hl-keyword">then</span> <span class="hl-literal">0</span> <span class="hl-keyword">else</span> <span class="hl-variable">H</span>(<span class="hl-variable">n</span>) <span class="hl-combinator">&gt;</span>(<span class="hl-variable">x</span>,<span class="hl-variable">_</span>)<span class="hl-combinator">&gt;</span> <span class="hl-variable">x</span>
</pre>
</p><p>
As a more complex example of matching, consider the following function which finds
the first <code class="code"><span class="hl-variable">n</span></code> elements of a list (the list is assumed to be at least
<code class="code"><span class="hl-variable">n</span></code> elements long).

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">Take</span>(<span class="hl-literal">0</span>,<span class="hl-variable">_</span>) = []
<span class="hl-keyword">def</span> <span class="hl-variable">Take</span>(<span class="hl-variable">n</span>,<span class="hl-variable">h</span>:<span class="hl-variable">t</span>) = <span class="hl-variable">h</span>:(<span class="hl-variable">Take</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>,<span class="hl-variable">t</span>))
</pre>
</p><p>
Mutual recursion and clausal definitions are allowed to occur together.
For example, this function takes a list and computes a new list in which every other element is repeated:

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">Stutter</span>([]) = []
<span class="hl-keyword">def</span> <span class="hl-variable">Stutter</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>) = <span class="hl-variable">h</span>:<span class="hl-variable">h</span>:<span class="hl-variable">Mutter</span>(<span class="hl-variable">t</span>)
<span class="hl-keyword">def</span> <span class="hl-variable">Mutter</span>([]) = []
<span class="hl-keyword">def</span> <span class="hl-variable">Mutter</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>) = <span class="hl-variable">h</span>:<span class="hl-variable">Stutter</span>(<span class="hl-variable">t</span>)
</pre>

<code class="code"><span class="hl-variable">Stutter</span>([<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>])</code> evaluates to <code class="code">[<span class="hl-literal">1</span>,<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>,<span class="hl-literal">3</span>]</code>.
</p><p>
Clauses of mutually recursive functions may also be interleaved, to make
them easier to read.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">Even</span>(<span class="hl-literal">0</span>) = <span class="hl-literal">true</span>
<span class="hl-keyword">def</span> <span class="hl-variable">Odd</span>(<span class="hl-literal">0</span>) = <span class="hl-literal">false</span>
<span class="hl-keyword">def</span> <span class="hl-variable">Even</span>(<span class="hl-variable">n</span>) = <span class="hl-variable">Odd</span>(<span class="hl-keyword">if</span> <span class="hl-variable">n</span> &gt; <span class="hl-literal">0</span> <span class="hl-keyword">then</span> <span class="hl-variable">n</span>-<span class="hl-literal">1</span> <span class="hl-keyword">else</span> <span class="hl-variable">n</span>+<span class="hl-literal">1</span>)
<span class="hl-keyword">def</span> <span class="hl-variable">Odd</span>(<span class="hl-variable">n</span>) = <span class="hl-variable">Even</span>(<span class="hl-keyword">if</span> <span class="hl-variable">n</span> &gt; <span class="hl-literal">0</span> <span class="hl-keyword">then</span> <span class="hl-variable">n</span>-<span class="hl-literal">1</span> <span class="hl-keyword">else</span> <span class="hl-variable">n</span>+<span class="hl-literal">1</span>)
</pre>

</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N105C6"></a>1.2.8.&nbsp;Comments</h3></div></div></div><p>
Cor has two kinds of comments.   

</p><p>
A line which begins with two dashes (<code class="code"><span class="hl-comment">--</span></code>), preceded only by whitespace, is a single line comment.
The region from the two dashes to the next encountered newline, inclusive, is ignored.  
<pre class="programlisting">
<span class="hl-comment">-- This is a single line comment.</span>
	 <span class="hl-comment">-- This is also a single line comment.</span>
</pre>
</p><p>
Multiline comments are enclosed by matching braces of the form <code class="code"><span class="hl-comment">{- -}</span></code>. 
Multiline comments may be nested. They may appear anywhere, even in the middle of an expression.

<pre class="programlisting">
<span class="hl-comment">{- 
   This is a
   multiline comment.
-}</span>
   
<span class="hl-comment">{- Multiline comments {- can be nested -}</span> -}

<span class="hl-comment">{- They may appear anywhere, -}</span> 
<span class="hl-literal">1</span> + <span class="hl-comment">{- even in the middle of an expression. -}</span> <span class="hl-literal">2</span> + <span class="hl-literal">3</span>
</pre>

</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N105DB"></a>1.3.&nbsp;Orc: Orchestrating services</h2></div></div></div><p>
Cor is a pure declarative language. It has no state, since variables are bound at most once 
and cannot be reassigned. Evaluation of an expression results in at most one value.
It cannot communicate with the outside world except by producing a value. The full 
Orc language transcends these limitations by incorporating the orchestration of external services.
We introduce the term <em class="firstterm">site</em> to denote an external service which can be
called from an Orc program.
</p><p>
As in Cor, an Orc program is an  <em class="firstterm">expression</em>; Orc expressions are built 
up recursively from smaller expressions. Orc is a superset of Cor, i.e., all Cor expressions are 
also Orc expressions. Orc expressions are <em class="firstterm">executed</em>, rather than evaluated; 
an execution may call external services and <em class="firstterm">publish</em> some number of 
values (possibly zero). Different executions of the same expression may have completely different
behaviors; they may call different services, may receive different responses from the same site,
and may publish different values. Expressions in the functional subset, though, will display
the same behavior in all executions.
</p><p>
In the following sections we discuss the features of Orc. First, we discuss how Orc
communicates with external services. Then we introduce Orc's concurrency <em class="firstterm">combinators</em>,
which combine expressions into larger orchestrations and manage concurrent executions. 
We have already discussed the functional subset of Orc in our coverage of Cor, but we
reprise some of those topics; some Cor constructs exhibit new behaviors in the 
concurrent, stateful context of Orc.
</p><p>
The following figure summarizes the syntax of Orc as an extension of the syntax of Cor. 
The original Cor grammar rules are abbreviated by ellipses (...). 
</p><p>
<div class="table"><a name="orc-ebnf-table"></a><p class="title"><b>Table&nbsp;1.3.&nbsp;Basic Syntax of Orc</b></p><div class="table-contents"><table summary="Basic Syntax of Orc" border="0" width="80%"><colgroup><col align="right"><col align="center"><col align="left"><col align="left"><col align="left"></colgroup><tbody><tr><td align="right">D</td><td align="center">::=</td><td align="left"> ... </td><td align="left">
                                    <span class="emphasis"><em>Declaration</em></span>
                                </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code"><span class="hl-keyword">site</span></code> X <code class="code">=</code> <span class="emphasis"><em>address</em></span>
                                </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>site declaration</em></span>
                                </td></tr><tr><td align="right">C</td><td align="center">::=</td><td align="left"> ... </td><td align="left">
                                    <span class="emphasis"><em>Constant</em></span>
                                </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code"><span class="hl-keyword">signal</span></code>
                                </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>signal value</em></span>
                                </td></tr><tr><td align="right">E</td><td align="center">::=</td><td align="left">...</td><td align="left">
                                    <span class="emphasis"><em>Expression</em></span>
                                </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E <code class="code"><span class="hl-combinator">|</span></code> E</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>parallel combinator</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E<code class="code"> <span class="hl-combinator">&gt;</span></code>P<code class="code"><span class="hl-combinator">&gt;</span> </code>E</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>sequential combinator</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E<code class="code"> <span class="hl-combinator">&lt;</span></code>P<code class="code"><span class="hl-combinator">&lt;</span> </code>E</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>pruning combinator</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E <code class="code"><span class="hl-combinator">;</span></code> E</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>otherwise combinator</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code"><span class="hl-keyword">stop</span></code>
                                </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>silent expression</em></span>
                                </td></tr></tbody></table></div></div><br class="table-break">
</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N106BA"></a>1.3.1.&nbsp;Communicating with external services</h3></div></div></div><p>
An Orc expression may be a site call. Sites are called using the same syntax as a 
function call, but with a slightly different meaning. Sites are introduced and bound 
to variables by a special declaration.  
</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N106BF"></a>1.3.1.1.&nbsp;Calling a site</h4></div></div></div><p>
Suppose that the variable <code class="code"><span class="hl-variable">Google</span></code> is bound to a site which invokes the
Google search engine service in "I'm Feeling Lucky" mode. A call to <code class="code"><span class="hl-variable">Google</span></code> 
looks just like a function call. Calling <code class="code"><span class="hl-variable">Google</span></code> requests the URL of the top 
result for the given search term.

<pre class="programlisting">
<span class="hl-comment">{- Get the top search result for "computation orchestration" -}</span>
<span class="hl-variable">Google</span>(<span class="hl-literal">"computation orchestration"</span>)
</pre>

Once the Google search service determines the top result, it sends a response. The site 
call then publishes that response. Note that the service might not respond: Google's 
servers might be down, the network might be down, or the search might yield no result URL.  
</p><p>
A site call sends only a single request to an external service and receives at most one
response. These restrictions have two important consequences. First, all of the information needed 
for the call must be present before contacting the service. Thus, site calls are strict; all 
arguments must be bound before the call can proceed. If any argument is silent, the call never occurs.
Second, a site call publishes at most one value, since at most one response is received.
</p><p>
A call to a site has exactly one of the following effects: 

<div class="orderedlist"><ol type="1"><li>The site returns a value, called its <em class="firstterm">response</em>.</li><li>The site communicates that it will never respond to the call; we say that the call has <em class="firstterm">halted</em></li><li>The site neither returns a value nor indicates that the call has halted; we say that the call is <em class="firstterm">pending</em>.</li></ol></div>
</p><p>
In the last two cases, the site call is said to be silent. However, unlike a silent expression in Cor, 
a silent site call in Orc might perform some meaningful computation or communication; silence does 
not necessarily indicate an error. Since halted site calls and pending site calls are both silent,
they cannot usually be distinguished from each other; only the <a class="link" href="#combinator.otherwise" title="1.3.2.4.&nbsp;The otherwise combinator">
otherwise combinator</a> can tell the difference. 
</p><p>
A site is a value, just like an integer or a list. It may be bound to a variable, passed 
as an argument, or published by an execution, just like any other value.
</p><p>
<pre class="programlisting">
<span class="hl-comment">{-
  Create a search site from a search engine URL,
  bind the variable Search to that site,
  then use that site to search for a term.
-}</span>
<span class="hl-keyword">val</span> <span class="hl-variable">Search</span> = <span class="hl-variable">SearchEngine</span>(<span class="hl-literal">"http://www.google.com/"</span>)
<span class="hl-variable">Search</span>(<span class="hl-literal">"first class value"</span>)
</pre>
</p><p>
A site is sometimes called only for its effect on the external world; its return
value is irrelevant. Many sites which do not need to return a meaningful value will
instead return a <em class="firstterm">signal</em>: a special value which carries no 
information (analogous to the unit value <code class="code">()</code> in ML). The signal value
can be written as <code class="code"><span class="hl-keyword">signal</span></code> within Orc programs.


<pre class="orc">
<span class="hl-comment">{- 
  Use the 'println' site to print a string, followed by
  a newline, to an output console.
  The return value of this site call is a signal.
-}</span>
<span class="hl-variable">println</span>(<span class="hl-literal">"Hello, World!"</span>)
</pre>
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orc-declaring-a-site"></a>1.3.1.2.&nbsp;Declaring a site</h4></div></div></div><p>
A <code class="code"><span class="hl-keyword">site</span></code> declaration makes some service available as a site and
binds it to a variable. The service might be an object in the host language 
(e.g. a class instance in Java), or an external service on the web which is accessed 
through some protocol like SOAP or REST, or even a primitive operation like addition. 



Many useful sites are already defined in the Orc standard library, documented
in <a class="link" href="#appendix.library" title="Appendix&nbsp;B.&nbsp;Standard Library">Appendix B</a>. For now, we present a simple 
type of site declaration: using an object in the host language as a site.  
</p><p>
The following example instantiates a Java object to be used as a site in an Orc program, specifically
a Java object which provides an asynchronous buffer service. The declaration uses a
fully qualified Java class name to find and load a class, and creates an instance of that
class to provide the service. 

<pre class="programlisting">
<span class="hl-comment">{-  Define the Buffer site  -}</span>
<span class="hl-keyword">site</span> <span class="hl-variable">Buffer</span> = <span class="hl-variable">orc</span>.<span class="hl-variable">lib</span>.<span class="hl-variable">state</span>.<span class="hl-variable">Buffer</span>
</pre>  
</p><p>

</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10714"></a>1.3.2.&nbsp;The concurrency combinators of Orc</h3></div></div></div><p>
Orc has four <em class="firstterm">combinators</em>: parallel, sequential, pruning, and otherwise. 
A combinator forms an expression from two component expressions. Each combinator captures a 
different aspect of concurrency.
</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N1071C"></a>1.3.2.1.&nbsp;The parallel combinator</h4></div></div></div><p>
Orc's simplest combinator is <code class="code"><span class="hl-combinator">|</span></code>, the parallel combinator. Orc executes
the expression F <code class="code"><span class="hl-combinator">|</span></code> G, where F and G are Orc expressions, by executing 
F and G concurrently. Whenever F or G communicates with a service or publishes a value, 
F <code class="code"><span class="hl-combinator">|</span></code> G does so as well. 
</p><p>
<pre class="orc">
<span class="hl-comment">-- Publish 1 and 2 in parallel  </span>
<span class="hl-literal">1</span> <span class="hl-combinator">|</span> <span class="hl-literal">1</span>+<span class="hl-literal">1</span>
</pre>
</p><p>
<pre class="programlisting">
<span class="hl-comment">{- 
  Access two search sites, Google and Yahoo, in parallel.

  Publish any results they return.
  
  Since each call may publish a value, the expression
  may publish up to two values.
-}</span>  
<span class="hl-variable">Google</span>(<span class="hl-literal">"cupcake"</span>) <span class="hl-combinator">|</span> <span class="hl-variable">Yahoo</span>(<span class="hl-literal">"cupcake"</span>)
</pre>
</p><p>
The parallel combinator is fully associative: (F <code class="code"><span class="hl-combinator">|</span></code> G) <code class="code"><span class="hl-combinator">|</span></code> H and
F <code class="code"><span class="hl-combinator">|</span></code> (G <code class="code"><span class="hl-combinator">|</span></code> H) and F <code class="code"><span class="hl-combinator">|</span></code> G <code class="code"><span class="hl-combinator">|</span></code> H are all
equivalent.
</p><p>
It is also commutative: F <code class="code"><span class="hl-combinator">|</span></code> G is equivalent to G <code class="code"><span class="hl-combinator">|</span></code> F.  
</p><p>
<pre class="orc">
<span class="hl-comment">-- Publish 1, 2, and 3 in parallel  </span>
<span class="hl-literal">1</span>+<span class="hl-literal">0</span> <span class="hl-combinator">|</span> <span class="hl-literal">1</span>+<span class="hl-literal">1</span> <span class="hl-combinator">|</span> <span class="hl-literal">1</span>+<span class="hl-literal">2</span>
</pre>
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10757"></a>1.3.2.2.&nbsp;The sequential combinator</h4></div></div></div><p>
Now that we have expressions which publish multiple values, what can we do with those
publications? The sequential combinator, written F<code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> </code>G, 
combines the expression F, which may publish some values, with another expression G, 
which will use the values as they are published; <code class="code"><span class="hl-variable">x</span></code> transmits the values
from F to G.
</p><p>
The execution of F<code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> </code>G starts by executing F. Whenever F publishes a value, 
a new copy of G is executed in parallel with F (and with any previous copies of G); in that
copy of G, variable <code class="code"><span class="hl-variable">x</span></code> is bound to the value published by F. Values published by copies
of G are published by the whole expression, but the values published by F are not published
by the whole expression; they are consumed by the variable binding.
</p><p>
<pre class="orc">
<span class="hl-comment">-- Publish 1 and 2 in parallel  </span>
(<span class="hl-literal">0</span> <span class="hl-combinator">|</span> <span class="hl-literal">1</span>) <span class="hl-combinator">&gt;</span><span class="hl-variable">n</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">n</span>+<span class="hl-literal">1</span>
</pre>
</p><p>
<pre class="orc">
<span class="hl-comment">-- Publish 3 and 4 in parallel  </span>
<span class="hl-literal">2</span> <span class="hl-combinator">&gt;</span><span class="hl-variable">n</span><span class="hl-combinator">&gt;</span> (<span class="hl-variable">n</span>+<span class="hl-literal">1</span> <span class="hl-combinator">|</span> <span class="hl-variable">n</span>+<span class="hl-literal">2</span>)
</pre>
</p><p>
<pre class="orc">
<span class="hl-comment">-- Publish 0, 1, 2 and 3 in parallel  </span>
(<span class="hl-literal">0</span> <span class="hl-combinator">|</span> <span class="hl-literal">2</span>) <span class="hl-combinator">&gt;</span><span class="hl-variable">n</span><span class="hl-combinator">&gt;</span> (<span class="hl-variable">n</span> <span class="hl-combinator">|</span> <span class="hl-variable">n</span>+<span class="hl-literal">1</span>)
</pre>
</p><p>
<pre class="programlisting">
<span class="hl-comment">-- Prepend the site name to each published search result</span>
<span class="hl-comment">-- The cat site concatenates any number of arguments into one string  </span>
  <span class="hl-variable">Google</span>(<span class="hl-literal">"cupcake"</span>) <span class="hl-combinator">&gt;</span><span class="hl-variable">s</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">cat</span>(<span class="hl-literal">"Google: "</span>, <span class="hl-variable">s</span>)
<span class="hl-combinator">|</span> <span class="hl-variable">Yahoo</span>(<span class="hl-literal">"cupcake"</span>) <span class="hl-combinator">&gt;</span><span class="hl-variable">s</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">cat</span>(<span class="hl-literal">"Yahoo: "</span>, <span class="hl-variable">s</span>)
</pre>
</p><p>
The sequential combinator may be written as F<code class="code"> <span class="hl-combinator">&gt;</span></code>P<code class="code"><span class="hl-combinator">&gt;</span> </code>G, 
where P is a pattern instead of just a variable name. Any value published by F is matched against the 
pattern P. If this match is successful, a new copy of G is started with all of the bindings from the match. 
Otherwise, the published value is simply ignored, and no new copy of G is executed.
</p><p>
<pre class="orc">
<span class="hl-comment">-- Publish 3, 6, and 9 in arbitrary order.</span>
(<span class="hl-literal">3</span>,<span class="hl-literal">6</span>,<span class="hl-literal">9</span>)  <span class="hl-combinator">&gt;</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>,<span class="hl-variable">z</span>)<span class="hl-combinator">&gt;</span>  ( <span class="hl-variable">x</span> <span class="hl-combinator">|</span> <span class="hl-variable">y</span> <span class="hl-combinator">|</span> <span class="hl-variable">z</span> )
</pre>
</p><p>
<pre class="orc">
<span class="hl-comment">-- Filter out values of the form (_,false)</span>
( (<span class="hl-literal">4</span>,<span class="hl-literal">true</span>) <span class="hl-combinator">|</span> (<span class="hl-literal">5</span>,<span class="hl-literal">false</span>) <span class="hl-combinator">|</span> (<span class="hl-literal">6</span>,<span class="hl-literal">true</span>) )  <span class="hl-combinator">&gt;</span>(<span class="hl-variable">x</span>,<span class="hl-literal">true</span>)<span class="hl-combinator">&gt;</span> <span class="hl-variable">x</span>
<span class="hl-comment">-- Publishes 4 and 6 </span>
</pre>
</p><p>
We may also omit the variable entirely, writing <code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> </code>. This
is equivalent to using a wildcard pattern: <code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-variable">_</span><span class="hl-combinator">&gt;</span> </code>
</p><p>
We may want to execute an expression just for its effects, and hide all of its publications.
We can do this using <code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> </code> together with the special expression 
<code class="code"><span class="hl-keyword">stop</span></code>, which is always silent.  
</p><p>
<pre class="orc">
<span class="hl-comment">{- 
  Print two strings to the console,
  but don't publish the return values of the calls.
-}</span>
( <span class="hl-variable">println</span>(<span class="hl-literal">"goodbye"</span>) <span class="hl-combinator">|</span> <span class="hl-variable">println</span>(<span class="hl-literal">"world"</span>) ) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span>
</pre>
</p><p>
The sequential combinator is right associative: F<code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> </code>G<code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-variable">y</span><span class="hl-combinator">&gt;</span> </code>H
is equivalent to F<code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> (</code>G<code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-variable">y</span><span class="hl-combinator">&gt;</span> </code>H<code class="code">)</code>. It has higher
precedence than the parallel combinator: F<code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> </code>G <code class="code"><span class="hl-combinator">|</span></code> H is equivalent to
<code class="code">(</code>F<code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> </code>G <code class="code">) <span class="hl-combinator">|</span></code> H.
</p><p>
The right associativity of the sequential combinator makes it easy to bind variables in sequence and use
them together.
</p><p>
<pre class="orc">
<span class="hl-comment">{- 
  Publish the cross product of {1,2} and {3,4}:
  (1,3), (1,4), (2,3), and (2,4).
-}</span>
(<span class="hl-literal">1</span> <span class="hl-combinator">|</span> <span class="hl-literal">2</span>) <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> (<span class="hl-literal">3</span> <span class="hl-combinator">|</span> <span class="hl-literal">4</span>) <span class="hl-combinator">&gt;</span><span class="hl-variable">y</span><span class="hl-combinator">&gt;</span> (<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)
</pre>
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N107D3"></a>1.3.2.3.&nbsp;The pruning combinator</h4></div></div></div><p>
The pruning combinator, written F<code class="code"> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> </code>G, allows us to block 
a computation waiting for a result, or terminate a computation. The execution of 
F<code class="code"> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> </code>G starts by executing F and G in parallel. Whenever
F publishes a value, that value is published by the entire execution. When G publishes
its first value, that value is bound to x in F, and then the execution of G is immediately 
<em class="firstterm">terminated</em>. A terminated expression cannot call any sites or 
publish any values.
</p><p>
During the execution of F, any part of the execution that depends on <code class="code"><span class="hl-variable">x</span></code> 
will be suspended until <code class="code"><span class="hl-variable">x</span></code> is bound (to the first value published by G). If G
never publishes a value, that part of the execution is suspended forever. 
</p><p>
<pre class="orc">
<span class="hl-comment">-- Publish either 5 or 6, but not both</span>
<span class="hl-variable">x</span>+<span class="hl-literal">2</span> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> (<span class="hl-literal">3</span> <span class="hl-combinator">|</span> <span class="hl-literal">4</span>)
</pre>
</p><p>
<pre class="programlisting">
<span class="hl-comment">-- Query Google and Yahoo for a search result</span>
<span class="hl-comment">-- Print out the result that arrives first; ignore the other result</span>
<span class="hl-variable">println</span>(<span class="hl-variable">result</span>) <span class="hl-combinator">&lt;</span><span class="hl-variable">result</span><span class="hl-combinator">&lt;</span> ( <span class="hl-variable">Google</span>(<span class="hl-literal">"cupcake"</span>) <span class="hl-combinator">|</span> <span class="hl-variable">Yahoo</span>(<span class="hl-literal">"cupcake"</span>) )
</pre>
</p><p>
Though a terminated execution may not make any new calls, the calls
that it has already made will continue normally; their responses are simply
ignored. This may have surprising consequences when a call has side effects,
as in the following example.

<pre class="orc">
<span class="hl-comment">{- 
  This example actually prints both "true" and "false" to the
  console, regardless of which call responds first.
-}</span>
<span class="hl-keyword">stop</span> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> <span class="hl-variable">println</span>(<span class="hl-literal">"true"</span>) <span class="hl-combinator">|</span> <span class="hl-variable">println</span>(<span class="hl-literal">"false"</span>)
</pre>

Both of the <code class="code"><span class="hl-variable">println</span></code> calls are initiated before either one of
them publishes a value and terminates the expression. Once the expression
is terminated, no new calls occur, but the other <code class="code"><span class="hl-variable">println</span></code> call
still proceeds and still has the effect of printing its message to the
console.
</p><p>
The pruning combinator may include a full pattern P instead of just a variable name. Any
value published by G is matched against the pattern P. If this match is successful, then G
terminates and all of the bindings of the pattern P are made in F. Otherwise, the published 
value is simply ignored and G continues to execute.
</p><p>
<pre class="orc">
<span class="hl-comment">-- Publish either 9 or 25, but not 16.</span>
<span class="hl-variable">x</span>*<span class="hl-variable">x</span> <span class="hl-combinator">&lt;</span>(<span class="hl-variable">x</span>,<span class="hl-literal">true</span>)<span class="hl-combinator">&lt;</span> ( (<span class="hl-literal">3</span>,<span class="hl-literal">true</span>) <span class="hl-combinator">|</span> (<span class="hl-literal">4</span>,<span class="hl-literal">false</span>) <span class="hl-combinator">|</span> (<span class="hl-literal">5</span>,<span class="hl-literal">true</span>) )
</pre>
</p><p>
Note that even if <code class="code">(<span class="hl-literal">4</span>,<span class="hl-literal">false</span>)</code> is published before <code class="code">(<span class="hl-literal">3</span>,<span class="hl-literal">true</span>)</code> or <code class="code">(<span class="hl-literal">5</span>,<span class="hl-literal">true</span>)</code>, 
it is ignored. The right side continues to execute and will publish one of <code class="code">(<span class="hl-literal">3</span>,<span class="hl-literal">true</span>)</code> or 
<code class="code">(<span class="hl-literal">5</span>,<span class="hl-literal">true</span>)</code>.
</p><p>
The pruning combinator is left associative: F<code class="code"> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> </code>G<code class="code"> <span class="hl-combinator">&lt;</span><span class="hl-variable">y</span><span class="hl-combinator">&lt;</span> </code>H
is equivalent to <code class="code">(</code>F<code class="code"> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> </code>G<code class="code">) <span class="hl-combinator">&lt;</span><span class="hl-variable">y</span><span class="hl-combinator">&lt;</span> </code>H. It has lower
precedence than the parallel combinator: F<code class="code"> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> </code>G <code class="code"><span class="hl-combinator">|</span></code> H is equivalent to
F<code class="code"> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> (</code>G <code class="code"><span class="hl-combinator">|</span></code> H<code class="code">)</code>.
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="combinator.otherwise"></a>1.3.2.4.&nbsp;The otherwise combinator</h4></div></div></div><p>
Orc has a fourth concurrency combinator: the <em class="firstterm">otherwise</em> combinator,
written F<code class="code"> <span class="hl-combinator">;</span> </code>G. The execution of F<code class="code"> <span class="hl-combinator">;</span> </code> G proceeds as follows.
First, F is executed. If F <em class="firstterm">completes</em>, and has not published any values, 
then G executes. If F did publish one or more values, then G is ignored. The publications of 
F <code class="code"><span class="hl-combinator">;</span></code> G are those of F if F publishes, or those of G otherwise.
</p><p>
We determine when an expression completes using the following rules.

<div class="itemizedlist"><ul type="disc"><li>A Cor expression completes when it is fully evaluated; if it is silent, it completes immediately.</li><li>A site call completes when it has published a value or halted.</li><li>F <code class="code"><span class="hl-combinator">|</span></code> G completes when its subexpressions F and G have both completed.</li><li>F<code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> </code>G completes when F has completed and all instantiated copies of G have completed.</li><li>F<code class="code"> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> </code>G completes when F has completed, and G has either completed or
published a value. Also, if G completes without publishing a value, then all expressions in F which
use <code class="code"><span class="hl-variable">x</span></code> also complete, since they will never be able to proceed.</li><li>F <code class="code"><span class="hl-combinator">;</span></code> G completes either when F has published a value and subsequently completed,
or when F and G have both completed.</li><li><code class="code"><span class="hl-keyword">stop</span></code> completes immediately.</li></ul></div>

</p><p>
The otherwise combinator is fully associative, so F <code class="code"><span class="hl-combinator">;</span></code> G <code class="code"><span class="hl-combinator">;</span></code> H and
(F <code class="code"><span class="hl-combinator">;</span></code> G) <code class="code"><span class="hl-combinator">;</span></code> H and F <code class="code"><span class="hl-combinator">;</span></code> (G <code class="code"><span class="hl-combinator">;</span></code> H) are
all equivalent. It has lower precedence than the other three combinators. 
</p><p>
The otherwise combinator was not present in the original formulation of the Orc concurrency 
calculus; it has been added to support computation and iteration over strictly finite data. 
Sequential programs conflate the concept of producing a value with the concept of completion. 
Orc separates these two concepts; variable binding combinators like <code class="code"> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> </code> 
and <code class="code"> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> </code> handle values, whereas <code class="code"><span class="hl-combinator">;</span></code> detects the completion 
of an execution.
</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10890"></a>1.3.3.&nbsp;Revisiting Cor expressions</h3></div></div></div><p>
Some Cor expressions have new behaviors in the context of Orc, due to the introduction
of concurrency and of sites.
</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10895"></a>1.3.3.1.&nbsp;Arithmetic and Conditional</h4></div></div></div><p>
The arithmetic, logical, and comparison operators are actually calls to sites, simply
written in infix style with the expected operator symbols. For example, <code class="code"><span class="hl-literal">2</span>+<span class="hl-literal">3</span></code>
is actually <code class="code">(+)(<span class="hl-literal">2</span>,<span class="hl-literal">3</span>)</code>, where <code class="code">(+)</code> is a primitive site provided
by the language itself. All of the operators can be used directly as sites in this way;
the name of the site is the operator enclosed by parentheses, e.g. <code class="code">(**)</code>,
<code class="code">(<span class="hl-site">&gt;=</span>)</code>, etc. Negation (unary minus) is named <code class="code">(<span class="hl-literal">0</span>-)</code>.
</p><p>
The conditional expression <code class="code"><span class="hl-keyword">if</span></code> E <code class="code"><span class="hl-keyword">then</span></code> F <code class="code"><span class="hl-keyword">else</span></code> G
is actually a derived form based on a site named <code class="code"><span class="hl-keyword">if</span></code>. The <code class="code"><span class="hl-keyword">if</span></code>
site takes a boolean argument; it returns a signal if that argument is <code class="code"><span class="hl-literal">true</span></code>,
or remains silent if the argument is <code class="code"><span class="hl-literal">false</span></code>.
</p><p>
<code class="code"><span class="hl-keyword">if</span></code> E <code class="code"><span class="hl-keyword">then</span></code> F <code class="code"><span class="hl-keyword">else</span></code> G is equivalent 
to <code class="code">( <span class="hl-keyword">if</span>(<span class="hl-variable">b</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> </code>F<code class="code"> <span class="hl-combinator">|</span> <span class="hl-keyword">if</span>(~<span class="hl-variable">b</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> </code>G<code class="code">) <span class="hl-combinator">&lt;</span><span class="hl-variable">b</span><span class="hl-combinator">&lt;</span> </code>E.
</p><p>
 When the <code class="code"><span class="hl-keyword">else</span></code> branch of a conditional is unneeded, we can write <code class="code"><span class="hl-keyword">if</span></code> F <code class="code"><span class="hl-keyword">then</span></code> G,
 with no <code class="code"><span class="hl-keyword">else</span></code> branch. This is equivalent to <code class="code"><span class="hl-keyword">if</span>(</code>E<code class="code">) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> </code>F.
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N108EB"></a>1.3.3.2.&nbsp;
                        <code class="code"><span class="hl-keyword">val</span></code>
                    </h4></div></div></div><p>
The declaration <code class="code"><span class="hl-keyword">val</span> <span class="hl-variable">x</span> = </code>G, followed by expression F, is 
actually just a different way of writing the expression F<code class="code"> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> </code>G.
Thus, <code class="code"><span class="hl-keyword">val</span></code> shares all of the behavior of the pruning combinator,
which we have already described. (This is also true when a pattern is used instead
of variable name <code class="code"><span class="hl-variable">x</span></code>).
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N108FF"></a>1.3.3.3.&nbsp;Nesting Orc expressions</h4></div></div></div><p>
The execution of an Orc expression may publish many values. What does such an expression 
mean in a context where only one value is expected? For example, what does <code class="code"><span class="hl-literal">2</span> + (<span class="hl-literal">3</span> <span class="hl-combinator">|</span> <span class="hl-literal">4</span>)</code> 
publish? 
</p><p>
The specific contexts in which we are interested are as follows (where E is any Orc expression):

<div class="informaltable"><a name="value-context-table"></a><table border="0" width="40%"><colgroup><col align="left"><col align="right"></colgroup><tbody><tr><td align="left">E <span class="emphasis"><em>op</em></span> E</td><td align="right">
                                    <span class="emphasis"><em>operand</em></span>
                                    </td></tr><tr><td align="left">
                                    <code class="code"><span class="hl-keyword">if</span></code> E <code class="code"><span class="hl-keyword">then</span></code> ...</td><td align="right">
                                    <span class="emphasis"><em>conditional test</em></span>
                                    </td></tr><tr><td align="left">X<code class="code">(</code> ... <code class="code">,</code> E <code class="code">,</code> ... <code class="code">)</code>
                                    </td><td align="right">
                                    <span class="emphasis"><em>call argument</em></span>
                                    </td></tr><tr><td align="left">
                                    <code class="code">(</code> ... <code class="code">,</code> E <code class="code">,</code> ... <code class="code">)</code>
                                    </td><td align="right">
                                    <span class="emphasis"><em>tuple element</em></span>
                                    </td></tr><tr><td align="left">
                                    <code class="code">[</code> ... <code class="code">,</code> E <code class="code">,</code> ... <code class="code">]</code>
                                    </td><td align="right">
                                    <span class="emphasis"><em>list element</em></span>

                                    </td></tr></tbody></table></div>
</p><p>
Whenever an Orc expression appears in such a context, it executes until it publishes its first value, 
and then it is terminated. The published value is used in the context as if it were the result of evaluating
the expression.
</p><p>
<pre class="orc">
<span class="hl-comment">-- Publish either 5 or 6</span>
<span class="hl-literal">2</span> + (<span class="hl-literal">3</span> <span class="hl-combinator">|</span> <span class="hl-literal">4</span>)
</pre>
</p><p>
<pre class="orc">
<span class="hl-comment">-- Publish exactly one of 0, 1, 2 or 3</span>
(<span class="hl-literal">0</span> <span class="hl-combinator">|</span> <span class="hl-literal">2</span>) + (<span class="hl-literal">0</span> <span class="hl-combinator">|</span> <span class="hl-literal">1</span>)
</pre>
</p><p>
To be precise, whenever an Orc expression appears in such a context, it is treated as if it was 
on the right side of a pruning combinator, using a fresh variable name to fill in the hole. 
Thus, C[E] (where E is the Orc expression and C is the context) is equivalent to the expression 
C[<code class="code"><span class="hl-variable">x</span></code>] <code class="code"> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> </code> E. 
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10988"></a>1.3.3.4.&nbsp;Functions</h4></div></div></div><p>
The body of a function in Orc may be any Orc expression; thus, function
bodies in Orc are executed rather than evaluated, and may engage in communication
and publish multiple values.
</p><p>
A function call in Orc, as in Cor, binds the values of its actual parameters
to its formal parameters, and then executes the function body with those bindings.
Whenever the function body publishes a value, the function call publishes that
value. Thus, unlike a site call, or a pure functional Cor call, an Orc function
call may publish many values.
</p><p>
<pre class="orc">
<span class="hl-comment">-- Publish all integers in the interval 1..n, in arbitrary order. </span>
<span class="hl-keyword">def</span> <span class="hl-variable">range</span>(<span class="hl-variable">n</span>) = <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &gt; <span class="hl-literal">0</span>) <span class="hl-keyword">then</span> (<span class="hl-variable">n</span> <span class="hl-combinator">|</span> <span class="hl-variable">range</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>)) <span class="hl-keyword">else</span> <span class="hl-keyword">stop</span> 

<span class="hl-comment">-- Publish 1, 2, and 3 in arbitrary order.</span>
<span class="hl-variable">range</span>(<span class="hl-literal">3</span>)
</pre>
</p><p>
In the context of Orc, function calls are not strict. When a function call executes,
it begins to execute the function body immediately, and also executes the argument
expressions in parallel. When an argument expression publishes a value, it is terminated,
and the corresponding formal parameter is bound to that value in the execution of
the function body. Any part of the function body which uses a formal parameter
that has not yet been bound suspends until that parameter is bound to a value.
</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10997"></a>1.3.4.&nbsp;Time</h3></div></div></div><p>
Orc is designed to communicate with the external world, and one of the
most important characteristics of the external world is the passage of
time. Orc implicitly interacts with the passage of time by calling external
services which take time to respond. However, Orc can also explicitly
wait for some amount of time, using the special site <code class="code"><span class="hl-variable">Rtimer</span></code>. 
</p><p>
The site <code class="code"><span class="hl-variable">Rtimer</span></code> is a relative timer. It takes as an argument
a number of milliseconds to wait. It waits for exactly that amount of time,
and then responds with a signal.
</p><p>
<pre class="orc">
<span class="hl-comment">-- Print "red", wait for 3 seconds (3000 ms), and then print "green" </span>
<span class="hl-variable">println</span>(<span class="hl-literal">"red"</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">Rtimer</span>(<span class="hl-literal">3000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">println</span>(<span class="hl-literal">"green"</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span>
</pre>
</p><p>
The following example defines a metronome, which publishes a signal once 
every <code class="code"><span class="hl-variable">t</span></code> milliseconds, indefinitely.
</p><p>
<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">metronome</span>(<span class="hl-variable">t</span>) = <span class="hl-keyword">signal</span> <span class="hl-combinator">|</span> <span class="hl-variable">Rtimer</span>(<span class="hl-variable">t</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">metronome</span>(<span class="hl-variable">t</span>)
</pre>
</p><p>
We can also use <code class="code"><span class="hl-variable">Rtimer</span></code> together with the pruning combinator 
to enforce a timeout.
</p><p>
<pre class="programlisting">
<span class="hl-comment">{-
  Publish the result of a Google search.
  If it takes more than 5 seconds, time out.
-}</span>
<span class="hl-variable">result</span> 
  <span class="hl-combinator">&lt;</span><span class="hl-variable">result</span><span class="hl-combinator">&lt;</span> ( <span class="hl-variable">Google</span>(<span class="hl-literal">"impatience"</span>) 
           <span class="hl-combinator">|</span> <span class="hl-variable">Rtimer</span>(<span class="hl-literal">5000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Search timed out."</span>)
</pre>
</p>



We present many more examples of programming techniques using real time in <a class="link" href="#chapter.methodology" title="Chapter&nbsp;2.&nbsp;Programming Methodology">Chapter 2</a>.

</div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N109C3"></a>1.4.&nbsp;Advanced Features of Orc</h2></div></div></div><p>
In this section we introduce some advanced features of Orc. These include curried
function definitions and curried calls, writing an arbitrary expression as the
target of a call, a special syntax for writing calls in an object-oriented style, 
extensions to pattern matching, and new forms of declarations.
</p><p>
The following figure summarizes further extensions to the syntax of Orc. 
The Orc and Cor grammar rules presented earlier are abbreviated by ellipses (...).
The item G+ means "one or more instances of G concatenated together". 
</p><p>
<div class="table"><a name="advanced-ebnf-table"></a><p class="title"><b>Table&nbsp;1.4.&nbsp;Advanced Syntax of Orc</b></p><div class="table-contents"><table summary="Advanced Syntax of Orc" border="0" width="80%"><colgroup><col align="right"><col align="center"><col align="left"><col align="left"><col align="left"></colgroup><tbody><tr><td align="right">E</td><td align="center">::=</td><td align="left">...</td><td align="left">
                                    <span class="emphasis"><em>Expression</em></span>
                                </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E G+</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>generalized call</em></span>
                                </td></tr><tr><td align="right">G</td><td align="center">::=</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>Argument group</em></span>
                                </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">&nbsp;</td><td align="left"> <code class="code">(</code> E <code class="code">,</code> ... <code class="code">,</code> E <code class="code">)</code> </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>curried arguments</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left"> <code class="code">.</code>
                                    <span class="emphasis"><em>field</em></span> </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>field access</em></span>
                                </td></tr><tr><td align="right">P</td><td align="center">::=</td><td align="left">...</td><td align="left">
                                    <span class="emphasis"><em>Pattern</em></span>
                                </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code">!</code>P</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>publish pattern</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">P <code class="code"><span class="hl-keyword">as</span></code> X</td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>as pattern</em></span>
                                </td></tr><tr><td align="right">D</td><td align="center">::=</td><td align="left"> ... </td><td align="left">
                                    <span class="emphasis"><em>Declaration</em></span>
                                </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code"><span class="hl-keyword">class</span></code> X <code class="code">=</code> <span class="emphasis"><em>classname</em></span>
                                </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>class declaration</em></span>
                                </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                    <code class="code"><span class="hl-keyword">include</span></code> <code class="code"><span class="hl-literal">"</span></code> <span class="emphasis"><em>filename</em></span> <code class="code"><span class="hl-literal">"</span></code>
                                </td><td align="left">&nbsp;</td><td align="left">
                                    <span class="emphasis"><em>inclusion</em></span>
                                </td></tr></tbody></table></div></div><br class="table-break">
</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10AA6"></a>1.4.1.&nbsp;Special call forms</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10AA9"></a>1.4.1.1.&nbsp;The <code class="code">.</code> notation</h4></div></div></div><p>
In many object-oriented programming languages, one calls a method or accesses a field of an
object using the dot operator; for example, <code class="code"><span class="hl-variable">obj</span>.<span class="hl-variable">m</span>()</code> calls the method
<code class="code"><span class="hl-variable">m</span></code> of the object <code class="code"><span class="hl-variable">obj</span></code>. 
</p><p>
There is a special kind of site call in Orc which serves a similar purpose. One may write
<code class="code"><span class="hl-variable">x</span>.<span class="hl-variable">msg</span></code>, for any identifiers <code class="code"><span class="hl-variable">x</span></code> and <code class="code"><span class="hl-variable">msg</span></code>. This treats
 the value bound to <code class="code"><span class="hl-variable">x</span></code> as a site, and calls it with a special 
<em class="firstterm">message</em> value <code class="code"><span class="hl-variable">msg</span></code>. 
If the site understands the message <code class="code"><span class="hl-variable">msg</span></code> (for example, if <code class="code"><span class="hl-variable">x</span></code> is 
bound to a Java object with a field called <code class="code"><span class="hl-variable">msg</span></code>), the site interprets the message 
and responds with some appropriate value. If the site does not 
understand the message sent to it, it does not respond, and no publication occurs. 
If <code class="code"><span class="hl-variable">x</span></code> cannot be interpreted as a site, no call is made. 
</p><p>
Typically this capability is used so that sites may be syntactically treated like objects, 
with multiple methods and fields. For example, a channel <code class="code"><span class="hl-variable">c</span></code> might understand the messages
<code class="code"><span class="hl-variable">get</span></code> and <code class="code"><span class="hl-variable">put</span></code>, to get values from and put values on that channel,
respectively. Such calls would be written <code class="code"><span class="hl-variable">c</span>.<span class="hl-variable">get</span>()</code>, or <code class="code"><span class="hl-variable">c</span>.<span class="hl-variable">put</span>(<span class="hl-literal">6</span>)</code>.
</p><p>
A call such as <code class="code"><span class="hl-variable">c</span>.<span class="hl-variable">put</span>(<span class="hl-literal">6</span>)</code> actually occurs in two steps. First <code class="code"><span class="hl-variable">c</span>.<span class="hl-variable">put</span></code> sends the message
<code class="code"><span class="hl-variable">put</span></code> to the site <code class="code"><span class="hl-variable">c</span></code>; this publishes a site whose only purpose
is to put values on the channel. Next, that site is called on the argument
<code class="code"><span class="hl-literal">6</span></code>, sending 6 on the channel. Readers familiar with functional programming
will recognize this technique as <span class="emphasis"><em>currying</em></span>.
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10AFF"></a>1.4.1.2.&nbsp;Currying</h4></div></div></div><p>
It is sometimes useful to <span class="emphasis"><em>stage</em></span> the arguments to a function; that is,
rather than writing a function on two arguments, one instead writes a function on one
argument which returns a function taking the second argument and performing the remainder
of the evaluation. 
</p><p>
This technique is known as <span class="emphasis"><em>currying</em></span> and it is common in functional
programming languages. We can write curried functions using <a class="link" href="#cor.closures" title="1.2.7.2.&nbsp;Closures">closures</a>. Suppose we want to 
define a curried addition function on two arguments, and later apply that function to the 
arguments 3 and 4. We could write such a program in the following way:

<pre class="orc">
<span class="hl-keyword">def</span> <span class="hl-variable">Sum</span>(<span class="hl-variable">a</span>) = ( <span class="hl-keyword">lambda</span>(<span class="hl-variable">b</span>) = <span class="hl-variable">a</span>+<span class="hl-variable">b</span> )  
<span class="hl-keyword">val</span> <span class="hl-variable">f</span> = <span class="hl-variable">Sum</span>(<span class="hl-literal">3</span>)
<span class="hl-variable">f</span>(<span class="hl-literal">4</span>)
</pre>

This defines a function <code class="code"><span class="hl-variable">Sum</span></code> which, given an argument <code class="code"><span class="hl-variable">a</span></code>, creates a function
which will take an argument <code class="code"><span class="hl-variable">b</span></code> and add <code class="code"><span class="hl-variable">a</span></code> to <code class="code"><span class="hl-variable">b</span></code>. It then creates the
function which adds <code class="code"><span class="hl-literal">3</span></code> to its argument, binds that to <code class="code"><span class="hl-variable">f</span></code>, and then invokes
<code class="code"><span class="hl-variable">f</span></code> on <code class="code"><span class="hl-literal">4</span></code> to yield <code class="code"><span class="hl-literal">3</span>+<span class="hl-literal">4</span></code>.

</p><p>
When defining a curried function, we have abstracted it in two steps, and when
applying it we have written two separate calls. However, this is verbose and
not very clear. Orc has a special syntax for curried function definitions and curried 
applications that will simplify both of these steps. Function definitions may have multiple 
argument sequences; they are enclosed in parentheses and concatenated. Curried function calls 
chain together multiple applications in a similar way. Here is the previous program, written 
in this simplified syntax:

<pre class="orc">
<span class="hl-keyword">def</span> <span class="hl-variable">Sum</span>(<span class="hl-variable">a</span>)(<span class="hl-variable">b</span>) = <span class="hl-variable">a</span>+<span class="hl-variable">b</span>
<span class="hl-variable">Sum</span>(<span class="hl-literal">3</span>)(<span class="hl-literal">4</span>)
</pre>

Naturally, this syntax is backwards compatible; e.g. both of the following programs are also
equivalent:  

<pre class="orc">
<span class="hl-keyword">def</span> <span class="hl-variable">Sum</span>(<span class="hl-variable">a</span>) = ( <span class="hl-keyword">lambda</span>(<span class="hl-variable">b</span>) = <span class="hl-variable">a</span>+<span class="hl-variable">b</span> )  
<span class="hl-variable">Sum</span>(<span class="hl-literal">3</span>)(<span class="hl-literal">4</span>)
</pre>

<pre class="orc">
<span class="hl-keyword">def</span> <span class="hl-variable">Sum</span>(<span class="hl-variable">a</span>)(<span class="hl-variable">b</span>) = <span class="hl-variable">a</span>+<span class="hl-variable">b</span>  
<span class="hl-keyword">val</span> <span class="hl-variable">f</span> = <span class="hl-variable">Sum</span>(<span class="hl-literal">3</span>)
<span class="hl-variable">f</span>(<span class="hl-literal">4</span>)
</pre>

</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10B40"></a>1.4.2.&nbsp;Extensions to pattern matching</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10B43"></a>1.4.2.1.&nbsp;Publish pattern</h4></div></div></div><p>
A publish pattern, written <code class="code">!<span class="hl-variable">p</span></code>, will publish the value that matches the pattern 
<code class="code"><span class="hl-variable">p</span></code> if the match is successful.
</p><p>
<pre class="orc">
(<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>)  <span class="hl-combinator">&gt;</span>(<span class="hl-variable">x</span>,!<span class="hl-variable">y</span>,!<span class="hl-variable">z</span>)<span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span>
</pre>
</p><p>
This publishes <code class="code"><span class="hl-literal">2</span></code> and <code class="code"><span class="hl-literal">3</span></code>. 
</p><p>
Note that a publish pattern will not publish if the overall match fails, even if its particular match succeeds:
</p><p>
<pre class="orc">
( (<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>) <span class="hl-combinator">|</span> (<span class="hl-literal">4</span>,<span class="hl-literal">5</span>,<span class="hl-literal">6</span>) )  <span class="hl-combinator">&gt;</span>(<span class="hl-literal">1</span>,!<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)<span class="hl-combinator">&gt;</span>  <span class="hl-keyword">stop</span>
</pre>
</p><p>
This publishes only <code class="code"><span class="hl-literal">2</span></code>. Even though the pattern <code class="code"><span class="hl-variable">x</span></code> matches the value <code class="code"><span class="hl-literal">5</span></code>, 
the overall pattern <code class="code">(<span class="hl-literal">1</span>,!<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)</code> does not match the value <code class="code">(<span class="hl-literal">4</span>,<span class="hl-literal">5</span>,<span class="hl-literal">6</span>)</code>, so <code class="code"><span class="hl-literal">5</span></code> 
is not published.
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10B78"></a>1.4.2.2.&nbsp;As pattern</h4></div></div></div><p>
In taking apart a value with a pattern, it is often useful to capture intermediate results.

<pre class="programlisting">
<span class="hl-keyword">val</span> (<span class="hl-variable">a</span>,<span class="hl-variable">b</span>) = ((<span class="hl-literal">1</span>,<span class="hl-literal">2</span>),(<span class="hl-literal">3</span>,<span class="hl-literal">4</span>))
<span class="hl-keyword">val</span> (<span class="hl-variable">ax</span>,<span class="hl-variable">ay</span>) = <span class="hl-variable">a</span>
<span class="hl-keyword">val</span> (<span class="hl-variable">bx</span>,<span class="hl-variable">by</span>) = <span class="hl-variable">b</span>
</pre>

We can use the <code class="code"><span class="hl-keyword">as</span></code> keyword to simplify this program fragment, giving a name to an entire
subpattern. Here is an equivalent version of the above code.

<pre class="programlisting">
<span class="hl-keyword">val</span> ((<span class="hl-variable">ax</span>,<span class="hl-variable">ay</span>) <span class="hl-keyword">as</span> <span class="hl-variable">a</span>, (<span class="hl-variable">bx</span>,<span class="hl-variable">by</span>) <span class="hl-keyword">as</span> <span class="hl-variable">b</span>) = ((<span class="hl-literal">1</span>,<span class="hl-literal">2</span>),(<span class="hl-literal">3</span>,<span class="hl-literal">4</span>))
</pre>
</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10B86"></a>1.4.3.&nbsp;New forms of declarations</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10B89"></a>1.4.3.1.&nbsp;
                        <code class="code"><span class="hl-keyword">class</span></code> declaration</h4></div></div></div><p>
When Orc is run on top of an object-oriented programming language, classes
from that language may be used as sites in Orc itself, via the <code class="code"><span class="hl-keyword">class</span></code>
declaration. 
</p><p>
<pre class="programlisting">
<span class="hl-comment">{- Use the String class from Java's standard library as a site -}</span>
<span class="hl-keyword">class</span> <span class="hl-variable">String</span> = <span class="hl-variable">java</span>.<span class="hl-variable">lang</span>.<span class="hl-variable">String</span>
<span class="hl-keyword">val</span> <span class="hl-variable">s</span> = <span class="hl-variable">String</span>(<span class="hl-literal">"foo"</span>)
<span class="hl-variable">s</span>.<span class="hl-variable">concat</span>(<span class="hl-literal">"bar"</span>)
</pre>
</p><p>
This program binds the variable <code class="code"><span class="hl-variable">String</span></code> to the constructor of Java's
String class. When it is called, it constructs a new instance of String, passing
the given arguments to the constructor.
</p><p>
This instance of String is a Java object; its methods are called and its fields
are accessed using the dot (<code class="code">.</code>) notation, just as one would expect in Java.
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10BA3"></a>1.4.3.2.&nbsp;

                        <code class="code"><span class="hl-keyword">include</span></code> declaration</h4></div></div></div><p>
It is often convenient to group related declarations into units that can be
shared between programs. The <code class="code"><span class="hl-keyword">include</span></code> declaration offers a simple
way to do this. It names a source file containing a sequence of Orc declarations;
those declarations are incorporated into the program as if they had textually
replaced the include declaration. An included file may itself contain 
<code class="code"><span class="hl-keyword">include</span></code> declarations. 
</p><p>
<pre class="programlisting">
<span class="hl-comment">{- Contents of fold.inc -}</span>
<span class="hl-keyword">def</span> <span class="hl-variable">foldl</span>(<span class="hl-variable">f</span>,[],<span class="hl-variable">s</span>) = <span class="hl-variable">s</span>
<span class="hl-keyword">def</span> <span class="hl-variable">foldl</span>(<span class="hl-variable">f</span>,<span class="hl-variable">h</span>:<span class="hl-variable">t</span>,<span class="hl-variable">s</span>) = <span class="hl-variable">foldl</span>(<span class="hl-variable">f</span>,<span class="hl-variable">t</span>,<span class="hl-variable">f</span>(<span class="hl-variable">h</span>,<span class="hl-variable">s</span>))

<span class="hl-keyword">def</span> <span class="hl-variable">foldr</span>(<span class="hl-variable">f</span>,<span class="hl-variable">l</span>,<span class="hl-variable">s</span>) = <span class="hl-variable">foldl</span>(<span class="hl-variable">f</span>,<span class="hl-variable">rev</span>(<span class="hl-variable">l</span>),<span class="hl-variable">s</span>)
</pre>
</p><p>
<pre class="programlisting">
<span class="hl-comment">{- This is the same as inserting the contents of fold.inc here -}</span>
<span class="hl-keyword">include</span> <span class="hl-literal">"fold.inc"</span>

<span class="hl-keyword">def</span> <span class="hl-variable">sum</span>(<span class="hl-variable">L</span>) = <span class="hl-variable">foldl</span>(<span class="hl-keyword">lambda</span>(<span class="hl-variable">a</span>,<span class="hl-variable">b</span>) = <span class="hl-variable">a</span>+<span class="hl-variable">b</span>, <span class="hl-variable">L</span>, <span class="hl-literal">0</span>)

<span class="hl-variable">sum</span>([<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>])
</pre>
</p><p>
Note that these declarations still obey the rules of lexical scope. Also, Orc 
does not detect shared declarations; if the same file is included twice, its 
declarations occur twice.
</p></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="chapter.methodology"></a>Chapter&nbsp;2.&nbsp;Programming Methodology</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#N10BC7">2.1. Syntactic and Stylistic Conventions</a></span></dt><dd><dl><dt><span class="section"><a href="#N10BCC">2.1.1. Parallel combinator</a></span></dt><dt><span class="section"><a href="#N10C08">2.1.2. Sequential combinator</a></span></dt><dt><span class="section"><a href="#N10C45">2.1.3. Pruning combinator</a></span></dt><dt><span class="section"><a href="#N10CBA">2.1.4. Declarations</a></span></dt></dl></dd><dt><span class="section"><a href="#N10CF3">2.2. Programming Idioms</a></span></dt><dd><dl><dt><span class="section"><a href="#N10CF7">2.2.1. Fork-join</a></span></dt><dt><span class="section"><a href="#N10D70">2.2.2. Parallel Or</a></span></dt><dt><span class="section"><a href="#N10DAA">2.2.3. Finite Sequential Composition</a></span></dt><dt><span class="section"><a href="#N10DD0">2.2.4. Timeout</a></span></dt><dt><span class="section"><a href="#N10E0A">2.2.5. Priority</a></span></dt><dt><span class="section"><a href="#N10E1A">2.2.6. Repeat</a></span></dt><dt><span class="section"><a href="#N10E2F">2.2.7. Priority Poll</a></span></dt><dt><span class="section"><a href="#N10E3B">2.2.8. Parallel Matching</a></span></dt><dt><span class="section"><a href="#N10E51">2.2.9. Arrays</a></span></dt></dl></dd><dt><span class="section"><a href="#N10E75">2.3. Larger Examples</a></span></dt><dd><dl><dt><span class="section"><a href="#N10E78">2.3.1. Dining Philosophers</a></span></dt></dl></dd></dl></div><p>
In <a class="link" href="#chapter.language" title="Chapter&nbsp;1.&nbsp;The Orc Programming Language">Chapter 1</a>, we described the syntax and semantics of the Orc language. 
Now, we turn our attention to how the language is used in practice, with guidelines on style and programming 
methodology, including a number of common concurrency patterns.
</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N10BC7"></a>2.1.&nbsp;Syntactic and Stylistic Conventions</h2></div></div></div><p>
In this section we suggest some syntactic conventions for writing Orc programs. None of these 
conventions are required by the parser; newlines are used only to disambiguate certain corner
cases in parsing, and other whitespace is ignored. However, following programming convention 
helps to improve the readability of programs, so that the programmer's intent is more readily apparent.
</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10BCC"></a>2.1.1.&nbsp;Parallel combinator</h3></div></div></div><p>
When the combined expressions are small, write them all on one line.

<pre class="programlisting">
<span class="bold"><strong>F</strong></span> <span class="hl-combinator">|</span> <span class="bold"><strong>G</strong></span> <span class="hl-combinator">|</span> <span class="bold"><strong>H</strong></span>
</pre>

Note that we do not need parentheses here, since <code class="code"><span class="hl-combinator">|</span></code> is fully associative and commutative.
</p><p>
When the combined expressions are large enough to take up a full line, write one expression
per line, with each subsequent expression aligned with the first and preceded by <code class="code"><span class="hl-combinator">|</span></code>. 
Indent the first expression to improve readability.

<pre class="programlisting">
  <span class="bold"><strong>long expression</strong></span> 
<span class="hl-combinator">|</span> <span class="bold"><strong>long expression</strong></span>
<span class="hl-combinator">|</span> <span class="bold"><strong>long expression</strong></span>
</pre>
 
</p><p>
A sequence of parallel expressions often form the left hand side of a sequential combinator. 
Since the sequential combinator has higher precedence, use parentheses to group the
combined parallel expressions together. 


<pre class="programlisting">
( <span class="bold"><strong>expression</strong></span> 
<span class="hl-combinator">|</span> <span class="bold"><strong>expression</strong></span>
) <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span>
<span class="bold"><strong>another expression</strong></span>
</pre>
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10C08"></a>2.1.2.&nbsp;Sequential combinator</h3></div></div></div><p>
When the combined expressions are small, write a cascade of sequential combinators
all on the same line.
</p><pre class="programlisting">
<span class="bold"><strong>F</strong></span> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> <span class="bold"><strong>G</strong></span> <span class="hl-combinator">&gt;</span><span class="hl-variable">y</span><span class="hl-combinator">&gt;</span> <span class="bold"><strong>H</strong></span>
</pre><p>
Remember that sequential is right associative; in this example, <code class="code"><span class="hl-variable">x</span></code> is bound in both G and H, and <code class="code"><span class="hl-variable">y</span></code> is
bound in H.
</p><p>
When the combined expressions are large enough to take up a full line, write one expression
per line; each line ends with the combinator which binds the publications
produced by that line.

<pre class="programlisting">
<span class="bold"><strong>long expression</strong></span> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> 
<span class="bold"><strong>long expression</strong></span> <span class="hl-combinator">&gt;</span><span class="hl-variable">y</span><span class="hl-combinator">&gt;</span>
<span class="bold"><strong>long expression</strong></span>
</pre>
 
</p><p>
For very long-running expressions, or expressions that span multiple lines, write
the combinators on separate lines, indented, between each expression. 

<pre class="programlisting">
<span class="bold"><strong>very long expression</strong></span> 
  <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> 
<span class="bold"><strong>very long expression</strong></span> 
  <span class="hl-combinator">&gt;</span><span class="hl-variable">y</span><span class="hl-combinator">&gt;</span>
<span class="bold"><strong>very long expression</strong></span>
</pre>
 
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10C45"></a>2.1.3.&nbsp;Pruning combinator</h3></div></div></div><p>
When the combined expressions are small, write them on the same line:

<pre class="programlisting">
<span class="bold"><strong>F</strong></span> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> <span class="bold"><strong>G</strong></span>
</pre>

When multiple pruning combinators are used to bind multiple variables
(especially when the scoped expression is long), start each line with a 
combinator, aligned and indented, and continue with the expression.

<pre class="programlisting">
<span class="bold"><strong>long expression</strong></span> 
  <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> <span class="bold"><strong>G</strong></span>
  <span class="hl-combinator">&lt;</span><span class="hl-variable">y</span><span class="hl-combinator">&lt;</span> <span class="bold"><strong>H</strong></span>
</pre>

</p><p>
The pruning combinator is not often written in its explicit form
in Orc programs. Instead, the <code class="code"><span class="hl-keyword">val</span></code> declaration is often more
convenient, since it is semantically equivalent and mentions the variable
<code class="code"><span class="hl-variable">x</span></code> before its use in scope, rather than after.

<pre class="programlisting">
<span class="hl-keyword">val</span> <span class="hl-variable">x</span> = <span class="bold"><strong>G</strong></span>
<span class="hl-keyword">val</span> <span class="hl-variable">y</span> = <span class="bold"><strong>H</strong></span>
<span class="bold"><strong>long expression</strong></span> 
</pre>

</p><p>
Additionally, when the variable is used in only one place, and the
expression is small, it is often easier to use a nested expression.
For example,

<pre class="programlisting">
<span class="hl-keyword">val</span> <span class="hl-variable">x</span> = <span class="bold"><strong>G</strong></span>
<span class="hl-keyword">val</span> <span class="hl-variable">y</span> = <span class="bold"><strong>H</strong></span>
<span class="hl-variable">M</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)
</pre>

is equivalent to

<pre class="programlisting">
<span class="hl-variable">M</span>(<span class="bold"><strong>G</strong></span>,<span class="bold"><strong>H</strong></span>)
</pre>

</p><p>
Sometimes, we use the pruning combinator simply for its capability to terminate
expressions and get a single publication; binding a variable is irrelevant. This
is a special case of nested expressions. We use the identity site <code class="code"><span class="hl-variable">let</span></code>
to put the expression in the context of a function call.
</p><p>
For example,

<pre class="programlisting">
<span class="hl-variable">x</span> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> <span class="bold"><strong>F</strong></span> <span class="hl-combinator">|</span> <span class="bold"><strong>G</strong></span> <span class="hl-combinator">|</span> <span class="bold"><strong>H</strong></span>
</pre>

is equivalent to

<pre class="programlisting">
<span class="hl-variable">let</span>(<span class="bold"><strong>F</strong></span> <span class="hl-combinator">|</span> <span class="bold"><strong>G</strong></span> <span class="hl-combinator">|</span> <span class="bold"><strong>H</strong></span>)
</pre>
</p><p>
The translation uses a pruning combinator, but we don't need to write the combinator, 
name an irrelevant variable, or worry about precedence (since the expression is enclosed
in parentheses as part of the call).
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10CBA"></a>2.1.4.&nbsp;Declarations</h3></div></div></div><p>
Declarations should always end with a newline. 

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">add</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) = <span class="hl-variable">x</span> + <span class="hl-variable">y</span>
<span class="hl-keyword">val</span> <span class="hl-variable">z</span> = <span class="hl-literal">7</span>
<span class="hl-variable">add</span>(<span class="hl-variable">z</span>,<span class="hl-variable">z</span>)
</pre>

While the parser does not require a newline to end a declaration, it uses the 
newline to disambiguate certain corner cases in parsing, such as function application.
</p><p>
When the body of a declaration spans multiple lines, start the body on a new line
after the <code class="code">=</code> symbol, and indent the entire body.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">f</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) =
    <span class="bold"><strong>declaration</strong></span>
    <span class="bold"><strong>declaration</strong></span>
    <span class="bold"><strong>body expression</strong></span>
</pre>

</p><p>
Apply this style recursively; if a def appears within a def, indent its contents even further.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">f</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) =
    <span class="bold"><strong>declaration</strong></span>
    <span class="hl-keyword">def</span> <span class="hl-variable">helper</span>(<span class="hl-variable">z</span>) =
    	<span class="bold"><strong>declaration in helper</strong></span>
    	<span class="bold"><strong>declaration in helper</strong></span>
    	<span class="bold"><strong>body of helper</strong></span>
    <span class="bold"><strong>declaration</strong></span>
    <span class="bold"><strong>body expression</strong></span>
</pre>


</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N10CF3"></a>2.2.&nbsp;Programming Idioms</h2></div></div></div>

In this section we look at some common idioms used in the design of Orc programs. Many of these idioms will
be familiar to programmers using concurrency, and they are very simple to express in Orc.

<div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10CF7"></a>2.2.1.&nbsp;Fork-join</h3></div></div></div>

One of the most common concurrent idioms is a <em class="firstterm">fork-join</em>: run two processes concurrently,
and wait for a result from each one. This is very easy to express in Orc. Whenever we write a <code class="code"><span class="hl-keyword">val</span></code>
declaration, the process computing that value runs in parallel with the rest of the program. So if we write
two <code class="code"><span class="hl-keyword">val</span></code> declarations, and then form a tuple of their results, this performs a fork-join.


<p>
<pre class="programlisting">
<span class="hl-keyword">val</span> <span class="hl-variable">x</span> = <span class="bold"><strong>F</strong></span>
<span class="hl-keyword">val</span> <span class="hl-variable">y</span> = <span class="bold"><strong>G</strong></span>
(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)
</pre>
</p>


Fork-joins are a fundamental part of all Orc programs, since they are created by all nested expression
translations. In fact, the fork-join we wrote above could be expressed even more simply as just:

<p>
<pre class="programlisting">
(<span class="bold"><strong>F</strong></span>,<span class="bold"><strong>G</strong></span>)
</pre>
</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10D1F"></a>2.2.1.1.&nbsp;Example: Machine initialization</h4></div></div></div><p>
In Orc programs, we often use fork-join and recursion together to dispatch many tasks in parallel and wait
for all of them to complete. Suppose that given a machine <code class="code"><span class="hl-variable">m</span></code>, calling <code class="code"><span class="hl-variable">m</span>.<span class="hl-variable">init</span>()</code> 
initializes <code class="code"><span class="hl-variable">m</span></code> and then publishes a signal when initialization is complete. The function 
<code class="code"><span class="hl-variable">initAll</span></code> initializes a list of machines.
</p><pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">initAll</span>([]) = <span class="hl-keyword">signal</span>
<span class="hl-keyword">def</span> <span class="hl-variable">initAll</span>(<span class="hl-variable">m</span>:<span class="hl-variable">ms</span>) = ( <span class="hl-variable">m</span>.<span class="hl-variable">init</span>() , <span class="hl-variable">initAll</span>(<span class="hl-variable">ms</span>) ) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span>
</pre><p>
For each machine, we fork-join the initialization of that machine (<code class="code"><span class="hl-variable">m</span>.<span class="hl-variable">init</span>()</code>) with the initialization
of the remaining machines (<code class="code"><span class="hl-variable">initAll</span>(<span class="hl-variable">ms</span>)</code>). Thus, all of the initializations proceed in parallel, and
the function returns a signal only when every machine in the list has completed its initialization. 
</p><p>
Note that if some machine fails to initialize, and does not return a signal, then the initialization procedure
will never complete. 
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="example.auction"></a>2.2.1.2.&nbsp;Example: Simple parallel auction</h4></div></div></div><p>
We can also use a recursive fork-join to obtain a value, rather than just signaling completion. Suppose we
have a list of bidders in a sealed-bid, single-round auction. Calling <code class="code"><span class="hl-variable">b</span>.<span class="hl-variable">ask</span>()</code> requests a bid
from the bidder <code class="code"><span class="hl-variable">b</span></code>. We want to ask for one bid from each bidder, and then return the highest
bid. The function <code class="code"><span class="hl-variable">auction</span></code> performs such an auction for a list of bidders (<code class="code"><span class="hl-variable">max</span></code> 
finds the maxiumum of its arguments):
</p><pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">auction</span>([]) = <span class="hl-literal">0</span>
<span class="hl-keyword">def</span> <span class="hl-variable">auction</span>(<span class="hl-variable">b</span>:<span class="hl-variable">bs</span>) = <span class="hl-variable">max</span>(<span class="hl-variable">b</span>.<span class="hl-variable">ask</span>(), <span class="hl-variable">auction</span>(<span class="hl-variable">bs</span>))
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10D50"></a>2.2.1.3.&nbsp;Example: Barrier synchronization</h4></div></div></div><p>
Suppose we have an expression of the following form, where F and G are expressions and M and N are sites:

<pre class="programlisting">
<span class="hl-variable">M</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> <span class="bold"><strong>F</strong></span> <span class="hl-combinator">|</span> <span class="hl-variable">N</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">y</span><span class="hl-combinator">&gt;</span> <span class="bold"><strong>G</strong></span>
</pre>

</p><p>
However, we would also like to <span class="emphasis"><em>synchronize</em></span> the completion of M and N, so that
neither F nor G starts executing until both M and N have published. This is a particular example
of a fork-join:

<pre class="programlisting">
( <span class="hl-variable">M</span>() , <span class="hl-variable">N</span>() ) <span class="hl-combinator">&gt;</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>)<span class="hl-combinator">&gt;</span> ( <span class="bold"><strong>F</strong></span> <span class="hl-combinator">|</span> <span class="bold"><strong>G</strong></span> )
</pre>

We assume that x does not occur free in G, nor y in F.

</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10D70"></a>2.2.2.&nbsp;Parallel Or</h3></div></div></div><p>
Next we consider a classic example of parallel programming which builds up from fork-join: a parallel-or program. Given two
expressions F and G which may publish boolean values (or might stay silent forever), we want to find the disjunction of their
results as soon as possible. If one of the expressions publishes <code class="code"><span class="hl-literal">true</span></code>, then the disjunction is <code class="code"><span class="hl-literal">true</span></code>; 
hence, it is not necessary to wait for the other expression to publish a value.
</p><p>
Here is the code:

<pre class="programlisting">
<span class="hl-keyword">val</span> <span class="hl-variable">r</span> = 
    <span class="hl-keyword">val</span> <span class="hl-variable">a</span> = <span class="bold"><strong>F</strong></span>
    <span class="hl-keyword">val</span> <span class="hl-variable">b</span> = <span class="bold"><strong>G</strong></span>
      <span class="hl-keyword">if</span>(<span class="hl-variable">a</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">true</span> 
    <span class="hl-combinator">|</span> <span class="hl-keyword">if</span>(<span class="hl-variable">b</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">true</span> 
    <span class="hl-combinator">|</span> (<span class="hl-variable">a</span> <span class="hl-site">||</span> <span class="hl-variable">b</span>)
<span class="hl-variable">r</span>
</pre>
</p><p>
Recall that the <code class="code"><span class="hl-site">||</span></code> operator is strict; if one of <code class="code"><span class="hl-variable">a</span></code> or <code class="code"><span class="hl-variable">b</span></code> is not bound, it cannot
compute a result. So, we have added <code class="code"><span class="hl-keyword">if</span>(<span class="hl-variable">a</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">true</span></code> and <code class="code"><span class="hl-keyword">if</span>(<span class="hl-variable">b</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">true</span></code>, 
which wait in parallel for either variable to become <code class="code"><span class="hl-literal">true</span></code> and then publish the result <code class="code"><span class="hl-literal">true</span></code>. 
That way, the parallel-or can evaluate to <code class="code"><span class="hl-literal">true</span></code> based on only one of the results, even if the other result 
is not forthcoming.
</p><p>
Also note that the entire computation is within <code class="code"><span class="hl-keyword">val</span> <span class="hl-variable">r</span> =</code>, to prevent <code class="code"><span class="hl-literal">true</span></code> from being published
multiple times.
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10DAA"></a>2.2.3.&nbsp;Finite Sequential Composition</h3></div></div></div><p>
F <code class="code">&gt;<span class="hl-variable">x</span>&gt;</code> G instantiates a copy of G for each published value of F. Suppose we know 
that <span class="bold"><strong>F</strong></span> will publish only a finite number of values, and then complete; for 
example, <span class="bold"><strong>F</strong></span> publishes the contents of a text file, one line at a time, and
G prints each line to the console. After all of the lines have been printed, we want to start executing a new
expression <span class="bold"><strong>H</strong></span>.
</p><p>
Sequential composition alone is not sufficient, because we have no way to detect when all of the lines have been published. Fork-join is
also not suitable, since the values to be printed are not stored in some traversable data structure like a list; instead, they
are streaming as publications out of an expression. Instead, we use the <code class="code"><span class="hl-combinator">;</span></code> combinator, which waits for all of the
lines to be printed, then the left side completes and the right side can run. Note that we must suppress the publications on
the left side using <code class="code"><span class="hl-keyword">stop</span></code>; if the left side published, the right side would not run.
</p><pre class="programlisting">
<span class="bold"><strong>F</strong></span> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">println</span>(<span class="hl-variable">x</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span> <span class="hl-combinator">;</span> <span class="bold"><strong>H</strong></span>
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10DD0"></a>2.2.4.&nbsp;Timeout</h3></div></div></div><p>
One of the most powerful idioms available in Orc is a <em class="firstterm">timeout</em>: execute an expression for at
most a specified amount of time. We accomplish this using <code class="code"><span class="hl-keyword">val</span></code> and a timer. The following program runs
F for at most one second to get a value from it. If it does not publish within one second, the value defaults to 0.
</p><pre class="programlisting">
<span class="hl-variable">let</span>( <span class="bold"><strong>F</strong></span> <span class="hl-combinator">|</span> <span class="hl-variable">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">0</span> )
</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10DE1"></a>2.2.4.1.&nbsp;Auction with timeout</h4></div></div></div><p>
In the <a class="link" href="#example.auction" title="2.2.1.2.&nbsp;Example: Simple parallel auction">auction example</a> in Section 2.2.1.2, the auction may never complete if 
one of the bidders does not respond. We can add a timeout so that a bidder has at most 8 seconds to provide a bid:
</p><pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">auction</span>([]) = <span class="hl-literal">0</span>
<span class="hl-keyword">def</span> <span class="hl-variable">auction</span>(<span class="hl-variable">b</span>:<span class="hl-variable">bs</span>) = 
  <span class="hl-keyword">val</span> <span class="hl-variable">bid</span> = <span class="hl-variable">b</span>.<span class="hl-variable">ask</span>() <span class="hl-combinator">|</span> <span class="hl-variable">Rtimer</span>(<span class="hl-literal">8000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">0</span>
  <span class="hl-variable">Max</span>(<span class="hl-variable">bid</span>, <span class="hl-variable">auction</span>(<span class="hl-variable">bs</span>))
</pre><p>
Now, the auction is guaranteed to complete in at most 8 seconds.
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10DEE"></a>2.2.4.2.&nbsp;Detecting timeout</h4></div></div></div><p>
Sometimes, rather than just yielding a default value, we would like to determine
whether an expression has timed out, and if so, perform some other computation.
To detect the timeout, we pair the original expression with <code class="code"><span class="hl-literal">true</span></code> and the timer
with <code class="code"><span class="hl-literal">false</span></code>, so if the expression does time out, then we can detect
it using the truth value. We then test the truth value, performing the usual
computation if no timeout occurred, or some error-correcting computation if 
the expression did time out.
</p><p>
Here, we run the expression F with a time limit t. If it publishes within the time
limit, we execute G (the result of F is bound to r). Otherwise, we execute H.

<pre class="programlisting">
<span class="hl-keyword">val</span> (<span class="hl-variable">r</span>,<span class="hl-variable">b</span>) = (<span class="bold"><strong>F</strong></span>,<span class="hl-literal">true</span>) <span class="hl-combinator">|</span> (<span class="hl-variable">Rtimer</span>(<span class="hl-variable">t</span>),<span class="hl-literal">false</span>)
<span class="hl-keyword">if</span> <span class="hl-variable">b</span> <span class="hl-keyword">then</span> <span class="bold"><strong>G</strong></span> <span class="hl-keyword">else</span> <span class="bold"><strong>H</strong></span>
</pre>

</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E0A"></a>2.2.5.&nbsp;Priority</h3></div></div></div><p>
We can also use a timer to give a window of priority to one computation over another.
In this example, we run expressions F and G concurrently. F has priority for the first
second: if F publishes, its value is used immediately, but if G publishes, that publication 
is suspended for the first second and may be superseded by a publication from F
during that time. If neither F nor G publishes within a second, then whichever publishes
first after that point is the winner. 

<pre class="programlisting">
<span class="hl-keyword">val</span> <span class="hl-variable">x</span> = <span class="bold"><strong>F</strong></span>
<span class="hl-keyword">val</span> <span class="hl-variable">y</span> = <span class="bold"><strong>G</strong></span>
<span class="hl-variable">let</span>( <span class="hl-variable">y</span> <span class="hl-combinator">|</span> <span class="hl-variable">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">x</span> )
</pre>

</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E1A"></a>2.2.6.&nbsp;Repeat</h3></div></div></div><p>
Recall the definition of <code class="code"><span class="hl-variable">metronome</span></code> from the previous chapter:

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">metronome</span>() = <span class="hl-keyword">signal</span> <span class="hl-combinator">|</span> <span class="hl-variable">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">metronome</span>()
</pre>
</p><p>
We can use <code class="code"><span class="hl-variable">metronome</span></code> and the sequential combinator to repeat 
an expression, so that copies of that expression will execute at
regular intervals.
</p><p>
<pre class="programlisting">
<span class="hl-comment">{-
   Publish "tick" once every second.
   Publish "tock" once every second, with an initial 500ms delay.
   The publications alternate: tick tock tick tock ...
-}</span>   
  <span class="hl-variable">metronome</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"tick"</span>
<span class="hl-combinator">|</span> <span class="hl-variable">Rtimer</span>(<span class="hl-literal">500</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">metronome</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"tock"</span>
</pre>
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E2F"></a>2.2.7.&nbsp;Priority Poll</h3></div></div></div><p>
Suppose we have a list of buffers. We would like to poll these buffers periodically to see if they have
any available data. Furthermore, this list of buffers is ordered by priority; the first buffer in the
list has the highest priority, so it should be polled first, and if it has no data, then the next buffer
should be polled, and so on.
</p><p>
Here is a function which polls a prioritized list of buffers in this way. It publishes the first item 
that it finds, removing it from the originating buffer. If all buffers are empty, it remains silent.
We use the <code class="code"><span class="hl-variable">getnb</span></code> ("get non-blocking") method of the buffer, which retrieves the first
available item if there is one, or else remains silent and completes immediately if the buffer is empty
(it does not wait for an item to become available).
</p><pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">PriorityPoll</span>([]) = <span class="hl-keyword">stop</span>
<span class="hl-keyword">def</span> <span class="hl-variable">PriorityPoll</span>(<span class="hl-variable">b</span>:<span class="hl-variable">bs</span>) = <span class="hl-variable">b</span>.<span class="hl-variable">getnb</span>() <span class="hl-combinator">;</span> <span class="hl-variable">PriorityPoll</span>(<span class="hl-variable">bs</span>)
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E3B"></a>2.2.8.&nbsp;Parallel Matching</h3></div></div></div><p>
Matching a value against multiple patterns, as we have seen it so far, is a linear
process, and requires a <code class="code"><span class="hl-keyword">def</span></code> whose clauses have patterns in their
argument lists. Such a match is linear; each pattern is tried in order until
one succeeds.
</p><p>
What if we want to match a value against multiple patterns in parallel, executing
every clause that succeeds? Fortunately, this is very easy to do in Orc. Suppose
we have an expression F which publishes pairs of integers, and we want to publish
a signal for each 3 that occurs. We write:

<pre class="programlisting">
<span class="bold"><strong>F</strong></span> <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span>
  ( <span class="hl-variable">x</span> <span class="hl-combinator">&gt;</span>(<span class="hl-literal">3</span>,<span class="hl-variable">_</span>)<span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span>
  <span class="hl-combinator">|</span> <span class="hl-variable">x</span> <span class="hl-combinator">&gt;</span>(<span class="hl-variable">_</span>,<span class="hl-literal">3</span>)<span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span> ) 

</pre>

The interesting case is the pair <code class="code">(<span class="hl-literal">3</span>,<span class="hl-literal">3</span>)</code>, which is counted twice
because both patterns match it in parallel.
</p><p>
This is a useful idiom even if the patterns are mutually exclusive, to avoid
creating a helper function just to handle the pattern match.
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E51"></a>2.2.9.&nbsp;Arrays</h3></div></div></div><p>
While lists are a very useful data structure, they are not indexed; it is not possible to get the nth element of
a list in constant time. However, this capability is often needed in practice, so the Orc standard library
provides a function <code class="code"><span class="hl-variable">IArray</span></code> to create immutable arrays. Once initialized, an immutable array cannot
be rewritten; it can only be read. 
</p><p>
<code class="code"><span class="hl-variable">IArray</span></code> takes two arguments: an array size, and a function to initialize the array. The function
takes the index being initialized as an argument (indices start at 0), and publishes the value to be stored
at that array position. Here are a few examples:

<pre class="orc">
<span class="hl-comment">{- Create an array of 10 elements; element i is the ith power of 2 -}</span>
<span class="hl-variable">IArray</span>(<span class="hl-literal">10</span>, <span class="hl-keyword">lambda</span>(<span class="hl-variable">i</span>) = <span class="hl-literal">2</span> ** <span class="hl-variable">i</span>)
</pre>

<pre class="orc">
<span class="hl-comment">{- Create an array of 5 elements; each element is a newly created buffer -}</span>
<span class="hl-variable">IArray</span>(<span class="hl-literal">5</span>, <span class="hl-keyword">lambda</span>(<span class="hl-variable">_</span>) = <span class="hl-variable">Buffer</span>())
</pre>
</p><p>
The array is used like a function; the call <code class="code"><span class="hl-variable">A</span>(<span class="hl-variable">i</span>)</code> returns the <code class="code"><span class="hl-variable">i</span></code>th element of the
array <code class="code"><span class="hl-variable">A</span></code>. A call with an out-of-bounds index halts. 

<pre class="orc">
<span class="hl-comment">{- Create an array of 3 buffers -}</span>
<span class="hl-keyword">val</span> <span class="hl-variable">A</span> = <span class="hl-variable">IArray</span>(<span class="hl-literal">10</span>, <span class="hl-keyword">lambda</span>(<span class="hl-variable">_</span>) = <span class="hl-variable">Buffer</span>())

<span class="hl-comment">{- Send true on the 0th channel, and listen for a value on the 0th channel. -}</span>
<span class="hl-variable">A</span>(<span class="hl-literal">0</span>).<span class="hl-variable">put</span>(<span class="hl-literal">true</span>) <span class="hl-combinator">|</span> <span class="hl-variable">A</span>(<span class="hl-literal">0</span>).<span class="hl-variable">get</span>()
</pre>
</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N10E75"></a>2.3.&nbsp;Larger Examples</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E78"></a>2.3.1.&nbsp;Dining Philosophers</h3></div></div></div><p>
The dining philosophers problem is a well known and intensely studied problem in
concurrent programming. For a detailed description, see 
<a class="ulink" href="" target="_top">the wikipedia entry</a>
on the problem. Here, we present an Orc solution to the dining philosophers problem,
based on a probabilistic solution by Rabin.  
</p><pre class="orc">
<span class="hl-keyword">def</span> <span class="hl-variable">shuffle</span>(<span class="hl-variable">a</span>,<span class="hl-variable">b</span>) = <span class="hl-keyword">if</span> (<span class="hl-variable">random</span>(<span class="hl-literal">2</span>) = <span class="hl-literal">1</span>) <span class="hl-keyword">then</span> (<span class="hl-variable">a</span>,<span class="hl-variable">b</span>) <span class="hl-keyword">else</span> (<span class="hl-variable">b</span>,<span class="hl-variable">a</span>)

<span class="hl-keyword">def</span> <span class="hl-variable">take</span>((<span class="hl-variable">a</span>,<span class="hl-variable">b</span>)) =    
  <span class="hl-variable">a</span>.<span class="hl-variable">acquire</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">b</span>.<span class="hl-variable">acquirenb</span>() <span class="hl-combinator">;</span>
  <span class="hl-variable">a</span>.<span class="hl-variable">release</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">take</span>(<span class="hl-variable">shuffle</span>(<span class="hl-variable">a</span>,<span class="hl-variable">b</span>))
    
<span class="hl-keyword">def</span> <span class="hl-variable">drop</span>(<span class="hl-variable">a</span>,<span class="hl-variable">b</span>) = (<span class="hl-variable">a</span>.<span class="hl-variable">release</span>(), <span class="hl-variable">b</span>.<span class="hl-variable">release</span>()) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span>

<span class="hl-keyword">def</span> <span class="hl-variable">phil</span>(<span class="hl-variable">a</span>,<span class="hl-variable">b</span>,<span class="hl-variable">name</span>) =
  <span class="hl-keyword">def</span> <span class="hl-variable">thinking</span>() = 
    <span class="hl-keyword">if</span> (<span class="hl-variable">urandom</span>() &lt; <span class="hl-literal">0.9</span>)
      <span class="hl-keyword">then</span> <span class="hl-variable">Rtimer</span>(<span class="hl-variable">random</span>(<span class="hl-literal">1000</span>))
      <span class="hl-keyword">else</span> <span class="hl-variable">println</span>(<span class="hl-variable">name</span> + <span class="hl-literal">" is thinking forever."</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span>
  <span class="hl-keyword">def</span> <span class="hl-variable">hungry</span>() = <span class="hl-variable">take</span>((<span class="hl-variable">a</span>,<span class="hl-variable">b</span>))
  <span class="hl-keyword">def</span> <span class="hl-variable">eating</span>() = 
    <span class="hl-variable">println</span>(<span class="hl-variable">name</span> + <span class="hl-literal">" is eating."</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> 
    <span class="hl-variable">Rtimer</span>(<span class="hl-variable">random</span>(<span class="hl-literal">1000</span>)) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> 
    <span class="hl-variable">println</span>(<span class="hl-variable">name</span> + <span class="hl-literal">" has finished eating."</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
    <span class="hl-variable">drop</span>(<span class="hl-variable">a</span>,<span class="hl-variable">b</span>)
  <span class="hl-variable">thinking</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">hungry</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">eating</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">phil</span>(<span class="hl-variable">a</span>,<span class="hl-variable">b</span>,<span class="hl-variable">name</span>)

<span class="hl-keyword">def</span> <span class="hl-variable">dining</span>(<span class="hl-variable">n</span>) =
  <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &lt; <span class="hl-literal">2</span>) 
    <span class="hl-keyword">then</span> <span class="hl-variable">println</span>(<span class="hl-literal">"Can't simulate fewer than two philosophers."</span>)
    <span class="hl-keyword">else</span> 
    ( 
      <span class="hl-keyword">val</span> <span class="hl-variable">forks</span> = <span class="hl-variable">IArray</span>(<span class="hl-variable">n</span>, <span class="hl-keyword">lambda</span>(<span class="hl-variable">_</span>) = <span class="hl-variable">Semaphore</span>(<span class="hl-literal">1</span>))
      <span class="hl-keyword">def</span> <span class="hl-variable">phils</span>(<span class="hl-literal">0</span>) = <span class="hl-keyword">stop</span>
      <span class="hl-keyword">def</span> <span class="hl-variable">phils</span>(<span class="hl-variable">i</span>) = <span class="hl-variable">phil</span>(<span class="hl-variable">forks</span>(<span class="hl-variable">i</span>%<span class="hl-variable">n</span>), <span class="hl-variable">forks</span>(<span class="hl-variable">i</span>-<span class="hl-literal">1</span>), <span class="hl-literal">"Philosopher "</span> + <span class="hl-variable">i</span>) 
                   <span class="hl-combinator">|</span> <span class="hl-variable">phils</span>(<span class="hl-variable">i</span>-<span class="hl-literal">1</span>)
      <span class="hl-variable">phils</span>(<span class="hl-variable">n</span>) 
    )
<span class="hl-variable">dining</span>(<span class="hl-literal">5</span>) <span class="hl-combinator">;</span> <span class="hl-variable">println</span>(<span class="hl-literal">"Done."</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span>
</pre><p>
The program calls <code class="code"><span class="hl-variable">dining</span>(<span class="hl-literal">5</span>)</code> to simulate the dining philosophers
problem with size 5. It waits for the simulation to complete, then prints a message
and stops.
</p><p>
The <code class="code"><span class="hl-variable">dining</span></code> function takes the number <code class="code"><span class="hl-variable">n</span></code> of philosophers 
to simulate. It creates an array of <code class="code"><span class="hl-variable">n</span></code> binary semaphores to
represent the forks. Then, it starts <code class="code"><span class="hl-variable">n</span></code> philosopher processes in
parallel using the function <code class="code"><span class="hl-variable">phil</span></code>, giving each philosopher an
identifier, and references to its left and right forks. 
</p><p>
The <code class="code"><span class="hl-variable">phil</span></code> function describes the behavior of an individual philosopher.
It calls the <code class="code"><span class="hl-variable">thinking</span></code>, <code class="code"><span class="hl-variable">hungry</span></code>, and <code class="code"><span class="hl-variable">eating</span></code>
functions in a continuous loop. A <code class="code"><span class="hl-variable">thinking</span></code> philosopher waits for a random
amount of time, and also has a 10% chance of thinking forever. A <code class="code"><span class="hl-variable">hungry</span></code>
philosopher uses the <code class="code"><span class="hl-variable">take</span></code> function to acquire two forks. An <code class="code"><span class="hl-variable">eating</span></code>
philosopher waits for a random time interval and then uses the <code class="code"><span class="hl-variable">drop</span></code> function
to yield ownership of its forks. 
</p><p>
The <code class="code"><span class="hl-variable">take</span></code> and <code class="code"><span class="hl-variable">drop</span></code> functions are the key to the algorithm.
Calling <code class="code"><span class="hl-variable">take</span></code> attempts to acquire a pair of forks in two steps:
wait for one fork to become available, then immediately attempt to acquire the second
fork. If the second fork is acquired, signal success; otherwise, release the first
fork, and then try again, randomly changing the order in which the forks are
acquired using the <code class="code"><span class="hl-variable">shuffle</span></code> helper function. This reordering ensures
that the algorithm will probabilistically avoid livelock. The <code class="code"><span class="hl-variable">drop</span></code> function
simply releases both of the forks. 
</p></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="N10EC8"></a>Appendix&nbsp;A.&nbsp;Complete Syntax of Orc</h2></div></div></div><p>

<div class="table"><a name="full-ebnf-grammar"></a><p class="title"><b>Table&nbsp;A.1.&nbsp;Complete Syntax of Orc</b></p><div class="table-contents"><table summary="Complete Syntax of Orc" border="0" width="80%"><colgroup><col align="right"><col align="center"><col align="left"><col align="left"><col align="left"></colgroup><tbody><tr><td align="right">E</td><td align="center">::=</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>Expression</em></span>
                            </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">&nbsp;</td><td align="left">C</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>constant value</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E <span class="emphasis"><em>op</em></span> E</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>operator</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">X</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>variable</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                <code class="code"><span class="hl-keyword">if</span></code> E <code class="code"><span class="hl-keyword">then</span></code> E <code class="code"><span class="hl-keyword">else</span></code> E </td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>conditional</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E G+</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>call</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                <code class="code">(</code> E <code class="code">,</code> ... <code class="code">,</code> E <code class="code">)</code>
                            </td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>tuple</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                <code class="code">[</code> E <code class="code">,</code> ... <code class="code">,</code> E <code class="code">]</code>
                            </td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>list</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">D E</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>scoped declaration</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E <code class="code"><span class="hl-combinator">|</span></code> E</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>parallel combinator</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E<code class="code"> <span class="hl-combinator">&gt;</span></code>P<code class="code"><span class="hl-combinator">&gt;</span> </code>E</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>sequential combinator</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E<code class="code"> <span class="hl-combinator">&lt;</span></code>P<code class="code"><span class="hl-combinator">&lt;</span> </code>E</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>pruning combinator</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E <code class="code"><span class="hl-combinator">;</span></code> E</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>otherwise combinator</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                <code class="code"><span class="hl-keyword">stop</span></code>
                            </td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>silent expression</em></span>
                            </td></tr><tr><td align="right">G</td><td align="center">::=</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>Argument group</em></span>
                            </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">&nbsp;</td><td align="left"> <code class="code">(</code> E <code class="code">,</code> ... <code class="code">,</code> E <code class="code">)</code> </td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>arguments</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left"> <code class="code">.</code>
                                <span class="emphasis"><em>field</em></span> </td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>field access</em></span>
                            </td></tr><tr><td align="right">C</td><td align="center">::=</td><td align="left">
                                <code class="code"><span class="hl-literal">true</span></code> | <code class="code"><span class="hl-literal">false</span></code> | <span class="emphasis"><em>integer</em></span> | <span class="emphasis"><em>string</em></span> | <code class="code"><span class="hl-keyword">signal</span></code>
                            </td><td align="left">
                                <span class="emphasis"><em>Constant</em></span>
                            </td><td align="left">&nbsp;</td></tr><tr><td align="right">X</td><td align="center">::=</td><td align="left">
                                <span class="emphasis"><em>identifier</em></span>
                            </td><td align="left">
                                <span class="emphasis"><em>Variable</em></span>
                            </td><td align="left">&nbsp;</td></tr><tr><td align="right">D</td><td align="center">::=</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>Declaration</em></span>
                            </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">&nbsp;</td><td align="left">
                                <code class="code"><span class="hl-keyword">val</span></code> P <code class="code">=</code> E</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>value declaration</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                <code class="code"><span class="hl-keyword">def</span></code> X<code class="code">(</code> P <code class="code">,</code> ... <code class="code">,</code> P <code class="code">)</code> <code class="code">=</code> E</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>function declaration</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                <code class="code"><span class="hl-keyword">site</span></code> X <code class="code">=</code> <span class="emphasis"><em>address</em></span>
                            </td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>site declaration</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                <code class="code"><span class="hl-keyword">class</span></code> X <code class="code">=</code> <span class="emphasis"><em>classname</em></span>
                            </td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>class declaration</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                <code class="code"><span class="hl-keyword">include</span></code> <code class="code"><span class="hl-literal">"</span></code> <span class="emphasis"><em>filename</em></span> <code class="code"><span class="hl-literal">"</span></code>
                            </td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>inclusion</em></span>
                            </td></tr><tr><td align="right">P</td><td align="center">::=</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>Pattern</em></span>
                            </td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">&nbsp;</td><td align="left">X</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>variable</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">C</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>constant</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                <code class="code"><span class="hl-variable">_</span></code>
                            </td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>wildcard</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                <code class="code">(</code> P <code class="code">,</code> ... <code class="code">,</code> P <code class="code">)</code>
                            </td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>tuple</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                <code class="code">[</code> P <code class="code">,</code> ... <code class="code">,</code> P <code class="code">]</code>
                            </td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>list</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">
                                <code class="code">!</code>P</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>publish pattern</em></span>
                            </td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">P <code class="code"><span class="hl-keyword">as</span></code> X</td><td align="left">&nbsp;</td><td align="left">
                                <span class="emphasis"><em>as pattern</em></span>

                            </td></tr></tbody></table></div></div><br class="table-break">
</p></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="appendix.library"></a>Appendix&nbsp;B.&nbsp;Standard Library</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#N11131">B.1. Overview</a></span></dt><dt><span class="section"><a href="#N1113B">B.2. Notation</a></span></dt><dt><span class="section"><a href="#N11204">B.3. Reference</a></span></dt><dd><dl><dt><span class="section"><a href="#N11208">B.3.1. core.inc: Fundamental sites and operators.</a></span></dt><dt><span class="section"><a href="#N11466">B.3.2. data.inc: General-purpose supplemental data structures.</a></span></dt><dt><span class="section"><a href="#N11821">B.3.3. idioms.inc: Higher-order Orc programming idioms.</a></span></dt><dt><span class="section"><a href="#N1196E">B.3.4. list.inc: Operations on lists.</a></span></dt><dt><span class="section"><a href="#N11C07">B.3.5. text.inc: Operations on strings.</a></span></dt><dt><span class="section"><a href="#N11C94">B.3.6. time.inc: Real and logical time.</a></span></dt><dt><span class="section"><a href="#N11CDE">B.3.7. util.inc: Miscellaneous utility functions.</a></span></dt></dl></dd></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N11131"></a>B.1.&nbsp;Overview</h2></div></div></div><p>
The standard library is a set of declarations implicitly available to all Orc
programs.  In this section we give an informal description of the standard library,
including the type of each declaration and a short explanation of its use.
</p><p>
Orc programs are expected to rely on the host language and environment for
all but the most essential sites.  For example, in the Java implementation of
Orc, the entire Java standard library is available to Orc programs via
<code class="code"><span class="hl-keyword">class</span></code> declarations. Therefore the Orc standard library aims only
to provide convenience for the most common Orc idioms, not the complete set of
features needed for general-purpose programming.
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N1113B"></a>B.2.&nbsp;Notation</h2></div></div></div><p>
Each declaration in the standard library includes a type signature as part of
its documentation. The notation for type signatures, summarized here, is based
on a formal type system for Orc currently under preparation.
</p><p>
A type signature consists of: a declaration keyword, a declaration name, argument
types, the return type, and finally any subtyping constraints. For
example <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">min</span>(<span class="hl-variable">A</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, <span class="hl-variable">A</span> <span class="hl-site">&lt;:</span> <span class="hl-variable">Comparable</span></code> gives the type
of the <code class="code"><span class="hl-keyword">def</span></code> declaration for <code class="code"><span class="hl-variable">min</span></code>. According to this
signature, <code class="code"><span class="hl-variable">min</span></code> is a function which takes two arguments of type
<code class="code"><span class="hl-variable">A</span></code> and returns a value of the same type, where <code class="code"><span class="hl-variable">A</span></code> is
any subtype of <code class="code"><span class="hl-variable">Comparable</span></code>.
</p><p>
Declaration keywords include
<a class="link" href="#orc-declaring-a-site" title="1.3.1.2.&nbsp;Declaring a site">
                    <code class="code"><span class="hl-keyword">site</span></code>
                </a>,
<a class="link" href="#cor.functions" title="1.2.7.&nbsp;Functions">
                    <code class="code"><span class="hl-keyword">def</span></code>
                </a>,
<a class="link" href="#cor.variables" title="1.2.4.&nbsp;Variables">
                    <code class="code"><span class="hl-keyword">val</span></code>

                </a>, and <code class="code"><span class="hl-keyword">pattern</span></code>. The first three keywords
are described in previous chapters. The last, <code class="code"><span class="hl-keyword">pattern</span></code>, declares
the inverse of a site which can be used in a pattern. Given <code class="code"><span class="hl-keyword">pattern</span> <span class="hl-variable">M</span>(<span class="hl-variable">A</span>) :: (<span class="hl-variable">B</span>,<span class="hl-variable">C</span>)</code>,
evaluation of <code class="code"><span class="hl-variable">x</span> <span class="hl-combinator">&gt;</span><span class="hl-variable">M</span>(<span class="hl-variable">y</span>,<span class="hl-variable">z</span>)<span class="hl-combinator">&gt;</span> (<span class="hl-variable">y</span>,<span class="hl-variable">z</span>)</code> publishes a tuple <code class="code">(<span class="hl-variable">y</span>,<span class="hl-variable">z</span>)</code>
such that <code class="code"><span class="hl-variable">M</span>(<span class="hl-variable">y</span>,<span class="hl-variable">z</span>)=<span class="hl-variable">x</span></code>. Suppose <code class="code"><span class="hl-variable">Interleave</span></code> is a <code class="code"><span class="hl-keyword">site</span></code>
such that <code class="code"><span class="hl-variable">Interleave</span>(<span class="hl-variable">y</span>,<span class="hl-variable">z</span>)</code>, given two lists of equal length
<code class="code"><span class="hl-variable">y</span></code> and <code class="code"><span class="hl-variable">z</span></code>, returns the lists interleaved starting with
<code class="code"><span class="hl-variable">y</span></code>. Then, given <code class="code"><span class="hl-keyword">pattern</span> <span class="hl-variable">Interleave</span></code>,

<pre class="programlisting">
[<span class="hl-literal">0</span>,<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>] <span class="hl-combinator">&gt;</span><span class="hl-variable">Interleave</span>(<span class="hl-variable">y</span>,<span class="hl-variable">z</span>)<span class="hl-combinator">&gt;</span> (<span class="hl-variable">y</span>,<span class="hl-variable">z</span>)</pre>

publishes <code class="code">([<span class="hl-literal">0</span>,<span class="hl-literal">2</span>], [<span class="hl-literal">1</span>,<span class="hl-literal">3</span>])</code>.</p><p>
Object members (methods and fields) are each declared separately.  The binding
name of a member is written in the form Type.member, e.g.  <code class="code"><span class="hl-variable">Foo</span>.<span class="hl-variable">get</span></code>
refers to the <code class="code"><span class="hl-variable">get</span></code> member of an object of type <code class="code"><span class="hl-variable">Foo</span></code>.
The object type can include type variables which are referenced by the member
type, so for example <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Buffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">get</span>() :: <span class="hl-variable">A</span></code> means that
when the <code class="code"><span class="hl-variable">get</span></code> method is called on a <code class="code"><span class="hl-variable">Buffer</span></code> holding an
arbitrary element type <code class="code"><span class="hl-variable">A</span></code>, it will return a value of the same type.
</p><p>
Argument and return types are written as follows:
<div class="itemizedlist"><ul type="disc"><li>Primitive types are given descriptive names based on the names of the
	corresponding Java classes. For example, <code class="code"><span class="hl-variable">Number</span></code> is any
	number, and <code class="code"><span class="hl-variable">Comparable</span></code> is any value which supports a total
	order.</li><li>Type variables in polymorphic declarations are written using the
	letters <code class="code"><span class="hl-variable">A</span></code> ... <code class="code"><span class="hl-variable">Z</span></code>. For example, the signature
	<code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">let</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span></code> means that <code class="code"><span class="hl-variable">let</span></code> takes one
	argument of any type, and returns a value of the same type.</li><li>The Top type (of which all types are subtypes) is written
	<code class="code"><span class="hl-variable">Top</span></code>. The Bottom type (which is a subtype of all types) is
	written <code class="code"><span class="hl-variable">Bot</span></code>.</li><li>A list with element type <code class="code"><span class="hl-variable">A</span></code> is written <code class="code">[<span class="hl-variable">A</span>]</code>.</li><li>A tuple with element types <code class="code"><span class="hl-variable">A</span>, <span class="hl-variable">B</span>, ...</code> is written <code class="code">(<span class="hl-variable">A</span>, <span class="hl-variable">B</span>, ...)</code>.</li><li>Any other parameterized type is written as a type name followed by
	type parameters in angle brackets. For example,
	<code class="code"><span class="hl-variable">Array</span>&lt;<span class="hl-variable">Integer</span>&gt;</code> is the type of arrays of integers.</li><li>A function type (when given as an argument or return type) is written with the keyword
	<code class="code"><span class="hl-keyword">lambda</span></code> followed by the argument types and return type as
	in a declaration type signature. For example, <code class="code"><span class="hl-keyword">lambda</span> (<span class="hl-variable">Integer</span>) ::
	<span class="hl-variable">Integer</span></code> is the type of functions mapping integers to
	integers.</li></ul></div>
</p><p>
Multiple sets of argument types are syntactic sugar for currying. For
example, <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Foo</span>()() :: <span class="hl-variable">Signal</span></code> is equivalent to
<code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Foo</span>() :: <span class="hl-keyword">lambda</span> () :: <span class="hl-variable">Signal</span></code>.
</p><p>
Subtyping constraints are used to constrain the types of polymorphic type
variables, and are written <code class="code"><span class="hl-variable">A</span> <span class="hl-site">&lt;:</span> <span class="hl-variable">X</span></code>, meaning <code class="code"><span class="hl-variable">A</span></code> must
be a subtype of <code class="code"><span class="hl-variable">X</span></code>.
</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N11204"></a>B.3.&nbsp;Reference</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11208"></a>B.3.1.&nbsp;core.inc: Fundamental sites and operators.</h3></div></div></div><p>Fundamental sites and operators.</p><p>These declarations include both prefix and infix sites (operators).  For
consistency, all declarations are written in prefix form, with the site name
followed by the operands.  When the site name is surrounded in parentheses, as
in <code class="code">(+)</code>, it denotes an infix operator.</p><p>For a more complete description of the built-in operators and their syntax, see
the <a class="link" href="#language.base.operators" title="1.2.2.&nbsp;Operators">Operators</a> section of the
User Guide.</p><div class="variablelist"><dl><dt><span class="term">
                            <code class="code"><span class="hl-variable">let</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">let</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>When applied to a single argument, return that argument (behaving as the identity function).</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">let</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">let</span>(<span class="hl-variable">A</span>, ...) :: (<span class="hl-variable">A</span>, ...)</code>
                            </p><p>When applied to zero, two, or more arguments, return the arguments in a tuple.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-keyword">if</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-keyword">if</span>(<span class="hl-variable">Boolean</span>) :: <span class="hl-variable">Signal</span></code>

                            </p><p>Fail silently if the argument is false. Otherwise return a signal.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: "Always publishes"</span>
  <span class="hl-keyword">if</span>(<span class="hl-literal">false</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Never publishes"</span>
<span class="hl-combinator">|</span> <span class="hl-keyword">if</span>(<span class="hl-literal">true</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Always publishes"</span></pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">error</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">error</span>(<span class="hl-variable">String</span>) :: <span class="hl-variable">Bot</span></code>

                            </p><p>Halt with the given error message.</p><p>Example, using <code class="code"><span class="hl-variable">error</span></code> to implement assertions:
<pre class="orc">
<span class="hl-keyword">def</span> <span class="hl-variable">assert</span>(<span class="hl-variable">b</span>) =
  <span class="hl-keyword">if</span> <span class="hl-variable">b</span> <span class="hl-keyword">then</span> <span class="hl-keyword">signal</span> <span class="hl-keyword">else</span> <span class="hl-variable">error</span>(<span class="hl-literal">"assertion failed"</span>)

<span class="hl-comment">-- Fail with the error message: "assertion failed"</span>
<span class="hl-variable">assert</span>(<span class="hl-literal">false</span>)</pre>
                            </p></dd><dt><span class="term">
                            <code class="code">(+)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (+)(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span>+<span class="hl-variable">b</span></code> returns the sum of <code class="code"><span class="hl-variable">a</span></code> and <code class="code"><span class="hl-variable">b</span></code>.</p></dd><dt><span class="term">
                            <code class="code">(-)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (-)(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span>-<span class="hl-variable">b</span></code> returns the value of <code class="code"><span class="hl-variable">a</span></code> minus the value of <code class="code"><span class="hl-variable">b</span></code>.</p></dd><dt><span class="term">
                            <code class="code">(<span class="hl-literal">0</span>-)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (<span class="hl-literal">0</span>-)(<span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>Return the additive inverse of the argument.
When this site appears as an operator, it is written in prefix form without the
zero, i.e. <code class="code">(-<span class="hl-variable">a</span>)</code>
                            </p></dd><dt><span class="term">
                            <code class="code">(*)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (*)(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span>*<span class="hl-variable">b</span></code> returns the product of <code class="code"><span class="hl-variable">a</span></code> and <code class="code"><span class="hl-variable">b</span></code>.</p></dd><dt><span class="term">
                            <code class="code">(**)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (**)(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span> ** <span class="hl-variable">b</span></code> returns
<span class="mathphrase">a<sup>b</sup>
                                    </span>,
i.e. <code class="code"><span class="hl-variable">a</span></code> raised to the <code class="code"><span class="hl-variable">b</span></code>th power.</p></dd><dt><span class="term">
                            <code class="code">(/)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (/)(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>

                                <code class="code"><span class="hl-variable">a</span>/<span class="hl-variable">b</span></code> returns <code class="code"><span class="hl-variable">a</span></code> divided by <code class="code"><span class="hl-variable">b</span></code>.
If both arguments have integral types, <code class="code">(/)</code> performs integral
division, rounding towards zero. Otherwise, it performs floating-point
division. If <code class="code"><span class="hl-variable">b</span>=<span class="hl-literal">0</span></code>, <code class="code"><span class="hl-variable">a</span>/<span class="hl-variable">b</span></code> halts with an error.</p><p>Example:
<pre class="orc">
  <span class="hl-literal">7</span>/<span class="hl-literal">3</span>   <span class="hl-comment">-- publishes 2</span>
<span class="hl-combinator">|</span> <span class="hl-literal">7</span>/<span class="hl-literal">3.0</span> <span class="hl-comment">-- publishes 2.333...</span></pre>
                            </p></dd><dt><span class="term">
                            <code class="code">(%)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (%)(<span class="hl-variable">Number</span>, <span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>

                                <code class="code"><span class="hl-variable">a</span>%<span class="hl-variable">b</span></code> computes the remainder of <code class="code"><span class="hl-variable">a</span>/<span class="hl-variable">b</span></code>. If <code class="code"><span class="hl-variable">a</span></code>
and <code class="code"><span class="hl-variable">b</span></code> have integral types, then the remainder is given by
the expression <code class="code"><span class="hl-variable">a</span> - (<span class="hl-variable">a</span>/<span class="hl-variable">b</span>)*<span class="hl-variable">b</span></code>. For a full description, see the
<a class="link" href="http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#15.17.3" target="_top">Java Language Specification, 3rd edition</a>.</p></dd><dt><span class="term">
                            <code class="code">(&lt;)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (&lt;)(<span class="hl-variable">Comparable</span>, <span class="hl-variable">Comparable</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span> &lt; <span class="hl-variable">b</span></code> returns true if <code class="code"><span class="hl-variable">a</span></code> is less than <code class="code"><span class="hl-variable">b</span></code>, and false otherwise.</p></dd><dt><span class="term">
                            <code class="code">(<span class="hl-site">&lt;=</span>)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (<span class="hl-site">&lt;=</span>)(<span class="hl-variable">Comparable</span>, <span class="hl-variable">Comparable</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span> <span class="hl-site">&lt;=</span> <span class="hl-variable">b</span></code> returns true if <code class="code"><span class="hl-variable">a</span></code> is less than or equal to <code class="code"><span class="hl-variable">b</span></code>, and false otherwise.</p></dd><dt><span class="term">
                            <code class="code">(&gt;)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (&gt;)(<span class="hl-variable">Comparable</span>, <span class="hl-variable">Comparable</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span> &gt; <span class="hl-variable">b</span></code> returns true if <code class="code"><span class="hl-variable">a</span></code> is greater than <code class="code"><span class="hl-variable">b</span></code>, and false otherwise.</p></dd><dt><span class="term">
                            <code class="code">(<span class="hl-site">&gt;=</span>)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (<span class="hl-site">&gt;=</span>)(<span class="hl-variable">Comparable</span>, <span class="hl-variable">Comparable</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span> <span class="hl-site">&gt;=</span> <span class="hl-variable">b</span></code> returns true if <code class="code"><span class="hl-variable">a</span></code> is greater than or equal to <code class="code"><span class="hl-variable">b</span></code>, and false otherwise.</p></dd><dt><span class="term">
                            <code class="code">(=)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (=)(<span class="hl-variable">Top</span>, <span class="hl-variable">Top</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>

                                <code class="code"><span class="hl-variable">a</span> = <span class="hl-variable">b</span></code> returns true if <code class="code"><span class="hl-variable">a</span></code> is equal to <code class="code"><span class="hl-variable">b</span></code>,
and false otherwise.  The precise definition of "equal" depends on the values
being compared, but always obeys the rule that if two values are considered
equal, then one may be substituted locally for the other without affecting the
behavior of the program.</p><p>Two values with the same object identity are always considered equal.
In addition, Cor <a class="link" href="#cor.constants" title="1.2.1.&nbsp;Constants">constant values</a> and <a class="link" href="#cor.data" title="1.2.5.&nbsp;Data Structures">data structures</a> are considered equal if their
contents are equal. Other types are free to implement their own equality
relationship provided it conforms to the rules given here.</p><p>Note that although values of different types may be compared with
<code class="code">=</code>, the substitutability principle requires that such values are
always considered inequal, i.e. the comparison will return <code class="code"><span class="hl-literal">false</span></code>.</p></dd><dt><span class="term">
                            <code class="code">(/=)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (/=)(<span class="hl-variable">Top</span>, <span class="hl-variable">Top</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span>/=<span class="hl-variable">b</span></code> returns false if <code class="code"><span class="hl-variable">a</span>=<span class="hl-variable">b</span></code>, and true otherwise.</p></dd><dt><span class="term">
                            <code class="code">(~)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (~)(<span class="hl-variable">Boolean</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return the logical negation of the argument.</p></dd><dt><span class="term">
                            <code class="code">(&amp;&amp;)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (&amp;&amp;)(<span class="hl-variable">Boolean</span>, <span class="hl-variable">Boolean</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return the logical conjunction of the arguments. This is not a short-circuiting
operator; both arguments must be evaluated and available before the result is
computed.</p></dd><dt><span class="term">
                            <code class="code">(<span class="hl-site">||</span>)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (<span class="hl-site">||</span>)(<span class="hl-variable">Boolean</span>, <span class="hl-variable">Boolean</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return the logical disjunction of the arguments. This is not a short-circuiting
operator; both arguments must be evaluated and available before the result is
computed.</p></dd><dt><span class="term">
                            <code class="code">(:)</code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> (:)(<span class="hl-variable">A</span>, [<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>]</code>
                            </p><p>
                                <code class="code"><span class="hl-variable">a</span>:<span class="hl-variable">b</span></code> returns the list formed by prepending the element <code class="code"><span class="hl-variable">a</span></code>
to the list <code class="code"><span class="hl-variable">b</span></code>.</p><div class="variablelist"><dl><dt><span class="term">
                                    <code class="code">(:)</code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">pattern</span> (:)([<span class="hl-variable">A</span>]) :: (<span class="hl-variable">A</span>, [<span class="hl-variable">A</span>])</code>

                                    </p><p>The inverse of the list constructor <code class="code">(:)</code>. Returns the head and tail
of the list.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: (3, [4, 5])</span>
[<span class="hl-literal">3</span>,<span class="hl-literal">4</span>,<span class="hl-literal">5</span>] <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span>:<span class="hl-variable">xs</span><span class="hl-combinator">&gt;</span> (<span class="hl-variable">x</span>,<span class="hl-variable">xs</span>)</pre>
                                    </p></dd></dl></div></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">abs</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">abs</span>(<span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>Return the absolute value of the argument.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">signum</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">signum</span>(<span class="hl-variable">Number</span>) :: <span class="hl-variable">Number</span></code>
                            </p><p>
                                <code class="code"><span class="hl-variable">signum</span>(<span class="hl-variable">a</span>)</code> returns <code class="code">-<span class="hl-literal">1</span></code> if <code class="code"><span class="hl-variable">a</span>&lt;<span class="hl-literal">0</span></code>,
<code class="code"><span class="hl-literal">1</span></code> if <code class="code"><span class="hl-variable">a</span>&gt;<span class="hl-literal">0</span></code>, and <code class="code"><span class="hl-literal">0</span></code> if <code class="code"><span class="hl-variable">a</span>=<span class="hl-literal">0</span></code>.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">min</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">min</span>(<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, <span class="hl-variable">A</span> <span class="hl-site">&lt;:</span> <span class="hl-variable">Comparable</span></code>
                            </p><p>Return the lesser of the arguments. If the arguments
are equal, return the first argument.</p><p>Recall that the type constraint <code class="code"><span class="hl-variable">A</span> <span class="hl-site">&lt;:</span> <span class="hl-variable">Comparable</span></code>
means that <code class="code"><span class="hl-variable">min</span></code> can only be applied to arguments
which are subtypes of <code class="code"><span class="hl-variable">Comparable</span></code>; in other words,
they must have a total order.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">max</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">max</span>(<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, <span class="hl-variable">A</span> <span class="hl-site">&lt;:</span> <span class="hl-variable">Comparable</span></code>
                            </p><p>Return the greater of the arguments. If the arguments
are equal, return the second argument.</p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11466"></a>B.3.2.&nbsp;data.inc: General-purpose supplemental data structures.</h3></div></div></div><p>General-purpose supplemental data structures.</p><div class="variablelist"><dl><dt><span class="term">
                            <code class="code"><span class="hl-variable">Semaphore</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Semaphore</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Semaphore</span></code>

                            </p><p>Return a semaphore with the given value. The semaphore maintains the invariant
that its value is always non-negative.</p><p>An example using a semaphore as a lock for a critical section:
<pre class="orc">
<span class="hl-comment">-- Prints:</span>
<span class="hl-comment">-- Entering critical section</span>
<span class="hl-comment">-- Leaving critical section</span>
<span class="hl-keyword">val</span> <span class="hl-variable">lock</span> = <span class="hl-variable">Semaphore</span>(<span class="hl-literal">1</span>)
<span class="hl-variable">lock</span>.<span class="hl-variable">acquire</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
<span class="hl-variable">println</span>(<span class="hl-literal">"Entering critical section"</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
<span class="hl-variable">println</span>(<span class="hl-literal">"Leaving critical section"</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
<span class="hl-variable">lock</span>.<span class="hl-variable">release</span>()</pre>
                            </p><div class="variablelist"><dl><dt><span class="term">
                                    <code class="code"><span class="hl-variable">acquire</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Semaphore</span>.<span class="hl-variable">acquire</span>() :: <span class="hl-variable">Signal</span></code>
                                    </p><p>If the semaphore's value is greater than <code class="code"><span class="hl-literal">0</span></code>, decrement the semaphore and return a signal.
If the semaphore's value is <code class="code"><span class="hl-literal">0</span></code>, block until it becomes greater than <code class="code"><span class="hl-literal">0</span></code>.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">acquirenb</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Semaphore</span>.<span class="hl-variable">acquirenb</span>() :: <span class="hl-variable">Signal</span></code>
                                    </p><p>If the semaphore's value is greater than <code class="code"><span class="hl-literal">0</span></code>, decrement the semaphore and return a signal.
If the semaphore's value is <code class="code"><span class="hl-literal">0</span></code>, halt.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">release</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Semaphore</span>.<span class="hl-variable">release</span>() :: <span class="hl-variable">Signal</span></code>
                                    </p><p>If any calls to <code class="code"><span class="hl-variable">acquire</span></code> are blocked, allow the oldest such call
to return.  Otherwise, increment the value of the semaphore.  This may
increment the value beyond that with which the semaphore was constructed.</p></dd></dl></div></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">Buffer</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Buffer</span>() :: <span class="hl-variable">Buffer</span>&lt;<span class="hl-variable">A</span>&gt;</code>

                            </p><p>Create a new buffer (FIFO channel) of unlimited size.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 10</span>
<span class="hl-keyword">val</span> <span class="hl-variable">b</span> = <span class="hl-variable">Buffer</span>()
  <span class="hl-variable">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">b</span>.<span class="hl-variable">put</span>(<span class="hl-literal">10</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span>
<span class="hl-combinator">|</span> <span class="hl-variable">b</span>.<span class="hl-variable">get</span>()</pre>
                            </p><div class="variablelist"><dl><dt><span class="term">
                                    <code class="code"><span class="hl-variable">get</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Buffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">get</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Get an item from the buffer. If no items are available, block until one becomes available.</p><p>Recall that the type signature <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Buffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">get</span>() :: <span class="hl-variable">A</span></code> means that
when the <code class="code"><span class="hl-variable">get</span></code> method is called on a buffer holding an arbitrary
element type <code class="code"><span class="hl-variable">A</span></code>, it will return a value of the same type.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">getnb</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Buffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">getnb</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Get an item from the buffer. If no items are available, halt.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">put</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Buffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">put</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Signal</span></code>
                                    </p><p>Put an item in the buffer.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">close</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Buffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">close</span>() :: <span class="hl-variable">Signal</span></code>
                                    </p><p>Close the buffer and block until it is empty.
This has the effect of immediately causing any blocked calls to
<code class="code"><span class="hl-variable">get</span></code> to halt. In addition, any subsequent calls to <code class="code"><span class="hl-variable">put</span></code>
will halt, and once the buffer becomes empty, any subsequent calls to
<code class="code"><span class="hl-variable">get</span></code> will halt.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">closenb</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Buffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">closenb</span>() :: <span class="hl-variable">Signal</span></code>
                                    </p><p>Close the buffer and return a signal immediately.
This has the effect of immediately causing any blocked calls to
<code class="code"><span class="hl-variable">get</span></code> to halt. In addition, any subsequent calls to <code class="code"><span class="hl-variable">put</span></code>
will halt, and once the buffer becomes empty, any subsequent calls to
<code class="code"><span class="hl-variable">get</span></code> will halt.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">isClosed</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Buffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">isClosed</span>() :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>If the buffer is currently closed, return true, otherwise return false.</p></dd></dl></div></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">BoundedBuffer</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">BoundedBuffer</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">BoundedBuffer</span>&lt;<span class="hl-variable">A</span>&gt;</code>

                            </p><p>Create a new buffer (FIFO channel) with the given number of slots.
Putting an item into the buffer fills a slot, and removing an item opens a slot.
A buffer with zero slots is equivalent to a
<a class="link" href="#orc.lib.state.SyncChannel">synchronous channel</a>.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: "Put 1" "Got 1" "Put 2" "Got 2"</span>
<span class="hl-keyword">val</span> <span class="hl-variable">c</span> = <span class="hl-variable">BoundedBuffer</span>(<span class="hl-literal">1</span>)
  <span class="hl-variable">c</span>.<span class="hl-variable">put</span>(<span class="hl-literal">1</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Put "</span> + <span class="hl-literal">1</span>
<span class="hl-combinator">|</span> <span class="hl-variable">c</span>.<span class="hl-variable">put</span>(<span class="hl-literal">2</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Put "</span> + <span class="hl-literal">2</span>
<span class="hl-combinator">|</span> <span class="hl-variable">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> (
    <span class="hl-variable">c</span>.<span class="hl-variable">get</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">n</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Got "</span> + <span class="hl-variable">n</span>
  <span class="hl-combinator">|</span> <span class="hl-variable">c</span>.<span class="hl-variable">get</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">n</span><span class="hl-combinator">&gt;</span> <span class="hl-literal">"Got "</span> + <span class="hl-variable">n</span>
  )</pre>
                            </p><div class="variablelist"><dl><dt><span class="term">
                                    <code class="code"><span class="hl-variable">get</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">BoundedBuffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">get</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Get an item from the buffer. If no items are available, block until one becomes available.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">getnb</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">BoundedBuffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">getnb</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Get an item from the buffer. If no items are available, halt.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">put</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">BoundedBuffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">put</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Signal</span></code>
                                    </p><p>Put an item in the buffer. If no slots are open, block until one becomes open.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">putnb</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">BoundedBuffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">putnb</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Signal</span></code>
                                    </p><p>Put an item in the buffer. If no slots are open, halt.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">close</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">BoundedBuffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">close</span>() :: <span class="hl-variable">Signal</span></code>
                                    </p><p>Close the buffer and block until it is empty.
This has the effect of immediately causing any blocked calls to
<code class="code"><span class="hl-variable">get</span></code> to halt. In addition, any subsequent calls to <code class="code"><span class="hl-variable">put</span></code>
will halt, and once the buffer becomes empty, any subsequent calls to
<code class="code"><span class="hl-variable">get</span></code> will halt.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">closenb</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">BoundedBuffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">closenb</span>() :: <span class="hl-variable">Signal</span></code>
                                    </p><p>Close the buffer and return a signal immediately.
This has the effect of immediately causing any blocked calls to
<code class="code"><span class="hl-variable">get</span></code> to halt. In addition, any subsequent calls to <code class="code"><span class="hl-variable">put</span></code>
will halt, and once the buffer becomes empty, any subsequent calls to
<code class="code"><span class="hl-variable">get</span></code> will halt.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">isClosed</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">BoundedBuffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">isClosed</span>() :: <span class="hl-variable">Boolean</span></code>
                                    </p><p>If the buffer is currently closed, return true, otherwise return false.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">getOpen</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">BoundedBuffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">getOpen</span>() :: <span class="hl-variable">Integer</span></code>
                                    </p><p>Return the number of open slots in the buffer. Because of concurrency
this value may become out-of-date so it should only be used for debugging
or statistical measurements.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">getBound</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">BoundedBuffer</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">getBound</span>() :: <span class="hl-variable">Integer</span></code>
                                    </p><p>Return the total number of slots (open or filled) in the buffer.</p></dd></dl></div></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">SyncChannel</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">SyncChannel</span>() :: <span class="hl-variable">SyncChannel</span>&lt;<span class="hl-variable">A</span>&gt;</code>
                            </p><p>
<p><a name="orc.lib.state.SyncChannel"></a>
Create a synchronous channel, or rendezvous.
</p>
                            </p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publish: 10</span>
<span class="hl-keyword">val</span> <span class="hl-variable">c</span> = <span class="hl-variable">SyncChannel</span>()
  <span class="hl-variable">c</span>.<span class="hl-variable">put</span>(<span class="hl-literal">10</span>)
<span class="hl-combinator">|</span> <span class="hl-variable">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">c</span>.<span class="hl-variable">get</span>()</pre>
                            </p><div class="variablelist"><dl><dt><span class="term">
                                    <code class="code"><span class="hl-variable">get</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">SyncChannel</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">get</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Receive an item over the channel. If no sender is available, block until one becomes available.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">put</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">SyncChannel</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">put</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Signal</span></code>
                                    </p><p>Send an item over the channel. If no receiver is available, block until one becomes available.</p></dd></dl></div></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">Cell</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Cell</span>() :: <span class="hl-variable">Cell</span>&lt;<span class="hl-variable">A</span>&gt;</code>

                            </p><p>Create a write-once storage location.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 5 5</span>
<span class="hl-keyword">val</span> <span class="hl-variable">c</span> = <span class="hl-variable">Cell</span>()
  <span class="hl-variable">c</span>.<span class="hl-variable">write</span>(<span class="hl-literal">5</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">c</span>.<span class="hl-variable">read</span>()
<span class="hl-combinator">|</span> <span class="hl-variable">Rtimer</span>(<span class="hl-literal">1</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> ( <span class="hl-variable">c</span>.<span class="hl-variable">write</span>(<span class="hl-literal">10</span>) <span class="hl-combinator">;</span> <span class="hl-variable">c</span>.<span class="hl-variable">read</span>() )</pre>
                            </p><div class="variablelist"><dl><dt><span class="term">
                                    <code class="code"><span class="hl-variable">read</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Cell</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">read</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Read a value from the cell. If the cell does not yet have a value, block until it receives one.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">readnb</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Cell</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">readnb</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Read a value from the cell. If the cell does not yet have a value, halt.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">write</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Cell</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">write</span>() :: <span class="hl-variable">Signal</span></code>
                                    </p><p>Write a value to the cell. If the cell already has a value, halt.</p></dd></dl></div></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">Ref</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Ref</span>() :: <span class="hl-variable">Ref</span>&lt;<span class="hl-variable">A</span>&gt;</code>

                            </p><p>Create a rewritable storage location without an initial value.</p><p>Example:
<pre class="orc">
<span class="hl-keyword">val</span> <span class="hl-variable">r</span> = <span class="hl-variable">Ref</span>()
<span class="hl-variable">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">r</span>.<span class="hl-variable">write</span>(<span class="hl-literal">5</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span>
<span class="hl-combinator">|</span> <span class="hl-variable">println</span>(<span class="hl-variable">r</span>.<span class="hl-variable">read</span>()) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-variable">r</span>.<span class="hl-variable">write</span>(<span class="hl-literal">10</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-variable">println</span>(<span class="hl-variable">r</span>.<span class="hl-variable">read</span>()) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
  <span class="hl-keyword">stop</span></pre>
                            </p><div class="variablelist"><dl><dt><span class="term">
                                    <code class="code"><span class="hl-variable">Ref</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Ref</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Ref</span>&lt;<span class="hl-variable">A</span>&gt;</code>
                                    </p><p>Create a rewritable storage location initialized to the provided value.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">read</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Ref</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">read</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Read the value of the ref. If the ref does not yet have a value, block until it receives one.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">readnb</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Ref</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">readnb</span>() :: <span class="hl-variable">A</span></code>
                                    </p><p>Read the value of the ref. If the ref does not yet have a value, halt.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">write</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Ref</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">write</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Signal</span></code>
                                    </p><p>Write a value to the ref.</p></dd></dl></div></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">Null</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Null</span>() :: <span class="hl-variable">Bot</span></code>
                            </p><p>Return a Java null value. This is only necessary to interface with certain
Java libraries, Orc programs should use the <code class="code"><span class="hl-variable">None</span>()</code> constructor
instead of null values.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">Array</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Array</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Array</span>&lt;<span class="hl-variable">A</span>&gt;</code>

                            </p><p>Create a new native array of the given size.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 0 1 2</span>
<span class="hl-keyword">val</span> <span class="hl-variable">a</span> = <span class="hl-variable">Array</span>(<span class="hl-literal">3</span>)
<span class="hl-variable">for</span>(<span class="hl-literal">0</span>, <span class="hl-variable">a</span>.<span class="hl-variable">length</span>()) <span class="hl-combinator">&gt;</span><span class="hl-variable">i</span><span class="hl-combinator">&gt;</span>
<span class="hl-variable">a</span>.<span class="hl-variable">set</span>(<span class="hl-variable">i</span>, <span class="hl-variable">f</span>(<span class="hl-variable">i</span>)) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
<span class="hl-keyword">stop</span>
<span class="hl-combinator">;</span> <span class="hl-variable">a</span>.<span class="hl-variable">get</span>(<span class="hl-literal">0</span>) <span class="hl-combinator">|</span> <span class="hl-variable">a</span>.<span class="hl-variable">get</span>(<span class="hl-literal">1</span>) <span class="hl-combinator">|</span> <span class="hl-variable">a</span>.<span class="hl-variable">get</span>(<span class="hl-literal">2</span>)</pre>
                            </p><div class="variablelist"><dl><dt><span class="term">
                                    <code class="code"><span class="hl-variable">Array</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Array</span>(<span class="hl-variable">Integer</span>, <span class="hl-variable">String</span>) :: <span class="hl-variable">Array</span>&lt;<span class="hl-variable">A</span>&gt;</code>
                                    </p><p>Create a new primitive array of the given size with the given primitive type.
The primitive type should match the element type of the array, although a
typechecker may not be able to verify this. This constructor is only necessary
when interfacing with certain Java libraries; most programs will just use the 
<code class="code"><span class="hl-variable">Array</span>(<span class="hl-variable">Integer</span>)</code> constructor.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">get</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Array</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">get</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span></code>
                                    </p><p>Get the element of the array given by the index, counting from 0.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">set</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Array</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">set</span>(<span class="hl-variable">Integer</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">Signal</span></code>
                                    </p><p>Set the element of the array given by the index, counting from 0.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">slice</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Array</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">slice</span>(<span class="hl-variable">Integer</span>, <span class="hl-variable">Integer</span>) :: <span class="hl-variable">Array</span>&lt;<span class="hl-variable">A</span>&gt;</code>
                                    </p><p>Return a copy of the portion of the array with indices covered by the given
half-open range. The result array is still indexed counting from 0.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">length</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Array</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">length</span>() :: <span class="hl-variable">Integer</span></code>
                                    </p><p>Return the size of the array.</p></dd><dt><span class="term">
                                    <code class="code"><span class="hl-variable">fill</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Array</span>&lt;<span class="hl-variable">A</span>&gt;.<span class="hl-variable">fill</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Signal</span></code>

                                    </p><p>Set every element of the array to the given value. The given value is not
copied, but is shared by every element of the array, so for example
<code class="code"><span class="hl-variable">a</span>.<span class="hl-variable">fill</span>(<span class="hl-variable">Semaphore</span>(<span class="hl-literal">1</span>))</code> would allow you to access the same semaphore
from every element <code class="code"><span class="hl-variable">a</span></code>.</p><p>This method is primarily useful to initialize or reset an array to a constant
value,
for example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 0 0 0</span>
<span class="hl-keyword">val</span> <span class="hl-variable">a</span> = <span class="hl-variable">Array</span>(<span class="hl-literal">3</span>)
<span class="hl-variable">a</span>.<span class="hl-variable">fill</span>(<span class="hl-literal">0</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">each</span>(<span class="hl-variable">a</span>)</pre>
                                    </p></dd></dl></div></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">IArray</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">IArray</span>(<span class="hl-variable">Integer</span>, <span class="hl-keyword">lambda</span> (<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span>)(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>The call <code class="code"><span class="hl-variable">IArray</span>(<span class="hl-variable">n</span>,<span class="hl-variable">f</span>)</code>, where <code class="code"><span class="hl-variable">n</span></code> is a
natural number and <code class="code"><span class="hl-variable">f</span></code> a total function over natural numbers,
creates and returns a partial, pre-computed version of <code class="code"><span class="hl-variable">f</span></code>
restricted to the range (0, <code class="code"><span class="hl-variable">n</span></code>-1). If <code class="code"><span class="hl-variable">f</span></code> halts
on any number in this range, the call to <code class="code"><span class="hl-variable">IArray</span></code> will halt.</p><p>The user may also think of the call as returning an array whose
<code class="code"><span class="hl-variable">i</span></code>th element is <code class="code"><span class="hl-variable">f</span>(<span class="hl-variable">i</span>)</code>.</p><p>This function provides a simple form of memoisation; we avoid recomputing
the value of <code class="code"><span class="hl-variable">f</span>(<span class="hl-variable">i</span>)</code> by storing the result in an array.</p><p>Example:
<pre class="programlisting">
<span class="hl-keyword">val</span> <span class="hl-variable">a</span> = <span class="hl-variable">IArray</span>(<span class="hl-literal">5</span>, <span class="hl-variable">fib</span>)
<span class="hl-comment">-- Publishes the 4th number of the fibonnaci sequence: 5</span>
<span class="hl-variable">a</span>(<span class="hl-literal">3</span>)</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">Some</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Some</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Option</span>&lt;<span class="hl-variable">A</span>&gt;</code>
                            </p><p>Construct an available optional value.</p><div class="variablelist"><dl><dt><span class="term">
                                    <code class="code"><span class="hl-variable">Some</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">pattern</span> <span class="hl-variable">Some</span>(<span class="hl-variable">Option</span>&lt;<span class="hl-variable">A</span>&gt;) :: (<span class="hl-variable">A</span>)</code>

                                    </p><p>Deconstruct an available optional value.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 3</span>
<span class="hl-variable">Some</span>(<span class="hl-literal">3</span>) <span class="hl-combinator">&gt;</span><span class="hl-variable">Some</span>(<span class="hl-variable">x</span>)<span class="hl-combinator">&gt;</span> <span class="hl-variable">x</span></pre>
                                    </p></dd></dl></div></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">None</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">None</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Option</span>&lt;<span class="hl-variable">A</span>&gt;</code>
                            </p><p>Construct an unavailable optional value.</p><div class="variablelist"><dl><dt><span class="term">
                                    <code class="code"><span class="hl-variable">None</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">pattern</span> <span class="hl-variable">None</span>(<span class="hl-variable">Option</span>&lt;<span class="hl-variable">A</span>&gt;) :: ()</code>

                                    </p><p>Deconstruct an unavailable optional value.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: true</span>
  <span class="hl-variable">None</span>() <span class="hl-combinator">&gt;</span><span class="hl-variable">None</span>()<span class="hl-combinator">&gt;</span> <span class="hl-literal">true</span>
<span class="hl-combinator">|</span> <span class="hl-variable">Some</span>(<span class="hl-literal">3</span>) <span class="hl-combinator">&gt;</span><span class="hl-variable">None</span>()<span class="hl-combinator">&gt;</span> <span class="hl-literal">false</span></pre>
                                    </p></dd></dl></div></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">Left</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Left</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Either</span>&lt;<span class="hl-variable">A</span>&gt;</code>
                            </p><p>Construct a "left" member of a union which may be tagged either "left" or "right".</p><div class="variablelist"><dl><dt><span class="term">
                                    <code class="code"><span class="hl-variable">Left</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">pattern</span> <span class="hl-variable">Left</span>(<span class="hl-variable">Either</span>&lt;<span class="hl-variable">A</span>&gt;) :: <span class="hl-variable">A</span></code>

                                    </p><p>Deconstruct a "left" member of a union.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: "left"</span>
<span class="hl-variable">Left</span>(<span class="hl-literal">3</span>) <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> (
   <span class="hl-variable">x</span> <span class="hl-combinator">&gt;</span><span class="hl-variable">Right</span>(<span class="hl-variable">_</span>)<span class="hl-combinator">&gt;</span> <span class="hl-literal">"right"</span>
 <span class="hl-combinator">|</span> <span class="hl-variable">x</span> <span class="hl-combinator">&gt;</span><span class="hl-variable">Left</span>(<span class="hl-variable">_</span>)<span class="hl-combinator">&gt;</span> <span class="hl-literal">"left"</span>
)</pre>
                                    </p></dd></dl></div></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">Right</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Right</span>(<span class="hl-variable">A</span>) :: <span class="hl-variable">Either</span>&lt;<span class="hl-variable">A</span>&gt;</code>
                            </p><p>Construct a "right" member of a union which may be tagged either "left" or "right".</p><div class="variablelist"><dl><dt><span class="term">
                                    <code class="code"><span class="hl-variable">Right</span></code>
                                    </span></dt><dd><p>
                                    <code class="code"><span class="hl-keyword">pattern</span> <span class="hl-variable">Right</span>(<span class="hl-variable">Either</span>&lt;<span class="hl-variable">A</span>&gt;) :: <span class="hl-variable">A</span></code>

                                    </p><p>Deconstruct a "right" member of a union.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: "right"</span>
<span class="hl-variable">Right</span>(<span class="hl-literal">3</span>) <span class="hl-combinator">&gt;</span><span class="hl-variable">x</span><span class="hl-combinator">&gt;</span> (
   <span class="hl-variable">x</span> <span class="hl-combinator">&gt;</span><span class="hl-variable">Right</span>(<span class="hl-variable">_</span>)<span class="hl-combinator">&gt;</span> <span class="hl-literal">"right"</span>
 <span class="hl-combinator">|</span> <span class="hl-variable">x</span> <span class="hl-combinator">&gt;</span><span class="hl-variable">Left</span>(<span class="hl-variable">_</span>)<span class="hl-combinator">&gt;</span> <span class="hl-literal">"left"</span>
)</pre>
                                    </p></dd></dl></div></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">fst</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">fst</span>((<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)) :: <span class="hl-variable">A</span></code>
                            </p><p>Return the first element of a pair.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">snd</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">snd</span>((<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)) :: <span class="hl-variable">B</span></code>
                            </p><p>Return the second element of a pair.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">swap</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">swap</span>((<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)) :: (<span class="hl-variable">B</span>,<span class="hl-variable">A</span>)</code>
                            </p><p>Swap the elements of a pair.</p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11821"></a>B.3.3.&nbsp;idioms.inc: Higher-order Orc programming idioms.</h3></div></div></div><p>Higher-order Orc programming idioms.
Many of these are standard functional-programming
combinators borrowed from Haskell or Scheme.</p><div class="variablelist"><dl><dt><span class="term">
                            <code class="code"><span class="hl-variable">apply</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">apply</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, ...) :: <span class="hl-variable">B</span>, [<span class="hl-variable">A</span>]) :: <span class="hl-variable">B</span></code>
                            </p><p>Apply a function to a list of arguments.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">curry</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">curry</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>)(<span class="hl-variable">A</span>)(<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span></code>
                            </p><p>Curry a function of two arguments.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">curry3</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">curry3</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>) :: <span class="hl-variable">D</span>)(<span class="hl-variable">A</span>)(<span class="hl-variable">B</span>)(<span class="hl-variable">C</span>) :: <span class="hl-variable">D</span></code>
                            </p><p>Curry a function of three arguments.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">uncurry</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">uncurry</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>)(<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>)(<span class="hl-variable">A</span>, <span class="hl-variable">B</span>) :: <span class="hl-variable">C</span></code>
                            </p><p>Uncurry a function of two arguments.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">uncurry3</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">uncurry3</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>)(<span class="hl-variable">B</span>)(<span class="hl-variable">C</span>) :: <span class="hl-variable">D</span>)(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>,<span class="hl-variable">C</span>) :: <span class="hl-variable">D</span></code>
                            </p><p>Uncurry a function of three arguments.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">flip</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">flip</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>)(<span class="hl-variable">B</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">C</span></code>
                            </p><p>Flip the order of parameters of a two-argument function.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">constant</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">constant</span>(<span class="hl-variable">A</span>)() :: <span class="hl-variable">A</span></code>
                            </p><p>Create a function which returns a constant value.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">defer</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">defer</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-variable">A</span>)() :: <span class="hl-variable">B</span></code>
                            </p><p>Given a function and its argument, return a thunk which applies the function.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">defer2</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">defer2</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>, <span class="hl-variable">A</span>, <span class="hl-variable">B</span>)() :: <span class="hl-variable">C</span></code>
                            </p><p>Given a function and its arguments, return a thunk which applies the function.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">ignore</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">ignore</span>(<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">B</span>)(<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span></code>
                            </p><p>From a function of no arguments, create a function
of one argument, which is ignored.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">ignore2</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">ignore2</span>(<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">C</span>)(<span class="hl-variable">A</span>, <span class="hl-variable">B</span>) :: <span class="hl-variable">C</span></code>
                            </p><p>From a function of no arguments, create a function
of two arguments, which are ignored.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">compose</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">compose</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">B</span>) :: <span class="hl-variable">C</span>, <span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>)(<span class="hl-variable">A</span>) :: <span class="hl-variable">C</span></code>
                            </p><p>Compose two single-argument functions.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">while</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">while</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>)(<span class="hl-variable">A</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>Iterate a function while a predicate is satisfied, publishing
each value passed to the function. The exact behavior is specified
by the following implementation:</p><p>
                                <pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-variable">while</span>(<span class="hl-variable">p</span>,<span class="hl-variable">f</span>) = 
  <span class="hl-keyword">def</span> <span class="hl-variable">loop</span>(<span class="hl-variable">x</span>) = <span class="hl-keyword">if</span>(<span class="hl-variable">p</span>(<span class="hl-variable">x</span>)) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> ( <span class="hl-variable">x</span> <span class="hl-combinator">|</span> <span class="hl-variable">loop</span>(<span class="hl-variable">f</span>(<span class="hl-variable">x</span>)) )
  <span class="hl-variable">loop</span></pre>
                            </p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 0 1 2 3 4 5</span>
<span class="hl-variable">while</span>(
  <span class="hl-keyword">lambda</span> (<span class="hl-variable">n</span>) = (<span class="hl-variable">n</span> <span class="hl-site">&lt;=</span> <span class="hl-literal">5</span>),
  <span class="hl-keyword">lambda</span> (<span class="hl-variable">n</span>) = <span class="hl-variable">n</span>+<span class="hl-literal">1</span>
)(<span class="hl-literal">0</span>)</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">repeat</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">repeat</span>(<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span></code>
                            </p><p>Call a function sequentially, publishing each value returned by the function.
The expression <code class="code"><span class="hl-variable">repeat</span>(<span class="hl-variable">f</span>)</code> is equivalent to
the infinite expression <code class="code"><span class="hl-variable">f</span>() <span class="hl-combinator">&gt;</span>!<span class="hl-variable">_</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">f</span>() <span class="hl-combinator">&gt;</span>!<span class="hl-variable">_</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">f</span>() <span class="hl-combinator">&gt;</span>!<span class="hl-variable">_</span><span class="hl-combinator">&gt;</span> ...</code>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">fork</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">fork</span>([<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Call a list of functions in parallel, publishing
all values published by the functions.</p><p>The expression <code class="code"><span class="hl-variable">fork</span>([<span class="hl-variable">f</span>,<span class="hl-variable">g</span>,<span class="hl-variable">h</span>])</code> is equivalent to
the expression <code class="code"><span class="hl-variable">f</span>() <span class="hl-combinator">|</span> <span class="hl-variable">g</span>() <span class="hl-combinator">|</span> <span class="hl-variable">h</span>()</code>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">sequence</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">sequence</span>([<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>]) :: <span class="hl-variable">Signal</span></code>
                            </p><p>Call a list of functions in sequence, publishing
a signal whenever the last function publishes. The
actual publications of the given functions are not
published.</p><p>The expression <code class="code"><span class="hl-variable">sequence</span>([<span class="hl-variable">f</span>,<span class="hl-variable">g</span>,<span class="hl-variable">h</span>])</code> is equivalent to
the expression <code class="code"><span class="hl-variable">f</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">g</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">h</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">signal</span></code>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">join</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">join</span>([<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>]) :: <span class="hl-variable">Signal</span></code>
                            </p><p>Call a list of functions in parallel and publish
a signal once all functions have completed.</p><p>The expression <code class="code"><span class="hl-variable">join</span>([<span class="hl-variable">f</span>,<span class="hl-variable">g</span>,<span class="hl-variable">h</span>])</code> is equivalent to
the expression <code class="code"><span class="hl-variable">f</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span> <span class="hl-combinator">|</span> <span class="hl-variable">g</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span> <span class="hl-combinator">|</span> <span class="hl-variable">h</span>() <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span> <span class="hl-combinator">;</span> <span class="hl-keyword">signal</span></code>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">por</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">por</span>(<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">Boolean</span>, <span class="hl-keyword">lambda</span> () :: <span class="hl-variable">Boolean</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Parallel or. Evaluate two boolean functions in parallel, publishing
a value as soon as possible, and terminating any unnecessary ongoing
computation.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">pand</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">pand</span>(<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">Boolean</span>, <span class="hl-keyword">lambda</span> () :: <span class="hl-variable">Boolean</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Parallel and. Evaluate two boolean functions in parallel, publishing
a value as soon as possible, and terminating any unnecessary ongoing
computation.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">collect</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">collect</span>(<span class="hl-keyword">lambda</span> () :: <span class="hl-variable">A</span>) :: [<span class="hl-variable">A</span>]</code>

                            </p><p>Run a function, collecting all publications in a list.
Return the list when the function terminates.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: [signal, signal, signal, signal, signal]</span>
<span class="hl-variable">collect</span>(<span class="hl-variable">defer</span>(<span class="hl-variable">signals</span>, <span class="hl-literal">5</span>))</pre>
                            </p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1196E"></a>B.3.4.&nbsp;list.inc: Operations on lists.</h3></div></div></div><p>Operations on lists.
Many of these functions are similar to those in the Haskell prelude, but
operate on the elements of a list in parallel.</p><div class="variablelist"><dl><dt><span class="term">
                            <code class="code"><span class="hl-variable">each</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">each</span>([<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Publish every value in a list, simultaneously.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">map</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">map</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, [<span class="hl-variable">A</span>]) :: [<span class="hl-variable">B</span>]</code>
                            </p><p>Apply a function to every element of a list (in parallel),
returning a list of the results.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">reverse</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">reverse</span>([<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>]</code>
                            </p><p>Return the reverse of the given list.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">filter</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">filter</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, [<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>]</code>
                            </p><p>Return a list containing only those elements which satisfy the predicate.
The filter is applied to all list elements in parallel.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">head</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">head</span>([<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Return the first element of a list.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">tail</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">tail</span>([<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>]</code>
                            </p><p>Return all but the first element of a list.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">init</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">init</span>([<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>]</code>
                            </p><p>Return all but the last element of a list.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">last</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">last</span>([<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Return the last element of a list.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">empty</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">empty</span>([<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Is the list empty?</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">index</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">index</span>(<span class="hl-variable">Integer</span>, [<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>Return the nth element of a list, counting from 0.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">append</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">append</span>([<span class="hl-variable">A</span>], [<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>]</code>
                            </p><p>Return the first list concatenated with the second.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">foldl</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">foldl</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">B</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">B</span>, <span class="hl-variable">B</span>, [<span class="hl-variable">A</span>]) :: <span class="hl-variable">B</span></code>
                            </p><p>Reduce a list using the given left-associative binary operation and initial value.
Given the list <code class="code">[<span class="hl-variable">x1</span>, <span class="hl-variable">x2</span>, <span class="hl-variable">x3</span>, ...]</code> and initial value <code class="code"><span class="hl-variable">x0</span></code>,
returns <code class="code"><span class="hl-variable">f</span>(... <span class="hl-variable">f</span>(<span class="hl-variable">f</span>(<span class="hl-variable">f</span>(<span class="hl-variable">x0</span>, <span class="hl-variable">x1</span>), <span class="hl-variable">x2</span>), <span class="hl-variable">x3</span>) ...)</code>

                            </p><p>Example using <code class="code"><span class="hl-variable">foldl</span></code> to reverse a list:
<pre class="orc">
<span class="hl-comment">-- Publishes: [3, 2, 1]</span>
<span class="hl-variable">foldl</span>(<span class="hl-variable">flip</span>((:)), [], [<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>])</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">foldl1</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">foldl1</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, [<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>A special case of <code class="code"><span class="hl-variable">foldl</span></code> which uses the last element of the list as the
initial value.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">foldr</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">foldr</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">B</span>) :: <span class="hl-variable">B</span>, <span class="hl-variable">B</span>, [<span class="hl-variable">A</span>]) :: <span class="hl-variable">B</span></code>
                            </p><p>Reduce a list using the given right-associative binary operation and initial value.
Given the list <code class="code">[..., <span class="hl-variable">x3</span>, <span class="hl-variable">x2</span>, <span class="hl-variable">x1</span>]</code> and initial value <code class="code"><span class="hl-variable">x0</span></code>,
returns <code class="code"><span class="hl-variable">f</span>(... <span class="hl-variable">f</span>(<span class="hl-variable">x3</span>, <span class="hl-variable">f</span>(<span class="hl-variable">x2</span>, <span class="hl-variable">f</span>(<span class="hl-variable">x1</span>, <span class="hl-variable">x0</span>))) ...)</code>

                            </p><p>Example summing the numbers in a list:
<pre class="orc">
<span class="hl-comment">-- Publishes: 6</span>
<span class="hl-variable">foldr</span>((+), <span class="hl-literal">0</span>, [<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>])</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">foldr1</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">foldr1</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>, <span class="hl-variable">A</span>) :: <span class="hl-variable">A</span>, [<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span></code>
                            </p><p>A special case of <code class="code"><span class="hl-variable">foldr</span></code> which uses the last element of the list as the
initial value.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">zip</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">zip</span>([<span class="hl-variable">A</span>], [<span class="hl-variable">B</span>]) :: (<span class="hl-variable">A</span>, <span class="hl-variable">B</span>)</code>
                            </p><p>Combine two lists into a list of pairs.
The length of the shortest list determines the length of the result.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">unzip</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">unzip</span>([(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)]) :: ([<span class="hl-variable">A</span>], [<span class="hl-variable">B</span>])</code>
                            </p><p>Split a list of pairs into a pair of lists.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">length</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">length</span>([<span class="hl-variable">A</span>]) :: <span class="hl-variable">Integer</span></code>
                            </p><p>Return the number of elements in a list.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">take</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">take</span>(<span class="hl-variable">Integer</span>, [<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>]</code>
                            </p><p>Given a number <code class="code"><span class="hl-variable">n</span></code> and a list <code class="code"><span class="hl-variable">l</span></code>,
return the first <code class="code"><span class="hl-variable">n</span></code> elements of <code class="code"><span class="hl-variable">l</span></code>.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">drop</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">drop</span>(<span class="hl-variable">Integer</span>, [<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>]</code>
                            </p><p>Given a number <code class="code"><span class="hl-variable">n</span></code> and a list <code class="code"><span class="hl-variable">l</span></code>,
return the elements of <code class="code"><span class="hl-variable">l</span></code> after the first <code class="code"><span class="hl-variable">n</span></code>.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">member</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">member</span>(<span class="hl-variable">A</span>, [<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return true if the given item is a member of the given list, and false
otherwise.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">merge</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">merge</span>([<span class="hl-variable">A</span>], [<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>], <span class="hl-variable">A</span> <span class="hl-site">&lt;:</span> <span class="hl-variable">Comparable</span></code>

                            </p><p>Merge two sorted lists.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: [1, 2, 2, 3, 4, 5]</span>
<span class="hl-variable">merge</span>([<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>], [<span class="hl-literal">2</span>,<span class="hl-literal">4</span>,<span class="hl-literal">5</span>])</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">mergeBy</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">mergeBy</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, [<span class="hl-variable">A</span>], [<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>]</code>
                            </p><p>Merge two lists using the given less-than relation.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">sort</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">sort</span>([<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>], <span class="hl-variable">A</span> <span class="hl-site">&lt;:</span> <span class="hl-variable">Comparable</span></code>

                            </p><p>Sort a list.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: [1, 2, 3]</span>
<span class="hl-variable">sort</span>([<span class="hl-literal">1</span>,<span class="hl-literal">3</span>,<span class="hl-literal">2</span>])</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">sortBy</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">sortBy</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, [<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>]</code>
                            </p><p>Sort a list using the given less-than relation.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">mergeUnique</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">mergeUnique</span>([<span class="hl-variable">A</span>], [<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>], <span class="hl-variable">A</span> <span class="hl-site">&lt;:</span> <span class="hl-variable">Comparable</span></code>

                            </p><p>Merge two sorted lists, discarding duplicates.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: [1, 2, 3, 4, 5]</span>
<span class="hl-variable">mergeUnique</span>([<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>], [<span class="hl-literal">2</span>,<span class="hl-literal">4</span>,<span class="hl-literal">5</span>])</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">mergeUniqueBy</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">mergeUniqueBy</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, [<span class="hl-variable">A</span>], [<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>]</code>
                            </p><p>Merge two lists, discarding duplicates, using the given equality and less-than relations.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">sortUnique</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">sortUnique</span>([<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>], <span class="hl-variable">A</span> <span class="hl-site">&lt;:</span> <span class="hl-variable">Comparable</span></code>

                            </p><p>Sort a list, discarding duplicates.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: [1, 2, 3]</span>
<span class="hl-variable">sortUnique</span>([<span class="hl-literal">1</span>,<span class="hl-literal">3</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>])</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">sortUniqueBy</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">sortUniqueBy</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, <span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, [<span class="hl-variable">A</span>]) :: [<span class="hl-variable">A</span>]</code>
                            </p><p>Sort a list, discarding duplicates, using the given equality and less-than relations.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">group</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">group</span>([(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)]) :: [(<span class="hl-variable">A</span>,[<span class="hl-variable">B</span>])]</code>

                            </p><p>Given a list of pairs, group together the second
elements of consecutive pairs with equal first elements.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: [(1, [1, 2]), (2, [3]), (3, [4]), (1, [3])]</span>
<span class="hl-variable">group</span>([(<span class="hl-literal">1</span>,<span class="hl-literal">1</span>), (<span class="hl-literal">1</span>,<span class="hl-literal">2</span>), (<span class="hl-literal">2</span>,<span class="hl-literal">3</span>), (<span class="hl-literal">3</span>,<span class="hl-literal">4</span>), (<span class="hl-literal">1</span>,<span class="hl-literal">3</span>)])</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">groupBy</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">groupBy</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>,<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, [(<span class="hl-variable">A</span>,<span class="hl-variable">B</span>)]) :: [(<span class="hl-variable">A</span>,[<span class="hl-variable">B</span>])]</code>
                            </p><p>Given a list of pairs, group together the second
elements of consecutive pairs with equal first elements,
using the given equality relation.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">range</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">range</span>(<span class="hl-variable">Integer</span>, <span class="hl-variable">Integer</span>) :: [<span class="hl-variable">Integer</span>]</code>
                            </p><p>Generate a list of integers in the given half-open range.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">any</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">any</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, [<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return true if any of the elements of the list match the predicate, and false otherwise.
The predicate is applied to all elements of the list in parellel; the result
is returned as soon as it is known and any unnecessary evaluation of the predicate
terminated.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">all</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">all</span>(<span class="hl-keyword">lambda</span> (<span class="hl-variable">A</span>) :: <span class="hl-variable">Boolean</span>, [<span class="hl-variable">A</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return true if all of the elements of the list match the predicate, and false otherwise.
The predicate is applied to all elements of the list in parellel; the result
is returned as soon as it is known and any unnecessary evaluation of the predicate
terminated.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">sum</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">sum</span>([<span class="hl-variable">Number</span>]) :: <span class="hl-variable">Number</span></code>
                            </p><p>Return the sum of all numbers in a list.
The sum of an empty list is 0.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">product</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">product</span>([<span class="hl-variable">Number</span>]) :: <span class="hl-variable">Number</span></code>
                            </p><p>Return the product of all numbers in a list.
The product of an empty list is 1.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">and</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">and</span>([<span class="hl-variable">Boolean</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return the boolean conjunction of all boolean values in the list.
The conjunction of an empty list is <code class="code"><span class="hl-literal">true</span></code>.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">or</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">or</span>([<span class="hl-variable">Boolean</span>]) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Return the boolean disjunction of all boolean values in the list.
The disjunction of an empty list is <code class="code"><span class="hl-literal">true</span></code>.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">minimum</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">minimum</span>([<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>, <span class="hl-variable">A</span> <span class="hl-site">&lt;:</span> <span class="hl-variable">Comparable</span></code>
                            </p><p>Return the minimum element of a non-empty list.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">maximum</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">maximum</span>([<span class="hl-variable">A</span>]) :: <span class="hl-variable">A</span>, <span class="hl-variable">A</span> <span class="hl-site">&lt;:</span> <span class="hl-variable">Comparable</span></code>
                            </p><p>Return the maximum element of a non-empty list.</p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11C07"></a>B.3.5.&nbsp;text.inc: Operations on strings.</h3></div></div></div><p>Operations on strings.</p><div class="variablelist"><dl><dt><span class="term">
                            <code class="code"><span class="hl-variable">cat</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">cat</span>(<span class="hl-variable">Top</span>, ...) :: <span class="hl-variable">String</span></code>
                            </p><p>Return the string representation of one or more values, concatenated.
For Java objects, this will call <code class="code"><span class="hl-variable">toString</span>()</code> to convert
the object to a String.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">print</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">print</span>(<span class="hl-variable">Top</span>, ...) :: <span class="hl-variable">Signal</span></code>
                            </p><p>Print one or more values as strings, concatenated, to standard output.
For Java objects, this will call <code class="code"><span class="hl-variable">toString</span>()</code> to convert
the object to a String.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">println</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">println</span>(<span class="hl-variable">Top</span>, ...) :: <span class="hl-variable">Signal</span></code>
                            </p><p>Print one or more values as strings, concatenated,
to standard output, with each value followed by a newline.
For Java objects, this will call <code class="code"><span class="hl-variable">toString</span>()</code> to convert
the object to a String.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">parseInt</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">parseInt</span>(<span class="hl-variable">String</span>) :: <span class="hl-variable">BigInteger</span></code>
                            </p><p>Parse a string as a BigInteger.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">parseBool</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">parseBool</span>(<span class="hl-variable">String</span>) :: <span class="hl-variable">Boolean</span></code>
                            </p><p>Parse a string as a Boolean (true/false).</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">lines</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">lines</span>(<span class="hl-variable">String</span>) :: [<span class="hl-variable">String</span>]</code>
                            </p><p>Split a string into lines, which are substrings
terminated by an endline or the end of the string.
DOS, Mac, and Unix endline conventions are all accepted.
Endline characters are not included in the result.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">unlines</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">unlines</span>([<span class="hl-variable">String</span>]) :: <span class="hl-variable">String</span></code>
                            </p><p>Append a linefeed, "\n", to each string in the sequence
and concatenate the results.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">words</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">words</span>(<span class="hl-variable">String</span>) :: [<span class="hl-variable">String</span>]</code>
                            </p><p>Split a string into words, which are sequences of non-whitespace characters separated by whitespace.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">unwords</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">unwords</span>([<span class="hl-variable">String</span>]) :: <span class="hl-variable">String</span></code>
                            </p><p>Concatenate a sequence of strings with a single space between
each string.</p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11C94"></a>B.3.6.&nbsp;time.inc: Real and logical time.</h3></div></div></div><p>Real and logical time.</p><div class="variablelist"><dl><dt><span class="term">
                            <code class="code"><span class="hl-variable">Rtimer</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Rtimer</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Signal</span></code>
                            </p><p>Publish a signal after the given number of milliseconds.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">Clock</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Clock</span>()() :: <span class="hl-variable">Integer</span></code>

                            </p><p>A call to <code class="code"><span class="hl-variable">Clock</span></code> creates a new relative clock.
Calling a relative clock returns the number
of milliseconds which have elapsed since the
clock was created.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes a value near 1000</span>
<span class="hl-keyword">val</span> <span class="hl-variable">c</span> = <span class="hl-variable">Clock</span>()
<span class="hl-variable">Rtimer</span>(<span class="hl-literal">1000</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">c</span>()</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">Ltimer</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Ltimer</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Signal</span></code>
                            </p><p>Publish a signal after the given number of logical timesteps.
A logical timestep is complete as soon as all outstanding site
calls (other than calls to <code class="code"><span class="hl-variable">Ltimer</span></code>) have published.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">metronome</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">metronome</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Signal</span></code>
                            </p><p>Publish a signal at regular intervals, indefinitely. The period is given by the
argument, in milliseconds.</p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11CDE"></a>B.3.7.&nbsp;util.inc: Miscellaneous utility functions.</h3></div></div></div><p>Miscellaneous utility functions.</p><div class="variablelist"><dl><dt><span class="term">
                            <code class="code"><span class="hl-variable">random</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">random</span>() :: <span class="hl-variable">Integer</span></code>
                            </p><p>Return a random Integer value
chosen from the range of all possible 32-bit Integer values.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">random</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">random</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Integer</span></code>
                            </p><p>Return a pseudorandom, uniformly distributed Integer value
between 0 (inclusive) and the specified value (exclusive).
If the argument is 0, halt.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">urandom</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">urandom</span>() :: <span class="hl-variable">Double</span></code>
                            </p><p>Returns a pseudorandom, uniformly distributed Double value
between 0 and 1, inclusive.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">UUID</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">UUID</span>() :: <span class="hl-variable">String</span></code>
                            </p><p>Return a random (type 4) UUID represented as a string.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">Thread</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Thread</span>(<span class="hl-variable">Site</span>) :: <span class="hl-variable">Site</span></code>
                            </p><p>Given a site, return a new site which calls the original site
in a separate thread.  This is necessary when calling
a Java site which does not cooperate with Orc's scheduler
and may block for an unpredictable amount of time.</p><p>A limited number of threads are reserved in a pool for use
by this site, so there is a limit to the number of blocking,
uncooperative sites that can be called simultaneously.</p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">Prompt</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">site</span> <span class="hl-variable">Prompt</span>(<span class="hl-variable">String</span>) :: <span class="hl-variable">String</span></code>

                            </p><p>Prompt the user for some input. The user may cancel the prompt,
in which case the site fails silently. Otherwise their response
is returned as soon as it is received.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes the user's name</span>
<span class="hl-variable">Prompt</span>(<span class="hl-literal">"What is your name?"</span>)</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">signals</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">signals</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Signal</span></code>

                            </p><p>Publish the given number of signals, simultaneously.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes five signals</span>
<span class="hl-variable">signals</span>(<span class="hl-literal">5</span>)</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">for</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">for</span>(<span class="hl-variable">Integer</span>, <span class="hl-variable">Integer</span>) :: <span class="hl-variable">Integer</span></code>

                            </p><p>Publish all values in the given half-open range, simultaneously.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 1 2 3 4 5</span>
<span class="hl-variable">for</span>(<span class="hl-literal">1</span>,<span class="hl-literal">6</span>)</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">upto</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">upto</span>(<span class="hl-variable">Integer</span>) :: <span class="hl-variable">Integer</span></code>
                            </p><p>

                                <code class="code"><span class="hl-variable">upto</span>(<span class="hl-variable">n</span>)</code> publishes all values in the range <code class="code">(<span class="hl-literal">0.</span>.<span class="hl-variable">n</span>-<span class="hl-literal">1</span>)</code>
simultaneously.</p><p>Example:
<pre class="orc">
<span class="hl-comment">-- Publishes: 0 1 2 3 4</span>
<span class="hl-variable">upto</span>(<span class="hl-literal">5</span>)</pre>
                            </p></dd><dt><span class="term">
                            <code class="code"><span class="hl-variable">fillArray</span></code>
                        </span></dt><dd><p>
                                <code class="code"><span class="hl-keyword">def</span> <span class="hl-variable">fillArray</span>(<span class="hl-variable">Array</span>&lt;<span class="hl-variable">A</span>&gt;, <span class="hl-keyword">lambda</span> (<span class="hl-variable">Integer</span>) :: <span class="hl-variable">A</span>) :: <span class="hl-variable">Array</span>&lt;<span class="hl-variable">A</span>&gt;</code>

                            </p><p>Given an array and a function from indices to values, populate the array
by calling the function for each index in the array.</p><p>For example, to set all elements of an array to zero:
<pre class="orc">
<span class="hl-comment">-- Publishes: 0 0 0</span>
<span class="hl-keyword">val</span> <span class="hl-variable">a</span> = <span class="hl-variable">fillArray</span>(<span class="hl-variable">Array</span>(<span class="hl-literal">3</span>), <span class="hl-keyword">lambda</span> (<span class="hl-variable">_</span>) = <span class="hl-literal">0</span>)
<span class="hl-variable">a</span>.<span class="hl-variable">get</span>(<span class="hl-literal">0</span>) <span class="hl-combinator">|</span> <span class="hl-variable">a</span>.<span class="hl-variable">get</span>(<span class="hl-literal">1</span>) <span class="hl-combinator">|</span> <span class="hl-variable">a</span>.<span class="hl-variable">get</span>(<span class="hl-literal">2</span>)</pre>
                            </p></dd></dl></div></div></div></div></div><script type="text/javascript" src="/orchard/orc.js"></script></body></html>