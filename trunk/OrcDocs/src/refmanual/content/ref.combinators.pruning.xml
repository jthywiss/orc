<?xml version="1.0" encoding="UTF-8"?>
<!-- ref.combinators.pruning.xml - DocBook source for an Orc reference manual section

     $Id$

     Copyright (c) 2010 The University of Texas at Austin. All rights reserved.

     Use and redistribution of this file is governed by the license terms in
     the LICENSE file found in the project's top-level directory and also found at
     URL: http://orc.csres.utexas.edu/license.shtml .
  -->

<!-- Pruning Combinator -->
   <section xml:id="ref.combinators.pruning">
      <title>Pruning Combinator</title>
	  <section xml:id="ref.combinators.pruning.syntax">
		  <title>Syntax</title>
		  <para>
		    <productionset>
		    <productionrecap linkend="ebnf.expression.combinator.pruning"/>
		    </productionset>
		  </para>
		  <para><emphasis role="strong">Combinator Precedence</emphasis>: 
			  <olink targetdoc="userguide" targetptr="combinators.sequential">sequential</olink> >
			  <olink targetdoc="userguide" targetptr="combinators.parallel">parallel</olink> > 
			  <olink targetdoc="userguide" targetptr="combinators.pruning">pruning</olink> >
			  <olink targetdoc="userguide" targetptr="combinators.otherwise">otherwise</olink>
			        [<link linkend="ref.concepts.precedence">Full Table</link>]
			  </para>
	  </section>
	  
	  <section xml:id="ref.combinators.pruning.identities">
		  <title>Identities</title>	  
			  <para>
			  Notable identities include:
			  <informaltable class="identitylist">
				<tbody>
				  <tr>
				    <td><code><![CDATA[F <P< G <P< H]]></code></td>
				    <td> = </td>
				    <td><code><![CDATA[F <P< (G <P< H)]]></code></td>
				    <td>  (Left Associative)</td>
				  </tr>
				</tbody>
				</informaltable>
				...more identities...
			  </para>
      </section>
	  
	  <section xml:id="ref.combinators.pruning.behavior">
		  <title>Behavior</title>
		  <para>
		  <variablelist>
			<varlistentry><term><code><![CDATA[F <x< G]]></code></term>
			<listitem>
			 <para>
			  	The execution of <code><![CDATA[F <x< G]]></code> starts by executing <code><![CDATA[F]]></code> and <code><![CDATA[G]]></code> in parallel. Whenever
				<code><![CDATA[F]]></code> publishes a value, that value is published by the entire execution. When <code><![CDATA[G]]></code> publishes its first value, that
				value is bound to <code><![CDATA[x]]></code> in <code><![CDATA[F]]></code>, and then the execution of <code><![CDATA[G]]></code> is immediately <link linkend="ref.concepts.kill">killed</link>. A <link linkend="ref.concepts.kill">killed</link> expression
				cannot call any sites or publish any values. During the execution of <code><![CDATA[F]]></code>, any part of the execution that depends on <code><![CDATA[x]]></code> 
				will be suspended until <code><![CDATA[x]]></code> is bound (to
				the first value published by <code><![CDATA[G]]></code>). If <code><![CDATA[G]]></code> never publishes a value, that part of the execution is suspended forever.
			  </para>
			</listitem>
			</varlistentry>
			<varlistentry><term><code><![CDATA[F <P< G]]></code></term>
			<listitem>
			  <para>
				The pruning combinator may include a full pattern <code><![CDATA[P]]></code> instead of just a variable name. Any value published
				by <code><![CDATA[G]]></code> is <link linkend="ref.patterns">matched</link> against the pattern <code><![CDATA[P]]></code>. If this match is successful, then <code><![CDATA[G]]></code> <link linkend="ref.concepts.kill">killed</link> and all of the bindings
				of pattern <code><![CDATA[P]]></code> are made in <code><![CDATA[F]]></code>. Otherwise, the published value is simply ignored and <code><![CDATA[G]]></code> continues to execute.
			  </para>
			</listitem>
			</varlistentry>
			<varlistentry><term><code><![CDATA[F << G]]></code></term>
			<listitem>
			 <para>
				This is equivalent to using a wildcard pattern, <code><![CDATA[F <_< G]]></code>.  <code><![CDATA[G]]></code> continues to execute 
				until it publishes a value.  Any value published by <code><![CDATA[G]]></code> will match the pattern. After the successful match, 
				<code><![CDATA[G]]></code> is <link linkend="ref.concepts.kill">killed</link>, but no bindings are made in <code><![CDATA[F]]></code>.
			 </para>
			</listitem>
			</varlistentry>
			</variablelist>
		  </para>	
	  </section>
	  
	  <section xml:id="ref.combinators.pruning.examples">
		  <title>Examples</title>

		  <example xml:id="ref.combinators.pruning.examples.exclusive"><title>Exclusive Publication</title>
<programlisting language="orc-demo"><![CDATA[
{-
Simulate a coin toss by publishing either "heads" or "tails" arbitrarily
-}

x <x< ("heads" | "tails")

{-
OUTPUT:
"heads"

OUTPUT:
"tails"
-}
]]></programlisting>
		  </example>

		  <example xml:id="ref.combinators.pruning.examples.printfirst"><title>Print First Result</title>
<programlisting language="orc"><![CDATA[
{- 
Query Google and Yahoo for a search result
Print out the result that arrives first; ignore the other result
-}

println(result) <result< ( Google("cupcake") | Yahoo("cupcake") )

{-
NONRUNNABLE
-}
]]></programlisting>
		  </example>
		  
		  <example xml:id="ref.combinators.pruning.examples.patternpub"><title>Pattern Publication</title>
<programlisting language="orc-demo"><![CDATA[
{- 
Publish either 9 or 25, but not 16.
-}

x*x <(x,true)< ( (3,true) | (4,false) | (5,true) )

{-
OUTPUT:
9

OUTPUT:
25
-}
]]></programlisting>
		  </example>
		  
		  <example xml:id="ref.combinators.pruning.examples.timed"><title>Timed Termination</title>
<programlisting language="orc"><![CDATA[
{-
Print all publications of f for 100 msec (after the execution of f starts). 
Then kill f.
-}

stop << (f >x> println(x) >> stop | Rtimer(100) )

{-
NOTRUNNABLE
-}
]]></programlisting>		  
		  </example>
		  		  
	  </section>
	  
	  <section xml:id="ref.combinators.pruning.type">
	    <title>Type</title>
			<para>
				The type of <code><![CDATA[F <x< G]]></code> is the type of <code><![CDATA[F]]></code> 
				using the assumption <code><![CDATA[x :: T]]></code>, where <code><![CDATA[T]]></code> 
				is the type of <code><![CDATA[G]]></code>.
			</para>

		</section>
	  
	  <section xml:id="ref.combinators.pruning.links">
		  <title>Related Links</title>
		  
	  <informaltable frame="none">
  		<tgroup cols="1" align="left">
    	<thead>
      		<row>
        		<entry align="center">Related Reference Topics</entry>
        	</row>
    	</thead>
    	<tbody valign="top">
     		<row>
        		<entry><itemizedlist>
          			<listitem><para><link linkend="ref.combinators">Combinators</link></para></listitem>
          			<listitem><para><link linkend="ref.patterns">Patterns</link></para></listitem>
        		</itemizedlist></entry>
        	</row>
    	</tbody>
  		</tgroup>
	  </informaltable>
	  
	  <informaltable frame="none">
  		<tgroup cols="1" align="left">
    	<thead>
      		<row>
        		<entry align="left">Related Tutorial Sections</entry>
        	</row>
    	</thead>
    	<tbody valign="top">
     		<row>
        		<entry><itemizedlist>
          			<listitem><para><olink targetdoc="userguide" targetptr="combinators.pruning">Pruning Combinator</olink></para></listitem>
          			<listitem><para><olink targetdoc="userguide" targetptr="patterns.extensions">Pattern Matching Extensions</olink></para></listitem>
          			<listitem><para><olink targetdoc="userguide" targetptr="orc.sites">Sites</olink></para></listitem>
        		</itemizedlist></entry>
        	</row>
    	</tbody>
  		</tgroup>
	  </informaltable>

	  </section>
   </section>
