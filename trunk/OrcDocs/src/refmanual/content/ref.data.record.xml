<?xml version="1.0" encoding="UTF-8"?>
<!-- ref.data.record.xml - DocBook source for an Orc reference manual section

     $Id$

     Copyright (c) 2010 The University of Texas at Austin. All rights reserved.

     Use and redistribution of this file is governed by the license terms in
     the LICENSE file found in the project's top-level directory and also found at
     URL: http://orc.csres.utexas.edu/license.shtml .
  -->

<section xml:id="ref.data.record">
<title>Record Values</title>

<para><emphasis role="strong">Type</emphasis>: <code>{. x1 :: T1, x2 :: T2, ... .}</code></para>

<para>
Orc's <type>Record</type> data type is an unordered finite map from keys to values. It may be empty; the empty
record is written <code>{..}</code>. 
</para>

<section xml:id="ref.data.record.constructors">
<title>Constructors</title>

<para><emphasis role="strong">EBNF</emphasis>: <replaceable>Record</replaceable> ::= <code>{. x1 = E1, x2 = E2, ... .}</code></para>

<para>
A record is constructed from a comma-separated sequence of bindings enclosed by dotted braces. Each binding
associates a key with an expression. 
The record expression <code>{. x_0 = e_0, ..., x_n = e_n .}</code> publishes the record <code>{.x_0 = v_0, ..., x_n = v_n .}</code>
only if each <code>ei</code> <link linkend="ref.concepts.deflate">deflates</link> to value <code>vi</code>. 
Otherwise, it <link linkend="ref.concepts.halt">halts</link> <link linkend="ref.concepts.silent">silently</link>.
</para>

<para>Duplicate bindings for the same key are allowed, but only the rightmost binding will
be used in the resulting record value.</para>

</section>

<section xml:id="ref.data.record.operations">
<title>Operations</title>

<para>Notable record operations include:
<itemizedlist>
<listitem><para>Projection: <replaceable>record</replaceable><code>.</code><replaceable>key</replaceable></para></listitem>
<listitem><para>Extension: <replaceable>record</replaceable><code> + </code><replaceable>record</replaceable></para></listitem>
</itemizedlist>
</para>

<para>
Record extension, written <replaceable>R</replaceable><code> + </code><replaceable>S</replaceable>, publishes
a new record with all of the bindings of <replaceable>S</replaceable>, plus all of the bindings in <replaceable>R</replaceable>
which do not bind keys mentioned in <replaceable>S</replaceable>. In other words, <replaceable>S</replaceable>
overrides <replaceable>R</replaceable>. Record extension is associative, but not commutative. 
</para>

<para>
The expression <code>{. x_0 = e_0, x_1 = e_1, ..., x_n = e_n .}</code> is equivalent to the expression
<code>{. x_0 = e_0. } + {. x_1 = e_1 .} + ... + {. x_n = e_n .}</code>.
</para>

</section>

<section xml:id="ref.data.record.javacalls">
<title>Java calls</title>

<para>Orc <type>Record</type>s don't correspond to any Java value, so if a <type>Record</type>
is passed to Java code, it will be as a <type>java.lang.Object</type> of a type not specified here.</para>

</section>

<section xml:id="ref.data.record.examples">
<title>Examples</title>


<example xml:id="ref.data.record.examples.one">
<title>Normalizing Vectors</title>
<programlisting language="orc-demo"><![CDATA[
def magnitude(v) = 
  v.x * v.x + 
  v.y * v.y + 
  v.z * v.z
  
def norm(v) = 
  val m = magnitude(v)
  {. x = v.x / m, 
     y = v.y / m, 
     z = v.z / m .}
     
val velocity = {. x = 3, y = 0, z = 4 .}      
norm(velocity) 
]]></programlisting>
</example>

<example xml:id="ref.data.record.examples.two">
<title>Record Expansion</title>
<programlisting><![CDATA[
val rgb = {. red = 60, green = 230, blue = 5 .}
rgb + {. alpha = 128 .}
]]></programlisting>
</example>

</section>

<section xml:id="ref.data.record.links">
<title>Related Links</title>

	<informaltable frame="none">
  		<tgroup cols="1" align="left">
    	<thead>
      		<row>
        		<entry align="center">Related Reference Topics</entry>
        	</row>
    	</thead>
    	<tbody valign="top">
     		<row>
        		<entry><itemizedlist>
          	    <listitem><para><link linkend="ref.syntax.lexical">Lexical Specifications</link></para></listitem>
          		<listitem><para><link linkend="ref.syntax.EBNF">EBNF</link></para></listitem>
        		</itemizedlist></entry>
        	</row>
    	</tbody>
  		</tgroup>
	  </informaltable>
	  
	  <informaltable frame="none">
  		<tgroup cols="1" align="left">
    	<thead>
      		<row>
        		<entry align="left">Related Tutorial Sections</entry>
        	</row>
    	</thead>
    	<tbody valign="top">
     		<row>
        		<entry><itemizedlist>
          			<listitem><para><olink targetdoc="userguide" targetptr="section.services.java.method">Method Resolution</olink></para></listitem>
        		</itemizedlist></entry>
        	</row>
    	</tbody>
  		</tgroup>
	  </informaltable>
</section>

</section>
