<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title></title><link href="style.css" rel="stylesheet" type="text/css"><meta content="DocBook XSL Stylesheets V1.74.0" name="generator"><link href="/orchard/orc.css" type="text/css" rel="stylesheet"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#N2000E">1. The Orc Programming Language</a></span></dt><dd><dl><dt><span class="section"><a href="#N20012">1.1. Introduction</a></span></dt><dt><span class="section"><a href="#N20028">1.2. Cor: A Functional Subset</a></span></dt><dd><dl><dt><span class="section"><a href="#N20228">1.2.1. Constants</a></span></dt><dt><span class="section"><a href="#language.base.oeprators">1.2.2. Operators</a></span></dt><dt><span class="section"><a href="#N203CC">1.2.3. Conditionals</a></span></dt><dt><span class="section"><a href="#N204A4">1.2.4. Variables</a></span></dt><dt><span class="section"><a href="#N204E3">1.2.5. Data Structures</a></span></dt><dt><span class="section"><a href="#N20584">1.2.6. Patterns</a></span></dt><dt><span class="section"><a href="#N205FF">1.2.7. Functions</a></span></dt><dt><span class="section"><a href="#N206E5">1.2.8. Comments</a></span></dt></dl></dd><dt><span class="section"><a href="#N20700">1.3. Orc: Orchestrating services</a></span></dt><dd><dl><dt><span class="section"><a href="#N20806">1.3.1. Communicating with external services</a></span></dt><dt><span class="section"><a href="#N20854">1.3.2. The concurrency combinators of Orc</a></span></dt><dt><span class="section"><a href="#N2092E">1.3.3. Changes to functional expressions</a></span></dt><dt><span class="section"><a href="#N209E5">1.3.4. Time</a></span></dt></dl></dd><dt><span class="section"><a href="#N209EB">1.4. Advanced Features of Orc</a></span></dt><dd><dl><dt><span class="section"><a href="#N20B3C">1.4.1. Special call forms</a></span></dt><dt><span class="section"><a href="#N20BB1">1.4.2. Special patterns</a></span></dt><dt><span class="section"><a href="#N20C2A">1.4.3. Special declarations</a></span></dt><dt><span class="section"><a href="#N20C66">1.4.4. The after combinator</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#N20CAE">2. Programming Methodology</a></span></dt><dt><span class="chapter"><a href="#chapter.services">3. Accessing and Creating External Services</a></span></dt><dt><span class="appendix"><a href="#N20CBB">A. Complete Syntax of Orc</a></span></dt><dt><span class="appendix"><a href="#appendix.library">B. Standard Library</a></span></dt><dt><span class="appendix"><a href="#N20FD8">C. FAQ</a></span></dt></dl></div>

<div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="N2000E"></a>Chapter&nbsp;1.&nbsp;The Orc Programming Language</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#N20012">1.1. Introduction</a></span></dt><dt><span class="section"><a href="#N20028">1.2. Cor: A Functional Subset</a></span></dt><dd><dl><dt><span class="section"><a href="#N20228">1.2.1. Constants</a></span></dt><dt><span class="section"><a href="#language.base.oeprators">1.2.2. Operators</a></span></dt><dt><span class="section"><a href="#N203CC">1.2.3. Conditionals</a></span></dt><dt><span class="section"><a href="#N204A4">1.2.4. Variables</a></span></dt><dt><span class="section"><a href="#N204E3">1.2.5. Data Structures</a></span></dt><dt><span class="section"><a href="#N20584">1.2.6. Patterns</a></span></dt><dt><span class="section"><a href="#N205FF">1.2.7. Functions</a></span></dt><dt><span class="section"><a href="#N206E5">1.2.8. Comments</a></span></dt></dl></dd><dt><span class="section"><a href="#N20700">1.3. Orc: Orchestrating services</a></span></dt><dd><dl><dt><span class="section"><a href="#N20806">1.3.1. Communicating with external services</a></span></dt><dt><span class="section"><a href="#N20854">1.3.2. The concurrency combinators of Orc</a></span></dt><dt><span class="section"><a href="#N2092E">1.3.3. Changes to functional expressions</a></span></dt><dt><span class="section"><a href="#N209E5">1.3.4. Time</a></span></dt></dl></dd><dt><span class="section"><a href="#N209EB">1.4. Advanced Features of Orc</a></span></dt><dd><dl><dt><span class="section"><a href="#N20B3C">1.4.1. Special call forms</a></span></dt><dt><span class="section"><a href="#N20BB1">1.4.2. Special patterns</a></span></dt><dt><span class="section"><a href="#N20C2A">1.4.3. Special declarations</a></span></dt><dt><span class="section"><a href="#N20C66">1.4.4. The after combinator</a></span></dt></dl></dd></dl></div>

<div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N20012"></a>1.1.&nbsp;Introduction</h2></div></div></div>

<p>
Orc is a programming language designed to make distributed and
concurrent programs simple and intuitive to write. Orc expresses
orchestration, a type of structured concurrency. It emphasizes the
flow of control and gives a global view of a concurrent system. Orc
is well-suited for task orchestration, a form of
concurrent programming with applications in workflow, business process
management, and web service orchestration. Orc provides constructs to
orchestrate the concurrent invocation of services while managing
time-outs, priorities, and failures of services or communication.  To
learn more about Orc and run your own Orc programs, visit the website:
<a class="ulink" href="http://orc.csres.utexas.edu/" target="_top"><code class="code"><span class="hl-variable">http</span>://<span class="hl-variable">orc</span>.<span class="hl-variable">csres</span>.<span class="hl-variable">utexas</span>.<span class="hl-variable">edu</span>/</code></a>.
</p>

<p>
This chapter describes the Orc programming language in three steps. In Section 1.2, we
discuss a small subset of Orc called Cor. Cor is a pure functional language,
which has no features for concurrency, has no state, and does not communicate 
with external services. Cor introduces us to the parts of Orc that are most familiar 
from existing programming languages, such as arithmetic operations, variables,
conditionals, and functions.
</p>

<p>
Next, in Section 1.3, we consider Orc itself, which in addition to Cor, comprises 
external services and combinators for concurrent orchestration of those services. 
We show how Orc interacts with these external services, how the combinators can be
used to build up complex orchestrations from simple base expressions, and how the 
functional constructs of Cor take on new, subtler behaviors in the concurrent 
context of Orc.
</p>

<p>
Finally, in Section 1.4, we discuss some additional features of Orc that extend 
the basic syntax. These are useful for creating large-scale Orc programs, but 
they are not essential to the understanding of the language.
</p>
 
</div> 


<div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N20028"></a>1.2.&nbsp;Cor: A Functional Subset</h2></div></div></div>



 
<p>
In this section we introduce Cor, a pure functional subset of the Orc language.
Users of functional programming languages such as Haskell and ML will already be 
familiar with many of the key concepts of Cor.  
</p>

<p>
A Cor program is called an <em class="firstterm">expression</em>. Cor expressions are built
up recursively from smaller expressions. Cor <em class="firstterm">evaluates</em> an expression
to reduce it to some simple <em class="firstterm">value</em> which cannot be evaluated further, 
for example a list of numbers or a Boolean truth value. This value is called the <em class="firstterm">
result</em> of the expression.
</p>

<p>
In the following subsections we introduce the concepts of Cor. First, we talk about
simple constants, such as numbers and truth values, and the operations that we can perform
on those values. Then we introduce conditionals (<code class="code"><span class="hl-keyword">if</span> <span class="hl-keyword">then</span> <span class="hl-keyword">else</span></code>). Then we 
introduce variables and binding, as a way to give a name to the value of an expression. 
After that, we talk about constructing data structures, and examining those structures
using patterns. Lastly, we introduce functions.
</p> 

<p>
The following figure describes the syntax of Cor. Each part of the syntax is explained 
in a subsequent section.
</p>

<p>

<div class="informaltable"><a name="cor-ebnf-table"></a> 


<table border="0" width="80%"><colgroup><col align="right"><col align="center"><col align="left"><col align="left"><col align="left"></colgroup><tbody><tr><td align="right">E</td><td align="center">::=</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>Expression</em></span></td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">&nbsp;</td><td align="left">C</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>constant value</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E <span class="emphasis"><em>op</em></span> E</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>operator</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">X</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>variable</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left"><code class="code"><span class="hl-keyword">if</span></code> E <code class="code"><span class="hl-keyword">then</span></code> E <code class="code"><span class="hl-keyword">else</span></code> E </td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>conditional</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">X<code class="code">(</code> E <code class="code">,</code> ... <code class="code">,</code> E <code class="code">)</code></td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>function call</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left"><code class="code">(</code> E <code class="code">,</code> ... <code class="code">,</code> E <code class="code">)</code></td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>tuple</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left"><code class="code">[</code> E <code class="code">,</code> ... <code class="code">,</code> E <code class="code">]</code></td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>list</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">D E</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>scoped declaration</em></span></td></tr><tr><td align="right">C</td><td align="center">::=</td><td align="left"><code class="code"><span class="hl-literal">true</span></code> | <code class="code"><span class="hl-literal">false</span></code> | <span class="emphasis"><em>integer</em></span> | <span class="emphasis"><em>string</em></span></td><td align="left"><span class="emphasis"><em>Constant</em></span></td><td align="left">&nbsp;</td></tr><tr><td align="right">X</td><td align="center">::=</td><td align="left"><span class="emphasis"><em>identifier</em></span></td><td align="left"><span class="emphasis"><em>Variable</em></span></td><td align="left">&nbsp;</td></tr><tr><td align="right">D</td><td align="center">::=</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>Declaration</em></span></td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">&nbsp;</td><td align="left"><code class="code"><span class="hl-keyword">val</span></code> P <code class="code">=</code> E</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>value declaration</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left"><code class="code"><span class="hl-keyword">def</span></code> X<code class="code">(</code> P <code class="code">,</code> ... <code class="code">,</code> P <code class="code">)</code> <code class="code">=</code> E</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>function declaration</em></span></td></tr><tr><td align="right">P</td><td align="center">::=</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>Pattern</em></span></td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">&nbsp;</td><td align="left">X</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>variable</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">C</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>constant</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left"><code class="code"><span class="hl-variable">_</span></code></td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>wildcard</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left"><code class="code">(</code> P <code class="code">,</code> ... <code class="code">,</code> P <code class="code">)</code></td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>tuple</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left"><code class="code">[</code> P <code class="code">,</code> ... <code class="code">,</code> P <code class="code">]</code></td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>list</em></span></td></tr></tbody></table>
</div>
</p>



<div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N20228"></a>1.2.1.&nbsp;Constants</h3></div></div></div>
<p>
The simplest expression one can write is a constant. It evaluates trivially
to that constant value. 
</p>

<p>

Cor has three types of constants, and thus for the moment three types of values:

<div class="itemizedlist"><ul type="disc"><li>
Integers: <code class="code"> ... -<span class="hl-literal">1</span>, <span class="hl-literal">0</span>, <span class="hl-literal">1</span> ... </code>
</li><li>
Booleans: <code class="code"><span class="hl-literal">true</span></code> and <code class="code"><span class="hl-literal">false</span></code>
</li><li>
Strings: <code class="code"><span class="hl-literal">"orc"</span></code>, <code class="code"><span class="hl-literal">"ceci n'est pas une |"</span></code>
</li></ul></div>
</p>

</div>

<div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="language.base.oeprators"></a>1.2.2.&nbsp;Operators</h3></div></div></div>
<p>
Cor has a standard set of arithmetic, logical, and comparison operators.
As in most other programming languages, they are written in the usual 
infix style. They have Java-like operator precedence, which can be
overridden by adding parentheses.  
</p>

<p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code"><span class="hl-literal">1</span>+<span class="hl-literal">2</span></code> evaluates to <code class="code"><span class="hl-literal">3</span></code>.</li><li><code class="code">(<span class="hl-literal">98</span>+<span class="hl-literal">2</span>)*<span class="hl-literal">17</span></code> evaluates to <code class="code"><span class="hl-literal">1700</span></code>.</li><li><code class="code"><span class="hl-literal">4</span> = <span class="hl-literal">20</span> / <span class="hl-literal">5</span></code> evaluates to <code class="code"><span class="hl-literal">true</span></code>.</li><li><code class="code"><span class="hl-literal">3</span>-<span class="hl-literal">5</span> <span class="hl-combinator">&gt;</span>= <span class="hl-literal">5</span>-<span class="hl-literal">3</span> </code> evaluates to <code class="code"><span class="hl-literal">false</span></code>.</li><li><code class="code"><span class="hl-literal">true</span> &amp;&amp; (<span class="hl-literal">false</span> || <span class="hl-literal">true</span>)</code> evaluates to <code class="code"><span class="hl-literal">true</span></code>.</li><li><code class="code"><span class="hl-literal">"leap"</span> + <span class="hl-literal">"frog"</span></code> evaluates to <code class="code"><span class="hl-literal">"leapfrog"</span></code>.</li></ul></div>
</p>

<p>
Here is the full set of operators that Cor supports:

<div class="informaltable"><a name="ops-table"></a> 


<table border="0" width="80%"><colgroup><col align="left"><col align="left"><col align="left"><col align="left"><col align="left"><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th colspan="2" align="left">Arithmetic</th><th colspan="2" align="left">Comparison</th><th colspan="2" align="left">Logical</th><th colspan="2" align="left">String</th></tr></thead><tbody><tr><td align="left"><code class="code">+</code></td><td align="left">addition</td><td align="left"><code class="code">=</code></td><td align="left">equality</td><td align="left"><code class="code">&amp;&amp;</code></td><td align="left">logical and</td><td align="left"><code class="code">+</code></td><td align="left">concatenation</td></tr><tr><td align="left"><code class="code">-</code></td><td align="left">subtraction</td><td align="left"><code class="code">/=</code></td><td align="left">inequality</td><td align="left"><code class="code">||</code></td><td align="left">logical or</td><td colspan="2" align="left">&nbsp;</td></tr><tr><td align="left"><code class="code">*</code></td><td align="left">multiplication</td><td align="left"><code class="code">&lt;</code></td><td align="left">less than</td><td align="left"><code class="code">~</code></td><td align="left">logical not</td><td colspan="2" align="left">&nbsp;</td></tr><tr><td align="left"><code class="code">/</code></td><td align="left">division</td><td align="left"><code class="code">&gt;</code></td><td align="left">greater than</td><td colspan="2" align="left">&nbsp;</td><td colspan="2" align="left">&nbsp;</td></tr><tr><td align="left"><code class="code">%</code></td><td align="left">modulus</td><td align="left"><code class="code">&lt;=</code></td><td align="left">less than or equal</td><td colspan="2" align="left">&nbsp;</td><td colspan="2" align="left">&nbsp;</td></tr><tr><td colspan="2" align="left">&nbsp;</td><td align="left"><code class="code">&gt;=</code></td><td align="left">greater than or equal</td><td colspan="2" align="left">&nbsp;</td><td colspan="2" align="left">&nbsp;</td></tr></tbody></table>
</div>

</p>


<p>
The <code class="code">=</code> operator can compare values of any type.
</p>

<p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code"><span class="hl-literal">10</span> = <span class="hl-literal">true</span></code> evaluates to <code class="code"><span class="hl-literal">false</span></code>.</li></ul></div>
</p>

<p>
Sometimes, there are situations where an expression is stuck, because it is attempting to perform 
some impossible operation and cannot reach a value. If this is the case, we say that the expression
is <em class="firstterm">silent</em>. An expression is also silent if it depends on the result of a silent 
subexpression.
</p>

<p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code"><span class="hl-literal">10</span> / <span class="hl-literal">0</span></code> is silent.</li><li><code class="code"><span class="hl-literal">6</span> + <span class="hl-literal">false</span></code> is silent.</li><li><code class="code"><span class="hl-literal">3</span> + <span class="hl-literal">1</span>/<span class="hl-literal">0</span></code> is silent.</li><li><code class="code"><span class="hl-literal">4</span> + <span class="hl-literal">true</span> = <span class="hl-literal">5</span></code> is silent.</li></ul></div>
</p>

<p>
Note that Cor is a dynamically typed language. It does not statically check the type correctness
of an expression; instead, an expression with a type error is simply silent when evaluated.
</p>

</div>


<div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N203CC"></a>1.2.3.&nbsp;Conditionals</h3></div></div></div>

<p>
A conditional expression in Cor is of the form 
<code class="code"><span class="hl-keyword">if</span></code> E <code class="code"><span class="hl-keyword">then</span></code> F <code class="code"><span class="hl-keyword">else</span></code> G. 
Its meaning is similar to that in other languages: the value
of the expression is the value of F if and only if E evaluates to true, 
or the value of G if and only if E evaluates to false. Note that G is not
evaluated at all if E evaluates to true, and similarly F is not evaluated
at all of E evaluates to false. Thus, for example, evaluation of 
<code class="code"><span class="hl-keyword">if</span> <span class="hl-literal">3</span> = <span class="hl-literal">3</span> <span class="hl-keyword">then</span> <span class="hl-literal">5</span> <span class="hl-keyword">else</span> <span class="hl-literal">1</span>/<span class="hl-literal">0</span></code> does not cause any error. 
</p>

<p>
Unlike other languages, expressions in Cor may be silent. If E is
silent, then the entire expression is silent. And if E evaluates to true 
but F is silent (or if E evaluates to false and G is silent) then the 
expression is silent.
</p>

<p>
The behavior of conditionals is summarized by the following table
(<span class="emphasis"><em>v</em></span> denotes a value).

<div class="informaltable"><a name="cond-table"></a> 


<table border="0" width="60%"><colgroup><col align="center"><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th align="center">E</th><th align="center">F</th><th align="center">G</th><th align="center"><code class="code"><span class="hl-keyword">if</span></code> E <code class="code"><span class="hl-keyword">then</span></code> F <code class="code"><span class="hl-keyword">else</span></code> G</th></tr></thead><tbody><tr><td align="center"><code class="code"><span class="hl-literal">true</span></code></td><td align="center"><span class="emphasis"><em>v</em></span></td><td align="center">-</td><td align="center"><span class="emphasis"><em>v</em></span></td></tr><tr><td align="center"><code class="code"><span class="hl-literal">true</span></code></td><td align="center">silent</td><td align="center">-</td><td align="center">silent</td></tr><tr><td align="center"><code class="code"><span class="hl-literal">false</span></code></td><td align="center">-</td><td align="center"><span class="emphasis"><em>v</em></span></td><td align="center"><span class="emphasis"><em>v</em></span></td></tr><tr><td align="center"><code class="code"><span class="hl-literal">false</span></code></td><td align="center">-</td><td align="center">silent</td><td align="center">silent</td></tr><tr><td align="center">silent</td><td align="center">-</td><td align="center">-</td><td align="center">silent</td></tr></tbody></table>
</div>

</p>

<p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code"><span class="hl-keyword">if</span> <span class="hl-literal">true</span> <span class="hl-keyword">then</span> <span class="hl-literal">4</span> <span class="hl-keyword">else</span> <span class="hl-literal">5</span></code> evaluates to <code class="code"><span class="hl-literal">5</span></code>.</li><li><code class="code"><span class="hl-keyword">if</span>  <span class="hl-literal">2</span> &lt; <span class="hl-literal">3</span> &amp;&amp; <span class="hl-literal">5</span> &lt; <span class="hl-literal">4</span>  <span class="hl-keyword">then</span> <span class="hl-literal">"blue"</span> <span class="hl-keyword">else</span> <span class="hl-literal">"green"</span></code> evaluates to "green".</li><li><code class="code"><span class="hl-keyword">if</span>  <span class="hl-literal">true</span> || <span class="hl-literal">"fish"</span>  <span class="hl-keyword">then</span> <span class="hl-literal">"yes"</span> <span class="hl-keyword">else</span> <span class="hl-literal">"no"</span></code> is silent.</li><li><code class="code"><span class="hl-keyword">if</span>  <span class="hl-literal">false</span> || <span class="hl-literal">false</span>  <span class="hl-keyword">then</span> <span class="hl-literal">4</span>+<span class="hl-literal">true</span> <span class="hl-keyword">else</span> <span class="hl-literal">4</span>+<span class="hl-literal">5</span></code> is silent.</li><li><code class="code"><span class="hl-keyword">if</span> <span class="hl-literal">0</span> &lt; <span class="hl-literal">5</span> <span class="hl-keyword">then</span> <span class="hl-literal">0</span>/<span class="hl-literal">5</span> <span class="hl-keyword">else</span> <span class="hl-literal">5</span>/<span class="hl-literal">0</span></code> evaluates to 0.</li></ul></div>
</p>


</div>


<div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N204A4"></a>1.2.4.&nbsp;Variables</h3></div></div></div>

<p>
A <em class="firstterm">variable</em> names the value of some expression so that we can use it later.
Expression <code class="code"><span class="hl-variable">x</span></code>, where x is some variable name, evaluates to the result <em class="firstterm">bound</em>
to the variable x.
</p>

<p>
Variables are bound using a <em class="firstterm">declaration</em>. A declaration is a statement that has no value 
of its own but instead binds one or more variables. The simplest form of declaration is <code class="code"><span class="hl-keyword">val</span></code>, which 
evaluates an expression and binds its result to a variable. Declarations follow the rules of 
<a class="ulink" href="http://en.wikipedia.org/wiki/Lexical_scope" target="_top">lexical scoping</a>.
</p>

<p>
<pre class="programlisting">
<span class="hl-keyword">val</span> <span class="hl-variable">x</span> = <span class="hl-literal">1</span> + <span class="hl-literal">2</span> + <span class="hl-literal">3</span> + <span class="hl-literal">4</span> + <span class="hl-literal">5</span>
<span class="hl-keyword">val</span> <span class="hl-variable">y</span> = <span class="hl-variable">x</span> + <span class="hl-variable">x</span>
</pre>

These declarations bind variable <code class="code"><span class="hl-variable">x</span></code> to 15 and variable <code class="code"><span class="hl-variable">y</span></code> to 30.
</p>


<p>
If the expression on the right side of a <code class="code"><span class="hl-keyword">val</span></code> is silent, then the variable is not bound, but 
evaluation of other declarations and expressions can continue. If an evaluated expression depends on that
variable, that expression is silent.

<pre class="orc">
<span class="hl-keyword">val</span> <span class="hl-variable">x</span> = <span class="hl-literal">1</span>/<span class="hl-literal">0</span>
<span class="hl-keyword">val</span> <span class="hl-variable">y</span> = <span class="hl-literal">4</span>+<span class="hl-literal">5</span>
<span class="hl-keyword">if</span> <span class="hl-literal">false</span> <span class="hl-keyword">then</span> <span class="hl-variable">x</span> <span class="hl-keyword">else</span> <span class="hl-variable">y</span>
</pre>

Evaluation of the declaration and <code class="code"><span class="hl-keyword">val</span> <span class="hl-variable">y</span> = <span class="hl-literal">4</span>+<span class="hl-literal">5</span></code> and the expression <code class="code"><span class="hl-keyword">if</span> <span class="hl-literal">false</span> <span class="hl-keyword">then</span> <span class="hl-variable">x</span> <span class="hl-keyword">else</span> <span class="hl-variable">y</span></code>
may continue even though <code class="code"><span class="hl-variable">x</span></code> is not bound. The expression evaluates to 9.

</p>



</div>


<div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N204E3"></a>1.2.5.&nbsp;Data Structures</h3></div></div></div>

<p>
Cor supports two basic data structures, <em class="firstterm">tuples</em> and <em class="firstterm">lists</em>.
</p>

<p>
A <em class="firstterm">tuple expression</em> is a comma-separated sequence of at least two 
expressions, enclosed by parentheses. Each expression is evaluated; the value of the whole 
tuple expression is a tuple value containing each of these values in order. 
If any of the expressions is silent, then the whole tuple expression is silent.
</p>

<p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code">(<span class="hl-literal">1</span>+<span class="hl-literal">2</span>, <span class="hl-literal">7</span>)</code> evaluates to <code class="code">(<span class="hl-literal">3</span>,<span class="hl-literal">7</span>)</code>.</li><li><code class="code"> (<span class="hl-literal">"true"</span> + <span class="hl-literal">"false"</span>, <span class="hl-literal">true</span> || <span class="hl-literal">false</span>, <span class="hl-literal">true</span> &amp;&amp; <span class="hl-literal">false</span>) </code> evaluates to <code class="code">(<span class="hl-literal">"truefalse"</span>, <span class="hl-literal">true</span>, <span class="hl-literal">false</span>)</code>.</li><li><code class="code">(<span class="hl-literal">2</span>/<span class="hl-literal">2</span>, <span class="hl-literal">2</span>/<span class="hl-literal">1</span>, <span class="hl-literal">2</span>/<span class="hl-literal">0</span>)</code> is silent.</li></ul></div>
</p>

<p>
A <em class="firstterm">list expression</em> is a comma-separated sequence of expressions enclosed by
square brackets. It may be of any length, including zero. Each expression is evaluated; the value 
of the whole list expression is a list value containing each of these values in order.   
If any of the expressions is silent, then the whole list expression is silent.
</p>

<p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code">[<span class="hl-literal">1</span>,<span class="hl-literal">2</span>+<span class="hl-literal">3</span>] </code> evaluates to <code class="code">[<span class="hl-literal">1</span>,<span class="hl-literal">5</span>]</code>.</li><li><code class="code"> [<span class="hl-literal">true</span> &amp;&amp; <span class="hl-literal">true</span>]  </code> evaluates to <code class="code">[<span class="hl-literal">true</span>]</code>.</li><li><code class="code">[]</code> evaluates trivially to <code class="code">[]</code>, the empty list.</li><li><code class="code">[<span class="hl-literal">5</span>, <span class="hl-literal">5</span> + <span class="hl-literal">true</span>, <span class="hl-literal">5</span>]</code> is silent.</li></ul></div>
</p>

<p>
There is also a concatenation (<em class="firstterm">cons</em>) operation on lists,
written <span class="emphasis"><em>h</em></span><code class="code">:</code><span class="emphasis"><em>t</em></span>, where <span class="emphasis"><em>h</em></span>
and <span class="emphasis"><em>t</em></span> are expressions. Its result is a new list whose first element is the 
result of <span class="emphasis"><em>h</em></span> and whose remaining elements are the list result of
<span class="emphasis"><em>t</em></span>.
</p>

<p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code">(<span class="hl-literal">1</span>+<span class="hl-literal">3</span>):[<span class="hl-literal">2</span>+<span class="hl-literal">5</span>,<span class="hl-literal">6</span>]</code> evaluates to <code class="code">[<span class="hl-literal">4</span>,<span class="hl-literal">7</span>,<span class="hl-literal">6</span>]</code>.</li><li><code class="code"><span class="hl-literal">2</span>:<span class="hl-literal">2</span>:<span class="hl-literal">5</span>:[] </code> evaluates to <code class="code">[<span class="hl-literal">2</span>,<span class="hl-literal">2</span>,<span class="hl-literal">5</span>]</code>.</li><li>Suppose <code class="code"><span class="hl-variable">t</span></code> is bound to [3,5]. Then <code class="code"><span class="hl-literal">1</span>:<span class="hl-variable">t</span></code> evaluates to <code class="code">[<span class="hl-literal">1</span>,<span class="hl-literal">3</span>,<span class="hl-literal">5</span>]</code>.</li><li><code class="code"><span class="hl-literal">2</span>:<span class="hl-literal">3</span></code> is silent, because <code class="code"><span class="hl-literal">3</span></code> is not a list.</li></ul></div>
</p>


</div>

<div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N20584"></a>1.2.6.&nbsp;Patterns</h3></div></div></div>

<p>
We have seen how to construct data structures. But how do we examine them, and use them? We use <em class="firstterm">patterns</em>.
</p>

<p>
A pattern is a powerful way to bind variables. When writing <code class="code"><span class="hl-keyword">val</span></code> declarations, instead of just
binding one variable, we can replace the variable name with a more complex pattern that follows the structure of the
value, and matches its components. A pattern's structure is called its <em class="firstterm">shape</em>; a
pattern may take the shape of any structured value. A pattern can hierarchically match a value, going deep into its 
structure. It can also bind an entire structure to a variable.

</p>

<p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code"><span class="hl-keyword">val</span> (<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) = (<span class="hl-literal">2</span>+<span class="hl-literal">3</span>,<span class="hl-literal">2</span>*<span class="hl-literal">3</span>)</code> binds <code class="code"><span class="hl-variable">x</span></code> to 5 and <code class="code"><span class="hl-variable">y</span></code> to 6.</li><li>
<code class="code"><span class="hl-keyword">val</span> [<span class="hl-variable">a</span>,<span class="hl-variable">b</span>,<span class="hl-variable">c</span>] = [<span class="hl-literal">"one"</span>, <span class="hl-literal">"two"</span>, <span class="hl-literal">"three"</span>]</code> binds <code class="code"><span class="hl-variable">a</span></code> to "one", 
<code class="code"><span class="hl-variable">b</span></code> to "two", and <code class="code"><span class="hl-variable">c</span></code> to "three".
</li><li>
<code class="code"><span class="hl-keyword">val</span> ((<span class="hl-variable">a</span>,<span class="hl-variable">b</span>),<span class="hl-variable">c</span>) = ((<span class="hl-literal">1</span>, <span class="hl-literal">true</span>), (<span class="hl-literal">2</span>, <span class="hl-literal">false</span>))</code> binds <code class="code"><span class="hl-variable">a</span></code> to 1, <code class="code"><span class="hl-variable">b</span></code> to <code class="code"><span class="hl-literal">true</span></code>,
and <code class="code"><span class="hl-variable">c</span></code> to <code class="code">(<span class="hl-literal">2</span>,<span class="hl-literal">false</span>)</code>.
</li></ul></div>
</p>

<p>
Patterns are <em class="firstterm">linear</em>; that is, a pattern may mention a variable name at most once. 
For example, <code class="code">(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>,<span class="hl-variable">x</span>)</code> is not a valid pattern.
</p>

<p>
Note that a pattern may fail to match a value, if it does not have the same shape as that value. In a <code class="code"><span class="hl-keyword">val</span></code>
declaration, this has the same effect as evaluating a silent expression. No variable in the pattern is bound, and
if any one of those variables is later evaluated, it is silent.
</p>

<p>
It is often useful to ignore parts of the value that are not relevant. We can use the
wildcard pattern, written <code class="code"><span class="hl-variable">_</span></code>, to do this; it matches any shape and binds no
variables.
</p>

<p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code"><span class="hl-keyword">val</span> (<span class="hl-variable">x</span>,<span class="hl-variable">_</span>,<span class="hl-variable">_</span>) = (<span class="hl-literal">1</span>,(<span class="hl-literal">2</span>,<span class="hl-literal">2</span>),[<span class="hl-literal">3</span>,<span class="hl-literal">3</span>,<span class="hl-literal">3</span>])</code> binds <code class="code"><span class="hl-variable">x</span></code> to 1.</li><li><code class="code"><span class="hl-keyword">val</span> [[<span class="hl-variable">_</span>,<span class="hl-variable">x</span>],[<span class="hl-variable">_</span>,<span class="hl-variable">y</span>]] = [[<span class="hl-literal">1</span>,<span class="hl-literal">3</span>],[<span class="hl-literal">2</span>,<span class="hl-literal">4</span>]]</code> binds <code class="code"><span class="hl-variable">x</span></code> to 3 and <code class="code"><span class="hl-variable">y</span></code> to 4.</li></ul></div>
</p>

</div>

<div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N205FF"></a>1.2.7.&nbsp;Functions</h3></div></div></div>

<p>
Like most other programming languages, Cor has the capability to define <em class="firstterm">functions</em>,
which are expressions that have a defined name, and have some number of parameters. Functions are declared 
using the keyword <code class="code"><span class="hl-keyword">def</span></code>, in the following way.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-site">add</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) = <span class="hl-variable">x</span>+<span class="hl-variable">y</span>
</pre>

The expression on the right of the <code class="code">=</code> is called the <em class="firstterm">body</em> of the function.
</p>

<p>
After defining the function, we can <em class="firstterm">call</em> it. A call looks just like the left side of
the declaration except that the variable names (the <em class="firstterm">formal parameters</em>) have been 
replaced by expressions (the <em class="firstterm">actual parameters</em>). 
</p>

<p>
To evaluate a call, we treat it as a sequence of <code class="code"><span class="hl-keyword">val</span></code> declarations associating the formal
parameters with the actual parameters, followed by the body of the function. 

<pre class="programlisting">
<span class="hl-comment">{- Evaluation of add(1+2,3+4) -}</span>
<span class="hl-keyword">val</span> <span class="hl-variable">x</span> = <span class="hl-literal">1</span>+<span class="hl-literal">2</span>
<span class="hl-keyword">val</span> <span class="hl-variable">y</span> = <span class="hl-literal">3</span>+<span class="hl-literal">4</span>
<span class="hl-variable">x</span>+<span class="hl-variable">y</span>
</pre>
</p>

<p>
<div class="itemizedlist"><p class="title"><b>Examples</b></p><ul type="disc"><li><code class="code"><span class="hl-site">add</span>(<span class="hl-literal">10</span>,<span class="hl-literal">10</span>*<span class="hl-literal">10</span>)</code> evaluates to <code class="code"><span class="hl-literal">110</span></code>.</li><li><code class="code"><span class="hl-site">add</span>(<span class="hl-site">add</span>(<span class="hl-literal">5</span>,<span class="hl-literal">3</span>),<span class="hl-literal">5</span>)</code> evaluates to <code class="code"><span class="hl-literal">13</span></code>.</li></ul></div>
</p>

<p>
Notice that the evaluation strategy of functions allows to call to proceed even if some of the actual
parameters to be silent, so long as the values of those actual parameters are not used in the evaluation
of the body.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-site">cond</span>(<span class="hl-variable">b</span>,<span class="hl-variable">x</span>,<span class="hl-variable">y</span>) = <span class="hl-keyword">if</span> <span class="hl-variable">b</span> <span class="hl-keyword">then</span> <span class="hl-variable">x</span> <span class="hl-keyword">else</span> <span class="hl-variable">y</span>
<span class="hl-site">cond</span>(<span class="hl-literal">true</span>, <span class="hl-literal">3</span>, <span class="hl-literal">5</span>/<span class="hl-literal">0</span>)
</pre>

This evaluates to <code class="code"><span class="hl-literal">3</span></code> even though <code class="code"><span class="hl-literal">5</span>/<span class="hl-literal">0</span></code> is silent, because <code class="code"><span class="hl-variable">y</span></code> is not
needed.

</p>


<p>
A definition or a call may have zero arguments, in which case we write <code class="code">()</code> for the arguments.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-site">zero</span>() = <span class="hl-literal">0</span>
</pre>
</p>


<div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N2065A"></a>1.2.7.1.&nbsp;Recursion</h4></div></div></div>

<p>
Definitions can be recursive; that is, the name of a definition may be used in its own body.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-site">sumto</span>(<span class="hl-variable">n</span>) = <span class="hl-keyword">if</span> <span class="hl-variable">n</span> &lt; <span class="hl-literal">1</span> <span class="hl-keyword">then</span> <span class="hl-literal">0</span> <span class="hl-keyword">else</span> <span class="hl-variable">n</span> + <span class="hl-site">sumto</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>)
</pre>

Then, <code class="code"><span class="hl-site">sumto</span>(<span class="hl-literal">5</span>)</code> evaluates to 15.
</p>  

<p>
Mutual recursion is also supported.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-site">even</span>(<span class="hl-variable">n</span>) = 
  <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &gt; <span class="hl-literal">0</span>) <span class="hl-keyword">then</span> <span class="hl-site">odd</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>)
  <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &lt; <span class="hl-literal">0</span>) <span class="hl-keyword">then</span> <span class="hl-site">odd</span>(<span class="hl-variable">n</span>+<span class="hl-literal">1</span>)
  <span class="hl-keyword">else</span> <span class="hl-literal">true</span>
<span class="hl-keyword">def</span> <span class="hl-site">odd</span>(<span class="hl-variable">n</span>) = 
  <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &gt; <span class="hl-literal">0</span>) <span class="hl-keyword">then</span> <span class="hl-site">even</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>)
  <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &lt; <span class="hl-literal">0</span>) <span class="hl-keyword">then</span> <span class="hl-site">even</span>(<span class="hl-variable">n</span>+<span class="hl-literal">1</span>)
  <span class="hl-keyword">else</span> <span class="hl-literal">false</span>
</pre>

There is no special keyword for mutual recursion; any contiguous sequence of function declarations is assumed to be 
mutually recursive.
</p>

</div>

<div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N2066E"></a>1.2.7.2.&nbsp;Closure</h4></div></div></div>

<p>
Functions are actually values, just like any other value. Defining a function creates a special value called a 
<em class="firstterm">closure</em>; the name of the function is a variable and its bound value is the closure. Thus, 
a closure can be put into a data structure, or bound to some other variable, just like any other value.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-site">a</span>(<span class="hl-variable">x</span>) = <span class="hl-variable">x</span>-<span class="hl-literal">3</span>
<span class="hl-keyword">def</span> <span class="hl-site">b</span>(<span class="hl-variable">y</span>) = <span class="hl-variable">y</span>*<span class="hl-literal">4</span>
<span class="hl-keyword">val</span> <span class="hl-variable">funs</span> = (<span class="hl-variable">a</span>,<span class="hl-variable">b</span>)
</pre>
</p>

<p>
Like any other value, a closure can be passed as an argument to another function. This means that Cor
supports <span class="emphasis"><em>higher-order</em></span> functions.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-site">onetwosum</span>(<span class="hl-variable">f</span>) = <span class="hl-site">f</span>(<span class="hl-literal">1</span>) + <span class="hl-site">f</span>(<span class="hl-literal">2</span>)
<span class="hl-keyword">def</span> <span class="hl-site">triple</span>(<span class="hl-variable">x</span>) = <span class="hl-variable">x</span> * <span class="hl-literal">3</span>
</pre>

Then, <code class="code"><span class="hl-site">onetwosum</span>(<span class="hl-variable">triple</span>)</code> is <code class="code"><span class="hl-site">triple</span>(<span class="hl-literal">1</span>) + <span class="hl-site">triple</span>(<span class="hl-literal">2</span>)</code>, which is <code class="code"><span class="hl-literal">1</span> * <span class="hl-literal">3</span> + <span class="hl-literal">2</span> * <span class="hl-literal">3</span></code>, which evaluates to <code class="code"><span class="hl-literal">9</span></code>.

</p>

<p>
Since all declarations (including function declarations) in Cor are lexically scoped, these closures are
<span class="emphasis"><em>lexical closures</em></span>. This means that when a closure is created, if the body of the
function contains any variables other than the formal parameters, the bindings for those variables are
stored in the closure. Then, when the closure is called, the evaluation of the function body uses those 
stored variable bindings.  
</p>


</div>

<div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N20697"></a>1.2.7.3.&nbsp;Lambda</h4></div></div></div>

<p>
Sometimes one would like to create a closure directly, without bothering to give it a name. 
There is a special keyword <code class="code"><span class="hl-keyword">lambda</span></code> for this purpose. By writing a function
definition with the keyword <code class="code"><span class="hl-keyword">lambda</span></code> instead of a function name, that definition
becomes an expression which evaluates to a closure. 

<pre class="orc">
<span class="hl-keyword">def</span> <span class="hl-site">onetwosum</span>(<span class="hl-variable">f</span>) = <span class="hl-site">f</span>(<span class="hl-literal">1</span>) + <span class="hl-site">f</span>(<span class="hl-literal">2</span>)

<span class="hl-site">onetwosum</span>( <span class="hl-keyword">lambda</span>(<span class="hl-variable">x</span>) = <span class="hl-variable">x</span> * <span class="hl-literal">3</span> )
<span class="hl-comment">{- 
  identical to:
  def triple(x) = x * 3
  onetwosum(triple)
-}</span>
</pre>

Then, <code class="code"><span class="hl-site">onetwosum</span>( <span class="hl-keyword">lambda</span>(<span class="hl-variable">x</span>) = <span class="hl-variable">x</span> * <span class="hl-literal">3</span> )</code> evaluates to 9. 

</p>

</div>


<div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N206AC"></a>1.2.7.4.&nbsp;Clauses</h4></div></div></div>

<p>
The combination of functions and pattern matching offers a powerful capability: 
<em class="firstterm">clausal</em> definition of functions. We can define expressions which execute 
different code depending on the structure of their arguments. 
</p>


<p>
Here's an example.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-site">sum</span>([]) = <span class="hl-literal">0</span>
<span class="hl-keyword">def</span> <span class="hl-site">sum</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>) = <span class="hl-variable">h</span> + <span class="hl-site">sum</span>(<span class="hl-variable">t</span>)
</pre>

<code class="code"><span class="hl-site">sum</span>(<span class="hl-variable">L</span>)</code> publishes the sum of the numbers in the list <code class="code"><span class="hl-variable">L</span></code>. It has two clauses: 
one which matches the empty list, and one which matches any nonempty list. If its argument is an empty 
list, it returns 0, the appropriate sum for an empty list. If the argument is a nonempty list, it adds 
the first element of that list to the sum of all of the other elements. In this way, it recursively finds 
the sum of the list.
</p>

<p>
A function may have multiple clauses, each of which has a sequence of patterns to match each argument, 
and a body expression. Naturally, all clauses of a function must have the same number of arguments. Any 
contiguous sequence of definitions with the same name and different arguments is interpreted as a clausal 
definition, where each individual declaration is a clause of the larger function. 
</p>

<p>
When the function is called, the clauses are tried in the order in which they appear until a match is found. 
If no clause matches, the call remains silent.
</p>

<p>
We allow a new form of pattern which is very useful in clausal definition of functions: a constant pattern.
A constant pattern is a match only for the same constant value. We can use this to define the "base case"
of a recursive function in a straightforward way.

<pre class="programlisting">
<span class="hl-comment">{- Fibonacci numbers -}</span>
<span class="hl-keyword">def</span> <span class="hl-site">fib</span>(<span class="hl-literal">0</span>) = <span class="hl-literal">1</span>
<span class="hl-keyword">def</span> <span class="hl-site">fib</span>(<span class="hl-literal">1</span>) = <span class="hl-literal">1</span>
<span class="hl-keyword">def</span> <span class="hl-site">fib</span>(<span class="hl-variable">n</span>) = <span class="hl-keyword">if</span> (<span class="hl-variable">n</span> &lt; <span class="hl-literal">0</span>) <span class="hl-keyword">then</span> <span class="hl-literal">0</span> <span class="hl-keyword">else</span> <span class="hl-site">fib</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>) + <span class="hl-site">fib</span>(<span class="hl-variable">n</span>-<span class="hl-literal">2</span>)
</pre>

<pre class="programlisting">
<span class="hl-comment">{- Take up to the first n elements from a list -}</span>
<span class="hl-keyword">def</span> <span class="hl-site">take</span>(<span class="hl-literal">0</span>,<span class="hl-variable">_</span>) = []
<span class="hl-keyword">def</span> <span class="hl-site">take</span>(<span class="hl-variable">_</span>,[]) = []
<span class="hl-keyword">def</span> <span class="hl-site">take</span>(<span class="hl-variable">n</span>,<span class="hl-variable">h</span>:<span class="hl-variable">t</span>) = <span class="hl-variable">h</span>:(<span class="hl-site">take</span>(<span class="hl-variable">n</span>-<span class="hl-literal">1</span>,<span class="hl-variable">t</span>))
</pre>
</p>

<p>
Mutual recursion and clausal definitions are allowed to occur together.
For example, this function takes a list and evaluates to a new list with every other element repeated:

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-site">stutter</span>([]) = []
<span class="hl-keyword">def</span> <span class="hl-site">stutter</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>) = <span class="hl-variable">h</span>:<span class="hl-variable">h</span>:<span class="hl-site">mutter</span>(<span class="hl-variable">t</span>)
<span class="hl-keyword">def</span> <span class="hl-site">mutter</span>([]) = []
<span class="hl-keyword">def</span> <span class="hl-site">mutter</span>(<span class="hl-variable">h</span>:<span class="hl-variable">t</span>) = <span class="hl-variable">h</span>:<span class="hl-site">stutter</span>(<span class="hl-variable">t</span>)
</pre>

<code class="code"><span class="hl-site">stutter</span>([<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>])</code> evaluates to <code class="code">[<span class="hl-literal">1</span>,<span class="hl-literal">1</span>,<span class="hl-literal">2</span>,<span class="hl-literal">3</span>,<span class="hl-literal">3</span>]</code>.
</p>

<p>
Clauses of mutually recursive functions may also be interleaved, to make
them easier to read.

<pre class="programlisting">
<span class="hl-keyword">def</span> <span class="hl-site">even</span>(<span class="hl-literal">0</span>) = <span class="hl-literal">true</span>
<span class="hl-keyword">def</span> <span class="hl-site">odd</span>(<span class="hl-literal">0</span>) = <span class="hl-literal">false</span>
<span class="hl-keyword">def</span> <span class="hl-site">even</span>(<span class="hl-variable">n</span>) = <span class="hl-site">odd</span>(<span class="hl-keyword">if</span> <span class="hl-variable">n</span> &gt; <span class="hl-literal">0</span> <span class="hl-keyword">then</span> <span class="hl-variable">n</span>-<span class="hl-literal">1</span> <span class="hl-keyword">else</span> <span class="hl-variable">n</span>+<span class="hl-literal">1</span>)
<span class="hl-keyword">def</span> <span class="hl-site">odd</span>(<span class="hl-variable">n</span>) = <span class="hl-site">even</span>(<span class="hl-keyword">if</span> <span class="hl-variable">n</span> &gt; <span class="hl-literal">0</span> <span class="hl-keyword">then</span> <span class="hl-variable">n</span>-<span class="hl-literal">1</span> <span class="hl-keyword">else</span> <span class="hl-variable">n</span>+<span class="hl-literal">1</span>)
</pre>

</p>

</div>

</div>

<div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N206E5"></a>1.2.8.&nbsp;Comments</h3></div></div></div>
<p>
Cor has two kinds of comments.   

</p>

<p>
A line which begins with two dashes (<code class="code"><span class="hl-comment">--</span></code>), preceded only by whitespace, is a single line comment.
The region from the two dashes to the next encountered newline, inclusive, is ignored.  
<pre class="programlisting">
<span class="hl-comment">-- This is a single line comment.</span>
	 <span class="hl-comment">-- This is also a single line comment.</span>
</pre>
</p>

<p>
Multiline comments are enclosed by matching braces of the form <code class="code"><span class="hl-comment">{- -}</span></code>. 
Multiline comments may be nested. They may appear anywhere, even in the middle of an expression.

<pre class="programlisting">
<span class="hl-comment">{- 
   This is a
   multiline comment.
-}</span>
   
<span class="hl-comment">{- Multiline comments {- can be nested -}</span> -}

<span class="hl-comment">{- They may appear anywhere, -}</span> 
<span class="hl-literal">1</span> + <span class="hl-comment">{- even in the middle of an expression. -}</span> <span class="hl-literal">2</span> + <span class="hl-literal">3</span>
</pre>

</p>

</div>

</div>



<div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N20700"></a>1.3.&nbsp;Orc: Orchestrating services</h2></div></div></div>


<p>
In this section we present the full Orc language. As in Cor, an Orc program is an 
<em class="firstterm">expression</em>; Orc expressions are built up recursively from smaller 
expressions. All Cor expressions are also Orc expressions.
</p>

<p>
Orc expressions are <em class="firstterm">executed</em>, rather than evaluated; an execution 
communicates with external services and <em class="firstterm">publishes</em> some number of 
values (possibly zero). If an execution publishes no value, it is called <em class="firstterm">silent</em>.
However, unlike silent expressions in Cor, a silent expression in Orc might perform some meaningful 
computation or communication; silence does not necessarily indicate an error.
</p>

<p>
In the following sections we discuss the features of Orc. First, we discuss how Orc
communicates with external services. Then we introduce Orc's concurrency <em class="firstterm">combinators</em>,
which combine expressions into larger orchestrations and manage concurrent executions. 
We have already discussed the functional subset of Orc in our coverage of Cor, but we
reprise some of those topics; some Cor constructs exhibit new behaviors in the 
concurrent, stateful context of Orc.
</p>

<p>
The following figure summarizes the new syntax that Orc introduces, as an extension
of the syntax of Cor.
</p>

<p>
<div class="informaltable"><a name="orc-ebnf-table"></a> 


<table border="0" width="80%"><colgroup><col align="right"><col align="center"><col align="left"><col align="left"><col align="left"></colgroup><tbody><tr><td align="right">D</td><td align="center">::=</td><td align="left"> ... </td><td align="left"><span class="emphasis"><em>Declaration</em></span></td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left"><code class="code"><span class="hl-keyword">site</span></code> X <code class="code">=</code> <span class="emphasis"><em>URL</em></span></td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>site declaration</em></span></td></tr><tr><td align="right">C</td><td align="center">::=</td><td align="left"> ... </td><td align="left"><span class="emphasis"><em>Constant</em></span></td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left"><code class="code"><span class="hl-keyword">signal</span></code></td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>signal value</em></span></td></tr><tr><td align="right">E</td><td align="center">::=</td><td align="left">...</td><td align="left"><span class="emphasis"><em>Expression</em></span></td><td align="left">&nbsp;</td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E <code class="code">|</code> E</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>bar combinator</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E <code class="code">&gt;</code>P<code class="code">&gt;</code> E</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>sequential combinator</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left">E <code class="code">&lt;</code>P<code class="code">&lt;</code> E</td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>asymmetric combinator</em></span></td></tr><tr><td align="right">&nbsp;</td><td align="center">|</td><td align="left"><code class="code"><span class="hl-keyword">stop</span></code></td><td align="left">&nbsp;</td><td align="left"><span class="emphasis"><em>silent expression</em></span></td></tr></tbody></table>
</div>
</p>

<div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N20806"></a>1.3.1.&nbsp;Communicating with external services</h3></div></div></div>

<p>
Cor is a pure declarative language. It has no state, since variables are bound at most once 
and cannot be reassigned. Evaluation of an expression results in at most one value.
It cannot communicate with the outside world except by producing a value. Clearly, the full 
Orc language must transcend these limitations, because the orchestration of external services 
is critical to Orc's purpose.
</p>

<p>
We introduce <em class="firstterm">sites</em>: Orc's interface to external services.
Sites are called using the same syntax as a function call, but with a slightly different 
meaning. Sites are values, introduced and bound to variables by a special declaration.
</p>

<div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N20813"></a>1.3.1.1.&nbsp;Calling a site</h4></div></div></div>

<p>
Suppose that the variable <code class="code"><span class="hl-variable">Google</span></code> is bound to a site which sends a 
string to the Google search engine and returns the URL of the top result. A call to
<code class="code"><span class="hl-variable">Google</span></code> looks just like a function call.

<pre class="programlisting">
<span class="hl-comment">{- Get the top search result for "computation orchestration" -}</span>
<span class="hl-site">Google</span>(<span class="hl-literal">"computation orchestration"</span>)
</pre>

When the Google search engine determines the top result for this search, it responds with
some URL. The site call then publishes that response. Note that the service might
never respond: Google's servers might be down, the network might be down, or the search 
might yield no result URL. If the service fails to respond, the site call remains
silent.
</p>


<p>
A site call sends only a single request to an external service and receives at most one
response. These restrictions have two important consequences. First, all of the information needed 
for the call must be present before contacting the service. Thus, site calls are strict; all 
arguments must be bound before the call can proceed. If any argument is silent, the call never occurs.
Second, a site call publishes at most one value, since at most one response is received.
</p>


<p>
A site is sometimes called purely for its effect on the external world; its return
value is irrelevant. Many sites which do not need to return a meaningful value will
instead return a <em class="firstterm">signal</em>: a special value which carries no 
information (analogous to the unit value <code class="code">()</code> in ML). The signal value
can be written as <code class="code"><span class="hl-keyword">signal</span></code> within Orc programs.


<pre class="orc">
<span class="hl-comment">-- Use the 'print' site to print a string to an output console</span>
<span class="hl-comment">-- The return value of this site call is a signal</span>
<span class="hl-site">println</span>(<span class="hl-literal">"Hello, World!"</span>)
</pre>
</p>


</div>


<div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N20837"></a>1.3.1.2.&nbsp;Declaring sites</h4></div></div></div>

<p>
A <code class="code"><span class="hl-keyword">site</span></code> declaration makes some service available as a site and
binds it to a variable. The service might be an object in the host language, 
an external service on the web accessed through some protocol like SOAP or REST, 
or even a primitive operation like addition. We will discuss the particulars of 
these declarations, and the guidelines for accessing web-based services or creating 
one's own services, in <a class="link" href="#chapter.services" title="Chapter&nbsp;3.&nbsp;Accessing and Creating External Services">Chapter 3</a>. Also,
many useful sites are already defined in the Orc standard library, documented
in <a class="link" href="#appendix.library" title="Appendix&nbsp;B.&nbsp;Standard Library">Appendix B</a>. For now, we present a simple 
type of site declaration: using an object in the host language as a site.  
</p>

<p>
The following example instantiates a Java object to be used as a site in an Orc program, specifically
a Java object which provides an asynchronous buffer service. The declaration uses a
fully qualified Java class name to find and load a class, and creates an instance of that
class to provide the service. 

<pre class="programlisting">
<span class="hl-comment">{-  Define the Buffer site  -}</span>
<span class="hl-keyword">site</span> <span class="hl-variable">Buffer</span> = <span class="hl-variable">orc</span>.<span class="hl-variable">lib</span>.<span class="hl-variable">state</span>.<span class="hl-variable">Buffer</span>
</pre>  
</p>

<p>

</p>
  
</div>

</div>


<div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N20854"></a>1.3.2.&nbsp;The concurrency combinators of Orc</h3></div></div></div>

<p>
Orc has three concurrency <em class="firstterm">combinators</em>: ways of connecting expressions together so that they can
be executed concurrently.
</p>

<div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N2085E"></a>1.3.2.1.&nbsp;The parallel combinator</h4></div></div></div>

<p>
Orc's simplest combinator is <code class="code">|</code>, the parallel combinator. Orc executes
the expression F <code class="code">|</code> G, where F and G are Orc expressions, by executing 
F and G concurrently. Whenever F or G communicates with a service or publishes a value, 
the whole execution does so as well.
</p>   


<p>
<pre class="programlisting">
<span class="hl-comment">-- Publish 1, 2, and 3 in parallel  </span>
<span class="hl-literal">1</span><span class="hl-combinator"> | </span><span class="hl-literal">2</span><span class="hl-combinator"> | </span><span class="hl-literal">1</span>+<span class="hl-literal">2</span>
</pre>
</p>  

<p>
<pre class="programlisting">
<span class="hl-comment">{- 
  Access two search sites, Google and Yahoo, in parallel.

  Publish any results they return.
  
  Since each call may publish a value, the expression
  may publish up to two values.
-}</span>  
<span class="hl-site">Google</span>(<span class="hl-literal">"cupcake"</span>)<span class="hl-combinator"> | </span><span class="hl-site">Yahoo</span>(<span class="hl-literal">"cupcake"</span>)
</pre>
</p>  

</div>

<div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N20878"></a>1.3.2.2.&nbsp;The sequential combinator</h4></div></div></div>

<p>
Now that we have expressions which publish multiple values, what can we do with those
publications? The sequential combinator, written F <code class="code">&gt;<span class="hl-variable">x</span>&gt;</code> G, 
combines the expression F, which publishes some values, with another expression G 
which will use those values as they are published, using <code class="code"><span class="hl-variable">x</span></code> to transmit
the values from from F to G.
</p>

<p>
The execution of F <code class="code">&gt;<span class="hl-variable">x</span>&gt;</code> G executes F. Whenever F publishes a value, 
a new copy of G is executed in parallel with F (and with any previous copies of G); in that
copy of G, <code class="code"><span class="hl-variable">x</span></code> is bound to the value published by F. Values published by copies
of G are published by the whole expression, but the values published by F are not published
by the whole expression; they are consumed by the variable binding.
</p>

<p>
<pre class="programlisting">
<span class="hl-comment">-- Publish 1 and 2 in parallel  </span>
(<span class="hl-literal">0</span><span class="hl-combinator"> | </span><span class="hl-literal">1</span>) <span class="hl-combinator">&gt;</span><span class="hl-variable">n</span><span class="hl-combinator">&gt;</span> <span class="hl-variable">n</span>+<span class="hl-literal">1</span>
</pre>
</p>  

<p>
<pre class="programlisting">
<span class="hl-comment">-- Publish 3 and 4 in parallel  </span>
<span class="hl-literal">2</span> <span class="hl-combinator">&gt;</span><span class="hl-variable">n</span><span class="hl-combinator">&gt;</span> (<span class="hl-variable">n</span>+<span class="hl-literal">1</span><span class="hl-combinator"> | </span><span class="hl-variable">n</span>+<span class="hl-literal">2</span>)
</pre>
</p>  


<p>
<pre class="programlisting">
<span class="hl-comment">-- Publish 1, 2, 3 and 4 in parallel  </span>
(<span class="hl-literal">0</span><span class="hl-combinator"> | </span><span class="hl-literal">2</span>) <span class="hl-combinator">&gt;</span><span class="hl-variable">n</span><span class="hl-combinator">&gt;</span> (<span class="hl-variable">n</span>+<span class="hl-literal">1</span><span class="hl-combinator"> | </span><span class="hl-variable">n</span>+<span class="hl-literal">2</span>)
</pre>
</p>  


<p>
<pre class="programlisting">
<span class="hl-comment">-- Prepend the string "Result: " to each published search result</span>
<span class="hl-comment">-- The cat site concatenates any number of arguments into one string  </span>
(<span class="hl-site">Google</span>(<span class="hl-literal">"cupcake"</span>)<span class="hl-combinator"> | </span><span class="hl-site">Yahoo</span>(<span class="hl-literal">"cupcake"</span>)) <span class="hl-combinator">&gt;</span><span class="hl-variable">s</span><span class="hl-combinator">&gt;</span> <span class="hl-site">cat</span>(<span class="hl-literal">"Result: "</span>, <span class="hl-variable">s</span>)
</pre>
</p>  




<p>
The sequential combinator may be written as F <code class="code">&gt;</code>P<code class="code">&gt;</code> G, 
where P is a pattern instead of just a variable name. Any value published by F is matched against the 
pattern P. If this match is successful, a new copy of G is started with all of the bindings from the match. 
Otherwise, the published value is simply ignored, and no new copy of G is executed.
</p>

<p>
<pre class="programlisting">
<span class="hl-comment">-- Publish the elements of a triple in unspecified order</span>
<span class="hl-comment">-- Publishes 3, 6, and 9</span>
(<span class="hl-literal">3</span>,<span class="hl-literal">6</span>,<span class="hl-literal">9</span>)  <span class="hl-combinator">&gt;</span>(<span class="hl-variable">x</span>,<span class="hl-variable">y</span>,<span class="hl-variable">z</span>)<span class="hl-combinator">&gt;</span>  ( <span class="hl-variable">x</span><span class="hl-combinator"> | </span><span class="hl-variable">y</span><span class="hl-combinator"> | </span><span class="hl-variable">z</span> )
</pre>
</p>


<p>
<pre class="programlisting">
<span class="hl-comment">-- Publish x from any tuple of the form (1,x)</span>
<span class="hl-comment">-- Publishes 4 and 6  </span>
( (<span class="hl-literal">1</span>,<span class="hl-literal">4</span>)<span class="hl-combinator"> | </span>(<span class="hl-literal">2</span>,<span class="hl-literal">5</span>)<span class="hl-combinator"> | </span>(<span class="hl-literal">1</span>,<span class="hl-literal">6</span>) )  <span class="hl-combinator">&gt;</span>(<span class="hl-literal">1</span>,<span class="hl-variable">x</span>)<span class="hl-combinator">&gt;</span> <span class="hl-variable">x</span>
</pre>
</p>
 


<p>
We may also omit the variable entirely, writing <code class="code">&gt;&gt;</code>. This
is equivalent to using a wildcard pattern: <code class="code">&gt;<span class="hl-variable">_</span>&gt;</code>
</p>

<p>
We may want to execute an expression just for its effects, and hide all of its publications.
We can do this using <code class="code">&gt;&gt;</code> together with the special expression 
<code class="code"><span class="hl-keyword">stop</span></code>, which is always silent.  
</p>

<p>
<pre class="programlisting">
<span class="hl-comment">{- 
  Print two strings to the console,
  but don't publish the return values of the print calls.
-}</span>
( <span class="hl-site">print</span>(<span class="hl-literal">"goodbye"</span>)<span class="hl-combinator"> | </span><span class="hl-site">print</span>(<span class="hl-literal">"world"</span>) ) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-keyword">stop</span>
</pre>
</p>


</div>


<div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N208D4"></a>1.3.2.3.&nbsp;The asymmetric combinator</h4></div></div></div>

<p>
The asymmetric combinator, written F <code class="code">&lt;<span class="hl-variable">x</span>&lt;</code> G, allows us to block 
a computation waiting for a result, or terminate a computation.
</p> 

<p>
As with the sequential combinator, we consider the simple, one-variable case first. 
The execution of F <code class="code">&lt;<span class="hl-variable">x</span>&lt;</code> G starts executing F and G in parallel. Whenever
F publishes a value, that value is published by the entire execution. When G publishes
its first value, that value is bound to x in F, and then G is immediately <em class="firstterm">terminated</em>.
</p>

<p>
A terminated expression cannot perform any more execution; if it is in the process of communicating
with an external service, that communication is allowed to complete but the response is ignored.
</p>

<p>
<pre class="programlisting">
<span class="hl-comment">-- Publish either 5 or 6, but not both</span>
<span class="hl-variable">x</span>+<span class="hl-literal">2</span> <span class="hl-combinator">&lt;</span><span class="hl-variable">x</span><span class="hl-combinator">&lt;</span> <span clas