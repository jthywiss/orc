<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>7.2.&nbsp;Virtual Time</title><meta content="DocBook XSL-NS Stylesheets V1.76.1" name="generator"><link rel="home" href="index.html" title="Orc Reference Manual v2.1.0"><link rel="up" href="ref.time.html" title="Chapter&nbsp;7.&nbsp;Time"><link rel="prev" href="ref.time.real.html" title="7.1.&nbsp;Real Time"><link rel="next" href="ref.concepts.html" title="Chapter&nbsp;8.&nbsp;Concepts"><link rel="copyright" href="legalnotice.html" title="License and Grant Information"><link xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" type="text/css" rel="stylesheet" href="/orchard/orc.css"><link xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" href="style.css" type="text/css" rel="stylesheet"><script xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" type="text/javascript">
// Expandable content script from flooble.com.
// For more information please visit:
// http://www.flooble.com/scripts/expand.php
// Copyright 2002 Animus Pactum Consulting Inc.
//----------------------------------------------
function toggle(link, divId) {
	var lText = link.innerHTML;
	var d = document.getElementById(divId);
	if (lText == '+') {
		link.innerHTML = '&#8722;';
		d.style.display = 'block';
	} else {
		link.innerHTML = '+';
		d.style.display = 'none';
	}
}
</script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3"><a accesskey="h" href="index.html"><img src="images/home.gif" alt="Table of Contents"></a></th></tr><tr><td align="left" width="20%"><a accesskey="p" href="ref.time.real.html"><img src="images/prev.gif" alt="Prev"></a>&nbsp;</td><th align="center" width="60%"><a accesskey="u" href="ref.time.html">Chapter&nbsp;7.&nbsp;Time</a></th><td align="right" width="20%">&nbsp;<a accesskey="n" href="ref.concepts.html"><img src="images/next.gif" alt="Next"></a></td></tr><tr><td align="left" width="20%"><a href="ref.time.real.html">7.1.&nbsp;Real Time</a>&nbsp;</td><th align="center" width="60%">7.2.&nbsp;Virtual Time</th><td align="right" width="20%"><a href="ref.concepts.html">Chapter&nbsp;8.&nbsp;Concepts</a>&nbsp;</td></tr></table></div><div class="section" title="7.2.&nbsp;Virtual Time"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ref.time.virtual"></a>7.2.&nbsp;Virtual Time</h2></div></div></div><p>
			Virtual time provides the ability to order events in an Orc execution.
			As an expression is executed, the Orc runtime tracks the "current" virtual time.
			A <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code> site call waits for a particular point in time.
			Through use of <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code>, one can set up temporal dependencies among Orc expressions.
		</p><p>
			Simulations in Orc can make use of virtual time to simulate time passage without the unproductive delays caused by real time waits.
			Certain algorithms can be succinctly expressed using virtual time.  (See the shortest path example.)
		</p><p>
			An Orc virtual clock is created with four parameters, conceptually:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>A set of points of time (for example, the integers)</p></li><li class="listitem"><p>Equality and total ordering relations over this set (for example, = and &lt;)</p></li><li class="listitem"><p>Optionally, a parent clock</p></li><li class="listitem"><p>The scope (part of the program) over which it applies</p></li></ul></div><p>
			(In an actual Orc program, only the total ordering relation is given as an actual argument to a <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vclock</span></code> call.
			The other parameters are implicit.)
		</p><p>
			During execution. a virtual clock tracks:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The current time</p></li><li class="listitem"><p>A priority queue of pending <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code> calls, in order of their awaited time, as given by the clock's total ordering relation.</p></li></ul></div><p>
			When <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code> is called with a time value greater than the current time, that call is enqueued, and does not return until that time.
			Virtual time advances when all execution in the clock's scope becomes <em class="firstterm">quiescent</em>, defined below.
			Upon quiescence in a clock's scope, the clock's current time is updated to the least time among its waiters, and all <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code> calls for that time return.
		</p><div class="section" title="7.2.1.&nbsp;Quiescence"><div class="titlepage"><div><div><h3 class="title"><a name="ref.time.virtual.quiescence"></a>7.2.1.&nbsp;Quiescence</h3></div></div></div><p>
				An expression is <a name="N42B8A" class="indexterm"></a><em class="firstterm">quiescent</em> when
				all execution in the expression is either blocked on variables, blocked on certain site calls, halted, or killed.
				In other words, quiescence means no progress can be made in the expression without certain kinds of unblocking.
				Most site calls are not considered quiescent while they are invoked, however a few are;
				most notably <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code> when it is called with a future time value argument.
				Other not-quiescent-while-invoked sites are documented in their entry in the <a class="link" href="ref.concepts.publish.html" title="8.1.&nbsp;Publication">Standard Library</a> chapter.
				Child virtual clocks are not quiescent until all execution in their scope has halted.
				So, a child clock whose scope is quiescent but not halted is non-quiescent from the viewpoint of the parent clock.
			</p><p>
				Note that expressions blocked on variables are quiescent.
				This normally is the intuitive behavior: for example, <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">x</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-combinator">&lt;</span><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">x</span><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-combinator">&lt;</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-site">Q</span>()</code> is quiescent if the call to <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Q</span></code> is.
				However, if the right side of a pruning combinator is not in the clock's scope, then blocking on a variable bound by the pruning combinator will be quiescent.
				This might be surprising: Suppose <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-keyword">val</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">x</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-operator">=</span> </code><em class="replaceable"><code>F</code></em> is followed by <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-site">Vclock</span>(<span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">IntegerTimeOrdering</span>) <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-combinator">&gt;</span><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-combinator">&gt;</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">x</span></code>.
				The virtual clock scope <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">x</span></code> will be quiescent if executed before <em class="replaceable"><code>F</code></em> has published and <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">x</span></code> has a bound value.
				To avoid this, use the Orc <a href="../userguide/userguide.html#ug.idioms.forkjoin" class="olink">join idiom</a>.
				Before calling <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vclock</span></code>, join all potentially-unbound variables used inside the clock scope, like so: <code class="code">(<span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">x</span>, <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">y</span>, <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">z</span>) <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-combinator">&gt;</span><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-combinator">&gt;</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-site">Vclock</span>(<span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">IntegerTimeOrdering</span>) <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-combinator">&gt;</span><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-combinator">&gt;</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">x</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-operator">+</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">y</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-operator">+</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">z</span></code>.
			</p></div><div class="section" title="7.2.2.&nbsp;Vclock"><div class="titlepage"><div><div><h3 class="title"><a name="ref.time.virtual.Vclock"></a>7.2.2.&nbsp;Vclock</h3></div></div></div><p>
				Executing <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-site">Vclock</span>(<span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">timeComparator</span>) <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-combinator">&gt;</span><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-combinator">&gt;</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">e</span></code> executes the expression <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">e</span></code> with a virtual clock that has time values ordered by <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">timeComparator</span></code>.
				A time comparator operates on a particular time value type, for example integers.
				A time comparator is a site that takes two arguments, each of the time value type, and returns the value -1, 0, or 1 to indicate the first argument is less than, equal to, or greater than, respectively, the second argument.
				Note that in the current version of Orc, the site must be a Java site; it cannot be defined in Orc.
				(This limitation may be removed in a future Orc release.)
				The time value type of a clock is implicitly defined by the type of arguments that the given time comparator site accepts.
				The initial value of a virtual clock is established by the first <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code> call in the clock's scope that publishes.
			</p><p>
			    The scope over which a virtual clock is effective is the right side of the pruning combinator in <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-site">Vclock</span>(<span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">timeComparator</span>) <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-combinator">&gt;</span><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-combinator">&gt;</span> <span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">e</span></code>.
			    A <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vclock</span></code> call can only be used on the left side of a sequential combinator; use in any other context will be marked by the compiler as an error.
				When the expression <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">e</span></code> <a class="link" href="ref.concepts.publish.html" title="8.1.&nbsp;Publication">publishes</a>, the publication, as usual, is a publication of the sequential combinator expression.
				If the <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vclock</span></code> call is in the scope of another virtual clock, that clock is considered the parent clock of this clock.
			</p></div><div class="section" title="7.2.3.&nbsp;Vawait"><div class="titlepage"><div><div><h3 class="title"><a name="ref.time.virtual.Vawait"></a>7.2.3.&nbsp;Vawait</h3></div></div></div><p>
				Executing <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-site">Vawait</span>(</code><em class="replaceable"><code>t</code></em><code class="code">)</code> waits quiescently until the the current (innermost) virtual clock advances to time <em class="replaceable"><code>t</code></em>.
				There may be more than one <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code> call awaiting a given time value.
				All such calls will publish at the same time.
				Exactly one call, selected arbitrarily, will publish <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-literal">true</span></code>, and the others (if any) will publish <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-literal">false</span></code>.
				If <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-site">Vawait</span>(</code><em class="replaceable"><code>t</code></em><code class="code">)</code> is called when the current virtual time is already <em class="replaceable"><code>t</code></em>, the call immediately publishes <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-literal">false</span></code>, without becoming quiescent.
				If the current virtual time is greater than <em class="replaceable"><code>t</code></em>, the call <a class="link" href="ref.concepts.states.html#ref.concepts.states.halt" title="8.3.3.&nbsp;Halted">halts</a> <a class="link" href="ref.concepts.silent.html" title="8.2.&nbsp;Silence">silently</a>.
				If the current virtual clock does not have defined time&mdash;that is, <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code> has not been called yet in the scope of this clock&mdash;then the <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code> behaves as if its argument is a future time value.
				If <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code> is called outside of the scope of any virtual clock, the call halts silently.
			</p></div><div class="section" title="7.2.4.&nbsp;Vtime"><div class="titlepage"><div><div><h3 class="title"><a name="ref.time.virtual.Vtime"></a>7.2.4.&nbsp;Vtime</h3></div></div></div><p>
				The <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vtime</span></code> site publishes the current value of the current (innermost) virtual clock.
				If the clock has not had a value set by a <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code> call, or <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vtime</span></code> is calls outside of the scope of any virtual clock, <code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vtime</span></code> halts silently.
			</p></div><div class="section" title="7.2.5.&nbsp;Examples"><div class="titlepage"><div><div><h3 class="title"><a name="ref.time.virtual.examples"></a>7.2.5.&nbsp;Examples</h3></div></div></div><div xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="example"><div class="exampleHeading"><a class="showHideToggle" href="javascript: void(0);" title="show/hide" id="ref.time.virtual.examples.shortestpath_link" onclick="toggle(this, 'ref.time.virtual.examples.shortestpath_content')">
					&minus;
				</a><span class="exampleCaption">Shortest path using a virtual clock</span></div><div class="exampleBody" id="ref.time.virtual.examples.shortestpath_content"><pre class="orc">
<span class="hl-comment">{- Shortest path through a directed graph, using a virtual clock -}</span>

<span class="hl-keyword">def</span> <span class="hl-site">Vwait</span>(<span class="hl-variable">t</span> <span class="hl-operator">:</span><span class="hl-operator">:</span> <span class="hl-variable">Integer</span>) <span class="hl-operator">=</span> <span class="hl-site">Vawait</span>(<span class="hl-variable">t</span> <span class="hl-operator">+</span> (<span class="hl-site">Vtime</span>() <span class="hl-operator">:</span>!<span class="hl-operator">:</span> <span class="hl-variable">Integer</span>))

<span class="hl-site">Vclock</span>(<span class="hl-variable">IntegerTimeOrder</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> <span class="hl-site">Vawait</span>(<span class="hl-literal">0</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span> (
<span class="hl-keyword">type</span> <span class="hl-variable">Node</span> <span class="hl-operator">=</span> <span class="hl-variable">Integer</span>
<span class="hl-keyword">type</span> <span class="hl-variable">Distance</span> <span class="hl-operator">=</span> <span class="hl-variable">Integer</span>

<span class="hl-keyword">def</span> <span class="hl-site">path</span>(<span class="hl-variable">source</span> <span class="hl-operator">:</span><span class="hl-operator">:</span> <span class="hl-variable">Node</span>,
		 <span class="hl-variable">sink</span> <span class="hl-operator">:</span><span class="hl-operator">:</span> <span class="hl-variable">Node</span>,
		 <span class="hl-variable">cell</span> <span class="hl-operator">:</span><span class="hl-operator">:</span> <span class="hl-keyword">lambda</span>(<span class="hl-variable">Node</span>) <span class="hl-operator">:</span><span class="hl-operator">:</span> <span class="hl-site">Cell</span>[<span class="hl-site">List</span>[<span class="hl-variable">Node</span>]],
		 <span class="hl-variable">succ</span> <span class="hl-operator">:</span><span class="hl-operator">:</span> <span class="hl-keyword">lambda</span>(<span class="hl-variable">Node</span>) <span class="hl-operator">:</span><span class="hl-operator">:</span> (<span class="hl-variable">Node</span>,<span class="hl-variable">Distance</span>)
		 ) <span class="hl-operator">:</span><span class="hl-operator">:</span> <span class="hl-site">List</span>[<span class="hl-variable">Node</span>] <span class="hl-operator">=</span>
  <span class="hl-keyword">def</span> <span class="hl-site">run</span>(<span class="hl-variable">n</span> <span class="hl-operator">:</span><span class="hl-operator">:</span> <span class="hl-variable">Node</span>, <span class="hl-variable">p</span> <span class="hl-operator">:</span><span class="hl-operator">:</span> <span class="hl-site">List</span>[<span class="hl-variable">Node</span>]) <span class="hl-operator">:</span><span class="hl-operator">:</span> <span class="hl-variable">Bot</span> <span class="hl-operator">=</span>
    <span class="hl-site">cell</span>(<span class="hl-variable">n</span>).<span class="hl-site">write</span>(<span class="hl-variable">p</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
    <span class="hl-site">succ</span>(<span class="hl-variable">n</span>) <span class="hl-combinator">&gt;</span>(<span class="hl-variable">m</span>,<span class="hl-variable">d</span>)<span class="hl-combinator">&gt;</span>
    <span class="hl-site">Vwait</span>(<span class="hl-variable">d</span>) <span class="hl-combinator">&gt;</span><span class="hl-combinator">&gt;</span>
    <span class="hl-site">run</span>(<span class="hl-variable">m</span>,<span class="hl-variable">m</span><span class="hl-operator">:</span><span class="hl-variable">p</span>)
  <span class="hl-site">run</span>(<span class="hl-variable">source</span>, [<span class="hl-variable">source</span>])
  <span class="hl-combinator">;</span> <span class="hl-site">reverse</span>(<span class="hl-site">cell</span>(<span class="hl-variable">sink</span>).<span class="hl-site">read</span>())

<span class="hl-comment">-- A small test graph</span>
<span class="hl-keyword">val</span> <span class="hl-variable">source</span> <span class="hl-operator">=</span> <span class="hl-literal">0</span>
<span class="hl-keyword">val</span> <span class="hl-variable">sink</span> <span class="hl-operator">=</span> <span class="hl-literal">3</span>

<span class="hl-keyword">def</span> <span class="hl-site">mkcell</span>() <span class="hl-operator">=</span> <span class="hl-site">Cell</span>[<span class="hl-site">List</span>[<span class="hl-variable">Node</span>]]()

<span class="hl-keyword">val</span> <span class="hl-variable">cell0</span> <span class="hl-operator">=</span> <span class="hl-site">mkcell</span>()
<span class="hl-keyword">val</span> <span class="hl-variable">cell1</span> <span class="hl-operator">=</span> <span class="hl-site">mkcell</span>()
<span class="hl-keyword">val</span> <span class="hl-variable">cell2</span> <span class="hl-operator">=</span> <span class="hl-site">mkcell</span>()
<span class="hl-keyword">val</span> <span class="hl-variable">cell3</span> <span class="hl-operator">=</span> <span class="hl-site">mkcell</span>()

<span class="hl-keyword">def</span> <span class="hl-site">cell</span>(<span class="hl-variable">Node</span>) <span class="hl-operator">:</span><span class="hl-operator">:</span> <span class="hl-site">Cell</span>[<span class="hl-site">List</span>[<span class="hl-variable">Node</span>]]
<span class="hl-keyword">def</span> <span class="hl-site">cell</span>(<span class="hl-literal">0</span>) <span class="hl-operator">=</span> <span class="hl-variable">cell0</span>
<span class="hl-keyword">def</span> <span class="hl-site">cell</span>(<span class="hl-literal">1</span>) <span class="hl-operator">=</span> <span class="hl-variable">cell1</span>
<span class="hl-keyword">def</span> <span class="hl-site">cell</span>(<span class="hl-literal">2</span>) <span class="hl-operator">=</span> <span class="hl-variable">cell2</span>
<span class="hl-keyword">def</span> <span class="hl-site">cell</span>(<span class="hl-literal">3</span>) <span class="hl-operator">=</span> <span class="hl-variable">cell3</span>

<span class="hl-keyword">def</span> <span class="hl-site">succ</span>(<span class="hl-variable">Node</span>) <span class="hl-operator">:</span><span class="hl-operator">:</span> (<span class="hl-variable">Node</span>,<span class="hl-variable">Distance</span>)
<span class="hl-keyword">def</span> <span class="hl-site">succ</span>(<span class="hl-literal">0</span>) <span class="hl-operator">=</span> (<span class="hl-literal">1</span>,<span class="hl-literal">2</span>) <span class="hl-combinator">|</span> (<span class="hl-literal">2</span>,<span class="hl-literal">6</span>) <span class="hl-combinator">|</span> (<span class="hl-literal">3</span>,<span class="hl-literal">9</span>)
<span class="hl-keyword">def</span> <span class="hl-site">succ</span>(<span class="hl-literal">1</span>) <span class="hl-operator">=</span> (<span class="hl-literal">3</span>,<span class="hl-literal">7</span>)
<span class="hl-keyword">def</span> <span class="hl-site">succ</span>(<span class="hl-literal">2</span>) <span class="hl-operator">=</span> (<span class="hl-literal">3</span>,<span class="hl-literal">2</span>)
<span class="hl-keyword">def</span> <span class="hl-site">succ</span>(<span class="hl-literal">3</span>) <span class="hl-operator">=</span> <span class="hl-keyword">stop</span>

<span class="hl-site">path</span>(<span class="hl-variable">source</span>, <span class="hl-variable">sink</span>, <span class="hl-variable">cell</span>, <span class="hl-variable">succ</span>)
)

<span class="hl-comment">{-
OUTPUT:
[0, 2, 3]
-}</span>
</pre></div></div><noscript xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook"><p>"WARNING: This example requires Javascript to be rendered correctly. Please enable it in your browser."</p></noscript><script xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" type="text/javascript">
toggle(document.getElementById('ref.time.virtual.examples.shortestpath_link'), 'ref.time.virtual.examples.shortestpath_content');
</script></div><div class="section" title="7.2.6.&nbsp;Related Links"><div class="titlepage"><div><div><h3 class="title"><a name="ref.time.virtual.links"></a>7.2.6.&nbsp;Related Links</h3></div></div></div><div class="itemizedlist" title="Related Reference Topics"><p class="title"><b>Related Reference Topics</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="link" href="ref.stdlib.time.html" title="11.8.&nbsp;time: Real and virtual time.">Standard Library: Time</a></p></li><li class="listitem"><p><a class="link" href="ref.stdlib.time.html#ref.stdlib.time.Vclock"><code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vclock</span></code> site</a></p></li><li class="listitem"><p><a class="link" href="ref.stdlib.time.html#ref.stdlib.time.Vawait"><code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vawait</span></code> site</a></p></li><li class="listitem"><p><a class="link" href="ref.stdlib.time.html#ref.stdlib.time.Vtime"><code class="code"><span xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" class="hl-variable">Vtime</span></code> site</a></p></li></ul></div><div class="itemizedlist" title="Related Tutorial Sections"><p class="title"><b>Related Tutorial Sections</b></p><ul class="itemizedlist" type="disc"><li class="listitem"><p><a href="../userguide/userguide.html#ug.idioms.forkjoin" class="olink">Fork-join</a></p></li></ul></div></div></div><script xmlns:od="http://orc.csres.utexas.edu/OrcDocBook.xsd" xmlns:db="http://docbook.org/ns/docbook" type="text/javascript" src="/orchard/orc.js"></script></body></html>